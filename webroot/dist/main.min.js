"undefined"==typeof console&&(console={},console.log=function(e){"use strict"},console.error=console.debug=console.info=console.log),window.redirect=function(e){"use strict";document.location.replace(e)},define("jquery",[],function(){"use strict";return jQuery}),define("lib/bootstrapHelper",function(){}),define("lib/saito/underscore.extend",["underscore"],function(e){"use strict";e.mixin({chars:function(e){var t;return t=e.match(/(\uD83C[\uDF00-\uDFFF]|\uD83D[\uDC00-\uDFFF])/g)||[],e.length-t.length}})}),define("app/core",["marionette"],function(e){"use strict";return new e.Application({channelName:"app"})}),define("app/vent",["marionette","backbone.radio"],function(e,t){return new function(){this.vent=t.channel("app"),this.request=function(){var e=Array.prototype.slice.apply(arguments);return this.vent.request.apply(this.reqres,e)}}}),define("models/appSetting",["underscore","backbone"],function(e,t){"use strict";return t.Model.extend({})}),define("models/appStatus",["underscore","backbone","cakeRest","app/vent"],function(e,t,i,n){"use strict";var o=t.Model.extend({stream:null,initialize:function(t,i){this.settings=i.settings,this.methodToCakePhpUrl=e.clone(this.methodToCakePhpUrl),this.methodToCakePhpUrl.read="status/"},start:function(){this._setWebroot(this.settings.get("webroot")),this._poll()},_setWebroot:function(e){this.webroot=e+"status/"},_eventStream:function(){this.stream=new EventSource(this.webroot+this.methodToCakePhpUrl.read),this.stream.addEventListener("message",e.bind(function(e){var t=JSON.parse(e.data);this.set(t)},this),!1)},_poll:function(){var t,i,n,o,s,r;s=function(){void 0!==o&&clearTimeout(o)},t=function(){s(),r=1e4},n=function(){o=setTimeout(i,r)},i=e.bind(function(){n(),this.fetch({success:function(){(r=Math.floor(r*(1+r/4e4)))>9e4&&(r=9e4)},error:s})},this),this.listenTo(this,"change",function(){t(),n()}),i(),t(),n()}});return e.extend(o.prototype,i),o}),define("models/currentUser",["underscore","backbone"],function(e,t){"use strict";return t.Model.extend({isLoggedIn:function(){return this.get("id")>0}})}),define("models/app",["underscore","backbone","app/vent","models/appSetting","models/appStatus","models/currentUser"],function(e,t,i,n,o,s){"use strict";return new(t.Model.extend({eventBus:null,settings:null,status:null,currentUser:null,request:null,initialize:function(){this.eventBus=i.vent,this.settings=new n,this.status=new o({},{settings:this.settings}),this.currentUser=new s}}))}),define("modules/html5-notification/views/notification",["underscore","backbone","models/app"],function(e,t,i){"use strict";return t.View.extend({_hideAfter:10,_iconUrl:!1,initialize:function(e){this._iconUrl=e.iconUrl,this.listenTo(i.eventBus,"html5-notification",this.notification),i.commands.setHandler("app:html5-notification:activate",this._activate,this),i.vent.on("app:html5-notification:available",this._isEnabled,this)},notification:function(t){var n=!i.eventBus.request("isAppVisible");if(t=e.defaults(t,{icon:this._iconUrl,always:!1}),t.always||n){var o=new window.Notification(t.title,{icon:t.icon,body:t.message});navigator.userAgent.toLowerCase().indexOf("chrome")>-1&&setTimeout(function(){o.close()},1e3*this._hideAfter)}},_activate:function(){if("permission"in window.Notification&&"granted"!==window.Notification.permission)return void window.Notification.requestPermission();window.Notification.requestPermission()},_isEnabled:function(){return"Notification"in window}})}),define("modules/html5-notification/html5-notification",["app/core","marionette","modules/html5-notification/views/notification"],function(e,t,i){"use strict";return}),define("models/threadline",["underscore","backbone","models/app","cakeRest"],function(e,t,i,n){"use strict";var o=t.Model.extend({defaults:{isInlineOpened:!1,shouldScrollOnInlineOpen:!0,isAlwaysShownInline:!1,isNewToUser:!1,posting:"",html:""},initialize:function(){this.webroot=i.settings.get("webroot")+"entries/",this.methodToCakePhpUrl=e.clone(this.methodToCakePhpUrl),this.methodToCakePhpUrl.read="threadLine/",this.set("isAlwaysShownInline",i.currentUser.get("user_show_inline")||!1)}});return e.extend(o.prototype,n),o}),define("collections/threadlines",["underscore","backbone","models/threadline"],function(e,t,i){return t.Collection.extend({model:i})}),define("text!templates/threadline-spinner.html",[],function(){return'<div class="js-thread_inline thread_inline" style="display:none">\n\t<div class="js-btn-strip btn-strip btn-strip-top pointer">\n\t\t<i class="fa fa-close-widget"></i>\n\t</div>\n\t<div class="threadInline-slider">\n\t</div>\n</div>'}),define("views/postingActionBookmark",["jquery","underscore","marionette","models/app"],function(e,t,i,n){"use strict";return i.View.extend({tagName:"a",className:"btn-bookmark-add btn-icon panel-footer-form-btn",template:t.template('<i class="fa fa-lg"></i>'),events:{click:"_onClick"},modelEvents:{"change:isBookmarked":"_toggle"},initialize:function(){this._shouldRender()&&(this.$el.attr("href","#"),this.render())},_shouldRender:function(){return!!n.currentUser.isLoggedIn()},_onClick:function(e){e.preventDefault(),this.model.get("isBookmarked")?window.location=n.settings.get("webroot")+"bookmarks/index/#"+this.model.get("id"):this.model.set("isBookmarked",!0)},_toggle:function(){var t=this.$("i");this.model.get("isBookmarked")?(t.removeClass("fa-bookmark-o"),t.addClass("fa-bookmark"),this.$el.attr("title",e.i18n.__("Entry is bookmarked"))):(t.removeClass("fa-bookmark"),t.addClass("fa-bookmark-o"),this.$el.attr("title",e.i18n.__("Bookmark the entry")))},onRender:function(){this._toggle()}})}),define("text!templates/postingActionDelete.html",[],function(){return'<div class="panel">\n    <div class="panel-content">\n        <p>\n            <%- $.i18n.__(\'delete_tree_link_confirm_message\') %>\n        </p>\n    </div>\n    <div class="panel-footer panel-form">\n        <button class="btn btn-submit js-abort"><%- $.i18n.__(\'Abort\') %></button>\n        &nbsp;\n        <button class="btn btnLink js-delete"><%- $.i18n.__(\'Delete\') %></button>\n    </div>\n</div>\n'}),define("views/postingActionDelete",["jquery","underscore","marionette","models/app","text!templates/postingActionDelete.html"],function(e,t,i,n,o){"use strict";return i.View.extend({ui:{abort:".js-abort",submit:".js-delete"},events:{"click @ui.abort":"_onAbort","click @ui.submit":"_onSubmit"},template:t.template(o),_onAbort:function(e){e.preventDefault(),this.$el.dialog("close"),this.close()},_onSubmit:function(e){var t,i;e.preventDefault(),t=this.model.get("id"),i=n.settings.get("webroot")+"/entries/delete/"+t,window.location=i},onBeforeClose:function(){this.$el.dialog("destroy")},onRender:function(){this.$el.dialog({modal:!0,position:["center",120],resizable:!1,title:e.i18n.__("Delete")})}})}),define("views/postingActionSolves",["jquery","marionette","models/app"],function(e,t,i){"use strict";return t.View.extend({tagName:"a",className:"btn-solves btn-icon panel-footer-form-btn",template:_.template('<i class="fa fa-badge-solves-o fa-lg"></i>'),events:{click:"_onClick"},modelEvents:{"change:isSolves":"_toggle"},initialize:function(){this._shouldRender()&&(this.$el.attr({href:"#",title:e.i18n.__("Mark entry as helpful")}),this.render())},_shouldRender:function(){return!!i.currentUser.isLoggedIn()&&(!this.model.isRoot()&&this.model.get("rootEntryUserId")===i.currentUser.get("id"))},_onClick:function(e){e.preventDefault(),this.model.toggle("isSolves")},_toggle:function(){var t=this.$("i"),i=this.model.get("isSolves"),n="";i?(t.addClass("solves-isSolved"),t.removeClass("fa-badge-solves-o"),t.addClass("fa-badge-solves"),n=this.$el.html(),n=e(n).removeClass("fa-lg")):(t.removeClass("fa-badge-solves"),t.addClass("fa-badge-solves-o"),t.removeClass("solves-isSolved")),this._toggleGlobal(n)},_toggleGlobal:function(t){e(".solves."+this.model.get("id")).html(t)},onRender:function(){this._toggle()}})}),define("views/editCountdown",["jquery","underscore","marionette","moment","jqueryTinyTimer"],function(e,t,i,n){"use strict";return i.View.extend({_editEnd:null,_buttonText:null,_$countdownDummy:null,_doneAction:"remove",initialize:function(t){this._editEnd=n(this.model.get("time")).unix()+60*t.editPeriod,n().unix()>this._editEnd||(t.done&&(this._doneAction=t.done),this._buttonText=this.$el.html(),this._$countdownDummy=e('<span style="display: none;"></span>'),this.$el.append(this._$countdownDummy),this._start())},_setButtonText:function(e){this.$el.text(this._buttonText+" "+e)},_onTick:function(e){e.m>1||1===e.m&&e.s>30?(e.m=e.m+1,this._setButtonText("("+e.m+" min)")):1===e.m?this._setButtonText("("+e.m+" min "+e.s+" s)"):this._setButtonText("("+e.s+" s)")},_onEnd:function(){switch(this._doneAction){case"disable":this._disable();break;default:this._remove()}},_remove:function(){this.remove()},_disable:function(){this.$el.attr("disabled","disabled")},_start:function(){this._$countdownDummy.tinyTimer({to:n.unix(this._editEnd).toDate(),format:"",onTick:t.bind(this._onTick,this),onEnd:t.bind(this._onEnd,this)})}})}),define("views/postingAction",["jquery","underscore","marionette","models/app","views/postingActionBookmark","views/postingActionDelete","views/postingActionSolves","views/editCountdown"],function(e,t,i,n,o,s,r,a){"use strict";return i.View.extend({ui:{btnDelete:".js-delete",btnFixed:".btn-toggle-fixed",btnLocked:".btn-toggle-locked",titleFixed:".title-toggle-fixed",titleLocked:".title-toggle-locked"},events:{"click @ui.btnDelete":"onBtnDelete","click .js-btn-setAnsweringForm":"onBtnAnswer","click @ui.btnFixed":"onToggleFixed","click @ui.btnLocked":"onToggleLocked"},_jsButtons:[o,r],initialize:function(){this._initFormElements(),this.listenTo(this.model,"change:isAnsweringFormShown",this._toggleAnsweringForm)},_initFormElements:function(){t.each(this._jsButtons,function(e){this.$el.append(new e({model:this.model}).$el)},this);var e=this.$(".js-btn-edit");if(e.length>0){new a({el:e,model:this.model,editPeriod:n.settings.get("editPeriod")})}},onBtnAnswer:function(e){e.preventDefault(),this.model.set("isAnsweringFormShown",!0)},onBtnDelete:function(e){new s({model:this.model}).render();e.preventDefault()},onToggleFixed:function(e){e.preventDefault(),this._sendToggle("fixed")},onToggleLocked:function(e){e.preventDefault(),this._sendToggle("locked")},_sendToggle:function(i){var o=this.model.get("id"),s=this.$(this.ui["title"+t.startCase(i)]),r=n.settings.get("webroot")+"/entries/ajaxToggle/"+o+"/"+i;e.ajax({url:r,buffer:!1}).done(function(e){s.html(e.html)})},_toggleAnsweringForm:function(){this.model.get("isAnsweringFormShown")?this.$el.slideUp("fast"):this.$el.slideDown("fast")}})}),define("models/geshi",["underscore","backbone"],function(e,t){"use strict";return t.Model.extend({defaults:{isPlaintext:!1}})}),define("collections/geshis",["underscore","backbone","models/geshi"],function(e,t,i){return t.Collection.extend({model:i})}),define("views/geshi",["jquery","underscore","backbone","models/geshi"],function(e,t,i,n){"use strict";return i.View.extend({plainText:!1,htmlText:!1,events:{"click .geshi-plain-text":"_togglePlaintext"},initialize:function(){this.model=new n,this.collection.push(this.model),this.block=this.$(".geshi-plain-text").next(),this._setPlaintextButton(),this.listenTo(this.model,"change",this.render)},_setPlaintextButton:function(e){var t;e&&e.preventDefault(),t=this.model.get("isPlaintext")?"fa-list-ol":"fa-align-justify",this.$(".geshi-plain-text").html("<i class='fa "+t+"'></i>")},_togglePlaintext:function(e){e.preventDefault(),this.model.set("isPlaintext",!this.model.get("isPlaintext"))},_extractPlaintext:function(){!1===this.plainText&&(this.htmlText=this.block.html(),"Microsoft Internet Explorer"===navigator.appName?(this.htmlText=this.htmlText.replace(/\n\r/g,"+"),this.plainText=e(this.htmlText).text().replace(/\+\+/g,"\r")):this.plainText=this.block.text().replace(/code /g,"code \n"))},_renderText:function(){this.model.get("isPlaintext")?this.block.text(this.plainText).wrapInner('<pre class="code"></pre>'):this.block.html(this.htmlText)},render:function(){return this._setPlaintextButton(),this._extractPlaintext(),this._renderText(),this}})}),define("views/postingContent",["jquery","underscore","marionette","collections/geshis","views/geshi"],function(e,t,i,n,o){"use strict";return i.View.extend({initialize:function(){this.listenTo(this.model,"change:isAnsweringFormShown",this._toggleAnsweringForm),this.listenTo(this.model,"change:html",this.render),this._initGeshi(".geshi-wrapper")},_toggleAnsweringForm:function(){this.model.get("isAnsweringFormShown")?this._hideSignature():this._showSignature()},_showSignature:function(){this.$(".postingBody-signature").slideDown("fast")},_hideSignature:function(){this.$(".postingBody-signature").slideUp("fast")},_initGeshi:function(e){var t=this.$(e);if(t.length>0){var i=new n;t.each(function(e,t){new o({el:t,collection:i})})}},render:function(){return this.$el.html(this.model.get("html")),this._initGeshi(".geshi-wrapper"),this}})}),define("models/upload",["underscore","backbone","models/app","cakeRest"],function(e,t,i,n){"use strict";var o=t.Model.extend({initialize:function(){this.webroot=i.settings.get("webroot")+"uploads/"}});return e.extend(o.prototype,n),o}),define("collections/uploads",["underscore","backbone","models/upload"],function(e,t,i){return t.Collection.extend({model:i,initialize:function(e){this.url=e.url+"uploads/index/"}})}),define("text!templates/upload.html",[],function(){return'<div class="panel-content upload_box_header">\n    <%= linkImage %>\n</div>\n<div class="panel-footer panel-form upload_box_footer">\n    <button class="btn btn-submit">\n        <%- $.i18n.__(\'upload_btn_insert_into_posting\') %>\n    </button>\n    <div class="upload_box_delete">\n        <%= linkDelete %>\n    </div>\n</div>\n'}),function(e,t){"use strict";"function"==typeof define&&define.amd?define("lib/saito/jquery.insertAtCaret",["jquery"],function(e){return t(e)}):t(jQuery)}(0,function(e){"use strict";e.fn.insertAtCaret=function(e){var t,i=this[0],n=0,o=i.selectionStart||"0"===i.selectionStart?"standard":!!document.selection&&"ie";"ie"===o?(i.focus(),t=document.selection.createRange(),t.moveStart("character",-i.value.length),n=t.text.length):"standard"===o&&(n=i.selectionStart);var s=i.value.substring(0,n),r=i.value.substring(n,i.value.length);return i.value=s+e+r,n+=e.length,"ie"===o?(i.focus(),t=document.selection.createRange(),t.moveStart("character",-i.value.length),t.moveStart("character",n),t.moveEnd("character",0),t.select()):"standard"===o&&(i.selectionStart=n,i.selectionEnd=n,i.focus()),this}}),define("views/upload",["jquery","underscore","backbone","models/app","text!templates/upload.html","lib/saito/jquery.insertAtCaret"],function(e,t,i,n,o){"use strict";return i.View.extend({className:"panel-content upload_box current",events:{"click .upload_box_delete":"_removeUpload","click .btn-submit":"_insert"},initialize:function(e){this.textarea=e.textarea,this.listenTo(this.model,"destroy",this._uploadRemoved)},_removeUpload:function(e){e.preventDefault(),this.model.destroy({success:t.bind(function(e,t){n.eventBus.trigger("notification",t)},this)})},_uploadRemoved:function(){this.remove()},_insert:function(t){t.preventDefault(),e(this.textarea).insertAtCaret("[upload]"+this.model.get("name")+"[/upload]")},render:function(){return this.$el.html(t.template(o,this.model.toJSON())),this}})}),function(e){function t(){}var i={fallback_id:"",fallback_dropzoneClick:!0,url:"",refresh:1e3,paramname:"userfile",requestType:"POST",allowedfileextensions:[],allowedfiletypes:[],maxfiles:25,maxfilesize:1,queuefiles:0,queuewait:200,data:{},headers:{},drop:t,dragStart:t,dragEnter:t,dragOver:t,dragLeave:t,docEnter:t,docOver:t,docLeave:t,beforeEach:t,afterAll:t,rename:t,error:function(e,t,i,n){alert(e)},uploadStarted:t,uploadFinished:t,progressUpdated:t,globalProgressUpdated:t,speedUpdated:t},n=["BrowserNotSupported","TooManyFiles","FileTooLarge","FileTypeNotAllowed","NotFound","NotReadable","AbortError","ReadError","FileExtensionNotAllowed"];e.fn.filedrop=function(t){function o(e){if(!1===x.drop.call(this,e))return!1;if(e.originalEvent.dataTransfer)return null===(y=e.originalEvent.dataTransfer.files)||void 0===y||0===y.length?(x.error(n[0]),!1):(C=y.length,l(),e.preventDefault(),!1)}function s(t,i,n,o){var s="\r\n",r="",a=x.paramname;if(x.data){var l=e.param(x.data).replace(/\+/g,"%20").split(/&/);e.each(l,function(){var e=this.split("=",2),t=decodeURIComponent(e[0]),i=decodeURIComponent(e[1]);2===e.length&&(r+="--",r+=o,r+=s,r+='Content-Disposition: form-data; name="'+t+'"',r+=s,r+=s,r+=i,r+=s)})}return jQuery.isFunction(a)&&(a=a(t)),r+="--",r+=o,r+=s,r+='Content-Disposition: form-data; name="'+(a||"")+'"',r+='; filename="'+encodeURIComponent(t)+'"',r+=s,r+="Content-Type: "+n,r+=s,r+=s,r+=i,r+=s,r+="--",r+=o,r+="--",r+=s}function r(e){if(e.lengthComputable){var t=Math.round(100*e.loaded/e.total);if(this.currentProgress!==t){this.currentProgress=t,x.progressUpdated(this.index,this.file,this.currentProgress),k[this.global_progress_index]=this.currentProgress,a();var i=(new Date).getTime(),n=i-this.currentStart;if(n>=x.refresh){var o=e.loaded-this.startData,s=o/n;x.speedUpdated(this.index,this.file,s),this.startData=e.loaded,this.currentStart=i}}}}function a(){if(0!==k.length){var e,t=0;for(e in k)k.hasOwnProperty(e)&&(t+=k[e]);x.globalProgressUpdated(Math.round(t/k.length))}}function l(){if(T=!1,!y)return x.error(n[0]),!1;if(x.allowedfiletypes.push&&x.allowedfiletypes.length)for(var t=y.length;t--;)if(!y[t].type||e.inArray(y[t].type,x.allowedfiletypes)<0)return x.error(n[3],y[t]),!1;if(x.allowedfileextensions.push&&x.allowedfileextensions.length)for(var t=y.length;t--;){var i=!1;for(g=0;g<x.allowedfileextensions.length;g++)y[t].name.substr(y[t].name.length-x.allowedfileextensions[g].length).toLowerCase()==x.allowedfileextensions[g].toLowerCase()&&(i=!0);if(!i)return x.error(n[8],y[t]),!1}var o=0,l=0;if(C>x.maxfiles&&0===x.queuefiles)return x.error(n[1]),!1;for(var f=[],p=[],m=[],g=0;g<C;g++)f.push(g);var v=function(e){setTimeout(_,e)},_=function(){var e;if(T)return!1;if(x.queuefiles>0&&p.length>=x.queuefiles)return v(x.queuewait);e=f[0],f.splice(0,1),p.push(e);try{if(!1!==u(y[e])){if(e===C)return;var t=new FileReader,i=1048576*x.maxfilesize;if(t.index=e,y[e].size>i)return x.error(n[2],y[e],e),p.forEach(function(t,i){t===e&&p.splice(i,1)}),l++,!0;t.onerror=function(e){switch(e.target.error.code){case e.target.error.NOT_FOUND_ERR:return x.error(n[4]),!1;case e.target.error.NOT_READABLE_ERR:return x.error(n[5]),!1;case e.target.error.ABORT_ERR:return x.error(n[6]),!1;default:return x.error(n[7]),!1}},t.onloadend=x.beforeSend?function(t){x.beforeSend(y[e],e,function(){b(t)})}:b,t.readAsDataURL(y[e])}else l++}catch(t){return p.forEach(function(t,i){t===e&&p.splice(i,1)}),x.error(n[0]),!1}f.length>0&&_()},b=function(t){var i=(t.srcElement||t.target).index;void 0===t.target.index&&(t.target.index=d(t.total));var n,u=new XMLHttpRequest,f=u.upload,g=y[t.target.index],v=t.target.index,_=(new Date).getTime(),b="------multipartformboundary"+(new Date).getTime(),w=k.length,S=c(g.name),A=g.type;x.withCredentials&&(u.withCredentials=x.withCredentials);var D=t.target.result.split(",")[1],$=void 0===D?"":atob(D);n="string"==typeof S?s(S,$,A,b):s(g.name,$,A,b),f.index=v,f.file=g,f.downloadStartTime=_,f.currentStart=_,f.currentProgress=0,f.global_progress_index=w,f.startData=0,f.addEventListener("progress",r,!1),jQuery.isFunction(x.url)?u.open(x.requestType,x.url(f),!0):u.open(x.requestType,x.url,!0),u.setRequestHeader("content-type","multipart/form-data; boundary="+b),u.setRequestHeader("X-Requested-With","XMLHttpRequest"),e.each(x.headers,function(e,t){u.setRequestHeader(e,t)}),u.sendAsBinary||(u.sendAsBinary=function(e){function t(e){return 255&e.charCodeAt(0)}var i=Array.prototype.map.call(e,t),n=new Uint8Array(i);this.send(n.buffer)}),u.sendAsBinary(n),k[w]=0,a(),x.uploadStarted(v,g,C),u.onload=function(){var e=null;if(u.responseText)try{e=jQuery.parseJSON(u.responseText)}catch(t){e=u.responseText}var t=(new Date).getTime(),n=t-_,s=x.uploadFinished(v,g,e,n,u);o++,p.forEach(function(e,t){e===i&&p.splice(t,1)}),m.push(i),k[w]=100,a(),o===C-l&&h(),!1===s&&(T=!0),(u.status<200||u.status>299)&&x.error(u.statusText,g,i,u.status)}};_()}function d(e){for(var t=0;t<C;t++)if(y[t].size===e)return t}function c(e){return x.rename(e)}function u(e){return x.beforeEach(e)}function h(){return x.afterAll()}function f(e){clearTimeout(w),e.preventDefault(),x.dragEnter.call(this,e)}function p(e){clearTimeout(w),e.preventDefault(),x.docOver.call(this,e),x.dragOver.call(this,e)}function m(e){clearTimeout(w),x.dragLeave.call(this,e),e.stopPropagation()}function g(e){return e.preventDefault(),x.docLeave.call(this,e),!1}function v(e){return clearTimeout(w),e.preventDefault(),x.docEnter.call(this,e),!1}function _(e){return clearTimeout(w),e.preventDefault(),x.docOver.call(this,e),!1}function b(e){w=setTimeout(function(t){return function(){x.docLeave.call(t,e)}}(this),200)}var w,y,x=e.extend({},i,t),k=[],T=!1,C=0;if(!0===x.fallback_dropzoneClick&&e("#"+x.fallback_id).css({display:"none",width:0,height:0}),this.on("drop",o).on("dragstart",x.dragStart).on("dragenter",f).on("dragover",p).on("dragleave",m),e(document).on("drop",g).on("dragenter",v).on("dragover",_).on("dragleave",b),!0===x.fallback_dropzoneClick){if(this.find("#"+x.fallback_id).length>0)throw"Fallback element ["+x.fallback_id+"] cannot be inside dropzone, unless option fallback_dropzoneClick is false";this.on("click",function(t){e("#"+x.fallback_id).trigger(t)})}return e("#"+x.fallback_id).change(function(e){x.drop(e),y=e.target.files,C=y.length,l()}),this};try{if(XMLHttpRequest.prototype.sendAsBinary)return;XMLHttpRequest.prototype.sendAsBinary=function(e){function t(e){return 255&e.charCodeAt(0)}var i=Array.prototype.map.call(e,t),n=new Uint8Array(i);"ArrayBufferView"in window?this.send(n):this.send(n.buffer)}}catch(e){}}(jQuery),define("views/../../dev/node_modules/jquery-filedrop/jquery.filedrop",function(){}),define("text!templates/uploadNew.html",[],function(){return'<form action="<%= url %>" method="post" class="dropbox" target="uploadIFrame"\n      enctype="multipart/form-data">\n    <div class="panel-content upload_box_header">\n        <div class="upload-layer">\n        </div>\n        <div class="upload-drag-indicator">\n            <i class="icon-upload"></i>\n        </div>\n        <h2> <%- $.i18n.__(\'upload_new_title\') %></h2>\n        <p>\n            <%- $.i18n.__(\'upload_info\', {size: upload_size}) %>\n        </p>\n    </div>\n    <div class="panel-footer panel-form upload_box_footer">\n        <div style="position: relative;">\n            <%\n            // To present a nice upload button we generate a dead button.\n            // Beneath the nice dummy button is the actual input file upload,\n            // but it\'s hidden behind the opacity:0 curtain div.\n            // z-index: 2000 to have the button above the jQuery UI modal.\n            %>\n            <button class="btn btn-submit" type="button">\n                <%- $.i18n.__("upload_btn") %>\n            </button>\n            <div style="position: absolute; z-index: 2000; top:0; right: 0; width: 100%; height: 100%; opacity: 0; cursor: pointer; overflow: hidden; " >\n                <input id="Upload0File"\n                       class="btn btn-submit"\n                       type="file" name="data[Upload][0][file]"\n                       style="width: 150px; height: 100%">\n            </div>\n        </div>\n    </div>\n</form>\n<iframe id="uploadIFrame" name="uploadIFrame" src="about:blank" style="display: none;">\n    <html><head></head><body></body></html>\n</iframe>\n'}),define("text!templates/spinner.html",[],function(){return'<div class="spinner">\n    <div class="rect1"></div>\n    <div class="rect2"></div>\n    <div class="rect3"></div>\n    <div class="rect4"></div>\n    <div class="rect5"></div>\n</div>'}),define("views/uploadNew",["jquery","underscore","backbone","../../dev/node_modules/jquery-filedrop/jquery.filedrop","models/app","text!templates/uploadNew.html","text!templates/spinner.html","humanize"],function(e,t,i,n,o,s,r,a){"use strict";return i.View.extend({className:"panel upload_box upload-new",wasChild:"unset",events:{"change #Upload0File":"_uploadManual"},initialize:function(e){this.uploadUrl=o.settings.get("webroot")+"uploads/add",this.collection=e.collection},_initDropUploader:function(){this._browserSupportsDragAndDrop()&&window.FileReader?this.$(".upload-layer").filedrop({maxfiles:1,maxfilesize:o.settings.get("upload_max_img_size")/1024,url:this.uploadUrl,paramname:"data[Upload][0][file]",allowedfiletypes:["image/jpeg","image/jpg","image/png","image/gif"],dragOver:t.bind(function(){this._showDragIndicator()},this),dragLeave:t.bind(function(){this._hideDragIndicator()},this),uploadFinished:t.bind(function(e,t,i,n){this._postUpload(i)},this),beforeSend:t.bind(function(e,t,i){this._hideDragIndicator(),this._setUploadSpinner(),i()},this),error:t.bind(function(t,i){var n;switch(this._hideDragIndicator(),t){case"FileTypeNotAllowed":n=e.i18n.__("upload_fileTypeNotAllowed");break;case"FileTooLarge":n=e.i18n.__("upload_fileToLarge",{name:i.name});break;case"BrowserNotSupported":n=e.i18n.__("upload_browserNotSupported");break;case"TooManyFiles":n=e.i18n.__("upload_toManyFiles");break;default:n=t}o.eventBus.trigger("notification",{title:"Error",message:n,type:"error"})},this)}):this.$("h2").html(e.i18n.__("Upload"))},_browserSupportsDragAndDrop:function(){var e=this.$(".upload-layer")[0];return"draggable"in e||"ondragstart"in e&&"ondrop"in e},_showDragIndicator:function(){this.$(".upload-drag-indicator").fadeIn()},_hideDragIndicator:function(){this.$(".upload-drag-indicator").fadeOut()},_setUploadSpinner:function(){this.$(".upload_box_header").html(r)},_uploadManual:function(e){var t,i,n=!0;e.preventDefault();try{t=new FormData,i=this.$("#Upload0File")[0],t.append(i.name,i.files[0])}catch(e){n=!1}this._setUploadSpinner(),n?this._uploadAjax(t):this._uploadIFrame()},_uploadIFrame:function(){var e=this.$("form"),i=this.$("#uploadIFrame");i.load(t.bind(function(){this._postUpload(i.contents().find("body").html()),i.off("load")},this)),e.submit()},_uploadAjax:function(e){var i=new XMLHttpRequest;i.open("POST",this.uploadUrl),i.onloadend=t.bind(function(e){this._postUpload(e.target.response)},this),i.onerror=this._onUploadError,i.send(e)},_onUploadError:function(){o.eventBus.trigger("notification",{type:"error",message:e.i18n.__("upload_genericError")})},_postUpload:function(e){if(t.isString(e))try{e=JSON.parse(e)}catch(e){this._onUploadError()}o.eventBus.trigger("notification",e),this.collection.fetch({reset:!0}),this.render()},render:function(){return this.$el.html(t.template(s)({url:this.uploadUrl,upload_size:a.filesize(o.settings.get("upload_max_img_size"))})),this._initDropUploader(),this}})}),define("text!templates/uploads.html",[],function(){return'<div id="upload_index" class="upload index">\n    <div class="content">\n    </div>\n</div>\n'}),define("views/uploads",["jquery","underscore","backbone","models/app","collections/uploads","views/upload","views/uploadNew","text!templates/uploads.html"],function(e,t,i,n,o,s,r,a){return i.View.extend({events:{"click .current .btn-submit":"_closeDialog"},initialize:function(e){this.textarea=e.textarea,this.collection=new o({url:n.settings.get("webroot")}),this.listenTo(this.collection,"reset",this._addAll),this.$(".body").html(t.template(a)),this.uploadNewView=new r({collection:this.collection}),this.$(".content").append(this.uploadNewView.el),this.render(),this.collection.fetch({reset:!0})},_addOne:function(e){var t=new s({model:e,textarea:this.textarea});this.$(".upload-new").after(t.render().el)},_addAll:function(){this._removeAll(),this.collection.each(this._addOne,this)},_removeAll:function(){this.$(".upload_box.current").remove()},_setDialogSize:function(){this.$el.dialog("option","width",window.innerWidth-80),this.$el.dialog("option","height",window.innerHeight-80)},_closeDialog:function(){this.$el.dialog("close")},render:function(){return this.uploadNewView.render(),this.$el.dialog({title:e.i18n.__("Upload"),modal:!0,draggable:!1,resizable:!1,hide:"fade"}),this._setDialogSize(),e(window).resize(t.bind(function(){this._setDialogSize()},this)),window.onorientationchange=t.bind(function(){this._setDialogSize()},this),this}})}),define("lib/saito/markItUp.media",["jquery","underscore"],function(e,t){"use strict";var i={_preFilters:{dropbox:{cleanUp:function(e){return e.replace(/https:\/\/www\.dropbox\.com\//,"https://dl.dropbox.com/")}},youtube:{cleanUp:function(e){var t,i,n=e;if(!1===/http/.test(e)&&(n="http://"+e),t=/(http|https):\/\/(\w+:?\w*@)?(\S+)(:[0-9]+)?(\/|\/([\w#!:.?+=&%@!\-\/]))?/i,!t.test(n))return e;switch(n.match(/(https?:\/\/)?(www\.)?(.[^\/:]+)/i).pop()){case"youtu.be":t=/youtu.be\/(.*?)(&.*)?$/,t.test(n)&&(i=n.match(t)[1]);break;case"youtube.com":t=/v=(.*?)(&.*)?$/,t.test(n)&&(i=n.match(t)[1])}return void 0!==i&&(e=this._createIframe({src:"//www.youtube.com/embed/"+i})),e},_createIframe:function(e){var i,n,o;return i={width:560,height:315,frameborder:0,allowfullscreen:"allowfullscreen"},t.defaults(e,i),o=function(e,t,i){return e+i+'="'+t+'" '},n=t.reduce(e,o,""),"<iframe "+(n=n.trim())+"></iframe>"}}},multimedia:function(n,o){var s=e.trim(n),r=new RegExp("\\.(png|gif|jpg|jpeg|webp)([\\/?]|$)","i"),a=new RegExp("\\.(mp4|webm|m4v)([\\/?]|$)","i"),l=new RegExp("\\.(m4a|ogg|mp3|wav|opus)([\\/?]|$)","i"),d=/<object/i,c=/<iframe/i,u="";return o=o||{},t.defaults(o,{embedlyEnabled:!1}),t.each(this._preFilters,function(e){s=e.cleanUp(s)}),r.test(s)?u=i._image(s):a.test(s)?u=i._videoHtml5(s):l.test(s)?u=i._audioHtml5(s):c.test(s)?u=i._videoIframe(s):d.test(s)&&(u=i._videoFlash(s)),!0===o.embedlyEnabled&&""===u&&(u=i._embedly(s)),u},_image:function(e){return"[img]"+e+"[/img]"},_videoFlash:function(e){var t="[flash_video]URL|WIDTH|HEIGHT[/flash_video]";return null!==e?(t=t.replace("WIDTH",/width="(\d+)"/.exec(e)[1]),t=t.replace("HEIGHT",/height="(\d+)"/.exec(e)[1]),t=t.replace("URL",/src="([^"]+)"/.exec(e)[1])):""},_videoHtml5:function(e){return"[video]"+e+"[/video]"},_audioHtml5:function(e){return"[audio]"+e+"[/audio]"},_videoIframe:function(e){var t=/<iframe(.*?)>.*?<\/iframe>/i.exec(e)[1];return"[iframe"+(t=t.replace(/["']/g,""))+"][/iframe]"},_embedly:function(e){return"[embed]"+e+"[/embed]"}};return i}),define("text!templates/mediaInsert.html",[],function(){return'<div class="panel">\n    <div class="panel-content panel-form">\n        <form action="#" style="width: 100%;">\n            <label for="markitup_media_txta">\n                <%- $.i18n.__(\'Enter link to media or embedding code:\') %>\n            </label>\n            <textarea name="data[media]" id="markitup_media_txta" rows="6"\n                      columns="20"></textarea>\n            <input class="btn btn-submit" id="markitup_media_btn" type="submit"\n                   value="<%- $.i18n.__(\'Insert\') %>">\n\n            <div id="markitup_media_message" class="flash error"\n                 style="display: none;">\n                <%- $.i18n.__(\'Nothing recognized.\') %>\n            </div>\n        </form>\n    </div>\n</div>\n'}),define("views/mediaInsert",["jquery","underscore","backbone","models/app","lib/saito/markItUp.media","text!templates/mediaInsert.html"],function(e,t,i,n,o,s){"use strict";return i.View.extend({template:t.template(s),events:{"click #markitup_media_btn":"_insert"},initialize:function(){void 0!==this.model&&null!==this.model&&this.listenTo(this.model,"change:isAnsweringFormShown",this.remove)},_insert:function(t){var i,s;t.preventDefault(),s=o,i=s.multimedia(this.$("#markitup_media_txta").val(),{embedlyEnabled:!0===n.settings.get("embedly_enabled")}),""===i?this._invalidInput():(e.markItUp({replaceWith:i}),this._closeDialog())},_hideErrorMessages:function(){this.$("#markitup_media_message").hide()},
_invalidInput:function(){this.$("#markitup_media_message").show(),this.$el.dialog().parent().effect("shake",{times:2},250)},_closeDialog:function(){this.$el.dialog("close"),this._hideErrorMessages(),this.$("#markitup_media_txta").val("")},_showDialog:function(){this.$el.dialog({hide:{effect:"fade",duration:200},title:e.i18n.__("Multimedia"),minWidth:346,position:{at:"left+50% top+40%"},resizable:!1,open:function(){setTimeout(function(){e("#markitup_media_txta").focus()},210)},close:t.bind(function(){this._hideErrorMessages()},this)})},render:function(){return this.$el.html(this.template),this._showDialog(),this}})}),define("models/preview",["underscore","backbone","models/app"],function(e,t,i){"use strict";return t.Model.extend({defaults:{isFetchingData:!1,rendered:null,data:null},initialize:function(){this.webroot=i.settings.get("webroot"),this.listenTo(this,"change:data",this._fetchRendered)},_fetchRendered:function(){this.set("fetchingData",!0),$.post(this.webroot+"entries/preview/",this.get("data"),e.bind(function(e){this.set("fetchingData",!1),this.set("rendered",e.html),i.eventBus.trigger("notificationUnset","all"),i.eventBus.trigger("notification",e)},this),"json")}})}),define("views/preview",["jquery","underscore","marionette","text!templates/spinner.html"],function(e,t,i,n){"use strict";return i.View.extend({templates:{content:t.template("<%= rendered %>"),spinner:t.template(n)},modelEvents:{"change:fetchingData":"_fetchingData","change:rendered":"render"},_fetchingData:function(){this.model.get("fetchingData")&&this.render()},getTemplate:function(){return this.model.get("fetchingData")?this.templates.spinner:this.templates.content}})}),function(e){"use strict";var t={_scrollToTop:function(t){e("body").animate({scrollTop:t.offset().top-10,easing:"swing"},300)},_scrollToBottom:function(i){e("body").animate({scrollTop:t._elementBottom(i)-e(window).height()+20,easing:"swing"},300,function(){t._isHeigherThanView(i)&&t._scrollToTop(i)})},_elementBottom:function(e){return e.offset().top+e.height()},_isScrolledIntoView:function(i){if(0===e(i).length)return!0;var n=e(window).scrollTop(),o=n+e(window).height(),s=e(i).offset().top;return t._elementBottom(i)<=o&&s>=n},_isHeigherThanView:function(t){return e(window).height()<=t.height()}},i={top:function(){var i;return i=e(this),t._isScrolledIntoView(i)||t._scrollToTop(i),this},bottom:function(){var i;return i=e(this),t._isScrolledIntoView(i)||t._scrollToBottom(i),this},isInView:function(){var i;return i=e(this),t._isScrolledIntoView(i)}};e.fn.scrollIntoView=function(t){return i[t]?i[t].apply(this,Array.prototype.slice.call(arguments,1)):"object"!=typeof t&&t?void e.error("Method "+t+" does not exist on jQuery.scrollIntoView"):i.init.apply(this,arguments)}}(jQuery),define("lib/saito/jquery.scrollIntoView",function(){}),define("views/answering",["jquery","underscore","backbone","models/app","views/uploads","views/mediaInsert","views/editCountdown","models/preview","views/preview","lib/saito/jquery.scrollIntoView","jqueryAutosize"],function(e,t,i,n,o,s,r,a,l){"use strict";return i.View.extend({_requestUrl:null,rendered:!1,answeringForm:!1,preview:!1,mediaView:!1,sendInProgress:!1,_action:null,model:null,events:{"click .btn-previewClose":"_closePreview","click .btn-preview":"_showPreview","click .btn-markItUp-Upload":"_upload","click .btn-markItUp-Media":"_media","click .btn-submit":"_send","click .btn-cite":"_cite","keypress .js-subject":"_onKeyPressSubject","input .js-subject":"_updateSubjectCharCount"},initialize:function(e){t.defaults(e,{ajax:!0,parentThreadline:null}),this.options=e,!1===this.options.ajax&&this._onFormReady(),this._requestUrl=n.settings.get("webroot")+"entries/add/"+this.model.get("id"),this.listenTo(n.eventBus,"isAppVisible",this._focusSubject)},_disable:function(){this.$(".btn.btn-submit").attr("disabled","disabled")},_enable:function(){this.$(".btn.btn-submit").removeAttr("disabled")},_cite:function(e){var t=this.$(".cite-container"),i=this.$(".btn-cite").data("text"),n=this.$textarea.val();e.preventDefault(),this.$textarea.val(i+"\n\n"+n),t.slideToggle(),this.$textarea.trigger("autosize.resize"),this.$textarea.focus()},_onKeyPressSubject:function(e){13===e.keyCode&&this._send(e)},_updateSubjectCharCount:function(){var e,t,i,o;t=this.$(".postingform-subject-count"),i=n.settings.get("subject_maxlength"),o=this.$(".js-subject").val(),e=i-o.length,t.html(e)},_upload:function(e){e&&e.preventDefault(),new o({el:"#markitup_upload",textarea:this.$textarea[0]})},_media:function(e){e.preventDefault(),!1===this.mediaView&&(this.mediaView=new s({el:"#markitup_media",model:this.model})),this.mediaView.render()},_showPreview:function(e){var t;e.preventDefault(),this.$(".preview").slideDown("fast"),!1===this.preview&&(t=new a,this.preview=new l({el:this.$(".preview .panel-content"),model:t})),this.preview.model.set("data",this.$("form").serialize())},_closePreview:function(e){e.preventDefault(),this.$(".preview").slideUp("fast")},_setupTextArea:function(){this.$textarea=this.$("textarea"),this.$textarea.autosize()},_requestAnsweringForm:function(){e.ajax({cache:!0,url:this._requestUrl,success:t.bind(function(e){this.answeringForm=e,this.render()},this)})},_postRendering:function(){this.$el.scrollIntoView("bottom"),this._focusSubject(),this._onFormReady()},_onFormReady:function(){var e,t;this._setupTextArea(),this._updateSubjectCharCount(),e=this.$(".js-data"),e.length>0&&"edit"===e.data("meta").action&&(t=this.$(".js-data").data("entry"),this.model.set(t,{silent:!0}),this._addCountdown()),n.eventBus.trigger("change:DOM")},_addCountdown:function(){var e=this.$(".js-btn-submit");new r({el:e,model:this.model,editPeriod:n.settings.get("editPeriod"),done:"disable"})},_focusSubject:function(){window.navigator.userAgent.match("iPad|iPhone")||this.$(".postingform input[type=text]:first").focus()},_send:function(e){if(this.sendInProgress)return void e.preventDefault();this.sendInProgress=!0,this.options.parentThreadline?this._sendInline(e):this._sendRedirect(e)},_sendRedirect:function(i){var n,o=this.$(".btn-submit")[0];i.preventDefault(),"object"==typeof o.validity&&!1===o.form.checkValidity()?(n=t.bind(function(){this.checkValidityDummy||(this.checkValidityDummy=e("<button></button>",{type:"submit",style:"display: none;"}),e(o).after(this.checkValidityDummy)),this.checkValidityDummy.click()},this),n(),this.sendInProgress=!1):(o.disabled=!0,o.form.submit())},_sendInline:function(i){var o,s,r,a;i.preventDefault(),o=this.$("#EntryAddForm").serialize(),a=t.bind(function(e){this.model.set({isAnsweringFormShown:!1}),null!==this.options.parentThreadline&&this.options.parentThreadline.set("isInlineOpened",!1),n.eventBus.trigger("newEntry",{tid:e.tid,pid:this.model.get("id"),id:e.id,isNewToUser:!0})},this),r=t.bind(function(e,t){this.sendInProgress=!1,this._enable(),n.eventBus.trigger("notification",{title:t,type:"error",message:e.responseText})},this),s=t.bind(this._disable,this),e.ajax({url:this._requestUrl,type:"POST",dataType:"json",data:o,beforeSend:s}).done(a).fail(r)},render:function(){return!1===this.answeringForm?this._requestAnsweringForm():!1===this.rendered?(this.rendered=!0,this.$el.html(this.answeringForm),t.defer(function(e){e._postRendering()},this)):n.eventBus.trigger("change:DOM"),this}})}),define("views/postingSlider",["jquery","marionette","models/app","views/answering","text!templates/spinner.html"],function(e,t,i,n,o){"use strict";return t.View.extend({answeringForm:!1,events:{"click .btn-answeringClose":"onBtnClose"},initialize:function(e){this.parentThreadline=e.parentThreadline||null,this.listenTo(this.model,"change:isAnsweringFormShown",this.toggleAnsweringForm)},onBtnClose:function(e){e.preventDefault(),this.model.set("isAnsweringFormShown",!1)},toggleAnsweringForm:function(){this.model.get("isAnsweringFormShown")?(this._hideAllAnsweringForms(),this._showAnsweringForm()):this._hideAnsweringForm()},_showAnsweringForm:function(){i.eventBus.trigger("breakAutoreload"),!1===this.answeringForm&&this.$el.html(o),this.$el.slideDown("fast"),!1===this.answeringForm&&(this.answeringForm=new n({el:this.$el,model:this.model,parentThreadline:this.parentThreadline})),this.answeringForm.render()},_hideAnsweringForm:function(){this.$el.slideUp("fast",function(){i.eventBus.trigger("change:DOM")})},_hideAllAnsweringForms:function(){this.collection.forEach(function(e){e.get("id")!==this.model.get("id")&&e.set("isAnsweringFormShown",!1)},this)}})}),define("views/postingLayout",["underscore","marionette","app/vent","views/postingAction","views/postingContent","views/postingSlider","text!templates/spinner.html"],function(e,t,i,n,o,s,r){"use strict";return t.View.extend({initialize:function(t){e.defaults(t,{inline:!1,parentThreadline:!1}),t.inline?this._loadData(t):this._dataReady(t)},_loadData:function(t){this.$el.html(r),this.model.fetchHtml({success:e.bind(function(){this.$el.html(this.model.get("html")),this._dataReady(t)},this)})},_dataReady:function(e){var t=this.$(".js-data").data("entry");this.model.set(t,{silent:!0});new o({el:this.$(".postingBody"),model:this.model}),new n({el:this.$(".postingLayout-actions"),model:this.model}),new s({el:this.$(".postingLayout-slider"),model:this.model,collection:this.collection,parentThreadline:e.parentThreadline});i.vent.trigger("Vent.Posting.View.afterRender",{$el:this.$el})}})}),function(e,t){"use strict";"function"==typeof define&&define.amd?define("lib/saito/backbone.modelHelper",["underscore","backbone"],function(i,n){return t(i||e._,n||e.Backbone)}):t(_,Backbone)}(this,function(e,t){"use strict";t.Model.prototype.toggle=function(e){this.set(e,!this.get(e))}}),define("models/posting",["underscore","backbone","models/app","lib/saito/backbone.modelHelper"],function(e,t,i){"use strict";return t.Model.extend({defaults:{isBookmarked:!1,isSolves:!1,isAnsweringFormShown:!1,html:""},initialize:function(){this.listenTo(this,"change:isSolves",this.syncSolved),this.listenTo(this,"change:isBookmarked",this.syncBookmarked)},isRoot:function(){var t=this.get("pid");if(!e.isNumber(t))throw"pid is not a number.";return 0===t},syncBookmarked:function(){this.get("isBookmarked")&&$.ajax({url:i.settings.get("webroot")+"bookmarks/add",type:"POST",dataType:"json",data:"id="+this.get("id")})},syncSolved:function(){$.ajax({url:i.settings.get("webroot")+"entries/solve/"+this.get("id"),type:"POST",dateType:"json"})},fetchHtml:function(t){$.ajax({success:e.bind(function(e){this.set("html",e),t&&t.success&&t.success()},this),type:"POST",dateType:"html",url:i.settings.get("webroot")+"entries/view/"+this.get("id")})}})}),define("views/threadlines",["jquery","underscore","marionette","models/app","models/threadline","text!templates/threadline-spinner.html","views/postingLayout","models/posting","lib/saito/jquery.scrollIntoView"],function(e,t,i,n,o,s,r,a){"use strict";return i.View.extend({className:"threadLeaf",tagName:"li",spinnerTpl:s,postings:null,ui:{btnShowThread:".btn_show_thread",linkShowThread:".link_show_thread"},events:{"click @ui.btnShowThread":"toggleInlineOpen","click @ui.linkShowThread":"toggleInlineOpenFromLink"},initialize:function(e){this.postings=e.postings,this.model=new o({id:e.leafData.id,isNewToUser:e.leafData.isNewToUser}),void 0===e.el?this.model.fetch():this.model.set({html:this.el}),this.collection.add(this.model,{silent:!0}),this.attributes={"data-id":e.id},this.listenTo(this.model,"change:isInlineOpened",this._toggleInlineOpened),this.listenTo(this.model,"change:html",this.render)},toggleInlineOpenFromLink:function(e){this.model.get("isAlwaysShownInline")&&this.toggleInlineOpen(e)},toggleInlineOpen:function(e){e.preventDefault(),this.model.toggle("isInlineOpened")},_toggleInlineOpened:function(e,i){if(!i)return void this._closeInlineView();this.model.get("isContentLoaded")||(this.$(".threadLine").after(this.spinnerTpl),this.$(".js-btn-strip").on("click",t.bind(this.toggleInlineOpen,this)),this._insertContent(),this.model.set("isContentLoaded",!0)),this._showInlineView()},_insertContent:function(){var e=this.model.get("id");this.postingModel=new a({id:e}),this.postings.add(this.postingModel),new r({el:this.$(".threadInline-slider"),inline:!0,model:this.postingModel,collection:this.postings,parentThreadline:this.model})},_showInlineView:function(){var e=t.bind(function(){this.model.get("shouldScrollOnInlineOpen")?!1===this.$el.scrollIntoView("isInView")&&this.$el.scrollIntoView("bottom"):this.model.set("shouldScrollOnInlineOpen",!0)},this);this.$(".threadLine").fadeOut(100,t.bind(function(){this.$(".js-thread_inline").show(0,e)},this))},_closeInlineView:function(){n.eventBus.trigger("change:DOM"),this.$(".js-thread_inline").hide(0,t.bind(function(){this.$el.find(".threadLine").slideDown(),this._scrollLineIntoView()},this))},_scrollLineIntoView:function(){var e=this.$(".threadLine");e.scrollIntoView("isInView")||e.scrollIntoView("top").effect("highlight",{times:1},3e3)},render:function(){var t,i,n;return i=this.model.get("html"),i.length>0&&(t=this.$el,n=e(this.model.get("html")),this.setElement(n),t.replaceWith(n)),this}})}),define("models/thread",["underscore","backbone","collections/threadlines"],function(e,t,i){"use strict";return t.Model.extend({defaults:{isThreadCollapsed:!1},initialize:function(){this.threadlines=new i}})}),define("lib/saito/localStorageHelper",["underscore","app/vent"],function(e,t){"use strict";var i=function(){};e.extend(i.prototype,{_available:null,_prefix:"saito-",available:function(){return null===this._available&&(this._available=this._isAvailable()),this._available},_clear:function(){if(this.available()){var t=Object.keys(localStorage);e.each(t,function(e){0===e.indexOf(this._prefix)&&localStorage.removeItem(e)},this)}},_key:function(e){return this._prefix+e},_isAvailable:function(){if(!("localStorage"in window))return!1;try{var e="localStorageAvailableTestKey",t=window.localStorage;return t.setItem(e,"1"),t.removeItem(e),!0}catch(e){return!1}return!1}});var n=new i;t.vent.reply("app:localStorage:available",n.available,n),t.vent.reply("app:localStorage:key",n._key,n),t.vent.on("app:localStorage:clear",n._clear,n)}),define("collections/threads",["underscore","backbone","models/thread","models/app","backboneLocalStorage","lib/saito/localStorageHelper"],function(e,t,i,n){"use strict";return t.Collection.extend({model:i,localStorage:function(){var e=n.eventBus.request("app:localStorage:key","Threads");return new t.LocalStorage(e)}(),fetch:function(e){if(n.eventBus.request("app:localStorage:available"))return t.Model.prototype.fetch.call(this,e)}})}),define("views/thread",["jquery","underscore","backbone","models/app","collections/threadlines","views/threadlines"],function(e,t,i,n,o,s){"use strict";return i.View.extend({className:"threadBox",events:{"click .btn-threadCollapse":"collapseThread"},initialize:function(t){this.postings=t.postings,this.$rootUl=this.$("ul.root"),this.$subThreadRootIl=e(this.$rootUl.find("li:not(:first-child)")[0]),this.model.get("isThreadCollapsed")?this.hide():this.show(),n.eventBus.request("app:localStorage:available")||this._hideCollapseButton(),this.listenTo(n.eventBus,"newEntry",this._showNewThreadLine),this.listenTo(this.model,"change:isThreadCollapsed",this.toggleCollapseThread)},_showNewThreadLine:function(e){var t;e.tid===this.model.get("id")&&(t=new s({leafData:e,collection:this.model.threadlines,postings:this.postings}),this._appendThreadlineToThread(e.pid,t.render().$el))},_appendThreadlineToThread:function(e,t){var i,n;i=this.$('.threadLeaf[data-id="'+e+'"]'),n=i.next().not(".js_threadline").find("ul:first"),0===n.length?t.wrap('<ul class="threadTree-node"></ul>').parent().wrap("<li></li>").parent().insertAfter(i):n.append(t)},_hideCollapseButton:function(){this.$(".btn-threadCollapse").css("visibility","hidden")},collapseThread:function(e){e.preventDefault(),this.closeAllThreadlines(),this.model.toggle("isThreadCollapsed"),this.model.save()},toggleCollapseThread:function(e,t){t?this.slideUp():this.slideDown()},closeAllThreadlines:function(e){var i=this.model.threadlines.where({isInlineOpened:!0}),n=function(e){e.set({isInlineOpened:!1})};t.each(i,n),e&&e.preventDefault()},slideUp:function(){this.$subThreadRootIl.slideUp(300),this.markHidden()},slideDown:function(){this.$subThreadRootIl.slideDown(300),this.markShown()},hide:function(){this.$subThreadRootIl.hide(),this.markHidden()},show:function(){this.$subThreadRootIl.show(),this.markShown()},markShown:function(){e(this.el).find(".fa-thread-closed").removeClass("fa-thread-closed").addClass("fa-thread-open")},markHidden:function(){e(this.el).find(".fa-thread-open").removeClass("fa-thread-open").addClass("fa-thread-closed")}})}),define("collections/postings",["underscore","backbone","models/posting"],function(e,t,i){return t.Collection.extend({model:i})}),define("models/bookmark",["underscore","backbone","models/app","cakeRest"],function(e,t,i,n){"use strict";var o=t.Model.extend({initialize:function(){this.webroot=i.settings.get("webroot")+"bookmarks/"}});return e.extend(o.prototype,n),o}),define("collections/bookmarks",["underscore","backbone","models/bookmark"],function(e,t,i){return t.Collection.extend({model:i})}),define("views/bookmark",["jquery","underscore","backbone"],function(e,t,i){"use strict";return i.View.extend({events:{"click .btn-bookmark-delete":"deleteBookmark"},initialize:function(){t.bindAll(this,"render"),this.model.on("destroy",this.removeBookmark,this)},deleteBookmark:function(e){e.preventDefault(),this.model.destroy()},removeBookmark:function(){var t=this.collection;this.$el.hide("slide",null,500,function(){e(this).remove(),t.trigger("bookmark.removed")})}})}),define("text!templates/no-content-yet.html",[],function(){return"<div class=\"no-content-yet\">\n\t<%- $.i18n.__('ncy.bkm') %>\n</div>\n"}),define("views/bookmarks",["jquery","underscore","backbone","views/bookmark","text!templates/no-content-yet.html"],function(e,t,i,n,o){"use strict";return i.View.extend({initialize:function(){this.initCollectionFromDom(".js-bookmark",this.collection,n),this._fillNoContentYet(),this.listenTo(this.collection,"bookmark.removed",this._fillNoContentYet)},_fillNoContentYet:function(){this.collection.isEmpty()&&this.$el.html(t.template(o))}})}),define("views/helps",["jquery","underscore","backbone","models/app","drop"],function(e,t,i,n,o){"use strict";return i.View.extend({isHelpShown:!1,_popups:[],_elements:null,tpl:t.template('<a href="<%= webroot %>help/<%= id %>" target="_blank"><i class="fa fa-question-circle"></i></a>'),events:function(){var e={};return e["click "+this.indicatorName]="toggle",e},initialize:function(e){this.indicatorName=e.indicatorName,this.elementName=e.elementName,this.webroot=e.webroot,this.activateHelpButton(),this.listenTo(n.eventBus,"change:DOM",this._onDomChange)},activateHelpButton:function(){var t=e(this.indicatorName);t&&(this._isHelpOnPage()?t.addClass("is-active"):t.removeClass("is-active"))},_onDomChange:function(){this.activateHelpButton(),this._reset()},_isHelpOnPage:function(){return this._getElements().length>0},toggle:function(e){e.preventDefault(),this.isHelpShown?this._hide():this._show()},_reset:function(){this._hide(),this._elements=null,this._popups=[]},_getElements:function(){return null===this._elements&&(this._elements=this.$(this.elementName).filter(":visible")),this._elements},_show:function(){if(this.isHelpShown=!0,this._isHelpOnPage()){if(0===this._popups.length){var t=this;this._getElements().each(function(){var i=e(this),n=i.data("shpid"),s=t.tpl({id:n,webroot:t.webroot});t._popups.push(new o({target:this,content:s,classes:"drop-theme-arrows",position:"top center"}))})}this._popups.forEach(function(e){e.open()})}},_hide:function(){this.isHelpShown=!1,this._popups.forEach(function(e){e.destroy()})}})}),define("views/categoryChooser",["jquery","underscore","backbone"],function(e,t,i){"use strict";return i.View.extend({initialize:function(){this._initDialog()},_initDialog:function(){this.$el.dialog({autoOpen:!1,show:{effect:"fade",duration:200},hide:{effect:"fade",duration:200},title:e.i18n.__("Categories"),resizable:!1,modal:!0,position:{my:"top",at:"top"},width:"100%",draggable:!1})},toggle:function(){this.$el.dialog("isOpen")?this.$el.dialog("close"):this.$el.dialog("open")}})}),define("modules/slidetabs/views/slidetab",["jquery","underscore","backbone"],function(e,t,i){"use strict";return i.View.extend({events:{"click .slidetab-tab":"clickSlidetab"},initialize:function(){this.model.set({isOpen:this.isOpen()},{silent:!0}),this.listenTo(this.model,"change",this.toggleSlidetab)},isOpen:function(){return this.$el.find(".slidetab-outer").is(":visible")},clickSlidetab:function(e){this.model.save("isOpen",!this.model.get("isOpen"))},toggleSlidetab:function(){this.model.get("isOpen")?this.show():this.hide(),this.toggleSlidetabTabInfo()},show:function(){this.$el.animate({width:280}),this.$el.addClass("is-open")},hide:function(){this.$el.animate({width:28},t.bind(function(){this.$el.removeClass("is-open")},this))},toggleSlidetabTabInfo:function(){this.$el.find(".slidetab-tab-info").toggle()}})}),define("modules/slidetabs/models/slidetab",["jquery","underscore","backbone","app/vent","models/app"],function(e,t,i,n,o){"use strict";return i.Model.extend({defaults:{isOpen:!1},initialize:function(){this.webroot=o.settings.get("webroot"),this.listenTo(this,"change:isOpen",this.onChangeIsOpen)},onChangeIsOpen:function(){n.vent.trigger("slidetab:open",{slidetab:this.get("id"),open:this.get("isOpen")})},sync:function(){var t="show_"+this.get("id");e.post(this.webroot+"users/slidetabToggle",{slidetabKey:t})}})}),define("modules/slidetabs/collections/slidetabs",["underscore","backbone","models/app","modules/slidetabs/models/slidetab"],function(e,t,i,n){"use strict";return t.Collection.extend({model:n,initialize:function(){i.eventBus.reply("slidetab:open",this.isOpen,this)},isOpen:function(e){return this.get(e).get("isOpen")}})}),define("modules/slidetabs/slidetabs",["jquery","underscore","marionette","models/app","modules/slidetabs/views/slidetab","modules/slidetabs/collections/slidetabs"],function(e,t,i,n,o,s){"use strict";return i.View.extend({el:"#slidetabs",initialize:function(){this.collection=new s,this.webroot=n.settings.get("webroot"),this.initCollectionFromDom(".slidetab",this.collection,o),this.makeSortable()},makeSortable:function(){const i=this.webroot;this.$el.sortable({handle:".slidetab-tab",start:t.bind(function(e,t){this.$el.css("overflow","visible")},this),stop:t.bind(function(e,t){this.$el.css("overflow","hidden")},this),update:function(t,n){var o=e(this).sortable("toArray",{attribute:"data-id"});o=o.map(function(e){return"slidetab_"+e}),e.post(i+"users/slidetabOrder",{slidetabOrder:o})}})}})}),define("views/app",["jquery","underscore","marionette","models/app","collections/threadlines","views/threadlines","collections/threads","views/thread","collections/postings","models/posting","views/postingLayout","collections/bookmarks","views/bookmarks","views/helps","views/categoryChooser","modules/slidetabs/slidetabs","views/answering","jqueryUi"],function(e,t,i,n,o,s,r,a,l,d,c,u,h,f,p,m,g){"use strict";return i.View.extend({el:e("body"),regions:{slidetabs:"#slidetabs"},autoPageReloadTimer:!1,_domInitializers:{".entry.add-not-inline":"_initAnsweringNotInlined","#bookmarks":"_initBookmarks","#category-chooser":"_initCategoryChooser","#slidetabs":function(){this.showChildView("slidetabs",new m)},".js-entry-view-core":"_initPostings",".threadBox":"_initThreadBoxes",".threadLeaf":"_initThreadLeafs",".users.logout":"_initLogout"},events:{"click #showLoginForm":"showLoginForm","focus #header-searchField":"widenSearchField","click #btn-scrollToTop":"scrollToTop","click #btn-manuallyMarkAsRead":"manuallyMarkAsRead","click #btn-category-chooser":"toggleCategoryChooser","click #btn_header_logo":"_onEntriesIndexReload"},initialize:function(){this.threads=new r,"Entries"===n.request.controller&&"index"===n.request.action&&this.threads.fetch(),this.postings=new l,this.threadLines=new o,this.listenTo(n.eventBus,"initAutoreload",this.initAutoreload),this.listenTo(n.eventBus,"breakAutoreload",this.breakAutoreload),this.$el.on("dialogopen",this.fixJqueryUiDialog)},initFromDom:function(i){if(t.each(this._domInitializers,function(i,n){const o=e(n);if(o.length>0){if("function"==typeof i)return void t.bind(i,this,o)();this[i](o)}},this),this.initAutoreload(),this.initHelp(".shp"),n.status.start(),this._showPage(i.SaitoApp.timeAppStart,i.contentTimer),n.eventBus.trigger("notification",i.SaitoApp),window.location.href.indexOf("jump=")>-1){var o=window.location.href,s=/[\?\&]jump=(\d+)/.exec(o);try{this.scrollToThread(s[1])}catch(e){}finally{var r=o.replace(/[\?\&]jump=\d+/,"");window.history.replaceState(null,null,r)}}},_initAnsweringNotInlined:function(e){this.answeringForm=new g({el:e,model:new d({id:"foo"}),ajax:!1})},_initBookmarks:function(e){var t=new u;new h({el:e,collection:t})},_initCategoryChooser:function(e){this.categoryChooser=new p({el:e})},_initLogout:function(){n.eventBus.trigger("app:localStorage:clear"),t.defer(function(){window.redirect(n.settings.get("webroot"))})},_initPostings:function(i){t.each(i,function(t){var i,n;i=parseInt(t.getAttribute("data-id"),10),n=new d({id:i}),this.postings.add(n,{silent:!0}),new c({el:e(t),model:this.postings.get(i),collection:this.postings})},this)},_initThreadBoxes:function(i){t.each(i,function(t){var i;i=parseInt(e(t).attr("data-id"),10),this.threads.get(i)||this.threads.add([{id:i,isThreadCollapsed:"entries"===n.request.controller&&"index"===n.request.action&&n.currentUser.get("user_show_thread_collapsed")}],{silent:!0}),new a({el:e(t),postings:this.postings,model:this.threads.get(i)})},this)},_initThreadLeafs:function(i){t.each(i,function(t){var i=JSON.parse(t.getAttribute("data-leaf"));i.isNewToUser=i.new,delete i.new;var n,o=this.threads.get(i.tid);n=o?o.threadlines:this.threadLines;new s({el:e(t),leafData:i,postings:this.postings,collection:n})},this)},_showPage:function(t,i){var o=function(){n.eventBus.trigger("isAppVisible",!0)};n.request.isMobile||(new Date).getTime()-t>1500?(e("#content").css("visibility","visible"),o()):e("#content").css({visibility:"visible",opacity:0}).animate({opacity:1},{duration:150,easing:"easeInOutQuart",complete:o}),i.cancel()},fixJqueryUiDialog:function(t,i){e(".ui-dialog-titlebar-close").removeClass("ui-icon ui-button-icon-only").addClass("jqueryUi-closethick-fix").html("")},toggleCategoryChooser:function(e){e.preventDefault(),this.categoryChooser.toggle()},initHelp:function(e){new f({el:"body",elementName:e,indicatorName:"#shp-show",webroot:n.settings.get("webroot")})},scrollToThread:function(t){e(".threadBox[data-id="+t+"]")[0].scrollIntoView("top")},initAutoreload:function(){var e,t,i;i=window.location.pathname,t=function(){window.location=i},n.settings.get("autoPageReload")&&(this.breakAutoreload(),e=1e3*n.settings.get("autoPageReload"),this.autoPageReloadTimer=setTimeout(t,e))},breakAutoreload:function(){!1!==this.autoPageReloadTimer&&(clearTimeout(this.autoPageReloadTimer),this.autoPageReloadTimer=!1)},widenSearchField:function(t){t.preventDefault(),e(t.currentTarget).width()<350&&e(t.currentTarget).animate({width:"350px"},"fast")},showLoginForm:function(t){var i,n;navigator.userAgent.match(/iPhone/i)||navigator.userAgent.match(/iPod/i)||(n=e("#modalLoginDialog"),1===n.length&&(t.preventDefault(),n.height("auto"),i=t.currentTarget.title,n.dialog({hide:"fade",modal:!0,position:{my:"top",at:"top"},resizable:!1,title:i,width:"100%",draggable:!1})))},scrollToTop:function(e){e.preventDefault(),window.scrollTo(0,0)},manuallyMarkAsRead:function(e){e&&e.preventDefault(),this._onEntriesIndexReload(),window.redirect(n.settings.get("webroot")+"entries/update")},_onEntriesIndexReload:function(){var e=n.request.controller,t=n.request.action}})}),function(e){define("pnotify",[],function(){return function(){"use strict";var t=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var i=arguments[t];for(var n in i)Object.prototype.hasOwnProperty.call(i,n)&&(e[n]=i[n])}return e},i="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},n=function(){function e(e){return"object"===(void 0===e?"undefined":i(e))?e:W.styling[e]}function n(e){return"object"===(void 0===e?"undefined":i(e))?e:W.icons[e]}function o(){var e=t({_state:"initializing",_timer:null,_animTimer:null,_animating:!1,_animatingClass:"",_moveClass:"",_timerHide:!1,_moduleClasses:[],_moduleIsNoticeOpen:!1,_modules:{},_modulesPrependContainer:W.modulesPrependContainer,_modulesAppendContainer:W.modulesAppendContainer},W.defaults);return e.modules=t({},W.defaults.modules),e}function s(){var e=this;this.on("mouseenter",function(t){if(e.get("mouseReset")&&"out"===e.get("_animating")){if(!e.get("_timerHide"))return;e.cancelClose()}e.get("hide")&&e.get("mouseReset")&&e.cancelClose()}),this.on("mouseleave",function(t){e.get("hide")&&e.get("mouseReset")&&"out"!==e.get("_animating")&&e.queueClose(),W.positionAll()});var t=this.get("stack");t&&"top"===t.push?W.notices.splice(0,0,this):W.notices.push(this),this.runModules("init"),this.set({_state:"closed"}),this.get("autoDisplay")&&this.open()}function r(){var e=_("style");e.id="svelte-3059224252-style",e.textContent='body > .ui-pnotify{position:fixed;z-index:100040}body > .ui-pnotify.ui-pnotify-modal{z-index:100042}.ui-pnotify{position:absolute;height:auto;z-index:1;display:none}.ui-pnotify.ui-pnotify-modal{z-index:3}.ui-pnotify.ui-pnotify-in{display:block}.ui-pnotify.ui-pnotify-initial-hidden{display:block;visibility:hidden}.ui-pnotify.ui-pnotify-move{transition:left .5s ease, top .5s ease, right .5s ease, bottom .5s ease}.ui-pnotify.ui-pnotify-fade-slow{transition:opacity .4s linear;opacity:0}.ui-pnotify.ui-pnotify-fade-slow.ui-pnotify.ui-pnotify-move{transition:opacity .4s linear, left .5s ease, top .5s ease, right .5s ease, bottom .5s ease}.ui-pnotify.ui-pnotify-fade-normal{transition:opacity .25s linear;opacity:0}.ui-pnotify.ui-pnotify-fade-normal.ui-pnotify.ui-pnotify-move{transition:opacity .25s linear, left .5s ease, top .5s ease, right .5s ease, bottom .5s ease}.ui-pnotify.ui-pnotify-fade-fast{transition:opacity .1s linear;opacity:0}.ui-pnotify.ui-pnotify-fade-fast.ui-pnotify.ui-pnotify-move{transition:opacity .1s linear, left .5s ease, top .5s ease, right .5s ease, bottom .5s ease}.ui-pnotify.ui-pnotify-fade-in{opacity:1}.ui-pnotify .ui-pnotify-shadow{-webkit-box-shadow:0px 6px 28px 0px rgba(0,0,0,0.1);-moz-box-shadow:0px 6px 28px 0px rgba(0,0,0,0.1);box-shadow:0px 6px 28px 0px rgba(0,0,0,0.1)}.ui-pnotify-container{background-position:0 0;padding:.8em;height:100%;margin:0}.ui-pnotify-container:after{content:" ";visibility:hidden;display:block;height:0;clear:both}.ui-pnotify-container.ui-pnotify-sharp{-webkit-border-radius:0;-moz-border-radius:0;border-radius:0}.ui-pnotify-title{display:block;white-space:pre-line;margin-bottom:.4em;margin-top:0}.ui-pnotify.ui-pnotify-with-icon .ui-pnotify-title,.ui-pnotify.ui-pnotify-with-icon .ui-pnotify-text{margin-left:24px}[dir=rtl] .ui-pnotify.ui-pnotify-with-icon .ui-pnotify-title,[dir=rtl] .ui-pnotify.ui-pnotify-with-icon .ui-pnotify-text{margin-right:24px;margin-left:0}.ui-pnotify-title-bs4{font-size:1.2rem}.ui-pnotify-text{display:block;white-space:pre-line}.ui-pnotify-icon,.ui-pnotify-icon span{display:block;float:left}[dir=rtl] .ui-pnotify-icon,[dir=rtl] .ui-pnotify-icon span{float:right}.ui-pnotify-icon-bs3 > span{position:relative;top:2px}.ui-pnotify-icon-bs4 > span{position:relative;top:4px}.ui-pnotify-modal-overlay{background-color:rgba(0, 0, 0, .4);top:0;left:0;position:absolute;height:100%;width:100%;z-index:2}body > .ui-pnotify-modal-overlay{position:fixed;z-index:100041}',b(e,document.head)}function a(e,t){function i(e){t.fire("mouseover",e)}function n(e){t.fire("mouseout",e)}function o(e){t.fire("mouseenter",e)}function s(e){t.fire("mouseleave",e)}
function r(e){t.fire("mousemove",e)}function a(e){t.fire("mousedown",e)}function c(e){t.fire("mouseup",e)}function u(e){t.fire("click",e)}function h(e){t.fire("dblclick",e)}function f(e){t.fire("focus",e)}function v(e){t.fire("blur",e)}function D(e){t.fire("touchstart",e)}function $(e){t.fire("touchmove",e)}function j(e){t.fire("touchend",e)}function I(e){t.fire("touchcancel",e)}for(var q,F,L,O,B,U,M,z,N,P,R,V,H,E=e._modulesPrependContainer,W=[],Y=0;Y<E.length;Y+=1)W[Y]=l(e,E,E[Y],Y,t);for(var Q=!1!==e.icon&&d(e,t),Z=m(e),J=Z(e,t),G=g(e),X=G(e,t),K=e._modulesAppendContainer,ee=[],Y=0;Y<K.length;Y+=1)ee[Y]=p(e,K,K[Y],Y,t);return{c:function(){q=_("div"),F=_("div");for(var e=0;e<W.length;e+=1)W[e].c();L=w("\n    "),Q&&Q.c(),O=w("\n    "),B=_("h4"),J.c(),M=w("\n    "),z=_("div"),X.c(),P=w("\n    ");for(var e=0;e<ee.length;e+=1)ee[e].c();this.h()},h:function(){B.className=U="ui-pnotify-title "+(e._styles.title?e._styles.title:""),y(B,"display",!1===e.title?"none":"block"),z.className=N="ui-pnotify-text "+(e._styles.text?e._styles.text:""),y(z,"display",!1===e.text?"none":"block"),x(z,"role","alert"),F.className=R="\n        ui-pnotify-container\n        "+(e._styles.container?e._styles.container:"")+"\n        "+(e._styles[e.type]?e._styles[e.type]:"")+"\n        "+e.cornerClass+"\n        "+(e.shadow?"ui-pnotify-shadow":"")+"\n      ",F.style.cssText=V="\n        "+("string"==typeof e.width?"width: "+e.width+";":"")+"\n        "+("string"==typeof e.minHeight?"min-height: "+e.minHeight+";":"")+"\n      ",x(F,"role","alert"),q.className=H="\n      ui-pnotify\n      "+(!1!==e.icon?"ui-pnotify-with-icon":"")+"\n      "+(e._styles.element?e._styles.element:"")+"\n      "+e.addClass+"\n      "+e._animatingClass+"\n      "+e._moveClass+"\n      "+("fade"===e.animation?"ui-pnotify-fade-"+e.animateSpeed:"")+"\n      "+(e.stack&&e.stack.modal?"ui-pnotify-modal":"")+"\n      "+e._moduleClasses.join(" ")+"\n    ",x(q,"aria-live","assertive"),x(q,"role","alertdialog"),x(q,"ui-pnotify",!0),k(q,"mouseover",i),k(q,"mouseout",n),k(q,"mouseenter",o),k(q,"mouseleave",s),k(q,"mousemove",r),k(q,"mousedown",a),k(q,"mouseup",c),k(q,"click",u),k(q,"dblclick",h),k(q,"focus",f),k(q,"blur",v),k(q,"touchstart",D),k(q,"touchmove",$),k(q,"touchend",j),k(q,"touchcancel",I)},m:function(e,i){T(q,e,i),b(F,q);for(var n=0;n<W.length;n+=1)W[n].m(F,null);b(L,F),Q&&Q.m(F,null),b(O,F),b(B,F),J.m(B,null),t.refs.titleContainer=B,b(M,F),b(z,F),X.m(z,null),t.refs.textContainer=z,b(P,F);for(var n=0;n<ee.length;n+=1)ee[n].m(F,null);t.refs.container=F,t.refs.elem=q},p:function(e,i){var n=i._modulesPrependContainer;if(e._modulesPrependContainer){for(var o=W.length;o<n.length;o+=1)W[o]=l(i,n,n[o],o,t),W[o].c(),W[o].m(F,L);for(;o<W.length;o+=1)W[o].u(),W[o].d();W.length=n.length}!1!==i.icon?Q?Q.p(e,i):(Q=d(i,t),Q.c(),Q.m(F,O)):Q&&(Q.u(),Q.d(),Q=null),Z===(Z=m(i))&&J?J.p(e,i):(J.u(),J.d(),J=Z(i,t),J.c(),J.m(B,null)),e._styles&&U!==(U="ui-pnotify-title "+(i._styles.title?i._styles.title:""))&&(B.className=U),e.title&&y(B,"display",!1===i.title?"none":"block"),G===(G=g(i))&&X?X.p(e,i):(X.u(),X.d(),X=G(i,t),X.c(),X.m(z,null)),e._styles&&N!==(N="ui-pnotify-text "+(i._styles.text?i._styles.text:""))&&(z.className=N),e.text&&y(z,"display",!1===i.text?"none":"block");var s=i._modulesAppendContainer;if(e._modulesAppendContainer){for(var o=ee.length;o<s.length;o+=1)ee[o]=p(i,s,s[o],o,t),ee[o].c(),ee[o].m(F,null);for(;o<ee.length;o+=1)ee[o].u(),ee[o].d();ee.length=s.length}(e._styles||e.type||e.cornerClass||e.shadow)&&R!==(R="\n        ui-pnotify-container\n        "+(i._styles.container?i._styles.container:"")+"\n        "+(i._styles[i.type]?i._styles[i.type]:"")+"\n        "+i.cornerClass+"\n        "+(i.shadow?"ui-pnotify-shadow":"")+"\n      ")&&(F.className=R),(e.width||e.minHeight)&&V!==(V="\n        "+("string"==typeof i.width?"width: "+i.width+";":"")+"\n        "+("string"==typeof i.minHeight?"min-height: "+i.minHeight+";":"")+"\n      ")&&(F.style.cssText=V),(e.icon||e._styles||e.addClass||e._animatingClass||e._moveClass||e.animation||e.animateSpeed||e.stack||e._moduleClasses)&&H!==(H="\n      ui-pnotify\n      "+(!1!==i.icon?"ui-pnotify-with-icon":"")+"\n      "+(i._styles.element?i._styles.element:"")+"\n      "+i.addClass+"\n      "+i._animatingClass+"\n      "+i._moveClass+"\n      "+("fade"===i.animation?"ui-pnotify-fade-"+i.animateSpeed:"")+"\n      "+(i.stack&&i.stack.modal?"ui-pnotify-modal":"")+"\n      "+i._moduleClasses.join(" ")+"\n    ")&&(q.className=H)},u:function(){C(q);for(var e=0;e<W.length;e+=1)W[e].u();Q&&Q.u(),J.u(),X.u();for(var e=0;e<ee.length;e+=1)ee[e].u()},d:function(){S(W),Q&&Q.d(),J.d(),t.refs.titleContainer===B&&(t.refs.titleContainer=null),X.d(),t.refs.textContainer===z&&(t.refs.textContainer=null),S(ee),t.refs.container===F&&(t.refs.container=null),A(q,"mouseover",i),A(q,"mouseout",n),A(q,"mouseenter",o),A(q,"mouseleave",s),A(q,"mousemove",r),A(q,"mousedown",a),A(q,"mouseup",c),A(q,"click",u),A(q,"dblclick",h),A(q,"focus",f),A(q,"blur",v),A(q,"touchstart",D),A(q,"touchmove",$),A(q,"touchend",j),A(q,"touchcancel",I),t.refs.elem===q&&(t.refs.elem=null)}}}function l(e,t,i,n,o){function s(e){o.initModule(e.module)}var r,a=i;if(a)var l=new a(function(e,t,i,n){return{root:o.root}}(e,t,i,n));return l&&l.on("init",s),{c:function(){r=D(),l&&l._fragment.c()},m:function(e,t){T(r,e,t),l&&l._mount(e,t)},u:function(){C(r),l&&l._unmount()},d:function(){l&&l.destroy(!1)}}}function d(e,t){var i,n,o,s;return{c:function(){i=_("div"),n=_("span"),this.h()},h:function(){n.className=o=!0===e.icon?e._icons[e.type]?e._icons[e.type]:"":e.icon,i.className=s="ui-pnotify-icon "+(e._styles.icon?e._styles.icon:"")},m:function(e,t){T(i,e,t),b(n,i)},p:function(e,t){(e.icon||e._icons||e.type)&&o!==(o=!0===t.icon?t._icons[t.type]?t._icons[t.type]:"":t.icon)&&(n.className=o),e._styles&&s!==(s="ui-pnotify-icon "+(t._styles.icon?t._styles.icon:""))&&(i.className=s)},u:function(){C(i)},d:$}}function c(e,t){var i,n;return{c:function(){i=_("noscript"),n=_("noscript")},m:function(t,o){T(i,t,o),i.insertAdjacentHTML("afterend",e.title),T(n,t,o)},p:function(e,t){e.title&&(j(i,n),i.insertAdjacentHTML("afterend",t.title))},u:function(){j(i,n),C(i),C(n)},d:$}}function u(e,t){var i;return{c:function(){i=w(e.title)},m:function(e,t){T(i,e,t)},p:function(e,t){e.title&&(i.data=t.title)},u:function(){C(i)},d:$}}function h(e,t){var i,n;return{c:function(){i=_("noscript"),n=_("noscript")},m:function(t,o){T(i,t,o),i.insertAdjacentHTML("afterend",e.text),T(n,t,o)},p:function(e,t){e.text&&(j(i,n),i.insertAdjacentHTML("afterend",t.text))},u:function(){j(i,n),C(i),C(n)},d:$}}function f(e,t){var i;return{c:function(){i=w(e.text)},m:function(e,t){T(i,e,t)},p:function(e,t){e.text&&(i.data=t.text)},u:function(){C(i)},d:$}}function p(e,t,i,n,o){function s(e){o.initModule(e.module)}var r,a=i;if(a)var l=new a(function(e,t,i,n){return{root:o.root}}(e,t,i,n));return l&&l.on("init",s),{c:function(){r=D(),l&&l._fragment.c()},m:function(e,t){T(r,e,t),l&&l._mount(e,t)},u:function(){C(r),l&&l._unmount()},d:function(){l&&l.destroy(!1)}}}function m(e){return e.titleTrusted?c:u}function g(e){return e.textTrusted?h:f}function v(e){I(this,e),this.refs={},this._state=q(o(),e.data),this._recompute({styling:1,icons:1},this._state),document.getElementById("svelte-3059224252-style")||r();var t=s.bind(this);e.root||(this._oncreate=[],this._beforecreate=[],this._aftercreate=[]),this._fragment=a(this._state,this),this.root._oncreate.push(t),e.target&&(this._fragment.c(),this._fragment.m(e.target,e.anchor||null),this._lock=!0,F(this._beforecreate),F(this._oncreate),F(this._aftercreate),this._lock=!1)}function _(e){return document.createElement(e)}function b(e,t){t.appendChild(e)}function w(e){return document.createTextNode(e)}function y(e,t,i){e.style.setProperty(t,i)}function x(e,t,i){e.setAttribute(t,i)}function k(e,t,i){e.addEventListener(t,i,!1)}function T(e,t,i){t.insertBefore(e,i)}function C(e){e.parentNode.removeChild(e)}function S(e){for(var t=0;t<e.length;t+=1)e[t]&&e[t].d()}function A(e,t,i){e.removeEventListener(t,i,!1)}function D(){return document.createComment("")}function $(){}function j(e,t){for(;e.nextSibling&&e.nextSibling!==t;)e.parentNode.removeChild(e.nextSibling)}function I(e,t){e._observers={pre:H(),post:H()},e._handlers=H(),e._bind=t._bind,e.options=t,e.root=t.root||e,e.store=e.root.store||t.store}function q(e){for(var t,i,n=1,o=arguments.length;n<o;n++){i=arguments[n];for(t in i)e[t]=i[t]}return e}function F(e){for(;e&&e.length;)e.shift()()}function L(e){this.destroy=$,this.fire("destroy"),this.set=this.get=$,!1!==e&&this._fragment.u(),this._fragment.d(),this._fragment=this._state=null}function O(e){return e?this._state[e]:this._state}function B(e,t){var i=e in this._handlers&&this._handlers[e].slice();if(i)for(var n=0;n<i.length;n+=1)i[n].call(this,t)}function U(e,t,i){var n=i&&i.defer?this._observers.post:this._observers.pre;return(n[e]||(n[e]=[])).push(t),i&&!1===i.init||(t.__calling=!0,t.call(this,this._state[e]),t.__calling=!1),{cancel:function(){var i=n[e].indexOf(t);~i&&n[e].splice(i,1)}}}function M(e,t){if("teardown"===e)return this.on("destroy",t);var i=this._handlers[e]||(this._handlers[e]=[]);return i.push(t),{cancel:function(){var e=i.indexOf(t);~e&&i.splice(e,1)}}}function z(e){this._set(q({},e)),this.root._lock||(this.root._lock=!0,F(this.root._beforecreate),F(this.root._oncreate),F(this.root._aftercreate),this.root._lock=!1)}function N(e){var t=this._state,i={},n=!1;for(var o in e)this._differs(e[o],t[o])&&(i[o]=n=!0);n&&(this._state=q({},t,e),this._recompute(i,this._state),this._bind&&this._bind(i,this._state),this._fragment&&(E(this,this._observers.pre,i,this._state,t),this._fragment.p(i,this._state),E(this,this._observers.post,i,this._state,t)))}function P(e,t){this._fragment.m(e,t)}function R(){this._fragment&&this._fragment.u()}function V(e,t){return e!=e?t==t:e!==t||e&&"object"===(void 0===e?"undefined":i(e))||"function"==typeof e}function H(){return Object.create(null)}function E(e,t,i,n,o){for(var s in t)if(i[s]){var r=n[s],a=o[s],l=t[s];if(l)for(var d=0;d<l.length;d+=1){var c=l[d];c.__calling||(c.__calling=!0,c.call(e,r,a),c.__calling=!1)}}}var W=void 0,Y=void 0,Q=function(){W.defaultStack.context=document.body,window.addEventListener("resize",function(){Y&&clearTimeout(Y),Y=setTimeout(function(){W.positionAll()},10)})},Z=function(e){var t=document.createElement("div");t.classList.add("ui-pnotify-modal-overlay"),e.context!==document.body&&(t.style.height=e.context.scrollHeight+"px",t.style.width=e.context.scrollWidth+"px"),t.addEventListener("click",function(){e.overlayClose&&W.closeStack(e)}),e.overlay=t},J=function(e){e.overlay.parentNode!==e.context&&(e.overlay=e.context.insertBefore(e.overlay,e.context.firstChild))},G=function(e){e.overlay.parentNode&&e.overlay.parentNode.removeChild(e.overlay)},X=function(e,t){return"object"!==(void 0===e?"undefined":i(e))&&(e={text:e}),t&&(e.type=t),{target:document.body,data:e}},K={runModules:function(e){if("init"===e){for(var i in W.modules)if(W.modules.hasOwnProperty(i)&&"function"==typeof W.modules[i].init){var n=W.modules[i].init(this);this.initModule(n)}}else{var o=this.get("_modules");for(var s in o)if(o.hasOwnProperty(s)){var r=t({_notice:this,_options:this.get()},this.get("modules")[s]);o[s].set(r),"function"==typeof o[s][e]&&o[s][e]()}}},initModule:function(e){var i=this.get("modules");i.hasOwnProperty(e.constructor.key)||(i[e.constructor.key]={});var n=t({_notice:this,_options:this.get()},i[e.constructor.key]);e.initModule(n),this.get("_modules")[e.constructor.key]=e},update:function(e){var t=this.get("hide"),i=this.get("icon");this.set(e),this.runModules("update"),this.get("hide")?t||this.queueClose():this.cancelClose(),this.queuePosition();var n=this.get("icon");return n!==i&&(!0===n&&"fontawesome5"===this.get("icons")||"string"==typeof n&&n.match(/(^| )fa[srlb]($| )/))&&(this.set({icon:!1}),this.set({icon:n})),this},open:function(){var e=this;if("opening"!==this.get("_state")){if("open"===this.get("_state"))return void(this.get("hide")&&this.queueClose());this.set({_state:"opening",_animatingClass:"ui-pnotify-initial-hidden"}),this.runModules("beforeOpen");var t=this.get("stack");if(!this.refs.elem.parentNode||t&&t.context&&t.context!==this.refs.elem.parentNode)if(t&&t.context)t.context.appendChild(this.refs.elem);else{if(!document.body)throw new Error("No context to open this notice in.");document.body.appendChild(this.refs.elem)}return setTimeout(function(){t&&(t.animation=!1,W.positionAll(),t.animation=!0),e.animateIn(function(){e.get("hide")&&e.queueClose(),e.set({_state:"open"}),e.runModules("afterOpen")})},0),this}},remove:function(e){return this.close(e)},close:function(e){var t=this;if("closing"!==this.get("_state")&&"closed"!==this.get("_state"))return this.set({_state:"closing",_timerHide:!!e}),this.runModules("beforeClose"),this.get("_timer")&&clearTimeout&&(clearTimeout(this.get("_timer")),this.set({_timer:null})),this.animateOut(function(){if(t.set({_state:"closed"}),t.runModules("afterClose"),t.queuePosition(),t.get("remove")&&t.refs.elem.parentNode.removeChild(t.refs.elem),t.runModules("beforeDestroy"),t.get("destroy")&&null!==W.notices){var e=W.notices.indexOf(t);-1!==e&&W.notices.splice(e,1)}t.runModules("afterDestroy")}),this},animateIn:function(e){var t=this;this.set({_animating:"in"});var i=function i(){if(t.refs.elem.removeEventListener("transitionend",i),t.get("_animTimer")&&clearTimeout(t.get("_animTimer")),"in"===t.get("_animating")){var n=t.get("_moduleIsNoticeOpen");if(!n){var o=t.refs.elem.getBoundingClientRect();for(var s in o)if(o[s]>0){n=!0;break}}n?(e&&e.call(),t.set({_animating:!1})):t.set({_animTimer:setTimeout(i,40)})}};"fade"===this.get("animation")?(this.refs.elem.addEventListener("transitionend",i),this.set({_animatingClass:"ui-pnotify-in"}),this.refs.elem.style.opacity,this.set({_animatingClass:"ui-pnotify-in ui-pnotify-fade-in"}),this.set({_animTimer:setTimeout(i,650)})):(this.set({_animatingClass:"ui-pnotify-in"}),i())},animateOut:function(e){var t=this;this.set({_animating:"out"});var i=function i(){if(t.refs.elem.removeEventListener("transitionend",i),t.get("_animTimer")&&clearTimeout(t.get("_animTimer")),"out"===t.get("_animating")){var n=t.get("_moduleIsNoticeOpen");if(!n){var o=t.refs.elem.getBoundingClientRect();for(var s in o)if(o[s]>0){n=!0;break}}if(t.refs.elem.style.opacity&&"0"!=t.refs.elem.style.opacity&&n)t.set({_animTimer:setTimeout(i,40)});else{t.set({_animatingClass:""});var r=t.get("stack");if(r&&r.overlay){for(var a=!1,l=0;l<W.notices.length;l++){var d=W.notices[l];if(d!=t&&d.get("stack")===r&&"closed"!==d.get("_state")){a=!0;break}}a||G(r)}e&&e.call(),t.set({_animating:!1})}}};"fade"===this.get("animation")?(this.refs.elem.addEventListener("transitionend",i),this.set({_animatingClass:"ui-pnotify-in"}),this.set({_animTimer:setTimeout(i,650)})):(this.set({_animatingClass:""}),i())},position:function(){var e=this.get("stack"),t=this.refs.elem;if(e){if(e.context||(e.context=document.body),"number"!=typeof e.nextpos1&&(e.nextpos1=e.firstpos1),"number"!=typeof e.nextpos2&&(e.nextpos2=e.firstpos2),"number"!=typeof e.addpos2&&(e.addpos2=0),!t.classList.contains("ui-pnotify-in")&&!t.classList.contains("ui-pnotify-initial-hidden"))return this;e.modal&&(e.overlay||Z(e),J(e));t.getBoundingClientRect();e.animation&&this.set({_moveClass:"ui-pnotify-move"});var i=e.context===document.body?window.innerHeight:e.context.scrollHeight,n=e.context===document.body?window.innerWidth:e.context.scrollWidth,o=void 0;if(e.dir1){o={down:"top",up:"bottom",left:"right",right:"left"}[e.dir1];var s=void 0;switch(e.dir1){case"down":s=t.offsetTop;break;case"up":s=i-t.scrollHeight-t.offsetTop;break;case"left":s=n-t.scrollWidth-t.offsetLeft;break;case"right":s=t.offsetLeft}void 0===e.firstpos1&&(e.firstpos1=s,e.nextpos1=e.firstpos1)}if(e.dir1&&e.dir2){var r={down:"top",up:"bottom",left:"right",right:"left"}[e.dir2],a=void 0;switch(e.dir2){case"down":a=t.offsetTop;break;case"up":a=i-t.scrollHeight-t.offsetTop;break;case"left":a=n-t.scrollWidth-t.offsetLeft;break;case"right":a=t.offsetLeft}void 0===e.firstpos2&&(e.firstpos2=a,e.nextpos2=e.firstpos2);var l=e.nextpos1+t.offsetHeight+(void 0===e.spacing1?25:e.spacing1),d=e.nextpos1+t.offsetWidth+(void 0===e.spacing1?25:e.spacing1);switch((("down"===e.dir1||"up"===e.dir1)&&l>i||("left"===e.dir1||"right"===e.dir1)&&d>n)&&(e.nextpos1=e.firstpos1,e.nextpos2+=e.addpos2+(void 0===e.spacing2?25:e.spacing2),e.addpos2=0),"number"==typeof e.nextpos2&&(t.style[r]=e.nextpos2+"px",e.animation||t.style[r]),e.dir2){case"down":case"up":t.offsetHeight+(parseFloat(t.style.marginTop,10)||0)+(parseFloat(t.style.marginBottom,10)||0)>e.addpos2&&(e.addpos2=t.offsetHeight);break;case"left":case"right":t.offsetWidth+(parseFloat(t.style.marginLeft,10)||0)+(parseFloat(t.style.marginRight,10)||0)>e.addpos2&&(e.addpos2=t.offsetWidth)}}else if(e.dir1){var c=void 0,u=void 0;switch(e.dir1){case"down":case"up":u=["left","right"],c=e.context.scrollWidth/2-t.offsetWidth/2;break;case"left":case"right":u=["top","bottom"],c=i/2-t.offsetHeight/2}t.style[u[0]]=c+"px",t.style[u[1]]="auto",e.animation||t.style[u[0]]}if(e.dir1)switch("number"==typeof e.nextpos1&&(t.style[o]=e.nextpos1+"px",e.animation||t.style[o]),e.dir1){case"down":case"up":e.nextpos1+=t.offsetHeight+(void 0===e.spacing1?25:e.spacing1);break;case"left":case"right":e.nextpos1+=t.offsetWidth+(void 0===e.spacing1?25:e.spacing1)}else{var h=n/2-t.offsetWidth/2,f=i/2-t.offsetHeight/2;t.style.left=h+"px",t.style.top=f+"px",e.animation||t.style.left}return this}},queuePosition:function(e){return Y&&clearTimeout(Y),e||(e=10),Y=setTimeout(function(){W.positionAll()},e),this},cancelRemove:function(){return this.cancelClose()},cancelClose:function(){return this.get("_timer")&&clearTimeout(this.get("_timer")),this.get("_animTimer")&&clearTimeout(this.get("_animTimer")),"closing"===this.get("_state")&&this.set({_state:"open",_animating:!1,_animatingClass:"fade"===this.get("animation")?"ui-pnotify-in ui-pnotify-fade-in":"ui-pnotify-in"}),this},queueRemove:function(){return this.queueClose()},queueClose:function(){var e=this;return this.cancelClose(),this.set({_timer:setTimeout(function(){return e.close(!0)},isNaN(this.get("delay"))?0:this.get("delay"))}),this},addModuleClass:function(){for(var e=this.get("_moduleClasses"),t=arguments.length,i=Array(t),n=0;n<t;n++)i[n]=arguments[n];for(var o=0;o<i.length;o++){var s=i[o];-1===e.indexOf(s)&&e.push(s)}this.set({_moduleClasses:e})},removeModuleClass:function(){for(var e=this.get("_moduleClasses"),t=arguments.length,i=Array(t),n=0;n<t;n++)i[n]=arguments[n];for(var o=0;o<i.length;o++){var s=i[o],r=e.indexOf(s);-1!==r&&e.splice(r,1)}this.set({_moduleClasses:e})},hasModuleClass:function(){for(var e=this.get("_moduleClasses"),t=arguments.length,i=Array(t),n=0;n<t;n++)i[n]=arguments[n];for(var o=0;o<i.length;o++){var s=i[o];if(-1===e.indexOf(s))return!1}return!0}};return q(v.prototype,K,{destroy:L,get:O,fire:B,observe:U,on:M,set:z,teardown:L,_set:N,_mount:P,_unmount:R,_differs:V}),v.prototype._recompute=function(t,i){t.styling&&this._differs(i._styles,i._styles=e(i.styling))&&(t._styles=!0),t.icons&&this._differs(i._icons,i._icons=n(i.icons))&&(t._icons=!0)},function(e){W=e,W.VERSION="4.0.0-alpha.2",W.defaultStack={dir1:"down",dir2:"left",firstpos1:25,firstpos2:25,spacing1:36,spacing2:36,push:"bottom",context:window&&document.body},W.defaults={title:!1,titleTrusted:!1,text:!1,textTrusted:!1,styling:"brighttheme",icons:"brighttheme",addClass:"",cornerClass:"",autoDisplay:!0,width:"360px",minHeight:"16px",type:"notice",icon:!0,animation:"fade",animateSpeed:"normal",shadow:!0,hide:!0,delay:8e3,mouseReset:!0,remove:!0,destroy:!0,stack:W.defaultStack,modules:{}},W.notices=[],W.modules={},W.modulesPrependContainer=[],W.modulesAppendContainer=[],W.alert=function(e){return new W(X(e))},W.notice=function(e){return new W(X(e,"notice"))},W.info=function(e){return new W(X(e,"info"))},W.success=function(e){return new W(X(e,"success"))},W.error=function(e){return new W(X(e,"error"))},W.removeAll=function(){W.closeAll()},W.closeAll=function(){for(var e=0;e<W.notices.length;e++)W.notices[e].close&&W.notices[e].close(!1)},W.removeStack=function(e){W.closeStack(e)},W.closeStack=function(e){if(!1!==e)for(var t=0;t<W.notices.length;t++)W.notices[t].close&&W.notices[t].get("stack")===e&&W.notices[t].close(!1)},W.positionAll=function(){if(Y&&clearTimeout(Y),Y=null,W.notices.length>0){for(var e=0;e<W.notices.length;e++){var t=W.notices[e],i=t.get("stack");i&&(i.overlay&&G(i),i.nextpos1=i.firstpos1,i.nextpos2=i.firstpos2,i.addpos2=0)}for(var n=0;n<W.notices.length;n++)W.notices[n].position()}else delete W.defaultStack.nextpos1,delete W.defaultStack.nextpos2},W.styling={brighttheme:{container:"brighttheme",notice:"brighttheme-notice",info:"brighttheme-info",success:"brighttheme-success",error:"brighttheme-error"},bootstrap3:{container:"alert",notice:"alert-warning",info:"alert-info",success:"alert-success",error:"alert-danger",icon:"ui-pnotify-icon-bs3"},bootstrap4:{container:"alert",notice:"alert-warning",info:"alert-info",success:"alert-success",error:"alert-danger",icon:"ui-pnotify-icon-bs4",title:"ui-pnotify-title-bs4"}},W.icons={brighttheme:{notice:"brighttheme-icon-notice",info:"brighttheme-icon-info",success:"brighttheme-icon-success",error:"brighttheme-icon-error"},bootstrap3:{notice:"glyphicon glyphicon-exclamation-sign",info:"glyphicon glyphicon-info-sign",success:"glyphicon glyphicon-ok-sign",error:"glyphicon glyphicon-warning-sign"},fontawesome4:{notice:"fa fa-exclamation-circle",info:"fa fa-info-circle",success:"fa fa-check-circle",error:"fa fa-exclamation-triangle"},fontawesome5:{notice:"fas fa-exclamation-circle",info:"fas fa-info-circle",success:"fas fa-check-circle",error:"fas fa-exclamation-triangle"}},window&&document.body?Q():document.addEventListener("DOMContentLoaded",Q)}(v),v}();return e.PNotify=n}.apply(e,arguments)})}(this),define("views/notification",["jquery","underscore","backbone","models/app","pnotify"],function(e,t,i,n,o){"use strict";return i.View.extend({initialize:function(){this.listenTo(n.eventBus,"notification",this._showMessages),this.listenTo(n.eventBus,"notificationUnset",this._unset)},_showMessages:function(e){if(void 0!==e){if(void 0===e.msg){if(void 0===e.message)return;e={msg:[e]}}else if(0===e.msg.length)return;t.each(e.msg,function(e){this._showMessage(e)},this)}},_showMessage:function(t){switch(t.channel=t.channel||"notification",t.message=e.i18n.__(t.message.trim()),t.channel){case"form":this._form(t);break;case"popover":this._popover(t);break;default:this._showNotification(t)}},_unset:function(t){"all"===t&&e(".error-message").remove()},_form:function(i){var n;n=t.template('<div class="error-message"><%= message %></div>'),e(i.element).after(n({message:i.message}))},_showNotification:function(e){var t={title:e.title||!1,text:e.message,icon:!1,history:!1,addclass:"flash",delay:5e3},i=e.type;switch(i){case"success":t.addclass+=" flash-success";break;case"warning":i="notice",t.addclass+=" flash-warning";break;case"error":t.addclass+=" flash-error",t.delay=1e4;break;default:i="info",t.addclass+=" flash-notice"}o[i](t)}})}),define("views/prerequisitesTester",["jquery","marionette","models/app"],function(e,t,i){"use strict";return t.View.extend({_warningTpl:_.template('<div class="app-prerequisites-warning"> <%- warning %> </div>'),initialize:function(){this._testLocalStorage()},_testLocalStorage:function(){i.eventBus.request("app:localStorage:available")||this._addWarning(e.i18n.__("This web-application depends on Cookies and localStorage. Please make those available in your browser."))},_addWarning:function(e){this.$el.append(this._warningTpl({warning:e}))}})}),define("lib/leaflet/mq",[],function(){if("undefined"!=typeof MQ)return MQ}),define("text!modules/usermap/templates/controls.html",[],function(){return'<div class="input">\n    <% if (lat) { %>\n        <div class="saito-usermap-info infoText">\n            <%= lat %>, <%= lng %>, <%= zoom %>\n        </div>\n    <% } %>\n    <button class="btn js-btn-search"></button>\n    <% if (geolocation) { %>\n        <button class="btn js-btn-locate"><%- $.i18n.__(\'user.map.b.locate\') %></button>\n    <% } %>\n    <button class="btn js-btn-clear"><%- $.i18n.__(\'user.map.b.clear\') %></button>\n    <i class="saito-usermap-spinner fa fa-cog fa-spin" style="display: none;"></i>\n</div>'}),define("modules/usermap/views/controls",["jquery","marionette","lib/leaflet/mq","text!modules/usermap/templates/controls.html"],function(e,t,i,n){"use strict";return t.View.extend({template:_.template(n),ui:{search:".js-btn-search",locate:".js-btn-locate",clear:".js-btn-clear",spinner:".saito-usermap-spinner"},events:{"click @ui.search":"_search","click @ui.locate":"_locate","click @ui.clear":"_clear"},initialize:function(t){this.mapLayer=t.mapLayer,this.mapModel=t.mapModel,this.params=t.params,this.mapLayer.on("click",this._repin,this),this.mapLayer.on("locationfound",this._repin,this),e(this.params.fields.edit).on("keypress",_.bind(this._onSearchFieldChange,this)),e(this.params.fields.edit).on("keyup",_.bind(this._updateSearchButtonTitle,this))},_clear:function(e){e.preventDefault(),this.model.set({lat:"",lng:"",zoom:""}),this._updateFields()},_search:function(t){t.preventDefault(),this._activityStart();var n=e(this.params.fields.edit).val();i.geocode().search(n).on("success",_.bind(function(e){var t=e.result.best;this._repin(t)},this))},_onSearchFieldChange:function(e){13===e.which&&this._search(e)},_activityStart:function(){this.ui.spinner.show()},_activityStop:function(){this.ui.spinner.hide()},_updateSearchButtonTitle:function(){var t=e(this.params.fields.edit).val();if(!t)return void this.ui.search.attr("disabled","disabled");this.ui.search.removeAttr("disabled"),this.ui.search.html(e.i18n.__("user.map.b.search",{string:t}))},_locate:function(e){e.preventDefault(),this._activityStart(),this.mapLayer.locate()},_repin:function(e){var t=this._round({lat:e.latlng.lat,lng:e.latlng.lng,zoom:this.mapLayer.getZoom()});this._activityStop(),this.model.set(t),this.mapModel.set(t),this._updateFields()},_round:function(e){return _.each(["lat","lng"],function(t){e[t]=e[t].toFixed(4)}),e},onRender:function(){this._updateSearchButtonTitle()},_updateFields:function(){var t=this.params.fields.update,i=this.model;_.each(["lat","lng","zoom"],_.bind(function(n){var o=n;t&&t[n]&&_.each(t[n],function(t){var n=e(t),s=i.get(o);"input"===n.prop("tagName").toLowerCase()?n.val(s):n.html(s)})},this)),this.render()},_geolocation:function(){return"geolocation"in navigator},serializeData:function(){var e=this.model.toJSON();return e.geolocation=this._geolocation(),e}})}),define("templateHelpers",["jquery","underscore","app/vent","moment"],function(e,t,i,n){"use strict";var o=function(){this.webroot=i.vent.request("webroot")};return{Time:t.extend(new o,{moment:n,_timeFormats:{long:"DD.MM.YYYY",longWithTime:"DD.MM.YYYY HH:mm",RFC3339:"YYYY-MM-DDTHH:mm:ssZ",theRightWay:"YYYY-MM-DD HH:mm:ss",time:"HH:mm"},lastMidnight:function(){return n(this.now().format("YYYY-MM-DD"))},now:function(){return n()},_normal:function(t){var i=this.now(),n=this.lastMidnight(),o=i.diff(t)/1e3;return t.isAfter(n)||o<21600?t.format(this._timeFormats.time):o<64800?e.i18n.__("yesterday")+" "+t.format(this._timeFormats.time):t.format(this._timeFormats.long)},format:function(e,i,o){var s,r;if(i=i||"normal",o=o||{},t.defaults(o,{wrap:!0}),n.isMoment(e))r=e;else if(t.isNumber(e))(""+e).length<13&&(e=Math.round(1e3*e)),r=new n(e);else{if(!t.isDate(e))throw"No valid timestamp: "+e.toJSON();r=new n(e)}if(s="normal"===i?this._normal(r):this._timeFormats[i]?r.format(this._timeFormats[i]):r.format(i),o.wrap){var a=" ",l={title:r.format(this._timeFormats.theRightWay),datetime:r.format(this._timeFormats.RFC3339)};t.each(l,function(e,t){a+=t+'="'+e+'" '}),s="<time"+a+">"+s+"</time>"}return s}}),User:t.extend(new o,{templates:{linkToUserProfile:t.template('<a href="<%- url %>"><%- name %></a>')},linkToUserProfile:function(e,t){var i=this.urlToUserProfile(e);return this.templates.linkToUserProfile({url:i,name:t})},urlToUserProfile:function(e){return this.webroot+"users/view/"+e}})}}),define("lib/leaflet/leaflet",[],function(){if("undefined"!=typeof L)return L}),define("modules/usermap/views/map",["marionette","templateHelpers","lib/leaflet/leaflet","lib/leaflet/mq"],function(e,t,i,n){"use strict";return e.View.extend({collectionEvents:{add:"_createMarker",change:"_repinMarker"},modelEvents:{"change:lat":"_setView"},template:{},templateHelpers:t,mapLayer:null,markersLayer:null,markers:{},initialize:function(){"world"===this.model.get("type")&&this._zoomView(),this.markersLayer=new i.MarkerClusterGroup,this._map()},_zoomView:function(){var e=$("#content"),t={width:e.width(),top:e.offset().top},i={height:t.width*(120/198)},n={height:$(window).height()};n.available=n.height-t.top,i.height>n.available&&(i.height=n.available-40),this.$el.height(i.height)},_createMarker:function(e){var t,n=e.latlng(),o=i.marker(n);if(n[0]){if(e){var s=this.templateHelpers.User.linkToUserProfile(e.get("id"),e.get("name"));o.bindPopup(s)}if(this.markersLayer.addLayer(o),this.markers[e.get("id")]=o,"single"===(t=this.model.get("type"))||"edit"===t){var r={lat:e.get("lat"),lng:e.get("lng")};r.zoom="edit"===t?e.get("zoom"):this.model.get("maxZoom"),this.model.set(r)}}},_repinMarker:function(e){if(!e.get("lat"))return void this._clearMarkers();var t=this.markers[e.get("id")];if(!t)return void this._createMarker(e);var i=t.getLatLng();i.lat=e.get("lat"),i.lng=e.get("lng"),t.update()},_clearMarkers:function(){this.markers={},this.markersLayer.clearLayers()},_setView:function(){var e=this.model.get("lat"),t=this.model.get("lng"),i=this.model.get("zoom");this.mapLayer.setView([e,t],i)},_map:function(){var e=n.mapLayer();this.mapLayer=i.map(this.el,{closePopupOnClick:!1,maxZoom:this.model.get("maxZoom"),minZoom:this.model.get("minZoom"),maxBounds:this.model.get("maxBounds")}),this._setView(),this.mapLayer.addLayer(e),this.mapLayer.addLayer(this.markersLayer)}})}),define("modules/usermap/models/map",["backbone"],function(e){"use strict";return e.Model.extend({maxZoom:{edit:14,single:11,world:11},defaults:{lat:30,lng:0,zoom:2,maxZoom:11,minZoom:1,maxBounds:[[-90,-180],[90,180]]},initialize:function(){this.maxZoom[this.get("type")]&&this.set("maxZoom",this.maxZoom[this.get("type")])}})}),define("modules/usermap/models/user",["backbone"],function(e){"use strict";return e.Model.extend({latlng:function(){return[this.get("lat"),this.get("lng")]}})}),define("modules/usermap/collections/users",["backbone","modules/usermap/models/user"],function(e,t){"use strict";return e.Collection.extend({model:t})}),define("text!modules/usermap/templates/layout.html",[],function(){return"<div>\n    <div class='saito-usermap-map'></div>\n    <div class='saito-usermap-controls'></div>\n</div>"}),define("modules/usermap/usermap",["jquery","app/core","marionette","modules/usermap/views/controls","modules/usermap/views/map","modules/usermap/models/map","modules/usermap/collections/users","text!modules/usermap/templates/layout.html"],function(e,t,i,n,o,s,r,a){"use strict";return}),define("app/time",["moment","moment-de"],function(e){"use strict";var t=e().lang()._longDateFormat;t.LT="H:mm",e.lang("de",{longDateFormat:t})}),define("lib/saito/isAppVisible",["jquery","underscore","models/app"],function(e,t,i){"use strict";var n=function(){this.initialize.apply(this,arguments)};return t.extend(n.prototype,{_isVisibleOldSchool:!0,initialize:function(){i.on("isAppVisible",this.isVisible,this),this._isVisibleOldSchool=this._isAppVisibleHtml5(),this._initAppVisibleOldSchool()},isVisible:function(){return this._isVisibleOldSchool},_initAppVisibleOldSchool:function(){e(window).blur(t.bind(function(){this._isVisibleOldSchool=!1},this)),e(window).focus(t.bind(function(){this._isVisibleOldSchool=!0},this))},_isAppVisibleHtml5:function(){var e,t=!1
;return void 0!==document.hidden?e="hidden":void 0!==document.webkitHidden&&(e="webkitHidden"),document[e]&&(t=document[e]),!t}}),new n}),function(e){e.i18n={dict:null,setDictionary:function(e){this.dict=e},_:function(e,t){var i=e;return this.dict&&this.dict[e]&&(i=this.dict[e]),this.printf(i,t)},printf:function(e,t){if(!t)return e;for(var i="",n=/%(\d+)\$s/g,o=n.exec(e);o;){var s=parseInt(o[1],10)-1;e=e.replace("%"+o[1]+"$s",t[s]),o=n.exec(e)}var r=e.split("%s");if(r.length>1)for(var a=0;a<t.length;a++)r[a].length>0&&r[a].lastIndexOf("%")==r[a].length-1&&(r[a]+="s"+r.splice(a+1,1)[0]),i+=r[a]+t[a];return i+r[r.length-1]}},e.fn._t=function(t,i){return e(this).text(e.i18n._(t,i))}}(jQuery),define("lib/jquery.i18n/jquery.i18n",function(){}),define("lib/jquery.i18n/jquery.i18n.extend",["jquery","lib/jquery.i18n/jquery.i18n"],function(e){"use strict";e.extend(e.i18n,{currentString:"",setDict:function(e){this.dict=e},setUrl:function(e){this.dictUrl=e,this._loadDict()},_loadDict:function(){var t=function(e){this.dict=e};return t=e.proxy(t,this),e.ajax({url:this.dictUrl,dataType:"json",async:!1,cache:!0}).done(t)},__:function(e,t){var i=e;return"string"==typeof this.dict[e]&&""!==this.dict[e]&&(i=this.dict[e]),"object"==typeof t&&(i=this._insert(i,t)),i},_insert:function(e,t){return e.replace(/:([-\w]+)/g,function(e,i){return void 0!==t[i]?t[i]:e})}})}),function(e,t){"function"==typeof define&&define.amd?define("lib/saito/backbone.initHelper",["underscore","backbone"],function(i,n){return t(i||e._,n||e.Backbone)}):t(_,Backbone)}(this,function(e,t){t.View.prototype.initCollectionFromDom=function(e,t,i){var n=function(e,t,n){e.add({id:t}),new i({el:n,model:e.get(t),collection:e})};$(e).each(function(){n(t,$(this).data("id"),this)})}}),define("app/app",["marionette","app/core","app/vent","modules/html5-notification/html5-notification"],function(e,t,i){var n=SaitoApp,o=function(e){require(["jquery","domReady"],function(t,i){t.isReady?e():i(function(){e()})})},s={fireOnPageCallbacks:function(e){var t=e.afterAppInit;_.each(t,function(e){e()}),i.vent.on("isAppVisible",_.once(function(t){var i=e.afterViewInit;_.each(i,function(e){e()})}))},configureAjax:function(e,t){e.ajaxSetup({cache:!1}),e.ajaxPrefilter(function(e,i,n){n.crossDomain||n.setRequestHeader(t.header,t.token)})},bootstrapApp:function(e,t){require(["domReady","views/app","backbone","jquery","models/app","views/notification","views/prerequisitesTester","modules/html5-notification/html5-notification","modules/usermap/usermap","fastclick","app/time","lib/saito/isAppVisible","lib/jquery.i18n/jquery.i18n.extend","jqueryDropdown","lib/saito/backbone.initHelper","lib/saito/backbone.modelHelper","fastclick"],function(e,i,n,r,a,l,d,c,u,h){var f,p;a.settings.set(t.SaitoApp.app.settings),r.i18n.setUrl(a.settings.get("webroot")+"da/langJs"),a.currentUser.set(t.SaitoApp.currentUser),a.request=t.SaitoApp.request,s.configureAjax(r,a.request.csrf),new l;var m=t.SaitoApp.callbacks.beforeAppInit;_.each(m,function(e){e()}),window.addEventListener("load",function(){h.attach(document.body)},!1),new d({el:r(".app-prerequisites-warnings")}),f=new i,p=function(){s.fireOnPageCallbacks(t.SaitoApp.callbacks),f.initFromDom({SaitoApp:t.SaitoApp,contentTimer:t.contentTimer})},o(p)})}},r=t;return r.on("start",s.bootstrapApp),r.start({contentTimer:contentTimer,SaitoApp:n}),i.vent.reply("webroot",function(){return n.app.settings.webroot}),i.vent.reply("apiroot",function(){return n.app.settings.webroot+"api/v1/"}),r}),require.config({paths:{common:"../dist/common.min",templateHelpers:"lib/saito/templateHelpers"}}),function(e){"use strict";e.contentTimer={show:function(){$("#content").css("visibility","visible"),console.warn("DOM ready timed out: show content fallback used."),delete this.timeoutID},setup:function(){this.cancel();var t=this;this.timeoutID=e.setTimeout(function(){t.show()},5e3)},cancel:function(){"number"==typeof this.timeoutID&&(e.clearTimeout(this.timeoutID),delete this.timeoutID)}},e.contentTimer.setup()}(window),require(["lib/bootstrapHelper","common"],function(){"use strict";require(["lib/saito/underscore.extend"]),require(["app/app"])}),define("main",function(){});