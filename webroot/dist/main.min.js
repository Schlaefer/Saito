"undefined"==typeof console&&(console={},console.log=function(e){"use strict"},console.error=console.debug=console.info=console.log),window.redirect=function(e){"use strict";document.location.replace(e)},define("jquery",[],function(){"use strict";return jQuery}),define("lib/bootstrapHelper",function(){}),define("lib/saito/underscore.extend",["underscore"],function(e){"use strict";e.mixin({chars:function(e){var t;return t=e.match(/(\uD83C[\uDF00-\uDFFF]|\uD83D[\uDC00-\uDFFF])/g)||[],e.length-t.length}})}),define("app/core",["marionette"],function(e){"use strict";return new e.Application({channelName:"app"})}),define("app/vent",["marionette","backbone.radio"],function(e,t){return new function(){this.vent=t.channel("app"),this.request=function(){var e=Array.prototype.slice.apply(arguments);return this.vent.request.apply(this.reqres,e)}}}),define("models/appSetting",["underscore","backbone"],function(e,t){"use strict";return t.Model.extend({})}),define("models/appStatus",["underscore","backbone","cakeRest","app/vent"],function(e,t,i,n){"use strict";var o=t.Model.extend({stream:null,initialize:function(t,i){this.settings=i.settings,this.methodToCakePhpUrl=e.clone(this.methodToCakePhpUrl),this.methodToCakePhpUrl.read="status/"},start:function(){this._setWebroot(this.settings.get("webroot"))},_setWebroot:function(e){this.webroot=e+"status/"},_eventStream:function(){this.stream=new EventSource(this.webroot+this.methodToCakePhpUrl.read),this.stream.addEventListener("message",e.bind(function(e){var t=JSON.parse(e.data);this.set(t)},this),!1)},_poll:function(){var t,i,n,o,s,a;s=function(){void 0!==o&&clearTimeout(o)},t=function(){s(),a=1e4},n=function(){o=setTimeout(i,a)},i=e.bind(function(){n(),this.fetch({success:function(){(a=Math.floor(a*(1+a/4e4)))>9e4&&(a=9e4)},error:s})},this),this.listenTo(this,"change",function(){t(),n()}),i(),t(),n()}});return e.extend(o.prototype,i),o}),define("models/currentUser",["underscore","backbone"],function(e,t){"use strict";return t.Model.extend({isLoggedIn:function(){return this.get("id")>0}})}),define("models/app",["underscore","backbone","app/vent","models/appSetting","models/appStatus","models/currentUser"],function(e,t,i,n,o,s){"use strict";return new(t.Model.extend({eventBus:null,settings:null,status:null,currentUser:null,request:null,initialize:function(){this.eventBus=i.vent,this.settings=new n,this.status=new o({},{settings:this.settings}),this.currentUser=new s}}))}),define("modules/html5-notification/html5-notification",["models/app"],function(e){"use strict";return{_hideAfter:10,start:function(){e.eventBus.reply("app:html5-notification:activate",this._activate,this),e.eventBus.on("app:html5-notification:available",this._isEnabled,this),e.eventBus.on("html5-notification",this.notification)},notification:function(t){var i=!e.eventBus.request("isAppVisible");if((t=_.defaults(t,{icon:e.settings.get("notificationIcon"),always:!1})).always||i){var n=new window.Notification(t.title,{icon:t.icon,body:t.message});navigator.userAgent.toLowerCase().indexOf("chrome")>-1&&setTimeout(function(){n.close()},1e3*this._hideAfter)}},_activate:function(){"permission"in window.Notification&&window.Notification.permission,window.Notification.requestPermission()},_isEnabled:function(){return"Notification"in window}}}),define("models/threadline",["underscore","backbone","models/app","cakeRest"],function(e,t,i,n){"use strict";var o=t.Model.extend({defaults:{isInlineOpened:!1,shouldScrollOnInlineOpen:!0,isAlwaysShownInline:!1,isNewToUser:!1,posting:"",html:""},initialize:function(){this.webroot=i.settings.get("webroot")+"entries/",this.methodToCakePhpUrl=e.clone(this.methodToCakePhpUrl),this.methodToCakePhpUrl.read="threadLine/",this.set("isAlwaysShownInline",i.currentUser.get("user_show_inline")||!1)}});return e.extend(o.prototype,n),o}),define("collections/threadlines",["underscore","backbone","models/threadline"],function(e,t,i){return t.Collection.extend({model:i})}),define("text!templates/threadline-spinner.html",[],function(){return'<div class="js-thread_inline thread_inline" style="display:none;">\n\t<div class="js-btn-strip btn-strip-top">\n\t\t<button type="button" class="close">\n\t\t\t<i class="fa fa-close-widget"></i>\n\t\t</button>\n\t</div>\n\t<div class="threadInline-slider"></div>\n</div>\n'}),define("views/postingActionBookmark",["jquery","underscore","marionette","models/app"],function(e,t,i,n){"use strict";return i.View.extend({tagName:"a",className:"btn btn-link btn-bookmark-add",template:t.template('<i class="fa fa-lg"></i>'),events:{click:"_onClick"},modelEvents:{"change:isBookmarked":"_toggle"},initialize:function(){this._shouldRender()&&(this.$el.attr("href","#"),this.render())},_shouldRender:function(){return!!n.currentUser.isLoggedIn()},_onClick:function(e){e.preventDefault(),this.model.get("isBookmarked")?window.location=n.settings.get("webroot")+"bookmarks/index/#"+this.model.get("id"):this.model.set("isBookmarked",!0)},_toggle:function(){var t=this.$("i");this.model.get("isBookmarked")?(t.removeClass("fa-bookmark-o"),t.addClass("fa-bookmark"),this.$el.attr("title",e.i18n.__("Entry is bookmarked"))):(t.removeClass("fa-bookmark"),t.addClass("fa-bookmark-o"),this.$el.attr("title",e.i18n.__("Bookmark the entry")))},onRender:function(){this._toggle()}})}),define("text!templates/postingActionDelete.html",[],function(){return'<div class="panel">\n    <div class="panel-content">\n        <p>\n            <%- $.i18n.__(\'delete_tree_link_confirm_message\') %>\n        </p>\n    </div>\n    <div class="panel-footer panel-form">\n        <button class="btn btn-primary js-abort"><%- $.i18n.__(\'Abort\') %></button>\n        &nbsp;\n        <button class="btn btn-link js-delete"><%- $.i18n.__(\'Delete\') %></button>\n    </div>\n</div>\n'}),define("views/postingActionDelete",["jquery","underscore","marionette","models/app","text!templates/postingActionDelete.html"],function(e,t,i,n,o){"use strict";return i.View.extend({ui:{abort:".js-abort",submit:".js-delete"},events:{"click @ui.abort":"_onAbort","click @ui.submit":"_onSubmit"},template:t.template(o),_onAbort:function(e){e.preventDefault(),this.$el.dialog("close"),this.close()},_onSubmit:function(e){var t,i;e.preventDefault(),t=this.model.get("id"),i=n.settings.get("webroot")+"/entries/delete/"+t,window.location=i},onBeforeClose:function(){this.$el.dialog("destroy")},onRender:function(){this.$el.dialog({modal:!0,position:["center",120],resizable:!1,title:e.i18n.__("Delete")})}})}),define("views/postingActionSolves",["jquery","marionette","models/app"],function(e,t,i){"use strict";return t.View.extend({tagName:"a",className:"btn btn-link btn-solves",template:_.template('<i class="fa fa-badge-solves-o fa-lg"></i>'),events:{click:"_onClick"},modelEvents:{"change:isSolves":"_toggle"},initialize:function(){this._shouldRender()&&(this.$el.attr({href:"#",title:e.i18n.__("Mark entry as helpful")}),this.render())},_shouldRender:function(){return!!i.currentUser.isLoggedIn()&&(!this.model.isRoot()&&this.model.get("rootEntryUserId")===i.currentUser.get("id"))},_onClick:function(e){e.preventDefault(),this.model.toggle("isSolves")},_toggle:function(){var t=this.$("i"),i="";this.model.get("isSolves")?(t.addClass("solves-isSolved"),t.removeClass("fa-badge-solves-o"),t.addClass("fa-badge-solves"),i=this.$el.html(),i=e(i).removeClass("fa-lg")):(t.removeClass("fa-badge-solves"),t.addClass("fa-badge-solves-o"),t.removeClass("solves-isSolved")),this._toggleGlobal(i)},_toggleGlobal:function(t){e(".solves."+this.model.get("id")).html(t)},onRender:function(){this._toggle()}})}),define("views/editCountdown",["jquery","underscore","marionette","moment","jqueryTinyTimer"],function(e,t,i,n){"use strict";return i.View.extend({_editEnd:null,_buttonText:null,_$countdownDummy:null,_doneAction:"remove",initialize:function(t){this._editEnd=n(this.model.get("time")).unix()+60*t.editPeriod,n().unix()>this._editEnd||(t.done&&(this._doneAction=t.done),this._buttonText=this.$el.html(),this._$countdownDummy=e('<span style="display: none;"></span>'),this.$el.append(this._$countdownDummy),this._start())},_setButtonText:function(e){this.$el.text(this._buttonText+" "+e)},_onTick:function(e){e.m>1||1===e.m&&e.s>30?(e.m=e.m+1,this._setButtonText("("+e.m+" min)")):1===e.m?this._setButtonText("("+e.m+" min "+e.s+" s)"):this._setButtonText("("+e.s+" s)")},_onEnd:function(){switch(this._doneAction){case"disable":this._disable();break;default:this._remove()}},_remove:function(){this.remove()},_disable:function(){this.$el.attr("disabled","disabled")},_start:function(){this._$countdownDummy.tinyTimer({to:n.unix(this._editEnd).toDate(),format:"",onTick:t.bind(this._onTick,this),onEnd:t.bind(this._onEnd,this)})}})}),define("views/postingAction",["jquery","underscore","marionette","models/app","views/postingActionBookmark","views/postingActionDelete","views/postingActionSolves","views/editCountdown"],function(e,t,i,n,o,s,a,r){"use strict";return i.View.extend({ui:{btnDelete:".js-delete",btnFixed:".js-btn-toggle-fixed",btnLocked:".js-btn-toggle-locked",titleFixed:".title-toggle-fixed",titleLocked:".title-toggle-locked"},events:{"click @ui.btnDelete":"onBtnDelete","click .js-btn-setAnsweringForm":"onBtnAnswer","click @ui.btnFixed":"onToggleFixed","click @ui.btnLocked":"onToggleLocked"},_jsButtons:[o,a],initialize:function(){this._initFormElements(),this.listenTo(this.model,"change:isAnsweringFormShown",this._toggleAnsweringForm)},_initFormElements:function(){t.each(this._jsButtons,function(e){this.$el.append(new e({model:this.model}).$el)},this);var e=this.$(".js-btn-edit");if(e.length>0)new r({el:e,model:this.model,editPeriod:n.settings.get("editPeriod")})},onBtnAnswer:function(e){e.preventDefault(),this.model.set("isAnsweringFormShown",!0)},onBtnDelete:function(e){new s({model:this.model}).render();e.preventDefault()},onToggleFixed:function(e){e.preventDefault(),this._sendToggle("fixed")},onToggleLocked:function(e){e.preventDefault(),this._sendToggle("locked")},_sendToggle:function(i){var o=this.model.get("id"),s=this.$(this.ui["title"+t.startCase(i)]),a=n.settings.get("webroot")+"/entries/ajaxToggle/"+o+"/"+i;e.ajax({url:a,buffer:!1}).done(function(e){s.html(e.html)})},_toggleAnsweringForm:function(){this.model.get("isAnsweringFormShown")?this.$el.slideUp("fast"):this.$el.slideDown("fast")}})}),define("models/geshi",["underscore","backbone"],function(e,t){"use strict";return t.Model.extend({defaults:{isPlaintext:!1}})}),define("collections/geshis",["underscore","backbone","models/geshi"],function(e,t,i){return t.Collection.extend({model:i})}),define("views/geshi",["jquery","underscore","backbone","models/geshi"],function(e,t,i,n){"use strict";return i.View.extend({plainText:!1,htmlText:!1,events:{"click .geshi-plain-text":"_togglePlaintext"},initialize:function(){this.model=new n,this.collection.push(this.model),this.block=this.$(".geshi-plain-text").next(),this._setPlaintextButton(),this.listenTo(this.model,"change",this.render)},_setPlaintextButton:function(e){var t;e&&e.preventDefault(),t=this.model.get("isPlaintext")?"fa-list-ol":"fa-align-justify",this.$(".geshi-plain-text").html("<i class='fa "+t+"'></i>")},_togglePlaintext:function(e){e.preventDefault(),this.model.set("isPlaintext",!this.model.get("isPlaintext"))},_extractPlaintext:function(){!1===this.plainText&&(this.htmlText=this.block.html(),"Microsoft Internet Explorer"===navigator.appName?(this.htmlText=this.htmlText.replace(/\n\r/g,"+"),this.plainText=e(this.htmlText).text().replace(/\+\+/g,"\r")):this.plainText=this.block.text().replace(/code /g,"code \n"))},_renderText:function(){this.model.get("isPlaintext")?this.block.text(this.plainText).wrapInner('<pre class="code"></pre>'):this.block.html(this.htmlText)},render:function(){return this._setPlaintextButton(),this._extractPlaintext(),this._renderText(),this}})}),define("views/postingContent",["jquery","underscore","marionette","collections/geshis","views/geshi"],function(e,t,i,n,o){"use strict";return i.View.extend({initialize:function(){this.listenTo(this.model,"change:isAnsweringFormShown",this._toggleAnsweringForm),this.listenTo(this.model,"change:html",this.render),this._initGeshi(".geshi-wrapper")},_toggleAnsweringForm:function(){this.model.get("isAnsweringFormShown")?this._hideSignature():this._showSignature()},_showSignature:function(){this.$(".postingBody-signature").slideDown("fast")},_hideSignature:function(){this.$(".postingBody-signature").slideUp("fast")},_initGeshi:function(e){var t=this.$(e);if(t.length>0){var i=new n;t.each(function(e,t){new o({el:t,collection:i})})}},render:function(){return this.$el.html(this.model.get("html")),this._initGeshi(".geshi-wrapper"),this}})}),define("text!modules/modalDialog/templates/modalDialog.html",[],function(){return'<div class="modal-dialog" role="document">\n  <div class="modal-content">\n    <div class="modal-header">\n      <h3 class="modal-title" id="exampleModalLabel">\n        <%- title %>\n      </h3>\n      <button type="button" class="close" data-dismiss="modal" aria-label="Close">\n        <span aria-hidden="true">&times;</span>\n      </button>\n    </div>\n    <div class="modal-body">\n      <div id="saito-modal-dialog-content"></div>\n    </div>\n  </div>\n</div>\n'}),define("modules/modalDialog/modalDialog",["backbone","marionette","text!modules/modalDialog/templates/modalDialog.html"],function(e,t,i){"use strict";return new(t.View.extend({el:"#saito-modal-dialog",defaults:{width:"normal"},template:_.template(i),regions:{content:"#saito-modal-dialog-content"},initialize:function(){this.model=new e.Model({title:""})},show:function(e,t){t=_.defaults(t,this.defaults),this.model.set("title",t.title||""),this.render(),this.showChildView("content",e),this.setWidth(t.width),this.$el.modal("show")},hide:function(){this.$el.modal("hide")},setWidth:function(e){switch(e){case"max":this.$(".modal-dialog").css("max-width","95%");break;default:this.$(".modal-dialog").css("max-width","")}}}))}),define("text!templates/spinner.html",[],function(){return'<div class="spinner">\n    <div class="progress">\n        <div class="progress-bar progress-bar-striped progress-bar-animated" role="progressbar" style="width: 100%;"></div>\n    </div>\n</div>\n'}),define("views/spinnerVw",["marionette","text!templates/spinner.html"],function(e,t){"use strict";return e.View.extend({className:"spinner",template:t})}),define("text!modules/uploader/templates/uploaderAddTpl.html",[],function(){return'<form enctype="multipart/form-data">\n    <div class="card-body">\n        <div class="js-drop imageUploader-add-dropLayer"></div>\n        <div class="js-indicator imageUploader-add-dropIndicator">\n            <i class="fa fa-upload"></i>\n        </div>\n        <h2 class="card-title">\n            <%- $.i18n.__(\'Upload\') %>\n        </h2>\n        <p>\n             <%- $.i18n.__(\'upload_info\', {size: uploadSize}) %>\n        </p>\n        <div class="js-imageUploadSpinner"></div>\n    </div>\n    <div class="card-footer panel-form">\n        <div style="position: relative;">\n            <%\n            // To present a nice upload button we generate a stayled fake button.\n            // Beneath the styled dummy button is the actual input file upload,\n            // but it\'s hidden behind the opacity: 0 curtain div.\n            // z-index: 2000 to have the button above the jQuery UI modal.\n            %>\n            <button class="btn btn-primary" type="button">\n                <%- $.i18n.__("upload_btn") %>\n            </button>\n            <div class="imageUploader-add-veil">\n                <input id="Upload0File"\n                       class="btn btn-primary"\n                       type="file" name="upload[0][file]"\n                       style="width: 150px; height: 100%;">\n            </div>\n        </div>\n    </div>\n</form>\n'}),define("modules/uploader/views/uploaderAddVw",["marionette","humanize","models/app","views/spinnerVw","text!modules/uploader/templates/uploaderAddTpl.html"],function(e,t,i,n,o){"use strict";return e.View.extend({className:"imageUploader-add",template:_.template(o),templateContext:()=>({uploadSize:t.filesize(i.settings.get("upload_max_img_size"))}),ui:{dropLayer:".js-drop",indicator:".js-indicator",inputFile:"#Upload0File",heading:"h2"},regions:{spinner:".js-imageUploadSpinner"},events:{"dragleave @ui.dropLayer":"_handleDragLeave","dragover @ui.dropLayer":"_handleDragOver","drop @ui.dropLayer":"_handleDrop","change @ui.inputFile":"_uploadManual"},onRender:function(){this._initDropUploader()},_uploadManual:function(e){e.preventDefault();const t=new FormData,i=this.getUI("inputFile")[0];t.append(i.name,i.files[0]),this._send(t)},_send:function(e){this.showChildView("spinner",new n);const t=new XMLHttpRequest;t.open("POST",i.settings.get("apiroot")+"uploads"),t.setRequestHeader("Accept","application/json, text/javascript"),t.setRequestHeader("Authorization","bearer "+i.settings.get("jwt"));const o=e=>{i.eventBus.trigger("notification",{type:"error",message:e||$.i18n.__("upload_genericError")})};t.onloadend=(e=>{if(this.detachChildView("spinner"),this.render(),"2"===(""+t.status)[0])this.collection.add(JSON.parse(t.responseText).data.attributes);else{var i=null;try{i=JSON.parse(t.responseText).errors[0].title}catch(e){o()}o(i)}}),t.onerror=o,t.send(e)},_initDropUploader:function(){const e=this.getUI("dropLayer")[0];("draggable"in e||"ondragstart"in e&&"ondrop"in e)&&window.FileReader?this.getUI("heading").html($.i18n.__("upload_new_title")):this.getUI("dropLayer").remove()},_handleDrop:function(e){this._handleDragLeave(e);const t=e.originalEvent.dataTransfer.files,i=new FormData;i.append("upload[0][file]",t[0]),this._send(i)},_handleDragOver:function(e){e.preventDefault(),this.getUI("indicator").removeClass("fadeOut").addClass("fadeIn")},_handleDragLeave:function(e){e.preventDefault(),this.getUI("indicator").removeClass("fadeIn").addClass("fadeOut")}})}),define("text!modules/uploader/templates/uploadItemTpl.html",[],function(){return'<a href="<%= url %>" target="_blank">\n    <div class="card-img-container">\n        <% // @see http://samherbert.net/svg-loaders/ %>\n        <img\n            class="b-lazy card-img-top"\n            src="data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iNDQiIGhlaWdodD0iNDQiIHZpZXdCb3g9IjAgMCA0NCA0NCIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIiBzdHJva2U9IiM4ODgiPg0KICAgIDxnIGZpbGw9Im5vbmUiIGZpbGwtcnVsZT0iZXZlbm9kZCIgc3Ryb2tlLXdpZHRoPSIyIj4NCiAgICAgICAgPGNpcmNsZSBjeD0iMjIiIGN5PSIyMiIgcj0iMSI+DQogICAgICAgICAgICA8YW5pbWF0ZSBhdHRyaWJ1dGVOYW1lPSJyIg0KICAgICAgICAgICAgICAgIGJlZ2luPSIwcyIgZHVyPSIxLjhzIg0KICAgICAgICAgICAgICAgIHZhbHVlcz0iMTsgMjAiDQogICAgICAgICAgICAgICAgY2FsY01vZGU9InNwbGluZSINCiAgICAgICAgICAgICAgICBrZXlUaW1lcz0iMDsgMSINCiAgICAgICAgICAgICAgICBrZXlTcGxpbmVzPSIwLjE2NSwgMC44NCwgMC40NCwgMSINCiAgICAgICAgICAgICAgICByZXBlYXRDb3VudD0iaW5kZWZpbml0ZSIgLz4NCiAgICAgICAgICAgIDxhbmltYXRlIGF0dHJpYnV0ZU5hbWU9InN0cm9rZS1vcGFjaXR5Ig0KICAgICAgICAgICAgICAgIGJlZ2luPSIwcyIgZHVyPSIxLjhzIg0KICAgICAgICAgICAgICAgIHZhbHVlcz0iMTsgMCINCiAgICAgICAgICAgICAgICBjYWxjTW9kZT0ic3BsaW5lIg0KICAgICAgICAgICAgICAgIGtleVRpbWVzPSIwOyAxIg0KICAgICAgICAgICAgICAgIGtleVNwbGluZXM9IjAuMywgMC42MSwgMC4zNTUsIDEiDQogICAgICAgICAgICAgICAgcmVwZWF0Q291bnQ9ImluZGVmaW5pdGUiIC8+DQogICAgICAgIDwvY2lyY2xlPg0KICAgICAgICA8Y2lyY2xlIGN4PSIyMiIgY3k9IjIyIiByPSIxIj4NCiAgICAgICAgICAgIDxhbmltYXRlIGF0dHJpYnV0ZU5hbWU9InIiDQogICAgICAgICAgICAgICAgYmVnaW49Ii0wLjlzIiBkdXI9IjEuOHMiDQogICAgICAgICAgICAgICAgdmFsdWVzPSIxOyAyMCINCiAgICAgICAgICAgICAgICBjYWxjTW9kZT0ic3BsaW5lIg0KICAgICAgICAgICAgICAgIGtleVRpbWVzPSIwOyAxIg0KICAgICAgICAgICAgICAgIGtleVNwbGluZXM9IjAuMTY1LCAwLjg0LCAwLjQ0LCAxIg0KICAgICAgICAgICAgICAgIHJlcGVhdENvdW50PSJpbmRlZmluaXRlIiAvPg0KICAgICAgICAgICAgPGFuaW1hdGUgYXR0cmlidXRlTmFtZT0ic3Ryb2tlLW9wYWNpdHkiDQogICAgICAgICAgICAgICAgYmVnaW49Ii0wLjlzIiBkdXI9IjEuOHMiDQogICAgICAgICAgICAgICAgdmFsdWVzPSIxOyAwIg0KICAgICAgICAgICAgICAgIGNhbGNNb2RlPSJzcGxpbmUiDQogICAgICAgICAgICAgICAga2V5VGltZXM9IjA7IDEiDQogICAgICAgICAgICAgICAga2V5U3BsaW5lcz0iMC4zLCAwLjYxLCAwLjM1NSwgMSINCiAgICAgICAgICAgICAgICByZXBlYXRDb3VudD0iaW5kZWZpbml0ZSIgLz4NCiAgICAgICAgPC9jaXJjbGU+DQogICAgPC9nPg0KPC9zdmc+"\n            data-src="<%= thumbnail_url %>"\n            data-src1="<%= url %>"\n            >\n    </div>\n</a>\n<div class="card-footer panel-form">\n    <div class="js-rgForm"></div>\n    <button class="js-btnDelete btn btn-link">\n        <i class="fa fa-trash-o"></i>\n    </button>\n</div>\n\n'}),define("modules/uploader/views/uploaderItemVw",["underscore","marionette","models/app","text!modules/uploader/templates/uploadItemTpl.html"],function(e,t,i,n){"use strict";return t.View.extend({className:"card",regions:{rgForm:".js-rgForm"},template:e.template(n),ui:{btnDelete:".js-btnDelete"},events:{"click @ui.btnDelete":"_delete"},initialize:function(e){this.InsertVw=e.InsertVw||null},onRender:function(){this.InsertVw&&this.showChildView("rgForm",new this.InsertVw({model:this.model}))},_delete:function(e){e.preventDefault(),this.model.destroy({error:(e,t)=>{msg=t.responseJSON.errors[0],i.eventBus.trigger("notification",{message:msg,type:"error"})}})}})}),define("text!templates/noContentYetTpl.html",[],function(){return'<div class="no-content-yet">\n\t<%- content %>\n</div>\n'}),define("views/noContentYetVw",["underscore","marionette","text!templates/noContentYetTpl.html"],function(e,t,i){"use strict";return t.View.extend({template:e.template(i)})}),define("modules/uploader/views/uploaderCollectionVw",["jquery","underscore","backbone","marionette","modules/uploader/views/uploaderItemVw","views/noContentYetVw","blazy"],function(e,t,i,n,o,s,a){"use strict";return n.CollectionView.extend({className:"imageUploader-cards",childView:o,emptyView:s,collectionEvents:{add:"initLazyLoading"},emptyViewOptions:()=>({model:new i.Model({content:e.i18n.__("imageUploader.ncy")})}),childViewOptions:function(){return{InsertVw:this.InsertVw}},initialize:function(e){this.InsertVw=e.InsertVw||null},onRender:function(){this.initLazyLoading()},initLazyLoading:function(){new a}})}),define("modules/uploader/models/upload",["underscore","backbone"],function(e,t){"use strict";return t.Model.extend({parse:function(e,t){return e.attributes}})}),define("modules/uploader/collections/uploads",["underscore","backbone","models/app","modules/uploader/models/upload"],function(e,t,i,n){"use strict";return t.Collection.extend({model:n,initialize:function(e){this.url=i.settings.get("apiroot")+"uploads/"},comparator:function(e){return-1*e.get("id")},parse:function(e,t){return e.data}})}),define("text!modules/uploader/templates/uploaderTpl.html",[],function(){return'<div class="imageUploader">\n    <div class="js-imageUploader-add card"></div>\n    <div class="js-imageUploader-list"></div>\n</div>\n'}),define("modules/uploader/uploader",["underscore","marionette","modules/uploader/views/uploaderAddVw","modules/uploader/views/uploaderCollectionVw","modules/uploader/collections/uploads","views/spinnerVw","text!modules/uploader/templates/uploaderTpl.html"],function(e,t,i,n,o,s,a){"use strict";return t.View.extend({regions:{addRegion:".js-imageUploader-add",collectionRegion:".js-imageUploader-list"},template:e.template(a),initialize:function(e){this.collection=new o,this.InsertVw=e.InsertVw||null},onRender:function(){this.showChildView("addRegion",new i({collection:this.collection})),this.showChildView("collectionRegion",new s),this.collection.fetch({success:e=>{const t=new n({collection:e,InsertVw:this.InsertVw});this.showChildView("collectionRegion",t)}})}})}),define("lib/saito/markItUp.media",["jquery","underscore"],function(e,t){"use strict";var i={_preFilters:{dropbox:{cleanUp:function(e){return e.replace(/https:\/\/www\.dropbox\.com\//,"https://dl.dropbox.com/")}},youtube:{cleanUp:function(e){var t,i,n=e;if(!1===/http/.test(e)&&(n="http://"+e),!(t=/(http|https):\/\/(\w+:?\w*@)?(\S+)(:[0-9]+)?(\/|\/([\w#!:.?+=&%@!\-\/]))?/i).test(n))return e;switch(n.match(/(https?:\/\/)?(www\.)?(.[^\/:]+)/i).pop()){case"youtu.be":(t=/youtu.be\/(.*?)(&.*)?$/).test(n)&&(i=n.match(t)[1]);break;case"youtube.com":(t=/v=(.*?)(&.*)?$/).test(n)&&(i=n.match(t)[1])}return void 0!==i&&(e=this._createIframe({src:"//www.youtube.com/embed/"+i})),e},_createIframe:function(e){var i,n;return i={width:560,height:315,frameborder:0,allowfullscreen:"allowfullscreen"},t.defaults(e,i),n=function(e,t,i){return e+i+'="'+t+'" '},"<iframe "+t.reduce(e,n,"").trim()+"></iframe>"}}},multimedia:function(n,o){var s=e.trim(n),a=new RegExp("\\.(png|gif|jpg|jpeg|webp)([\\/?]|$)","i"),r=new RegExp("\\.(mp4|webm|m4v)([\\/?]|$)","i"),l=new RegExp("\\.(m4a|ogg|mp3|wav|opus)([\\/?]|$)","i"),d="";return o=o||{},t.defaults(o,{embedlyEnabled:!1}),t.each(this._preFilters,function(e){s=e.cleanUp(s)}),a.test(s)?d=i._image(s):r.test(s)?d=i._videoHtml5(s):l.test(s)?d=i._audioHtml5(s):/<iframe/i.test(s)?d=i._videoIframe(s):/<object/i.test(s)&&(d=i._videoFlash(s)),!0===o.embedlyEnabled&&""===d&&(d=i._embedly(s)),d},_image:function(e){return"[img]"+e+"[/img]"},_videoFlash:function(e){var t="[flash_video]URL|WIDTH|HEIGHT[/flash_video]";return null!==e?t=(t=(t=t.replace("WIDTH",/width="(\d+)"/.exec(e)[1])).replace("HEIGHT",/height="(\d+)"/.exec(e)[1])).replace("URL",/src="([^"]+)"/.exec(e)[1]):""},_videoHtml5:function(e){return"[video]"+e+"[/video]"},_audioHtml5:function(e){return"[audio]"+e+"[/audio]"},_videoIframe:function(e){var t=/<iframe(.*?)>.*?<\/iframe>/i.exec(e)[1];return"[iframe"+(t=t.replace(/["']/g,""))+"][/iframe]"},_embedly:function(e){return"[embed]"+e+"[/embed]"}};return i}),define("text!templates/mediaInsert.html",[],function(){return'<div id=\'markitup_media\' style="overflow: hidden;">\n    <div class="panel">\n        <div class="panel-content panel-form">\n            <form action="#" style="width: 100%;">\n                <label for="markitup_media_txta">\n                    <%- $.i18n.__(\'Enter link to media or embedding code:\') %>\n                </label>\n                <textarea name="data[media]" id="markitup_media_txta" rows="6"\n                        columns="20"></textarea>\n                <input class="btn btn-primary" id="markitup_media_btn" type="submit"\n                    value="<%- $.i18n.__(\'Insert\') %>">\n\n                <div id="markitup_media_message" class="flash error"\n                    style="display: none;">\n                    <%- $.i18n.__(\'Nothing recognized.\') %>\n                </div>\n            </form>\n        </div>\n    </div>\n</div>'}),define("views/mediaInsert",["jquery","underscore","marionette","models/app","lib/saito/markItUp.media","modules/modalDialog/modalDialog","text!templates/mediaInsert.html"],function(e,t,i,n,o,s,a){"use strict";return i.View.extend({ui:{message:"#markitup_media_message",submit:"#markitup_media_btn",textarea:"#markitup_media_txta"},template:t.template(a),events:{"click @ui.submit":"_insert"},initialize:function(){void 0!==this.model&&null!==this.model&&this.listenTo(this.model,"change:isAnsweringFormShown",this.remove)},_insert:function(t){t.preventDefault();const i=o.multimedia(this.getUI("textarea").val(),{embedlyEnabled:!0===n.settings.get("embedly_enabled")});""===i?this._invalidInput():(e.markItUp({replaceWith:i}),this._closeDialog())},_invalidInput:function(){this.getUI("message").show(),s.$el.effect("shake",{times:2},250)},_closeDialog:function(){s.closeDialog()},_showDialog:function(){s.show(this,{title:e.i18n.__("Multimedia")}),s.on("hidden.bs.modal",function(t){setTimeout(function(){e("#markitup_media_txta").focus()},210)})},onRender:function(){this._showDialog()}})}),define("models/preview",["underscore","backbone","models/app"],function(e,t,i){"use strict";return t.Model.extend({defaults:{isFetchingData:!1,rendered:null,data:null},initialize:function(){this.webroot=i.settings.get("webroot"),this.listenTo(this,"change:data",this._fetchRendered)},_fetchRendered:function(){this.set("fetchingData",!0),$.post(this.webroot+"entries/preview/",this.get("data"),e.bind(function(e){this.set("fetchingData",!1),this.set("rendered",e.html),i.eventBus.trigger("notificationUnset","all"),i.eventBus.trigger("notification",e)},this),"json")}})}),define("views/preview",["jquery","underscore","marionette","text!templates/spinner.html"],function(e,t,i,n){"use strict";return i.View.extend({templates:{content:t.template("<%= rendered %>"),spinner:t.template(n)},modelEvents:{"change:fetchingData":"_fetchingData","change:rendered":"render"},_fetchingData:function(){this.model.get("fetchingData")&&this.render()},getTemplate:function(){return this.model.get("fetchingData")?this.templates.spinner:this.templates.content}})}),function(e){"use strict";var t={_scrollToTop:function(t){e("body").animate({scrollTop:t.offset().top-10,easing:"swing"},300)},_scrollToBottom:function(i){e("body").animate({scrollTop:t._elementBottom(i)-e(window).height()+20,easing:"swing"},300,function(){t._isHeigherThanView(i)&&t._scrollToTop(i)})},_elementBottom:function(e){return e.offset().top+e.height()},_isScrolledIntoView:function(i){if(0===e(i).length)return!0;var n=e(window).scrollTop(),o=n+e(window).height(),s=e(i).offset().top;return t._elementBottom(i)<=o&&s>=n},_isHeigherThanView:function(t){return e(window).height()<=t.height()}},i={top:function(){var i;return i=e(this),t._isScrolledIntoView(i)||t._scrollToTop(i),this},bottom:function(){var i;return i=e(this),t._isScrolledIntoView(i)||t._scrollToBottom(i),this},isInView:function(){var i;return i=e(this),t._isScrolledIntoView(i)}};e.fn.scrollIntoView=function(t){return i[t]?i[t].apply(this,Array.prototype.slice.call(arguments,1)):"object"!=typeof t&&t?void e.error("Method "+t+" does not exist on jQuery.scrollIntoView"):i.init.apply(this,arguments)}}(jQuery),define("lib/saito/jquery.scrollIntoView",function(){}),function(e,t){"use strict";"function"==typeof define&&define.amd?define("lib/saito/jquery.insertAtCaret",["jquery"],function(e){return t(e)}):t(jQuery)}(0,function(e){"use strict";e.fn.insertAtCaret=function(e){var t,i=this[0],n=0,o=i.selectionStart||"0"===i.selectionStart?"standard":!!document.selection&&"ie";"ie"===o?(i.focus(),(t=document.selection.createRange()).moveStart("character",-i.value.length),n=t.text.length):"standard"===o&&(n=i.selectionStart);var s=i.value.substring(0,n),a=i.value.substring(n,i.value.length);return i.value=s+e+a,n+=e.length,"ie"===o?(i.focus(),(t=document.selection.createRange()).moveStart("character",-i.value.length),t.moveStart("character",n),t.moveEnd("character",0),t.select()):"standard"===o&&(i.selectionStart=n,i.selectionEnd=n,i.focus()),this}}),define("views/answering",["jquery","underscore","backbone","marionette","models/app","modules/modalDialog/modalDialog","modules/uploader/uploader","views/mediaInsert","views/editCountdown","models/preview","views/preview","lib/saito/jquery.scrollIntoView","jqueryAutosize","lib/saito/jquery.insertAtCaret"],function(e,t,i,n,o,s,a,r,l,d,c){"use strict";return i.View.extend({_requestUrl:null,rendered:!1,answeringForm:!1,preview:!1,sendInProgress:!1,_action:null,model:null,events:{"click .js-btnCite":"_cite","click .js-btnPreviewClose":"_closePreview","click .btn-preview":"_showPreview","click .btn-markItUp-Upload":"_upload","click .btn-markItUp-Media":"_media","click .btn-primary":"_send","keypress .js-subject":"_onKeyPressSubject","input .js-subject":"_updateSubjectCharCount"},initialize:function(e){t.defaults(e,{ajax:!0,parentThreadline:null}),this.options=e,!1===this.options.ajax&&this._onFormReady(),this._requestUrl=o.settings.get("webroot")+"entries/add/"+this.model.get("id"),this.listenTo(o.eventBus,"isAppVisible",this._focusSubject)},_disable:function(){this.$(".btn.btn-primary").attr("disabled","disabled")},_enable:function(){this.$(".btn.btn-primary").removeAttr("disabled")},_cite:function(e){const t=this.$(".js-btnCite").data("text"),i=this.$textarea.val();e.preventDefault(),this.$textarea.val(t+"\n\n"+i),this.$textarea.trigger("autosize.resize"),this.$textarea.focus()},_onKeyPressSubject:function(e){13===e.keyCode&&this._send(e)},_updateSubjectCharCount:function(){var e,t;t=this.$(".postingform-subject-count"),e=o.settings.get("subject_maxlength")-this.$(".js-subject").val().length,t.html(e)},_upload:function(i){i&&i.preventDefault();const o=this,r=n.View.extend({template:t.template('<button class="btn btn-primary"><%- title %></button>'),events:{"click button":"handleInsert"},templateContext:()=>({title:e.i18n.__("upload_btn_insert_into_posting")}),handleInsert:function(e){e.preventDefault(),o._insert("[upload]"+this.model.get("name")+"[/upload]"),s.hide()}}),l=new a({el:"#markitup_upload",className:"imageUploader",textarea:this.$textarea[0],InsertVw:r});s.show(l,{title:e.i18n.__("Upload"),width:"max"}),l.render()},_insert:function(e){this.$("textarea").insertAtCaret(e)},_media:function(e){e.preventDefault(),this.mediaView=new r({model:this.model}),this.mediaView.render()},_showPreview:function(e){var t;e.preventDefault(),this.$(".preview").slideDown("fast"),!1===this.preview&&(t=new d,this.preview=new c({el:this.$(".preview .panel-content"),model:t})),this.preview.model.set("data",this.$("form").serialize())},_closePreview:function(e){e.preventDefault(),this.$(".preview").slideUp("fast")},_setupTextArea:function(){this.$textarea=this.$("textarea"),this.$textarea.autosize()},_requestAnsweringForm:function(){e.ajax({cache:!0,url:this._requestUrl,success:t.bind(function(e){this.answeringForm=e,this.render()},this)})},_postRendering:function(){this.$el.scrollIntoView("bottom"),this._focusSubject(),this._onFormReady()},_onFormReady:function(){var e,t;this._setupTextArea(),this._updateSubjectCharCount(),(e=this.$(".js-data")).length>0&&"edit"===e.data("meta").action&&(t=this.$(".js-data").data("entry"),this.model.set(t,{silent:!0}),this._addCountdown()),o.eventBus.trigger("change:DOM")},_addCountdown:function(){var e=this.$(".js-btn-primary");new l({el:e,model:this.model,editPeriod:o.settings.get("editPeriod"),done:"disable"})},_focusSubject:function(){window.navigator.userAgent.match("iPad|iPhone")||this.$(".postingform input[type=text]:first").focus()},_send:function(e){this.sendInProgress?e.preventDefault():(this.sendInProgress=!0,this.options.parentThreadline?this._sendInline(e):this._sendRedirect(e))},_sendRedirect:function(i){var n=this.$(".btn-primary")[0];i.preventDefault(),"object"==typeof n.validity&&!1===n.form.checkValidity()?(t.bind(function(){this.checkValidityDummy||(this.checkValidityDummy=e("<button></button>",{type:"submit",style:"display: none;"}),e(n).after(this.checkValidityDummy)),this.checkValidityDummy.click()},this)(),this.sendInProgress=!1):(n.disabled=!0,n.form.submit())},_sendInline:function(i){var n,s,a,r;i.preventDefault(),n=this.$("#EntryAddForm").serialize(),r=t.bind(function(e){this.model.set({isAnsweringFormShown:!1}),null!==this.options.parentThreadline&&this.options.parentThreadline.set("isInlineOpened",!1),o.eventBus.trigger("newEntry",{tid:e.tid,pid:this.model.get("id"),id:e.id,isNewToUser:!0})},this),a=t.bind(function(e,t){this.sendInProgress=!1,this._enable(),o.eventBus.trigger("notification",{title:t,type:"error",message:e.responseText})},this),s=t.bind(this._disable,this),e.ajax({url:this._requestUrl,type:"POST",dataType:"json",data:n,beforeSend:s}).done(r).fail(a)},render:function(){return!1===this.answeringForm?this._requestAnsweringForm():!1===this.rendered?(this.rendered=!0,this.$el.html(this.answeringForm),t.defer(function(e){e._postRendering()},this)):o.eventBus.trigger("change:DOM"),this}})}),define("views/postingSlider",["jquery","marionette","models/app","views/answering","text!templates/spinner.html"],function(e,t,i,n,o){"use strict";return t.View.extend({answeringForm:!1,ui:{btnClose:".js-btnAnsweringClose"},events:{"click @ui.btnClose":"onBtnClose"},initialize:function(e){this.parentThreadline=e.parentThreadline||null,this.listenTo(this.model,"change:isAnsweringFormShown",this.toggleAnsweringForm)},onBtnClose:function(e){e.preventDefault(),this.model.set("isAnsweringFormShown",!1)},toggleAnsweringForm:function(){this.model.get("isAnsweringFormShown")?(this._hideAllAnsweringForms(),this._showAnsweringForm()):this._hideAnsweringForm()},_showAnsweringForm:function(){i.eventBus.trigger("breakAutoreload"),!1===this.answeringForm&&this.$el.html(o),this.$el.slideDown("fast"),!1===this.answeringForm&&(this.answeringForm=new n({el:this.$el,model:this.model,parentThreadline:this.parentThreadline})),this.answeringForm.render()},_hideAnsweringForm:function(){this.$el.slideUp("fast",function(){i.eventBus.trigger("change:DOM")})},_hideAllAnsweringForms:function(){this.collection.forEach(function(e){e.get("id")!==this.model.get("id")&&e.set("isAnsweringFormShown",!1)},this)}})}),define("views/postingLayout",["underscore","marionette","app/vent","views/postingAction","views/postingContent","views/postingSlider","text!templates/spinner.html"],function(e,t,i,n,o,s,a){"use strict";return t.View.extend({initialize:function(t){e.defaults(t,{inline:!1,parentThreadline:!1}),t.inline?this._loadData(t):this._dataReady(t)},_loadData:function(t){this.$el.html(a),this.model.fetchHtml({success:e.bind(function(){this.$el.html(this.model.get("html")),this._dataReady(t)},this)})},_dataReady:function(e){var t=this.$(".js-data").data("entry");this.model.set(t,{silent:!0});new o({el:this.$(".postingBody"),model:this.model}),new n({el:this.$(".postingLayout-actions"),model:this.model}),new s({el:this.$(".postingLayout-slider"),model:this.model,collection:this.collection,parentThreadline:e.parentThreadline});i.vent.trigger("Vent.Posting.View.afterRender",{$el:this.$el})}})}),function(e,t){"use strict";"function"==typeof define&&define.amd?define("lib/saito/backbone.modelHelper",["underscore","backbone"],function(i,n){return t(i||e._,n||e.Backbone)}):t(_,Backbone)}(this,function(e,t){"use strict";t.Model.prototype.toggle=function(e){this.set(e,!this.get(e))}}),define("models/posting",["underscore","backbone","models/app","lib/saito/backbone.modelHelper"],function(e,t,i){"use strict";return t.Model.extend({defaults:{isBookmarked:!1,isSolves:!1,isAnsweringFormShown:!1,html:""},initialize:function(){this.listenTo(this,"change:isSolves",this.syncSolved),this.listenTo(this,"change:isBookmarked",this.syncBookmarked)},isRoot:function(){var t=this.get("pid");if(!e.isNumber(t))throw"pid is not a number.";return 0===t},syncBookmarked:function(){this.get("isBookmarked")&&$.ajax({url:i.settings.get("webroot")+"bookmarks/add",type:"POST",dataType:"json",data:"id="+this.get("id")})},syncSolved:function(){$.ajax({url:i.settings.get("webroot")+"entries/solve/"+this.get("id"),type:"POST",dateType:"json"})},fetchHtml:function(t){$.ajax({success:e.bind(function(e){this.set("html",e),t&&t.success&&t.success()},this),type:"POST",dateType:"html",url:i.settings.get("webroot")+"entries/view/"+this.get("id")})}})}),define("views/threadlines",["jquery","underscore","marionette","models/app","models/threadline","text!templates/threadline-spinner.html","views/postingLayout","models/posting","lib/saito/jquery.scrollIntoView"],function(e,t,i,n,o,s,a,r){"use strict";return i.View.extend({className:"threadLeaf",tagName:"li",spinnerTpl:s,postings:null,ui:{btnShowThread:".btn_show_thread",btnClose:".js-btn-strip",linkShowThread:".link_show_thread"},events:{"click @ui.btnShowThread":"toggleInlineOpen","click @ui.linkShowThread":"toggleInlineOpenFromLink","click @ui.btnClose":"toggleInlineOpen"},initialize:function(e){this.postings=e.postings,this.model=new o({id:e.leafData.id,isNewToUser:e.leafData.isNewToUser}),void 0===e.el?this.model.fetch():this.model.set({html:this.el}),this.collection.add(this.model,{silent:!0}),this.attributes={"data-id":e.id},this.listenTo(this.model,"change:isInlineOpened",this._toggleInlineOpened),this.listenTo(this.model,"change:html",this.render)},toggleInlineOpenFromLink:function(e){this.model.get("isAlwaysShownInline")&&this.toggleInlineOpen(e)},toggleInlineOpen:function(e){e.preventDefault(),this.model.toggle("isInlineOpened")},_toggleInlineOpened:function(e,t){t?(this.model.get("isContentLoaded")||(this.$(".threadLine").after(this.spinnerTpl),this._insertContent(),this.model.set("isContentLoaded",!0)),this._showInlineView()):this._closeInlineView()},_insertContent:function(){var e=this.model.get("id");this.postingModel=new r({id:e}),this.postings.add(this.postingModel),new a({el:this.$(".threadInline-slider"),inline:!0,model:this.postingModel,collection:this.postings,parentThreadline:this.model})},_showInlineView:function(){var e=t.bind(function(){this.model.get("shouldScrollOnInlineOpen")?!1===this.$el.scrollIntoView("isInView")&&this.$el.scrollIntoView("bottom"):this.model.set("shouldScrollOnInlineOpen",!0)},this);this.$(".threadLine").fadeOut(100,t.bind(function(){this.$(".js-thread_inline").show(0,e)},this))},_closeInlineView:function(){n.eventBus.trigger("change:DOM"),this.$(".js-thread_inline").hide(0,t.bind(function(){this.$el.find(".threadLine").slideDown(),this._scrollLineIntoView()},this))},_scrollLineIntoView:function(){var e=this.$(".threadLine");e.scrollIntoView("isInView")||e.scrollIntoView("top").effect("highlight",{times:1},3e3)},render:function(){var t,i;return this.model.get("html").length>0&&(t=this.$el,i=e(this.model.get("html")),this.setElement(i),t.replaceWith(i)),this}})}),define("models/thread",["underscore","backbone","collections/threadlines"],function(e,t,i){"use strict";return t.Model.extend({defaults:{isThreadCollapsed:!1},initialize:function(){this.threadlines=new i}})}),define("lib/saito/localStorageHelper",["underscore","app/vent"],function(e,t){"use strict";var i=function(){};e.extend(i.prototype,{_available:null,_prefix:"saito-",available:function(){return null===this._available&&(this._available=this._isAvailable()),this._available},_clear:function(){if(this.available()){var t=Object.keys(localStorage);e.each(t,function(e){0===e.indexOf(this._prefix)&&localStorage.removeItem(e)},this)}},_key:function(e){return this._prefix+e},_isAvailable:function(){if(!("localStorage"in window))return!1;try{var e="localStorageAvailableTestKey",t=window.localStorage;return t.setItem(e,"1"),t.removeItem(e),!0}catch(e){return!1}return!1}});var n=new i;t.vent.reply("app:localStorage:available",n.available,n),t.vent.reply("app:localStorage:key",n._key,n),t.vent.on("app:localStorage:clear",n._clear,n)}),define("collections/threads",["underscore","backbone","models/thread","models/app","backboneLocalStorage","lib/saito/localStorageHelper"],function(e,t,i,n){"use strict";var o;return t.Collection.extend({model:i,localStorage:(o=n.eventBus.request("app:localStorage:key","Threads"),new t.LocalStorage(o)),fetch:function(e){if(n.eventBus.request("app:localStorage:available"))return t.Model.prototype.fetch.call(this,e)}})}),define("views/thread",["jquery","underscore","backbone","models/app","collections/threadlines","views/threadlines"],function(e,t,i,n,o,s){"use strict";return i.View.extend({className:"threadBox",events:{"click .btn-threadCollapse":"collapseThread"},initialize:function(t){this.postings=t.postings,this.$rootUl=this.$("ul.root"),this.$subThreadRootIl=e(this.$rootUl.find("li:not(:first-child)")[0]),this.model.get("isThreadCollapsed")?this.hide():this.show(),n.eventBus.request("app:localStorage:available")||this._hideCollapseButton(),this.listenTo(n.eventBus,"newEntry",this._showNewThreadLine),this.listenTo(this.model,"change:isThreadCollapsed",this.toggleCollapseThread)},_showNewThreadLine:function(e){var t;e.tid===this.model.get("id")&&(t=new s({leafData:e,collection:this.model.threadlines,postings:this.postings}),this._appendThreadlineToThread(e.pid,t.render().$el))},_appendThreadlineToThread:function(e,t){var i,n;0===(n=(i=this.$('.threadLeaf[data-id="'+e+'"]')).next().not(".js_threadline").find("ul:first")).length?t.wrap('<ul class="threadTree-node"></ul>').parent().wrap("<li></li>").parent().insertAfter(i):n.append(t)},_hideCollapseButton:function(){this.$(".btn-threadCollapse").css("visibility","hidden")},collapseThread:function(e){e.preventDefault(),this.closeAllThreadlines(),this.model.toggle("isThreadCollapsed"),this.model.save()},toggleCollapseThread:function(e,t){t?this.slideUp():this.slideDown()},closeAllThreadlines:function(e){var i=this.model.threadlines.where({isInlineOpened:!0});t.each(i,function(e){e.set({isInlineOpened:!1})}),e&&e.preventDefault()},slideUp:function(){this.$subThreadRootIl.slideUp(300),this.markHidden()},slideDown:function(){this.$subThreadRootIl.slideDown(300),this.markShown()},hide:function(){this.$subThreadRootIl.hide(),this.markHidden()},show:function(){this.$subThreadRootIl.show(),this.markShown()},markShown:function(){e(this.el).find(".fa-thread-closed").removeClass("fa-thread-closed").addClass("fa-thread-open")},markHidden:function(){e(this.el).find(".fa-thread-open").removeClass("fa-thread-open").addClass("fa-thread-closed")}})}),define("collections/postings",["underscore","backbone","models/posting"],function(e,t,i){return t.Collection.extend({model:i})}),define("models/bookmark",["underscore","backbone","models/app","cakeRest"],function(e,t,i,n){"use strict";var o=t.Model.extend({initialize:function(){this.webroot=i.settings.get("webroot")+"bookmarks/"}});return e.extend(o.prototype,n),o}),define("collections/bookmarks",["underscore","backbone","models/bookmark"],function(e,t,i){return t.Collection.extend({model:i})}),define("views/bookmark",["jquery","underscore","backbone"],function(e,t,i){"use strict";return i.View.extend({events:{"click .btn-bookmark-delete":"deleteBookmark"},initialize:function(){t.bindAll(this,"render"),this.model.on("destroy",this.removeBookmark,this)},deleteBookmark:function(e){e.preventDefault(),this.model.destroy()},removeBookmark:function(){var t=this.collection;this.$el.hide("slide",null,500,function(){e(this).remove(),t.trigger("bookmark.removed")})}})}),define("views/bookmarks",["jquery","underscore","backbone","views/bookmark","text!templates/noContentYetTpl.html"],function(e,t,i,n,o){"use strict";return i.View.extend({initialize:function(){this.initCollectionFromDom(".js-bookmark",this.collection,n),this._fillNoContentYet(),this.listenTo(this.collection,"bookmark.removed",this._fillNoContentYet)},_fillNoContentYet:function(){this.collection.isEmpty()&&this.$el.html(t.template(o)({content:e.i18n.__("ncy.bkm")}))}})}),define("views/helps",["jquery","underscore","backbone","models/app","drop"],function(e,t,i,n,o){"use strict";return i.View.extend({isHelpShown:!1,_popups:[],_elements:null,tpl:t.template('<a href="<%= webroot %>help/<%= id %>" target="_blank"><i class="fa fa-question-circle"></i></a>'),events:function(){var e={};return e["click "+this.indicatorName]="toggle",e},initialize:function(e){this.indicatorName=e.indicatorName,this.elementName=e.elementName,this.webroot=e.webroot,this.activateHelpButton(),this.listenTo(n.eventBus,"change:DOM",this._onDomChange)},activateHelpButton:function(){var t=e(this.indicatorName);t&&(this._isHelpOnPage()?t.addClass("is-active"):t.removeClass("is-active"))},_onDomChange:function(){this.activateHelpButton(),this._reset()},_isHelpOnPage:function(){return this._getElements().length>0},toggle:function(e){e.preventDefault(),this.isHelpShown?this._hide():this._show()},_reset:function(){this._hide(),this._elements=null,this._popups=[]},_getElements:function(){return null===this._elements&&(this._elements=this.$(this.elementName).filter(":visible")),this._elements},_show:function(){if(this.isHelpShown=!0,this._isHelpOnPage()){if(0===this._popups.length){var t=this;this._getElements().each(function(){var i=e(this).data("shpid"),n=t.tpl({id:i,webroot:t.webroot});t._popups.push(new o({target:this,content:n,classes:"drop-theme-arrows",position:"top center"}))})}this._popups.forEach(function(e){e.open()})}},_hide:function(){this.isHelpShown=!1,this._popups.forEach(function(e){e.destroy()})}})}),define("views/categoryChooser",["jquery","underscore","marionette","modules/modalDialog/modalDialog"],function(e,t,i,n){"use strict";return i.View.extend({template:"#tpl-categoryChooser",modelEvents:{"change:isOpen":"_handleStateIsOpen"},initialize:function(){this.model=new Backbone.Model({defaults:{isOpen:!1}})},_handleStateIsOpen:function(t,i){i&&(n.show(this,{title:e.i18n.__("Categories")}),n.on("close",()=>{this.model.set("isOpen",!1)}))}})}),define("modules/slidetabs/views/slidetab",["jquery","underscore","backbone"],function(e,t,i){"use strict";return i.View.extend({events:{"click .slidetab-tab":"clickSlidetab"},initialize:function(){this.model.set({isOpen:this.isOpen()},{silent:!0}),this.listenTo(this.model,"change",this.toggleSlidetab)},isOpen:function(){return this.$el.find(".slidetab-outer").is(":visible")},clickSlidetab:function(e){this.model.save("isOpen",!this.model.get("isOpen"))},toggleSlidetab:function(){this.model.get("isOpen")?this.show():this.hide(),this.toggleSlidetabTabInfo()},show:function(){this.$el.animate({width:280}),this.$el.addClass("is-open")},hide:function(){this.$el.animate({width:28},t.bind(function(){this.$el.removeClass("is-open")},this))},toggleSlidetabTabInfo:function(){this.$el.find(".slidetab-tab-info").toggle()}})}),define("modules/slidetabs/models/slidetab",["jquery","underscore","backbone","app/vent","models/app"],function(e,t,i,n,o){"use strict";return i.Model.extend({defaults:{isOpen:!1},initialize:function(){this.webroot=o.settings.get("webroot"),this.listenTo(this,"change:isOpen",this.onChangeIsOpen)},onChangeIsOpen:function(){n.vent.trigger("slidetab:open",{slidetab:this.get("id"),open:this.get("isOpen")})},sync:function(){var t="show_"+this.get("id");e.post(this.webroot+"users/slidetabToggle",{slidetabKey:t})}})}),define("modules/slidetabs/collections/slidetabs",["underscore","backbone","models/app","modules/slidetabs/models/slidetab"],function(e,t,i,n){"use strict";return t.Collection.extend({model:n,initialize:function(){i.eventBus.reply("slidetab:open",this.isOpen,this)},isOpen:function(e){return this.get(e).get("isOpen")}})}),define("modules/slidetabs/slidetabs",["jquery","underscore","marionette","models/app","modules/slidetabs/views/slidetab","modules/slidetabs/collections/slidetabs"],function(e,t,i,n,o,s){"use strict";return i.View.extend({el:"#slidetabs",initialize:function(){this.collection=new s,this.webroot=n.settings.get("webroot"),this.initCollectionFromDom(".slidetab",this.collection,o),this.makeSortable()},makeSortable:function(){const i=this.webroot;this.$el.sortable({handle:".slidetab-tab",start:t.bind(function(e,t){this.$el.css("overflow","visible")},this),stop:t.bind(function(e,t){this.$el.css("overflow","hidden")},this),update:function(t,n){var o=e(this).sortable("toArray",{attribute:"data-id"});o=o.map(function(e){return"slidetab_"+e}),e.post(i+"users/slidetabOrder",{slidetabOrder:o})}})}})}),define("views/loginView",["marionette"],function(e){"use strict";return e.View.extend({template:"#tpl-modalLoginDialog"})}),define("views/app",["jquery","underscore","marionette","models/app","collections/threadlines","views/threadlines","collections/threads","views/thread","collections/postings","models/posting","views/postingLayout","collections/bookmarks","views/bookmarks","views/helps","views/categoryChooser","modules/slidetabs/slidetabs","views/answering","views/loginView","modules/modalDialog/modalDialog","jqueryUi"],function(e,t,i,n,o,s,a,r,l,d,c,u,h,f,m,p,g,b,v){"use strict";return i.View.extend({el:e("body"),regions:{modalDialog:"#saito-modal-dialog",slidetabs:"#slidetabs"},autoPageReloadTimer:!1,_domInitializers:{".entry.add-not-inline":"_initAnsweringNotInlined","#bookmarks":"_initBookmarks","#slidetabs":function(){this.showChildView("slidetabs",new p)},".js-entry-view-core":"_initPostings",".threadBox":"_initThreadBoxes",".threadLeaf":"_initThreadLeafs",".users.logout":"_initLogout"},ui:{categoryChooserBtn:"#btn-category-chooser"},events:{"click #showLoginForm":"showLoginForm","focus #header-searchField":"widenSearchField","click .js-scrollToTop":"scrollToTop","click #btn-manuallyMarkAsRead":"manuallyMarkAsRead","click @ui.categoryChooserBtn":"toggleCategoryChooser","click #btn_header_logo":"_onEntriesIndexReload"},initialize:function(){this.threads=new a,"Entries"===n.request.controller&&"index"===n.request.action&&this.threads.fetch(),this.postings=new l,this.threadLines=new o,this.listenTo(n.eventBus,"initAutoreload",this.initAutoreload),this.listenTo(n.eventBus,"breakAutoreload",this.breakAutoreload)},initFromDom:function(i){if(this.showChildView("modalDialog",v),t.each(this._domInitializers,function(i,n){const o=e(n);if(o.length>0){if("function"==typeof i)return void t.bind(i,this,o)();this[i](o)}},this),this.initAutoreload(),this.initHelp(".shp"),n.status.start(),this._showPage(i.SaitoApp.timeAppStart,i.contentTimer),n.eventBus.trigger("notification",i.SaitoApp),window.location.href.indexOf("jump=")>-1){var o=window.location.href,s=/[\?\&]jump=(\d+)/.exec(o);try{this.scrollToThread(s[1])}catch(e){}finally{var a=o.replace(/[\?\&]jump=\d+/,"");window.history.replaceState(null,null,a)}}},_initAnsweringNotInlined:function(e){this.answeringForm=new g({el:e,model:new d({id:"foo"}),ajax:!1})},_initBookmarks:function(e){var t=new u;new h({el:e,collection:t})},_initLogout:function(){n.eventBus.trigger("app:localStorage:clear"),t.defer(function(){window.redirect(n.settings.get("webroot"))})},_initPostings:function(i){t.each(i,function(t){var i,n;i=parseInt(t.getAttribute("data-id"),10),n=new d({id:i}),this.postings.add(n,{silent:!0}),new c({el:e(t),model:this.postings.get(i),collection:this.postings})},this)},_initThreadBoxes:function(i){t.each(i,function(t){var i;i=parseInt(e(t).attr("data-id"),10),this.threads.get(i)||this.threads.add([{id:i,isThreadCollapsed:"entries"===n.request.controller&&"index"===n.request.action&&n.currentUser.get("user_show_thread_collapsed")}],{silent:!0}),new r({el:e(t),postings:this.postings,model:this.threads.get(i)})},this)},_initThreadLeafs:function(i){t.each(i,function(t){var i=JSON.parse(t.getAttribute("data-leaf"));i.isNewToUser=i.new,delete i.new;var n,o=this.threads.get(i.tid);n=o?o.threadlines:this.threadLines;new s({el:e(t),leafData:i,postings:this.postings,collection:n})},this)},_showPage:function(t,i){var o=function(){n.eventBus.trigger("isAppVisible",!0)};n.request.isMobile||(new Date).getTime()-t>1500?(e("#content").css("visibility","visible"),o()):e("#content").css({visibility:"visible",opacity:0}).animate({opacity:1},{duration:150,easing:"easeInOutQuart",complete:o}),i.cancel()},toggleCategoryChooser:function(e,t){const i=new m;i.model.set("isOpen",!i.model.get("isOpen"))},initHelp:function(e){new f({el:"body",elementName:e,indicatorName:"#shp-show",webroot:n.settings.get("webroot")})},scrollToThread:function(t){e(".threadBox[data-id="+t+"]")[0].scrollIntoView("top")},initAutoreload:function(){var e,t,i;i=window.location.pathname,t=function(){window.location=i},n.settings.get("autoPageReload")&&(this.breakAutoreload(),e=1e3*n.settings.get("autoPageReload"),this.autoPageReloadTimer=setTimeout(t,e))},breakAutoreload:function(){!1!==this.autoPageReloadTimer&&(clearTimeout(this.autoPageReloadTimer),this.autoPageReloadTimer=!1)},widenSearchField:function(t){t.preventDefault(),e(t.currentTarget).width()<350&&e(t.currentTarget).animate({width:"350px"},"fast")},showLoginForm:function(e){e.preventDefault();const t=e.currentTarget.title;v.show(new b,{title:t})},scrollToTop:function(e){e.preventDefault(),window.scrollTo(0,0)},manuallyMarkAsRead:function(e){e&&e.preventDefault(),this._onEntriesIndexReload(),window.redirect(n.settings.get("webroot")+"entries/update")},_onEntriesIndexReload:function(){n.request.controller,n.request.action}})}),function(e){define("pnotify",[],function(){return function(){"use strict";var t=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var i=arguments[t];for(var n in i)Object.prototype.hasOwnProperty.call(i,n)&&(e[n]=i[n])}return e},i="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},n=function(){var e=void 0,n=void 0,o=function(){e.defaultStack.context=document.body,window.addEventListener("resize",function(){n&&clearTimeout(n),n=setTimeout(function(){e.positionAll()},10)})},s=function(e){e.overlay.parentNode&&e.overlay.parentNode.removeChild(e.overlay)},a=function(e,t){return"object"!==(void 0===e?"undefined":i(e))&&(e={text:e}),t&&(e.type=t),{target:document.body,data:e}};var r={runModules:function(i){if("init"===i){for(var n in e.modules)if(e.modules.hasOwnProperty(n)&&"function"==typeof e.modules[n].init){var o=e.modules[n].init(this);this.initModule(o)}}else{var s=this.get("_modules");for(var a in s)if(s.hasOwnProperty(a)){var r=t({_notice:this,_options:this.get()},this.get("modules")[a]);s[a].set(r),"function"==typeof s[a][i]&&s[a][i]()}}},initModule:function(e){var i=this.get("modules");i.hasOwnProperty(e.constructor.key)||(i[e.constructor.key]={});var n=t({_notice:this,_options:this.get()},i[e.constructor.key]);e.initModule(n),this.get("_modules")[e.constructor.key]=e},update:function(e){var t=this.get("hide"),i=this.get("icon");this.set(e),this.runModules("update"),this.get("hide")?t||this.queueClose():this.cancelClose(),this.queuePosition();var n=this.get("icon");return n!==i&&(!0===n&&"fontawesome5"===this.get("icons")||"string"==typeof n&&n.match(/(^| )fa[srlb]($| )/))&&(this.set({icon:!1}),this.set({icon:n})),this},open:function(){var t=this;if("opening"!==this.get("_state")){if("open"!==this.get("_state")){this.set({_state:"opening",_animatingClass:"ui-pnotify-initial-hidden"}),this.runModules("beforeOpen");var i=this.get("stack");if(!this.refs.elem.parentNode||i&&i.context&&i.context!==this.refs.elem.parentNode)if(i&&i.context)i.context.appendChild(this.refs.elem);else{if(!document.body)throw new Error("No context to open this notice in.");document.body.appendChild(this.refs.elem)}return setTimeout(function(){i&&(i.animation=!1,e.positionAll(),i.animation=!0),t.animateIn(function(){t.get("hide")&&t.queueClose(),t.set({_state:"open"}),t.runModules("afterOpen")})},0),this}this.get("hide")&&this.queueClose()}},remove:function(e){return this.close(e)},close:function(t){var i=this;if("closing"!==this.get("_state")&&"closed"!==this.get("_state"))return this.set({_state:"closing",_timerHide:!!t}),this.runModules("beforeClose"),this.get("_timer")&&clearTimeout&&(clearTimeout(this.get("_timer")),this.set({_timer:null})),this.animateOut(function(){if(i.set({_state:"closed"}),i.runModules("afterClose"),i.queuePosition(),i.get("remove")&&i.refs.elem.parentNode.removeChild(i.refs.elem),i.runModules("beforeDestroy"),i.get("destroy")&&null!==e.notices){var t=e.notices.indexOf(i);-1!==t&&e.notices.splice(t,1)}i.runModules("afterDestroy")}),this},animateIn:function(e){var t=this;this.set({_animating:"in"});var i=function i(){if(t.refs.elem.removeEventListener("transitionend",i),t.get("_animTimer")&&clearTimeout(t.get("_animTimer")),"in"===t.get("_animating")){var n=t.get("_moduleIsNoticeOpen");if(!n){var o=t.refs.elem.getBoundingClientRect();for(var s in o)if(o[s]>0){n=!0;break}}n?(e&&e.call(),t.set({_animating:!1})):t.set({_animTimer:setTimeout(i,40)})}};"fade"===this.get("animation")?(this.refs.elem.addEventListener("transitionend",i),this.set({_animatingClass:"ui-pnotify-in"}),this.refs.elem.style.opacity,this.set({_animatingClass:"ui-pnotify-in ui-pnotify-fade-in"}),this.set({_animTimer:setTimeout(i,650)})):(this.set({_animatingClass:"ui-pnotify-in"}),i())},animateOut:function(t){var i=this;this.set({_animating:"out"});var n=function n(){if(i.refs.elem.removeEventListener("transitionend",n),i.get("_animTimer")&&clearTimeout(i.get("_animTimer")),"out"===i.get("_animating")){var o=i.get("_moduleIsNoticeOpen");if(!o){var a=i.refs.elem.getBoundingClientRect();for(var r in a)if(a[r]>0){o=!0;break}}if(i.refs.elem.style.opacity&&"0"!=i.refs.elem.style.opacity&&o)i.set({_animTimer:setTimeout(n,40)});else{i.set({_animatingClass:""});var l=i.get("stack");if(l&&l.overlay){for(var d=!1,c=0;c<e.notices.length;c++){var u=e.notices[c];if(u!=i&&u.get("stack")===l&&"closed"!==u.get("_state")){d=!0;break}}d||s(l)}t&&t.call(),i.set({_animating:!1})}}};"fade"===this.get("animation")?(this.refs.elem.addEventListener("transitionend",n),this.set({_animatingClass:"ui-pnotify-in"}),this.set({_animTimer:setTimeout(n,650)})):(this.set({_animatingClass:""}),n())},position:function(){var t=this.get("stack"),i=this.refs.elem;if(t){if(t.context||(t.context=document.body),"number"!=typeof t.nextpos1&&(t.nextpos1=t.firstpos1),"number"!=typeof t.nextpos2&&(t.nextpos2=t.firstpos2),"number"!=typeof t.addpos2&&(t.addpos2=0),!i.classList.contains("ui-pnotify-in")&&!i.classList.contains("ui-pnotify-initial-hidden"))return this;t.modal&&(t.overlay||function(t){var i=document.createElement("div");i.classList.add("ui-pnotify-modal-overlay"),t.context!==document.body&&(i.style.height=t.context.scrollHeight+"px",i.style.width=t.context.scrollWidth+"px"),i.addEventListener("click",function(){t.overlayClose&&e.closeStack(t)}),t.overlay=i}(t),function(e){e.overlay.parentNode!==e.context&&(e.overlay=e.context.insertBefore(e.overlay,e.context.firstChild))}(t));i.getBoundingClientRect();t.animation&&this.set({_moveClass:"ui-pnotify-move"});var n=t.context===document.body?window.innerHeight:t.context.scrollHeight,o=t.context===document.body?window.innerWidth:t.context.scrollWidth,s=void 0;if(t.dir1){s={down:"top",up:"bottom",left:"right",right:"left"}[t.dir1];var a=void 0;switch(t.dir1){case"down":a=i.offsetTop;break;case"up":a=n-i.scrollHeight-i.offsetTop;break;case"left":a=o-i.scrollWidth-i.offsetLeft;break;case"right":a=i.offsetLeft}void 0===t.firstpos1&&(t.firstpos1=a,t.nextpos1=t.firstpos1)}if(t.dir1&&t.dir2){var r={down:"top",up:"bottom",left:"right",right:"left"}[t.dir2],l=void 0;switch(t.dir2){case"down":l=i.offsetTop;break;case"up":l=n-i.scrollHeight-i.offsetTop;break;case"left":l=o-i.scrollWidth-i.offsetLeft;break;case"right":l=i.offsetLeft}void 0===t.firstpos2&&(t.firstpos2=l,t.nextpos2=t.firstpos2);var d=t.nextpos1+i.offsetHeight+(void 0===t.spacing1?25:t.spacing1),c=t.nextpos1+i.offsetWidth+(void 0===t.spacing1?25:t.spacing1);switch((("down"===t.dir1||"up"===t.dir1)&&d>n||("left"===t.dir1||"right"===t.dir1)&&c>o)&&(t.nextpos1=t.firstpos1,t.nextpos2+=t.addpos2+(void 0===t.spacing2?25:t.spacing2),t.addpos2=0),"number"==typeof t.nextpos2&&(i.style[r]=t.nextpos2+"px",t.animation||i.style[r]),t.dir2){case"down":case"up":i.offsetHeight+(parseFloat(i.style.marginTop,10)||0)+(parseFloat(i.style.marginBottom,10)||0)>t.addpos2&&(t.addpos2=i.offsetHeight);break;case"left":case"right":i.offsetWidth+(parseFloat(i.style.marginLeft,10)||0)+(parseFloat(i.style.marginRight,10)||0)>t.addpos2&&(t.addpos2=i.offsetWidth)}}else if(t.dir1){var u=void 0,h=void 0;switch(t.dir1){case"down":case"up":h=["left","right"],u=t.context.scrollWidth/2-i.offsetWidth/2;break;case"left":case"right":h=["top","bottom"],u=n/2-i.offsetHeight/2}i.style[h[0]]=u+"px",i.style[h[1]]="auto",t.animation||i.style[h[0]]}if(t.dir1)switch("number"==typeof t.nextpos1&&(i.style[s]=t.nextpos1+"px",t.animation||i.style[s]),t.dir1){case"down":case"up":t.nextpos1+=i.offsetHeight+(void 0===t.spacing1?25:t.spacing1);break;case"left":case"right":t.nextpos1+=i.offsetWidth+(void 0===t.spacing1?25:t.spacing1)}else{var f=o/2-i.offsetWidth/2,m=n/2-i.offsetHeight/2;i.style.left=f+"px",i.style.top=m+"px",t.animation||i.style.left}return this}},queuePosition:function(t){return n&&clearTimeout(n),t||(t=10),n=setTimeout(function(){e.positionAll()},t),this},cancelRemove:function(){return this.cancelClose()},cancelClose:function(){return this.get("_timer")&&clearTimeout(this.get("_timer")),this.get("_animTimer")&&clearTimeout(this.get("_animTimer")),"closing"===this.get("_state")&&this.set({_state:"open",_animating:!1,_animatingClass:"fade"===this.get("animation")?"ui-pnotify-in ui-pnotify-fade-in":"ui-pnotify-in"}),this},queueRemove:function(){return this.queueClose()},queueClose:function(){var e=this;return this.cancelClose(),this.set({_timer:setTimeout(function(){return e.close(!0)},isNaN(this.get("delay"))?0:this.get("delay"))}),this},addModuleClass:function(){for(var e=this.get("_moduleClasses"),t=arguments.length,i=Array(t),n=0;n<t;n++)i[n]=arguments[n];for(var o=0;o<i.length;o++){var s=i[o];-1===e.indexOf(s)&&e.push(s)}this.set({_moduleClasses:e})},removeModuleClass:function(){for(var e=this.get("_moduleClasses"),t=arguments.length,i=Array(t),n=0;n<t;n++)i[n]=arguments[n];for(var o=0;o<i.length;o++){var s=i[o],a=e.indexOf(s);-1!==a&&e.splice(a,1)}this.set({_moduleClasses:e})},hasModuleClass:function(){for(var e=this.get("_moduleClasses"),t=arguments.length,i=Array(t),n=0;n<t;n++)i[n]=arguments[n];for(var o=0;o<i.length;o++){var s=i[o];if(-1===e.indexOf(s))return!1}return!0}};function l(e,t,i,n,o){var s;if(i)var a=new i({root:o.root});return a&&a.on("init",function(e){o.initModule(e.module)}),{c:function(){s=S(),a&&a._fragment.c()},m:function(e,t){I(s,e,t),a&&a._mount(e,t)},u:function(){k(s),a&&a._unmount()},d:function(){a&&a.destroy(!1)}}}function d(e,t){var i,n,o,s;return{c:function(){i=v("div"),n=v("span"),this.h()},h:function(){n.className=o=!0===e.icon?e._icons[e.type]?e._icons[e.type]:"":e.icon,i.className=s="ui-pnotify-icon "+(e._styles.icon?e._styles.icon:"")},m:function(e,t){I(i,e,t),w(n,i)},p:function(e,t){(e.icon||e._icons||e.type)&&o!==(o=!0===t.icon?t._icons[t.type]?t._icons[t.type]:"":t.icon)&&(n.className=o),e._styles&&s!==(s="ui-pnotify-icon "+(t._styles.icon?t._styles.icon:""))&&(i.className=s)},u:function(){k(i)},d:j}}function c(e,t){var i,n;return{c:function(){i=v("noscript"),n=v("noscript")},m:function(t,o){I(i,t,o),i.insertAdjacentHTML("afterend",e.title),I(n,t,o)},p:function(e,t){e.title&&(D(i,n),i.insertAdjacentHTML("afterend",t.title))},u:function(){D(i,n),k(i),k(n)},d:j}}function u(e,t){var i;return{c:function(){i=_(e.title)},m:function(e,t){I(i,e,t)},p:function(e,t){e.title&&(i.data=t.title)},u:function(){k(i)},d:j}}function h(e,t){var i,n;return{c:function(){i=v("noscript"),n=v("noscript")},m:function(t,o){I(i,t,o),i.insertAdjacentHTML("afterend",e.text),I(n,t,o)},p:function(e,t){e.text&&(D(i,n),i.insertAdjacentHTML("afterend",t.text))},u:function(){D(i,n),k(i),k(n)},d:j}}function f(e,t){var i;return{c:function(){i=_(e.text)},m:function(e,t){I(i,e,t)},p:function(e,t){e.text&&(i.data=t.text)},u:function(){k(i)},d:j}}function m(e,t,i,n,o){var s;if(i)var a=new i({root:o.root});return a&&a.on("init",function(e){o.initModule(e.module)}),{c:function(){s=S(),a&&a._fragment.c()},m:function(e,t){I(s,e,t),a&&a._mount(e,t)},u:function(){k(s),a&&a._unmount()},d:function(){a&&a.destroy(!1)}}}function p(e){return e.titleTrusted?c:u}function g(e){return e.textTrusted?h:f}function b(i){var n;!function(e,t){e._observers={pre:M(),post:M()},e._handlers=M(),e._bind=t._bind,e.options=t,e.root=t.root||e,e.store=e.root.store||t.store}(this,i),this.refs={},this._state=V(function(){var i=t({_state:"initializing",_timer:null,_animTimer:null,_animating:!1,_animatingClass:"",_moveClass:"",_timerHide:!1,_moduleClasses:[],_moduleIsNoticeOpen:!1,_modules:{},_modulesPrependContainer:e.modulesPrependContainer,_modulesAppendContainer:e.modulesAppendContainer},e.defaults);return i.modules=t({},e.defaults.modules),i}(),i.data),this._recompute({styling:1,icons:1},this._state),document.getElementById("svelte-3059224252-style")||((n=v("style")).id="svelte-3059224252-style",n.textContent='body > .ui-pnotify{position:fixed;z-index:100040}body > .ui-pnotify.ui-pnotify-modal{z-index:100042}.ui-pnotify{position:absolute;height:auto;z-index:1;display:none}.ui-pnotify.ui-pnotify-modal{z-index:3}.ui-pnotify.ui-pnotify-in{display:block}.ui-pnotify.ui-pnotify-initial-hidden{display:block;visibility:hidden}.ui-pnotify.ui-pnotify-move{transition:left .5s ease, top .5s ease, right .5s ease, bottom .5s ease}.ui-pnotify.ui-pnotify-fade-slow{transition:opacity .4s linear;opacity:0}.ui-pnotify.ui-pnotify-fade-slow.ui-pnotify.ui-pnotify-move{transition:opacity .4s linear, left .5s ease, top .5s ease, right .5s ease, bottom .5s ease}.ui-pnotify.ui-pnotify-fade-normal{transition:opacity .25s linear;opacity:0}.ui-pnotify.ui-pnotify-fade-normal.ui-pnotify.ui-pnotify-move{transition:opacity .25s linear, left .5s ease, top .5s ease, right .5s ease, bottom .5s ease}.ui-pnotify.ui-pnotify-fade-fast{transition:opacity .1s linear;opacity:0}.ui-pnotify.ui-pnotify-fade-fast.ui-pnotify.ui-pnotify-move{transition:opacity .1s linear, left .5s ease, top .5s ease, right .5s ease, bottom .5s ease}.ui-pnotify.ui-pnotify-fade-in{opacity:1}.ui-pnotify .ui-pnotify-shadow{-webkit-box-shadow:0px 6px 28px 0px rgba(0,0,0,0.1);-moz-box-shadow:0px 6px 28px 0px rgba(0,0,0,0.1);box-shadow:0px 6px 28px 0px rgba(0,0,0,0.1)}.ui-pnotify-container{background-position:0 0;padding:.8em;height:100%;margin:0}.ui-pnotify-container:after{content:" ";visibility:hidden;display:block;height:0;clear:both}.ui-pnotify-container.ui-pnotify-sharp{-webkit-border-radius:0;-moz-border-radius:0;border-radius:0}.ui-pnotify-title{display:block;white-space:pre-line;margin-bottom:.4em;margin-top:0}.ui-pnotify.ui-pnotify-with-icon .ui-pnotify-title,.ui-pnotify.ui-pnotify-with-icon .ui-pnotify-text{margin-left:24px}[dir=rtl] .ui-pnotify.ui-pnotify-with-icon .ui-pnotify-title,[dir=rtl] .ui-pnotify.ui-pnotify-with-icon .ui-pnotify-text{margin-right:24px;margin-left:0}.ui-pnotify-title-bs4{font-size:1.2rem}.ui-pnotify-text{display:block;white-space:pre-line}.ui-pnotify-icon,.ui-pnotify-icon span{display:block;float:left}[dir=rtl] .ui-pnotify-icon,[dir=rtl] .ui-pnotify-icon span{float:right}.ui-pnotify-icon-bs3 > span{position:relative;top:2px}.ui-pnotify-icon-bs4 > span{position:relative;top:4px}.ui-pnotify-modal-overlay{background-color:rgba(0, 0, 0, .4);top:0;left:0;position:absolute;height:100%;width:100%;z-index:2}body > .ui-pnotify-modal-overlay{position:fixed;z-index:100041}',w(n,document.head));var o=function(){var t=this;this.on("mouseenter",function(e){if(t.get("mouseReset")&&"out"===t.get("_animating")){if(!t.get("_timerHide"))return;t.cancelClose()}t.get("hide")&&t.get("mouseReset")&&t.cancelClose()}),this.on("mouseleave",function(i){t.get("hide")&&t.get("mouseReset")&&"out"!==t.get("_animating")&&t.queueClose(),e.positionAll()});var i=this.get("stack");i&&"top"===i.push?e.notices.splice(0,0,this):e.notices.push(this),this.runModules("init"),this.set({_state:"closed"}),this.get("autoDisplay")&&this.open()}.bind(this);i.root||(this._oncreate=[],this._beforecreate=[],this._aftercreate=[]),this._fragment=function(e,t){for(var i,n,o,s,a,r,c,u,h,f,b,S,j,D=e._modulesPrependContainer,V=[],$=0;$<D.length;$+=1)V[$]=l(0,0,D[$],0,t);var L=!1!==e.icon&&d(e),M=p(e),B=M(e,t),F=g(e),O=F(e,t),N=e._modulesAppendContainer,P=[];for($=0;$<N.length;$+=1)P[$]=m(0,0,N[$],0,t);function z(e){t.fire("mouseover",e)}function q(e){t.fire("mouseout",e)}function U(e){t.fire("mouseenter",e)}function H(e){t.fire("mouseleave",e)}function R(e){t.fire("mousemove",e)}function E(e){t.fire("mousedown",e)}function W(e){t.fire("mouseup",e)}function Z(e){t.fire("click",e)}function Y(e){t.fire("dblclick",e)}function G(e){t.fire("focus",e)}function Q(e){t.fire("blur",e)}function X(e){t.fire("touchstart",e)}function J(e){t.fire("touchmove",e)}function K(e){t.fire("touchend",e)}function ee(e){t.fire("touchcancel",e)}return{c:function(){i=v("div"),n=v("div");for(var e=0;e<V.length;e+=1)V[e].c();for(o=_("\n    "),L&&L.c(),s=_("\n    "),a=v("h4"),B.c(),c=_("\n    "),u=v("div"),O.c(),f=_("\n    "),e=0;e<P.length;e+=1)P[e].c();this.h()},h:function(){a.className=r="ui-pnotify-title "+(e._styles.title?e._styles.title:""),y(a,"display",!1===e.title?"none":"block"),u.className=h="ui-pnotify-text "+(e._styles.text?e._styles.text:""),y(u,"display",!1===e.text?"none":"block"),C(u,"role","alert"),n.className=b="\n        ui-pnotify-container\n        "+(e._styles.container?e._styles.container:"")+"\n        "+(e._styles[e.type]?e._styles[e.type]:"")+"\n        "+e.cornerClass+"\n        "+(e.shadow?"ui-pnotify-shadow":"")+"\n      ",n.style.cssText=S="\n        "+("string"==typeof e.width?"width: "+e.width+";":"")+"\n        "+("string"==typeof e.minHeight?"min-height: "+e.minHeight+";":"")+"\n      ",C(n,"role","alert"),i.className=j="\n      ui-pnotify\n      "+(!1!==e.icon?"ui-pnotify-with-icon":"")+"\n      "+(e._styles.element?e._styles.element:"")+"\n      "+e.addClass+"\n      "+e._animatingClass+"\n      "+e._moveClass+"\n      "+("fade"===e.animation?"ui-pnotify-fade-"+e.animateSpeed:"")+"\n      "+(e.stack&&e.stack.modal?"ui-pnotify-modal":"")+"\n      "+e._moduleClasses.join(" ")+"\n    ",C(i,"aria-live","assertive"),C(i,"role","alertdialog"),C(i,"ui-pnotify",!0),x(i,"mouseover",z),x(i,"mouseout",q),x(i,"mouseenter",U),x(i,"mouseleave",H),x(i,"mousemove",R),x(i,"mousedown",E),x(i,"mouseup",W),x(i,"click",Z),x(i,"dblclick",Y),x(i,"focus",G),x(i,"blur",Q),x(i,"touchstart",X),x(i,"touchmove",J),x(i,"touchend",K),x(i,"touchcancel",ee)},m:function(e,r){I(i,e,r),w(n,i);for(var l=0;l<V.length;l+=1)V[l].m(n,null);for(w(o,n),L&&L.m(n,null),w(s,n),w(a,n),B.m(a,null),t.refs.titleContainer=a,w(c,n),w(u,n),O.m(u,null),t.refs.textContainer=u,w(f,n),l=0;l<P.length;l+=1)P[l].m(n,null);t.refs.container=n,t.refs.elem=i},p:function(e,c){var f=c._modulesPrependContainer;if(e._modulesPrependContainer){for(var v=V.length;v<f.length;v+=1)V[v]=l(0,0,f[v],0,t),V[v].c(),V[v].m(n,o);for(;v<V.length;v+=1)V[v].u(),V[v].d();V.length=f.length}!1!==c.icon?L?L.p(e,c):((L=d(c)).c(),L.m(n,s)):L&&(L.u(),L.d(),L=null),M===(M=p(c))&&B?B.p(e,c):(B.u(),B.d(),(B=M(c,t)).c(),B.m(a,null)),e._styles&&r!==(r="ui-pnotify-title "+(c._styles.title?c._styles.title:""))&&(a.className=r),e.title&&y(a,"display",!1===c.title?"none":"block"),F===(F=g(c))&&O?O.p(e,c):(O.u(),O.d(),(O=F(c,t)).c(),O.m(u,null)),e._styles&&h!==(h="ui-pnotify-text "+(c._styles.text?c._styles.text:""))&&(u.className=h),e.text&&y(u,"display",!1===c.text?"none":"block");var w=c._modulesAppendContainer;if(e._modulesAppendContainer){for(v=P.length;v<w.length;v+=1)P[v]=m(0,0,w[v],0,t),P[v].c(),P[v].m(n,null);for(;v<P.length;v+=1)P[v].u(),P[v].d();P.length=w.length}(e._styles||e.type||e.cornerClass||e.shadow)&&b!==(b="\n        ui-pnotify-container\n        "+(c._styles.container?c._styles.container:"")+"\n        "+(c._styles[c.type]?c._styles[c.type]:"")+"\n        "+c.cornerClass+"\n        "+(c.shadow?"ui-pnotify-shadow":"")+"\n      ")&&(n.className=b),(e.width||e.minHeight)&&S!==(S="\n        "+("string"==typeof c.width?"width: "+c.width+";":"")+"\n        "+("string"==typeof c.minHeight?"min-height: "+c.minHeight+";":"")+"\n      ")&&(n.style.cssText=S),(e.icon||e._styles||e.addClass||e._animatingClass||e._moveClass||e.animation||e.animateSpeed||e.stack||e._moduleClasses)&&j!==(j="\n      ui-pnotify\n      "+(!1!==c.icon?"ui-pnotify-with-icon":"")+"\n      "+(c._styles.element?c._styles.element:"")+"\n      "+c.addClass+"\n      "+c._animatingClass+"\n      "+c._moveClass+"\n      "+("fade"===c.animation?"ui-pnotify-fade-"+c.animateSpeed:"")+"\n      "+(c.stack&&c.stack.modal?"ui-pnotify-modal":"")+"\n      "+c._moduleClasses.join(" ")+"\n    ")&&(i.className=j)},u:function(){k(i);for(var e=0;e<V.length;e+=1)V[e].u();for(L&&L.u(),B.u(),O.u(),e=0;e<P.length;e+=1)P[e].u()},d:function(){A(V),L&&L.d(),B.d(),t.refs.titleContainer===a&&(t.refs.titleContainer=null),O.d(),t.refs.textContainer===u&&(t.refs.textContainer=null),A(P),t.refs.container===n&&(t.refs.container=null),T(i,"mouseover",z),T(i,"mouseout",q),T(i,"mouseenter",U),T(i,"mouseleave",H),T(i,"mousemove",R),T(i,"mousedown",E),T(i,"mouseup",W),T(i,"click",Z),T(i,"dblclick",Y),T(i,"focus",G),T(i,"blur",Q),T(i,"touchstart",X),T(i,"touchmove",J),T(i,"touchend",K),T(i,"touchcancel",ee),t.refs.elem===i&&(t.refs.elem=null)}}}(this._state,this),this.root._oncreate.push(o),i.target&&(this._fragment.c(),this._fragment.m(i.target,i.anchor||null),this._lock=!0,$(this._beforecreate),$(this._oncreate),$(this._aftercreate),this._lock=!1)}function v(e){return document.createElement(e)}function w(e,t){t.appendChild(e)}function _(e){return document.createTextNode(e)}function y(e,t,i){e.style.setProperty(t,i)}function C(e,t,i){e.setAttribute(t,i)}function x(e,t,i){e.addEventListener(t,i,!1)}function I(e,t,i){t.insertBefore(e,i)}function k(e){e.parentNode.removeChild(e)}function A(e){for(var t=0;t<e.length;t+=1)e[t]&&e[t].d()}function T(e,t,i){e.removeEventListener(t,i,!1)}function S(){return document.createComment("")}function j(){}function D(e,t){for(;e.nextSibling&&e.nextSibling!==t;)e.parentNode.removeChild(e.nextSibling)}function V(e){for(var t,i,n=1,o=arguments.length;n<o;n++)for(t in i=arguments[n])e[t]=i[t];return e}function $(e){for(;e&&e.length;)e.shift()()}function L(e){this.destroy=j,this.fire("destroy"),this.set=this.get=j,!1!==e&&this._fragment.u(),this._fragment.d(),this._fragment=this._state=null}function M(){return Object.create(null)}function B(e,t,i,n,o){for(var s in t)if(i[s]){var a=n[s],r=o[s],l=t[s];if(l)for(var d=0;d<l.length;d+=1){var c=l[d];c.__calling||(c.__calling=!0,c.call(e,a,r),c.__calling=!1)}}}return V(b.prototype,r,{destroy:L,get:function(e){return e?this._state[e]:this._state},fire:function(e,t){var i=e in this._handlers&&this._handlers[e].slice();if(!i)return;for(var n=0;n<i.length;n+=1)i[n].call(this,t)},observe:function(e,t,i){var n=i&&i.defer?this._observers.post:this._observers.pre;(n[e]||(n[e]=[])).push(t),i&&!1===i.init||(t.__calling=!0,t.call(this,this._state[e]),t.__calling=!1);return{cancel:function(){var i=n[e].indexOf(t);~i&&n[e].splice(i,1)}}},on:function(e,t){if("teardown"===e)return this.on("destroy",t);var i=this._handlers[e]||(this._handlers[e]=[]);return i.push(t),{cancel:function(){var e=i.indexOf(t);~e&&i.splice(e,1)}}},set:function(e){if(this._set(V({},e)),this.root._lock)return;this.root._lock=!0,$(this.root._beforecreate),$(this.root._oncreate),$(this.root._aftercreate),this.root._lock=!1},teardown:L,_set:function(e){var t=this._state,i={},n=!1;for(var o in e)this._differs(e[o],t[o])&&(i[o]=n=!0);if(!n)return;this._state=V({},t,e),this._recompute(i,this._state),this._bind&&this._bind(i,this._state);this._fragment&&(B(this,this._observers.pre,i,this._state,t),this._fragment.p(i,this._state),B(this,this._observers.post,i,this._state,t))},_mount:function(e,t){this._fragment.m(e,t)},_unmount:function(){this._fragment&&this._fragment.u()},_differs:function(e,t){return e!=e?t==t:e!==t||e&&"object"===(void 0===e?"undefined":i(e))||"function"==typeof e}}),b.prototype._recompute=function(t,n){var o,s;t.styling&&this._differs(n._styles,n._styles="object"===(void 0===(o=n.styling)?"undefined":i(o))?o:e.styling[o])&&(t._styles=!0),t.icons&&this._differs(n._icons,n._icons="object"===(void 0===(s=n.icons)?"undefined":i(s))?s:e.icons[s])&&(t._icons=!0)},(e=b).VERSION="4.0.0-alpha.2",e.defaultStack={dir1:"down",dir2:"left",firstpos1:25,firstpos2:25,spacing1:36,spacing2:36,push:"bottom",context:window&&document.body},e.defaults={title:!1,titleTrusted:!1,text:!1,textTrusted:!1,styling:"brighttheme",icons:"brighttheme",addClass:"",cornerClass:"",autoDisplay:!0,width:"360px",minHeight:"16px",type:"notice",icon:!0,animation:"fade",animateSpeed:"normal",shadow:!0,hide:!0,delay:8e3,mouseReset:!0,remove:!0,destroy:!0,stack:e.defaultStack,modules:{}},e.notices=[],e.modules={},e.modulesPrependContainer=[],e.modulesAppendContainer=[],e.alert=function(t){return new e(a(t))},e.notice=function(t){return new e(a(t,"notice"))},e.info=function(t){return new e(a(t,"info"))},e.success=function(t){return new e(a(t,"success"))},e.error=function(t){return new e(a(t,"error"))},e.removeAll=function(){e.closeAll()},e.closeAll=function(){for(var t=0;t<e.notices.length;t++)e.notices[t].close&&e.notices[t].close(!1)},e.removeStack=function(t){e.closeStack(t)},e.closeStack=function(t){if(!1!==t)for(var i=0;i<e.notices.length;i++)e.notices[i].close&&e.notices[i].get("stack")===t&&e.notices[i].close(!1)},e.positionAll=function(){if(n&&clearTimeout(n),n=null,e.notices.length>0){for(var t=0;t<e.notices.length;t++){var i=e.notices[t].get("stack");i&&(i.overlay&&s(i),i.nextpos1=i.firstpos1,i.nextpos2=i.firstpos2,i.addpos2=0)}for(var o=0;o<e.notices.length;o++)e.notices[o].position()}else delete e.defaultStack.nextpos1,delete e.defaultStack.nextpos2},e.styling={brighttheme:{container:"brighttheme",notice:"brighttheme-notice",info:"brighttheme-info",success:"brighttheme-success",error:"brighttheme-error"},bootstrap3:{container:"alert",notice:"alert-warning",info:"alert-info",success:"alert-success",error:"alert-danger",icon:"ui-pnotify-icon-bs3"},bootstrap4:{container:"alert",notice:"alert-warning",info:"alert-info",success:"alert-success",error:"alert-danger",icon:"ui-pnotify-icon-bs4",title:"ui-pnotify-title-bs4"}},e.icons={brighttheme:{notice:"brighttheme-icon-notice",info:"brighttheme-icon-info",success:"brighttheme-icon-success",error:"brighttheme-icon-error"},bootstrap3:{notice:"glyphicon glyphicon-exclamation-sign",info:"glyphicon glyphicon-info-sign",success:"glyphicon glyphicon-ok-sign",error:"glyphicon glyphicon-warning-sign"},fontawesome4:{notice:"fa fa-exclamation-circle",info:"fa fa-info-circle",success:"fa fa-check-circle",error:"fa fa-exclamation-triangle"},fontawesome5:{notice:"fas fa-exclamation-circle",info:"fas fa-info-circle",success:"fas fa-check-circle",error:"fas fa-exclamation-triangle"}},window&&document.body?o():document.addEventListener("DOMContentLoaded",o),b}();return e.PNotify=n}.apply(e,arguments)})}(this),define("views/notification",["jquery","underscore","backbone","models/app","pnotify"],function(e,t,i,n,o){"use strict";return i.View.extend({initialize:function(){this.listenTo(n.eventBus,"notification",this._showMessages),this.listenTo(n.eventBus,"notificationUnset",this._unset)},_showMessages:function(e){if(void 0!==e){if(void 0===e.msg){if(void 0===e.message)return;e={msg:[e]}}else if(0===e.msg.length)return;t.each(e.msg,function(e){this._showMessage(e)},this)}},_showMessage:function(t){switch(t.channel=t.channel||"notification",t.message=e.i18n.__(t.message.trim()),t.channel){case"form":this._form(t);break;case"popover":this._popover(t);break;default:this._showNotification(t)}},_unset:function(t){"all"===t&&e(".error-message").remove()},_form:function(i){var n;n=t.template('<div class="error-message"><%= message %></div>'),e(i.element).after(n({message:i.message}))},_showNotification:function(e){var t={title:e.title||!1,text:e.message,icon:!1,history:!1,addclass:"flash",delay:5e3},i=e.type;switch(i){case"success":t.addclass+=" flash-success";break;case"warning":i="notice",t.addclass+=" flash-warning";break;case"error":t.addclass+=" flash-error",t.delay=1e4;break;default:i="info",t.addclass+=" flash-notice"}o[i](t)}})}),define("views/prerequisitesTester",["jquery","marionette","models/app"],function(e,t,i){"use strict";return t.View.extend({_warningTpl:_.template('<div class="app-prerequisites-warning"> <%- warning %> </div>'),initialize:function(){this._testLocalStorage()},_testLocalStorage:function(){i.eventBus.request("app:localStorage:available")||this._addWarning(e.i18n.__("This web-application depends on Cookies and localStorage. Please make those available in your browser."))},_addWarning:function(e){this.$el.append(this._warningTpl({warning:e}))}})}),define("lib/leaflet/mq",[],function(){if("undefined"!=typeof MQ)return MQ}),define("text!modules/usermap/templates/controls.html",[],function(){return'<div class="input">\n    <% if (lat) { %>\n        <div class="saito-usermap-info infoText">\n            <%= lat %>, <%= lng %>, <%= zoom %>\n        </div>\n    <% } %>\n    <button class="btn js-btn-search">–</button>\n    <% if (geolocation) { %>\n        <button class="btn js-btn-locate"><%- $.i18n.__(\'user.map.b.locate\') %></button>\n    <% } %>\n    <button class="btn js-btn-clear"><%- $.i18n.__(\'user.map.b.clear\') %></button>\n    <i class="saito-usermap-spinner fa fa-cog fa-spin" style="display: none;"></i>\n</div>'}),define("modules/usermap/views/controls",["jquery","marionette","lib/leaflet/mq","text!modules/usermap/templates/controls.html"],function(e,t,i,n){"use strict";return t.View.extend({template:_.template(n),ui:{search:".js-btn-search",locate:".js-btn-locate",clear:".js-btn-clear",spinner:".saito-usermap-spinner"},events:{"click @ui.search":"_search","click @ui.locate":"_locate","click @ui.clear":"_clear"},initialize:function(t){this.mapLayer=t.mapLayer,this.mapModel=t.mapModel,this.params=t.params,this.mapLayer.on("click",this._repin,this),this.mapLayer.on("locationfound",this._repin,this),e(this.params.fields.edit).on("keypress",_.bind(this._onSearchFieldChange,this)),e(this.params.fields.edit).on("keyup",_.bind(this._updateSearchButtonTitle,this))},_clear:function(e){e.preventDefault(),this.model.set({lat:"",lng:"",zoom:""}),this._updateFields()},_search:function(t){t.preventDefault(),this._activityStart();var n=e(this.params.fields.edit).val();i.geocode().search(n).on("success",_.bind(function(e){var t=e.result.best;this._repin(t)},this))},_onSearchFieldChange:function(e){13===e.which&&this._search(e)},_activityStart:function(){this.ui.spinner.show()},_activityStop:function(){this.ui.spinner.hide()},_updateSearchButtonTitle:function(){var t=e(this.params.fields.edit).val();t?(this.ui.search.removeAttr("disabled"),this.ui.search.html(e.i18n.__("user.map.b.search",{string:t}))):this.ui.search.attr("disabled","disabled")},_locate:function(e){e.preventDefault(),this._activityStart(),this.mapLayer.locate()},_repin:function(e){var t=this._round({lat:e.latlng.lat,lng:e.latlng.lng,zoom:this.mapLayer.getZoom()});this._activityStop(),this.model.set(t),this.mapModel.set(t),this._updateFields()},_round:function(e){return _.each(["lat","lng"],function(t){e[t]=e[t].toFixed(4)}),e},onRender:function(){this._updateSearchButtonTitle()},_updateFields:function(){var t=this.params.fields.update,i=this.model;_.each(["lat","lng","zoom"],_.bind(function(n){var o=n;t&&t[n]&&_.each(t[n],function(t){var n=e(t),s=i.get(o);"input"===n.prop("tagName").toLowerCase()?n.val(s):n.html(s)})},this)),this.render()},_geolocation:function(){return"geolocation"in navigator},serializeData:function(){var e=this.model.toJSON();return e.geolocation=this._geolocation(),e}})}),define("templateHelpers",["jquery","underscore","app/vent","moment"],function(e,t,i,n){"use strict";var o=function(){this.webroot=i.vent.request("webroot")};return{Time:t.extend(new o,{moment:n,_timeFormats:{long:"DD.MM.YYYY",longWithTime:"DD.MM.YYYY HH:mm",RFC3339:"YYYY-MM-DDTHH:mm:ssZ",theRightWay:"YYYY-MM-DD HH:mm:ss",time:"HH:mm"},lastMidnight:function(){return n(this.now().format("YYYY-MM-DD"))},now:function(){return n()},_normal:function(t){var i=this.now(),n=this.lastMidnight(),o=i.diff(t)/1e3;return t.isAfter(n)||o<21600?t.format(this._timeFormats.time):o<64800?e.i18n.__("yesterday")+" "+t.format(this._timeFormats.time):t.format(this._timeFormats.long)},format:function(e,i,o){var s,a;if(i=i||"normal",o=o||{},t.defaults(o,{wrap:!0}),n.isMoment(e))a=e;else if(t.isNumber(e))(""+e).length<13&&(e=Math.round(1e3*e)),a=new n(e);else{if(!t.isDate(e))throw"No valid timestamp: "+e.toJSON();a=new n(e)}if(s="normal"===i?this._normal(a):this._timeFormats[i]?a.format(this._timeFormats[i]):a.format(i),o.wrap){var r=" ",l={title:a.format(this._timeFormats.theRightWay),datetime:a.format(this._timeFormats.RFC3339)};t.each(l,function(e,t){r+=t+'="'+e+'" '}),s="<time"+r+">"+s+"</time>"}return s}}),User:t.extend(new o,{templates:{linkToUserProfile:t.template('<a href="<%- url %>"><%- name %></a>')},linkToUserProfile:function(e,t){var i=this.urlToUserProfile(e);return this.templates.linkToUserProfile({url:i,name:t})},urlToUserProfile:function(e){return this.webroot+"users/view/"+e}})}}),define("lib/leaflet/leaflet",[],function(){if("undefined"!=typeof L)return L}),define("modules/usermap/views/map",["marionette","templateHelpers","lib/leaflet/leaflet","lib/leaflet/mq"],function(e,t,i,n){"use strict";return e.View.extend({collectionEvents:{add:"_createMarker",change:"_repinMarker"},modelEvents:{"change:lat":"_setView"},template:{},templateHelpers:t,mapLayer:null,markersLayer:null,markers:{},initialize:function(){"world"===this.model.get("type")&&this._zoomView(),this.markersLayer=new i.MarkerClusterGroup,this._map()},_zoomView:function(){var e=$("#content"),t=e.width(),i=e.offset().top,n={height:t*(120/198)},o={height:$(window).height()};o.available=o.height-i,n.height>o.available&&(n.height=o.available-40),this.$el.height(n.height)},_createMarker:function(e){var t,n=e.latlng(),o=i.marker(n);if(n[0]){if(e){var s=this.templateHelpers.User.linkToUserProfile(e.get("id"),e.get("name"));o.bindPopup(s)}if(this.markersLayer.addLayer(o),this.markers[e.get("id")]=o,"single"===(t=this.model.get("type"))||"edit"===t){var a={lat:e.get("lat"),lng:e.get("lng")};a.zoom="edit"===t?e.get("zoom"):this.model.get("maxZoom"),this.model.set(a)}}},_repinMarker:function(e){if(e.get("lat")){var t=this.markers[e.get("id")];if(t){var i=t.getLatLng();i.lat=e.get("lat"),i.lng=e.get("lng"),t.update()}else this._createMarker(e)}else this._clearMarkers()},_clearMarkers:function(){this.markers={},this.markersLayer.clearLayers()},_setView:function(){var e=this.model.get("lat"),t=this.model.get("lng"),i=this.model.get("zoom");this.mapLayer.setView([e,t],i)},_map:function(){var e=n.mapLayer();this.mapLayer=i.map(this.el,{closePopupOnClick:!1,maxZoom:this.model.get("maxZoom"),minZoom:this.model.get("minZoom"),maxBounds:this.model.get("maxBounds")}),this._setView(),this.mapLayer.addLayer(e),this.mapLayer.addLayer(this.markersLayer)}})}),define("modules/usermap/models/map",["backbone"],function(e){"use strict";return e.Model.extend({maxZoom:{edit:14,single:11,world:11},defaults:{lat:30,lng:0,zoom:2,maxZoom:11,minZoom:1,maxBounds:[[-90,-180],[90,180]]},initialize:function(){this.maxZoom[this.get("type")]&&this.set("maxZoom",this.maxZoom[this.get("type")])}})}),define("modules/usermap/models/user",["backbone"],function(e){"use strict";return e.Model.extend({latlng:function(){return[this.get("lat"),this.get("lng")]}})}),define("modules/usermap/collections/users",["backbone","modules/usermap/models/user"],function(e,t){"use strict";return e.Collection.extend({model:t})}),define("text!modules/usermap/templates/layout.html",[],function(){return"<div>\n    <div class='saito-usermap-map'></div>\n    <div class='saito-usermap-controls'></div>\n</div>"}),define("modules/usermap/usermap",["jquery","app/core","marionette","modules/usermap/views/controls","modules/usermap/views/map","modules/usermap/models/map","modules/usermap/collections/users","text!modules/usermap/templates/layout.html"],function(e,t,i,n,o,s,a,r){"use strict"}),define("app/time",["moment","moment-de"],function(e){"use strict";var t=e().lang()._longDateFormat;t.LT="H:mm",e.lang("de",{longDateFormat:t})}),define("lib/saito/isAppVisible",["jquery","underscore","models/app"],function(e,t,i){"use strict";var n=function(){this.initialize.apply(this,arguments)};return t.extend(n.prototype,{_isVisibleOldSchool:!0,initialize:function(){i.on("isAppVisible",this.isVisible,this),this._isVisibleOldSchool=this._isAppVisibleHtml5(),this._initAppVisibleOldSchool()},isVisible:function(){return this._isVisibleOldSchool},_initAppVisibleOldSchool:function(){e(window).blur(t.bind(function(){this._isVisibleOldSchool=!1},this)),e(window).focus(t.bind(function(){this._isVisibleOldSchool=!0},this))},_isAppVisibleHtml5:function(){var e,t=!1;return void 0!==document.hidden?e="hidden":void 0!==document.webkitHidden&&(e="webkitHidden"),document[e]&&(t=document[e]),!t}}),new n}),function(e){e.i18n={dict:null,setDictionary:function(e){this.dict=e},_:function(e,t){var i=e;return this.dict&&this.dict[e]&&(i=this.dict[e]),this.printf(i,t)},printf:function(e,t){if(!t)return e;for(var i="",n=/%(\d+)\$s/g,o=n.exec(e);o;){var s=parseInt(o[1],10)-1;e=e.replace("%"+o[1]+"$s",t[s]),o=n.exec(e)}var a=e.split("%s");if(a.length>1)for(var r=0;r<t.length;r++)a[r].length>0&&a[r].lastIndexOf("%")==a[r].length-1&&(a[r]+="s"+a.splice(r+1,1)[0]),i+=a[r]+t[r];return i+a[a.length-1]}},e.fn._t=function(t,i){return e(this).text(e.i18n._(t,i))}}(jQuery),define("lib/jquery.i18n/jquery.i18n",function(){}),define("lib/jquery.i18n/jquery.i18n.extend",["jquery","lib/jquery.i18n/jquery.i18n"],function(e){"use strict";e.extend(e.i18n,{currentString:"",setDict:function(e){this.dict=e},setUrl:function(e){this.dictUrl=e,this._loadDict()},_loadDict:function(){var t=function(e){this.dict=e};return t=e.proxy(t,this),e.ajax({url:this.dictUrl,dataType:"json",async:!1,cache:!0}).done(t)},__:function(e,t){var i=e;return"string"==typeof this.dict[e]&&""!==this.dict[e]&&(i=this.dict[e]),"object"==typeof t&&(i=this._insert(i,t)),i},_insert:function(e,t){return e.replace(/:([-\w]+)/g,function(e,i){return void 0!==t[i]?t[i]:e})}})}),function(e,t){"function"==typeof define&&define.amd?define("lib/saito/backbone.initHelper",["underscore","backbone"],function(i,n){return t(i||e._,n||e.Backbone)}):t(_,Backbone)}(this,function(e,t){t.View.prototype.initCollectionFromDom=function(e,t,i){$(e).each(function(){!function(e,t,n){e.add({id:t}),new i({el:n,model:e.get(t),collection:e})}(t,$(this).data("id"),this)})}}),define("app/app",["marionette","app/core","app/vent","modules/html5-notification/html5-notification"],function(e,t,i){var n=SaitoApp,o={fireOnPageCallbacks:function(e){var t=e.afterAppInit;_.each(t,function(e){e()}),i.vent.on("isAppVisible",_.once(function(t){var i=e.afterViewInit;_.each(i,function(e){e()})}))},configureAjax:function(e,t){e.ajaxSetup({cache:!1}),e.ajaxPrefilter(function(e,i,n){n.crossDomain||n.setRequestHeader(t.request.csrf.header,t.request.csrf.token)});const i=document.cookie.match(/Saito-jwt=([^\s;]*)/);i&&(t.settings.set("jwt",i[1]),e.ajaxPrefilter(function(e,i,n){n.crossDomain||n.setRequestHeader("Authorization","bearer "+t.settings.get("jwt"))}))},bootstrapApp:function(e,t){require(["domReady","views/app","backbone","jquery","models/app","views/notification","views/prerequisitesTester","modules/html5-notification/html5-notification","modules/usermap/usermap","fastclick","app/time","lib/saito/isAppVisible","bootstrap","lib/jquery.i18n/jquery.i18n.extend","lib/saito/backbone.initHelper","lib/saito/backbone.modelHelper","fastclick"],function(e,i,n,s,a,r,l,d,c,u){var h;a.settings.set(t.SaitoApp.app.settings),s.i18n.setUrl(a.settings.get("webroot")+"da/langJs"),a.currentUser.set(t.SaitoApp.currentUser),a.request=t.SaitoApp.request,o.configureAjax(s,a),d.start(),new r;var f,m=t.SaitoApp.callbacks.beforeAppInit;_.each(m,function(e){e()}),window.addEventListener("load",function(){u.attach(document.body)},!1),new l({el:s(".app-prerequisites-warnings")}),h=new i,f=function(){o.fireOnPageCallbacks(t.SaitoApp.callbacks),h.initFromDom({SaitoApp:t.SaitoApp,contentTimer:t.contentTimer})},require(["jquery","domReady"],function(e,t){e.isReady?f():t(function(){f()})})})}},s=t;return s.on("start",o.bootstrapApp),s.start({contentTimer:contentTimer,SaitoApp:n}),i.vent.reply("webroot",function(){return n.app.settings.webroot}),i.vent.reply("apiroot",function(){return n.app.settings.webroot+"api/v1/"}),s}),require.config({paths:{common:"../dist/common.min",templateHelpers:"lib/saito/templateHelpers"}}),function(e){"use strict";e.contentTimer={show:function(){$("#content").css("visibility","visible"),console.warn("DOM ready timed out: show content fallback used."),delete this.timeoutID},setup:function(){this.cancel();var t=this;this.timeoutID=e.setTimeout(function(){t.show()},5e3)},cancel:function(){"number"==typeof this.timeoutID&&(e.clearTimeout(this.timeoutID),delete this.timeoutID)}},e.contentTimer.setup()}(window),require(["lib/bootstrapHelper","common"],function(){"use strict";require(["lib/saito/underscore.extend"]),require(["app/app"])}),define("main",function(){});