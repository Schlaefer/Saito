define("models/appSetting",["underscore","backbone"],function(t,e){var i=e.Model.extend({});return i}),define("models/appStatus",["underscore","backbone","cakeRest"],function(t,e,i){var n=e.Model.extend({initialize:function(){this.methodToCakePhpUrl=t.clone(this.methodToCakePhpUrl),this.methodToCakePhpUrl.read="status/"},setWebroot:function(t){this.webroot=t+"saitos/"}});return t.extend(n.prototype,i),n}),define("models/currentUser",["underscore","backbone"],function(t,e){var i=e.Model.extend({});return i}),define("models/app",["underscore","backbone","models/appSetting","models/appStatus","models/currentUser"],function(t,e,i,n,o){var s=e.Model.extend({eventBus:null,settings:null,status:null,currentUser:null,request:null,initialize:function(){this.eventBus=t.extend({},e.Events),this.settings=new i,this.status=new n,this.currentUser=new o},initAppStatusUpdate:function(){var e,i,n,o,s,r,a=1e4,l=9e4;s=function(){void 0!==o&&clearTimeout(o)},e=function(){s(),r=a},n=function(){o=setTimeout(i,r)},i=t.bind(function(){n(),this.status.fetch(),r=Math.floor(r*(1+r/4e4)),r>l&&(r=l)},this),this.status.setWebroot(this.settings.get("webroot")),this.listenTo(this.status,"change",function(){e(),n()}),i(),e(),n()}});return new s}),define("models/threadline",["underscore","backbone","models/app","cakeRest"],function(t,e,i,n){var o=e.Model.extend({defaults:{isInlineOpened:!1,shouldScrollOnInlineOpen:!0,isAlwaysShownInline:!1,isNewToUser:!1,posting:"",html:""},initialize:function(){this.webroot=i.settings.get("webroot")+"entries/",this.methodToCakePhpUrl=t.clone(this.methodToCakePhpUrl),this.methodToCakePhpUrl.read="threadLine/",this.set("isAlwaysShownInline",i.currentUser.get("user_show_inline")||!1),this.listenTo(this,"change:html",this._setIsNewToUser)},_setIsNewToUser:function(){this.set("isNewToUser","1"===$(this.get("html")).data("data-new"))}});return t.extend(o.prototype,n),o}),define("collections/threadlines",["underscore","backbone","models/threadline"],function(t,e,i){var n=e.Collection.extend({model:i});return n}),define("views/threadline-spinner",["jquery","underscore","backbone"],function(t,e,i){var n=i.View.extend({running:!1,show:function(){var t=e.bind(function(){return this.running===!1?(this.$el.css({opacity:1}),void 0):(this.$el.animate({opacity:.1},900,e.bind(function(){this.$el.animate({opacity:1},500,t())},this)),void 0)},this);this.running=!0,t()},hide:function(){this.running=!1}});return n}),define("text!templates/threadline-spinner.html",[],function(){return'<div class="js-thread_inline thread_inline" style="display:none">\n	<div class="js-btn-strip btn-strip btn-strip-top pointer">\n		<i class="icon-close-widget"></i>\n	</div>\n	<div class="t_s">\n	</div>\n</div>'}),define("models/geshi",["underscore","backbone"],function(t,e){var i=e.Model.extend({defaults:{isPlaintext:!1}});return i}),define("collections/geshis",["underscore","backbone","models/geshi"],function(t,e,i){var n=e.Collection.extend({model:i});return n}),define("views/geshi",["jquery","underscore","backbone","models/geshi"],function(t,e,i,n){var o=i.View.extend({plainText:!1,htmlText:!1,events:{"click .geshi-plain-text":"_togglePlaintext"},initialize:function(){this.model=new n,this.collection.push(this.model),this.block=this.$(".geshi-plain-text").next(),this._setPlaintextButton(),this.listenTo(this.model,"change",this.render)},_setPlaintextButton:function(){this.model.get("isPlaintext")?this.$(".geshi-plain-text").html("<i class='icon-list-ol'></i>"):this.$(".geshi-plain-text").html("<i class='icon-reorder'></i>")},_togglePlaintext:function(t){t.preventDefault(),this.model.set("isPlaintext",!this.model.get("isPlaintext"))},_extractPlaintext:function(){this.plainText===!1&&(this.htmlText=this.block.html(),"Microsoft Internet Explorer"===navigator.appName?(this.htmlText=this.htmlText.replace(/\n\r/g,"+"),this.plainText=t(this.htmlText).text().replace(/\+\+/g,"\r")):this.plainText=this.block.text().replace(/code /g,"code \n"))},_renderText:function(){this.model.get("isPlaintext")?this.block.text(this.plainText).wrapInner('<pre class="code"></pre>'):this.block.html(this.htmlText)},render:function(){return this._setPlaintextButton(),this._extractPlaintext(),this._renderText(),this}});return o}),define("models/upload",["underscore","backbone","models/app","cakeRest"],function(t,e,i,n){var o=e.Model.extend({initialize:function(){this.webroot=i.settings.get("webroot")+"uploads/"}});return t.extend(o.prototype,n),o}),define("collections/uploads",["underscore","backbone","models/upload"],function(t,e,i){var n=e.Collection.extend({model:i,initialize:function(t){this.url=t.url+"uploads/index/"}});return n}),define("text!templates/upload.html",[],function(){return'<div class="upload_box_delete">\n    <%= linkDelete %>\n</div>\n<div>\n    <div class="upload_box_header">\n        <%= linkImage %>\n    </div>\n</div>\n<div>\n    <div class="l-box-footer box-footer-form upload_box_footer">\n        <%= linkInsert %>\n    </div>\n</div>\n'}),define("views/upload",["jquery","underscore","backbone","models/app","text!templates/upload.html"],function(t,e,i,n,o){var s=i.View.extend({className:"box-content upload_box current",events:{"click .upload_box_delete":"_removeUpload","click .btn-submit":"_insert"},initialize:function(t){this.textarea=t.textarea,this.listenTo(this.model,"destroy",this._uploadRemoved)},_removeUpload:function(t){t.preventDefault(),this.model.destroy({success:e.bind(function(t,e){n.eventBus.trigger("notification",e)},this)})},_uploadRemoved:function(){this.remove()},_insert:function(t){t.preventDefault(),this._insertAtCaret("[upload]"+this.model.get("name")+"[/upload]",this.textarea)},_insertAtCaret:function(t,e){var i=0,n=e.selectionStart||"0"==e.selectionStart?"ff":document.selection?"ie":!1;if("ie"==n){e.focus();var o=document.selection.createRange();o.moveStart("character",-e.value.length),i=o.text.length}else"ff"==n&&(i=e.selectionStart);var s=e.value.substring(0,i),r=e.value.substring(i,e.value.length);if(e.value=s+t+r,i+=t.length,"ie"==n){e.focus();var o=document.selection.createRange();o.moveStart("character",-e.value.length),o.moveStart("character",i),o.moveEnd("character",0),o.select()}else"ff"==n&&(e.selectionStart=i,e.selectionEnd=i,e.focus())},render:function(){return this.$el.html(e.template(o,this.model.toJSON())),this}});return s}),function(t){function e(){}jQuery.event.props.push("dataTransfer");var i,n,o={fallback_id:"",url:"",refresh:1e3,paramname:"userfile",allowedfiletypes:[],maxfiles:25,maxfilesize:1,queuefiles:0,queuewait:200,data:{},headers:{},drop:e,dragStart:e,dragEnter:e,dragOver:e,dragLeave:e,docEnter:e,docOver:e,docLeave:e,beforeEach:e,afterAll:e,rename:e,error:function(t){alert(t)},uploadStarted:e,uploadFinished:e,progressUpdated:e,globalProgressUpdated:e,speedUpdated:e},s=["BrowserNotSupported","TooManyFiles","FileTooLarge","FileTypeNotAllowed","NotFound","NotReadable","AbortError","ReadError"],r=!1,a=0;t.fn.filedrop=function(e){function l(t){return C.drop.call(this,t)===!1?!1:(n=t.dataTransfer.files,null===n||void 0===n||0===n.length?(C.error(s[0]),!1):(a=n.length,d(),t.preventDefault(),!1))}function h(e,i,n,o){var s="--",r="\r\n",a="";if(C.data){var l=t.param(C.data).replace(/\+/g,"%20").split(/&/);t.each(l,function(){var t=this.split("=",2),e=decodeURIComponent(t[0]),i=decodeURIComponent(t[1]);a+=s,a+=o,a+=r,a+='Content-Disposition: form-data; name="'+e+'"',a+=r,a+=r,a+=i,a+=r})}return a+=s,a+=o,a+=r,a+='Content-Disposition: form-data; name="'+C.paramname+'"',a+='; filename="'+e+'"',a+=r,a+="Content-Type: "+n,a+=r,a+=r,a+=i,a+=r,a+=s,a+=o,a+=s,a+=r}function c(t){if(t.lengthComputable){var e=Math.round(100*t.loaded/t.total);if(this.currentProgress!==e){this.currentProgress=e,C.progressUpdated(this.index,this.file,this.currentProgress),T[this.global_progress_index]=this.currentProgress,u();var i=(new Date).getTime(),n=i-this.currentStart;if(n>=C.refresh){var o=t.loaded-this.startData,s=o/n;C.speedUpdated(this.index,this.file,s),this.startData=t.loaded,this.currentStart=i}}}}function u(){if(0!==T.length){var t,e=0;for(t in T)T.hasOwnProperty(t)&&(e+=T[t]);C.globalProgressUpdated(Math.round(e/T.length))}}function d(){if(r=!1,!n)return C.error(s[0]),!1;if(C.allowedfiletypes.push&&C.allowedfiletypes.length)for(var e=n.length;e--;)if(!n[e].type||t.inArray(n[e].type,C.allowedfiletypes)<0)return C.error(s[3],n[e]),!1;var i=0,o=0;if(a>C.maxfiles&&0===C.queuefiles)return C.error(s[1]),!1;for(var l=[],d=[],v=[],b=0;a>b;b++)l.push(b);var y=function(t){setTimeout(w,t)},w=function(){var t;if(r)return!1;if(C.queuefiles>0&&d.length>=C.queuefiles)return y(C.queuewait);t=l[0],l.splice(0,1),d.push(t);try{if(g(n[t])!==!1){if(t===a)return;var e=new FileReader,i=1048576*C.maxfilesize;if(e.index=t,n[t].size>i)return C.error(s[2],n[t],t),d.forEach(function(e,i){e===t&&d.splice(i,1)}),o++,!0;e.onerror=function(t){switch(t.target.error.code){case t.target.error.NOT_FOUND_ERR:return C.error(s[4]),!1;case t.target.error.NOT_READABLE_ERR:return C.error(s[5]),!1;case t.target.error.ABORT_ERR:return C.error(s[6]),!1;default:return C.error(s[7]),!1}},e.onloadend=C.beforeSend?function(e){C.beforeSend(n[t],t,function(){_(e)})}:_,e.readAsBinaryString(n[t])}else o++}catch(h){return d.forEach(function(e,i){e===t&&d.splice(i,1)}),C.error(s[0]),!1}l.length>0&&w()},_=function(e){var s=("undefined"==typeof e.srcElement?e.target:e.srcElement).index;void 0===e.target.index&&(e.target.index=f(e.total));var l,g=new XMLHttpRequest,b=g.upload,y=n[e.target.index],w=e.target.index,_=(new Date).getTime(),x="------multipartformboundary"+(new Date).getTime(),k=T.length,I=p(y.name),S=y.type;C.withCredentials&&(g.withCredentials=C.withCredentials),l="string"==typeof I?h(I,e.target.result,S,x):h(y.name,e.target.result,S,x),b.index=w,b.file=y,b.downloadStartTime=_,b.currentStart=_,b.currentProgress=0,b.global_progress_index=k,b.startData=0,b.addEventListener("progress",c,!1),jQuery.isFunction(C.url)?g.open("POST",C.url(),!0):g.open("POST",C.url,!0),g.setRequestHeader("content-type","multipart/form-data; boundary="+x),t.each(C.headers,function(t,e){g.setRequestHeader(t,e)}),g.sendAsBinary(l),T[k]=0,u(),C.uploadStarted(w,y,a),g.onload=function(){var t=null;if(g.responseText)try{t=jQuery.parseJSON(g.responseText)}catch(e){t=g.responseText}var n=(new Date).getTime(),l=n-_,h=C.uploadFinished(w,y,t,l,g);i++,d.forEach(function(t,e){t===s&&d.splice(e,1)}),v.push(s),T[k]=100,u(),i===a-o&&m(),h===!1&&(r=!0),(g.status<200||g.status>299)&&C.error(g.statusText,y,s,g.status)}};w()}function f(t){for(var e=0;a>e;e++)if(n[e].size===t)return e;return void 0}function p(t){return C.rename(t)}function g(t){return C.beforeEach(t)}function m(){return C.afterAll()}function v(t){clearTimeout(i),t.preventDefault(),C.dragEnter.call(this,t)}function b(t){clearTimeout(i),t.preventDefault(),C.docOver.call(this,t),C.dragOver.call(this,t)}function y(t){clearTimeout(i),C.dragLeave.call(this,t),t.stopPropagation()}function w(t){return t.preventDefault(),C.docLeave.call(this,t),!1}function _(t){return clearTimeout(i),t.preventDefault(),C.docEnter.call(this,t),!1}function x(t){return clearTimeout(i),t.preventDefault(),C.docOver.call(this,t),!1}function k(t){i=setTimeout(function(e){return function(){C.docLeave.call(e,t)}}(this),200)}var C=t.extend({},o,e),T=[];return this.on("drop",l).on("dragstart",C.dragStart).on("dragenter",v).on("dragover",b).on("dragleave",y),t(document).on("drop",w).on("dragenter",_).on("dragover",x).on("dragleave",k),t("#"+C.fallback_id).change(function(t){C.drop(t),n=t.target.files,a=n.length,d()}),this};try{if(XMLHttpRequest.prototype.sendAsBinary)return;XMLHttpRequest.prototype.sendAsBinary=function(t){function e(t){return 255&t.charCodeAt(0)}var i=Array.prototype.map.call(t,e),n=new Uint8Array(i);this.send(n.buffer)}}catch(l){}}(jQuery),define("views/../../dev/vendors/jquery-filedrop/jquery.filedrop",function(){}),define("text!templates/uploadNew.html",[],function(){return'<form action="<%= url %>" method="post" class="dropbox" target="uploadIFrame"\n      enctype="multipart/form-data">\n    <div class="upload_box_header">\n        <div class="upload-layer">\n        </div>\n        <div class="upload-drag-indicator">\n            <i class="icon-upload"></i>\n        </div>\n        <h2> <%- $.i18n.__(\'upload_new_title\') %></h2>\n        <p>\n            <%- $.i18n.__(\'upload_info\', {size: upload_size}) %>\n        </p>\n    </div>\n    <div class="l-box-footer box-footer-form upload_box_footer">\n        <div style="position: relative;">\n            <!--\n                // To present a nice upload button we generate a dead button.\n                // Beneath the nice dummy button is the actual input file upload,\n                // but it\'s hidden behind the opacity:0 curtain div.\n              // z-index: 2000 to have the button above the jQuery UI modal.\n              -->\n            <button class="btn btn-submit" type="button">\n                <%- $.i18n.__("upload_btn") %>\n            </button>\n            <div style="position: absolute; z-index: 2000; top:0; right: 0; width: 100%; height: 100%; opacity: 0; cursor: pointer; overflow: hidden; " >\n                <input id="Upload0File"\n                       type="file" name="data[Upload][0][file]"\n                       style="width: 150px; height: 100%"\n                        >\n            </div>\n        </div>\n    </div>\n</form>\n<iframe id="uploadIFrame" name="uploadIFrame" src="about:blank" style="display: none;">\n    <html><head></head><body></body></html>\n</iframe>\n'}),define("text!templates/spinner.html",[],function(){return'<div class="spinner"></div>\n'}),define("views/uploadNew",["jquery","underscore","backbone","../../dev/vendors/jquery-filedrop/jquery.filedrop","models/app","text!templates/uploadNew.html","text!templates/spinner.html","humanize"],function(t,e,i,n,o,s,r,a){var l=i.View.extend({className:"box-content upload_box upload-new",wasChild:"unset",events:{"change #Upload0File":"_uploadManual"},initialize:function(t){this.uploadUrl=o.settings.get("webroot")+"uploads/add",this.collection=t.collection},_initDropUploader:function(){this._browserSupportsDragAndDrop()&&window.FileReader?this.$(".upload-layer").filedrop({maxfiles:1,maxfilesize:o.settings.get("upload_max_img_size")/1024,url:this.uploadUrl,paramname:"data[Upload][0][file]",allowedfiletypes:["image/jpeg","image/jpg","image/png","image/gif"],dragOver:e.bind(function(){this._showDragIndicator()},this),dragLeave:e.bind(function(){this._hideDragIndicator()},this),uploadFinished:e.bind(function(t,e,i){this._postUpload(i)},this),beforeSend:e.bind(function(t,e,i){this._hideDragIndicator(),this._setUploadSpinner(),i()},this),error:e.bind(function(e,i){var n;switch(this._hideDragIndicator(),e){case"FileTypeNotAllowed":n=t.i18n.__("upload_fileTypeNotAllowed");break;case"FileTooLarge":n=t.i18n.__("upload_fileToLarge",{name:i.name});break;case"BrowserNotSupported":n=t.i18n.__("upload_browserNotSupported");break;case"TooManyFiles":n=t.i18n.__("upload_toManyFiles");break;default:n=e}o.eventBus.trigger("notification",{title:"Error",message:n,type:"error"})},this)}):this.$("h2").html(t.i18n.__("Upload"))},_browserSupportsDragAndDrop:function(){var t=this.$(".upload-layer")[0];return"draggable"in t||"ondragstart"in t&&"ondrop"in t},_showDragIndicator:function(){this.$(".upload-drag-indicator").fadeIn()},_hideDragIndicator:function(){this.$(".upload-drag-indicator").fadeOut()},_setUploadSpinner:function(){this.$(".upload_box_header").html(r)},_uploadManual:function(t){var e,i,n=!0;t.preventDefault();try{e=new FormData,i=this.$("#Upload0File")[0],e.append(i.name,i.files[0])}catch(o){n=!1}this._setUploadSpinner(),n?this._uploadAjax(e):this._uploadIFrame()},_uploadIFrame:function(){var t=this.$("form"),i=this.$("#uploadIFrame");i.load(e.bind(function(){this._postUpload(i.contents().find("body").html()),i.off("load")},this)),t.submit()},_uploadAjax:function(t){var i=new XMLHttpRequest;i.open("POST",this.uploadUrl),i.onloadend=e.bind(function(t){this._postUpload(t.target.response)},this),i.onerror=this._onUploadError,i.send(t)},_onUploadError:function(){o.eventBus.trigger("notification",{type:"error",message:t.i18n.__("upload_genericError")})},_postUpload:function(t){if(e.isString(t))try{t=JSON.parse(t)}catch(i){this._onUploadError()}o.eventBus.trigger("notification",t),this.collection.fetch({reset:!0}),this.render()},render:function(){return this.$el.html(e.template(s)({url:this.uploadUrl,upload_size:a.filesize(o.settings.get("upload_max_img_size"))})),this._initDropUploader(),this}});return l}),define("text!templates/uploads.html",[],function(){return'<div id="upload_index" class="upload index">\n    <div class="content">\n    </div>\n</div>\n'}),define("views/uploads",["jquery","underscore","backbone","models/app","collections/uploads","views/upload","views/uploadNew","text!templates/uploads.html"],function(t,e,i,n,o,s,r,a){var l=i.View.extend({events:{"click .current .btn-submit":"_closeDialog"},initialize:function(t){this.textarea=t.textarea,this.collection=new o({url:n.settings.get("webroot")}),this.listenTo(this.collection,"reset",this._addAll),this.$(".body").html(e.template(a)),this.uploadNewView=new r({collection:this.collection}),this.$(".content").append(this.uploadNewView.el),this.render(),this.collection.fetch({reset:!0})},_addOne:function(t){var e=new s({model:t,textarea:this.textarea});this.$(".upload-new").after(e.render().el)},_addAll:function(){this._removeAll(),this.collection.each(this._addOne,this)},_removeAll:function(){this.$(".upload_box.current").remove()},_setDialogSize:function(){this.$el.dialog("option","width",window.innerWidth-80),this.$el.dialog("option","height",window.innerHeight-80)},_closeDialog:function(){this.$el.dialog("close")},render:function(){return this.uploadNewView.render(),this.$el.dialog({title:t.i18n.__("Upload"),modal:!0,draggable:!1,resizable:!1,position:[40,40],hide:"fade"}),this._setDialogSize(),t(window).resize(e.bind(function(){this._setDialogSize()},this)),window.onorientationchange=e.bind(function(){this._setDialogSize()},this),this}});return l}),define("lib/saito/markItUp.media",["jquery","underscore"],function(t,e){var i={cleanUp:function(t){return t=t.replace(/https:\/\/www\.dropbox\.com\//,"https://dl.dropbox.com/")}},n={rawUrlCleaner:[i],multimedia:function(i,o){var s=t.trim(i),r="([\\/?]|$)",a=new RegExp("\\.(png|gif|jpg|jpeg|webp)"+r,"i"),l=new RegExp("\\.(mp4|webm|m4v)"+r,"i"),h=new RegExp("\\.(m4a|ogg|mp3|wav|opus)"+r,"i"),c=/<object/i,u=/<iframe/i,d="";return o=o||{},e.defaults(o,{embedlyEnabled:!1}),e.each(this.rawUrlCleaner,function(t){s=t.cleanUp(s)}),d=a.test(s)?n._image(s):l.test(s)?n._videoHtml5(s):h.test(s)?n._audioHtml5(s):u.test(s)?n._videoIframe(s):c.test(s)?n._videoFlash(s):n._videoFallback(s),o.embedlyEnabled===!0&&""===d&&(d=n._embedly(s)),d},_image:function(t){return"[img]"+t+"[/img]"},_videoFlash:function(t){var e="[flash_video]URL|WIDTH|HEIGHT[/flash_video]";return null!==t?(e=e.replace("WIDTH",/width="(\d+)"/.exec(t)[1]),e=e.replace("HEIGHT",/height="(\d+)"/.exec(t)[1]),e=e.replace("URL",/src="([^"]+)"/.exec(t)[1])):""},_videoHtml5:function(t){return"[video]"+t+"[/video]"},_audioHtml5:function(t){return"[audio]"+t+"[/audio]"},_videoIframe:function(t){var e=/<iframe(.*?)>.*?<\/iframe>/i.exec(t)[1];return e=e.replace(/["']/g,""),"[iframe"+e+"][/iframe]"},_videoFallback:function(t){var e,i="";if(/http/.test(t)===!1&&(t="http://"+t),/(http|https):\/\/(\w+:{0,1}\w*@)?(\S+)(:[0-9]+)?(\/|\/([\w#!:.?+=&%@!\-\/]))?/i.test(t)){var o=t.match(/(https?:\/\/)?(www\.)?(.[^\/:]+)/i).pop();if("youtu.be"===o&&/youtu.be\/(.*?)(&.*)?$/.test(t))return e=t.match(/youtu.be\/(.*?)(&.*)?$/)[1],i=n._createIframe({url:"//www.youtube.com/embed/"+e}),i=n._videoIframe(i);if("youtube.com"===o)return/v=(.*?)(&.*)?$/.test(t)&&(e=t.match(/v=(.*?)(&.*)?$/)[1],i=n._createIframe({url:"//www.youtube.com/embed/"+e}),i=n._videoIframe(i)),i}return i},_embedly:function(t){return"[embed]"+t+"[/embed]"},_createIframe:function(t){return'<iframe src="'+t.url+'" width="425" height="349" frameborder="0" allowfullscreen></iframe>'}};return n}),define("text!templates/mediaInsert.html",[],function(){return'<form action="#" style="width: 100%;" id="addForm" method="post" accept-charset="utf-8">\n    <label for="markitup_media_txta" class="c_markitup_label">\n        <%- $.i18n.__(\'Enter link to media or embedding code:\') %>\n    </label>\n    <textarea name="data[media]" id="markitup_media_txta" class="c_markitup_popup_txta" rows="6" columns="20">\n    </textarea>\n    <div class="clearfix"></div>\n    <br/>\n    <div class="submit">\n        <input style="float: right;" class="btn btn-submit"\n               id="markitup_media_btn" type="submit"\n               value="<%- $.i18n.__(\'Insert\') %>"/>\n    </div>\n    <div class="clearfix"></div>\n    <br/>\n    <div id="markitup_media_message" class="flash error" style="display: none;">\n        <%- $.i18n.__(\'Nothing recognized.\') %>\n    </div>\n</form>\n'}),define("views/mediaInsert",["jquery","underscore","backbone","models/app","lib/saito/markItUp.media","text!templates/mediaInsert.html"],function(t,e,i,n,o,s){return i.View.extend({template:e.template(s),events:{"click #markitup_media_btn":"_insert"},initialize:function(){void 0!==this.model&&null!==this.model&&this.listenTo(this.model,"change:isAnsweringFormShown",this.remove)},_insert:function(e){var i,s;e.preventDefault(),s=o,i=s.multimedia(this.$("#markitup_media_txta").val(),{embedlyEnabled:n.settings.get("embedly_enabled")===!0}),""===i?this._invalidInput():(t.markItUp({replaceWith:i}),this._closeDialog())},_hideErrorMessages:function(){this.$("#markitup_media_message").hide()},_invalidInput:function(){this.$("#markitup_media_message").show(),this.$el.dialog().parent().effect("shake",{times:2},250)},_closeDialog:function(){this.$el.dialog("close"),this._hideErrorMessages(),this.$("#markitup_media_txta").val("")},_showDialog:function(){this.$el.dialog({show:{effect:"scale",duration:200},hide:{effect:"fade",duration:200},title:t.i18n.__("Multimedia"),resizable:!1,open:function(){setTimeout(function(){t("#markitup_media_txta").focus()},210)},close:e.bind(function(){this._hideErrorMessages()},this)})},render:function(){return this.$el.html(this.template),this._showDialog(),this}})}),define("models/preview",["underscore","backbone","models/app"],function(t,e,i){var n=e.Model.extend({defaults:{rendered:"",data:"",fetchingData:0},initialize:function(){this.webroot=i.settings.get("webroot"),this.listenTo(this,"change:data",this._fetchRendered)},_fetchRendered:function(){this.set("fetchingData",1),$.post(this.webroot+"entries/preview/",this.get("data"),t.bind(function(t){this.set("fetchingData",0),this.set("rendered",t.html),i.eventBus.trigger("notificationUnset","all"),i.eventBus.trigger("notification",t)},this),"json")}});return n}),define("views/preview",["jquery","underscore","backbone","text!templates/spinner.html"],function(t,e,i,n){var o=i.View.extend({initialize:function(){this.render(),this.listenTo(this.model,"change:fetchingData",this._spinner),this.listenTo(this.model,"change:rendered",this.render)},_spinner:function(t){t.get("fetchingData")?this.$el.html(n):this.$el.html("")},render:function(){var t;return t=this.model.get("rendered"),t||(t=""),this.$el.html(t),this}});return o}),function(t){var e={_scrollToTop:function(e){t("body").animate({scrollTop:e.offset().top-10,easing:"swing"},300)},_scrollToBottom:function(i){t("body").animate({scrollTop:e._elementBottom(i)-t(window).height()+20,easing:"swing"},300,function(){e._isHeigherThanView(i)&&e._scrollToTop(i)})},_elementBottom:function(t){return t.offset().top+t.height()},_isScrolledIntoView:function(i){if(0===t(i).length)return!0;var n=t(window).scrollTop(),o=n+t(window).height(),s=t(i).offset().top,r=e._elementBottom(i);return o>=r&&s>=n},_isHeigherThanView:function(e){return t(window).height()<=e.height()}},i={top:function(){var i;return i=t(this),e._isScrolledIntoView(i)||e._scrollToTop(i),this},bottom:function(){var i;return i=t(this),e._isScrolledIntoView(i)||e._scrollToBottom(i),this},isInView:function(){var i;return i=t(this),e._isScrolledIntoView(i)}};t.fn.scrollIntoView=function(e){return i[e]?i[e].apply(this,Array.prototype.slice.call(arguments,1)):"object"!=typeof e&&e?(t.error("Method "+e+" does not exist on jQuery.scrollIntoView"),void 0):i.init.apply(this,arguments)}}(jQuery),define("lib/saito/jquery.scrollIntoView",function(){}),define("views/answering",["jquery","underscore","backbone","models/app","views/uploads","views/mediaInsert","models/preview","views/preview","lib/saito/jquery.scrollIntoView"],function(t,e,i,n,o,s,r,a){var l=i.View.extend({rendered:!1,answeringForm:!1,preview:!1,mediaView:!1,sendInProgress:!1,model:null,events:{"click .btn-previewClose":"_closePreview","click .btn-preview":"_showPreview","click .btn-markItUp-Upload":"_upload","click .btn-markItUp-Media":"_media","click .btn-submit":"_send","click .btn-cite":"_cite","keypress .inp-subject":"_onKeyPressSubject"},initialize:function(t){this.parentThreadline=t.parentThreadline||null,this.parentThreadline||this._setupTextArea(),this.listenTo(n.eventBus,"isAppVisible",this._focusSubject)},_cite:function(t){t.preventDefault();var e=this.$(".cite-container"),i=this.$(".btn-cite").data("text"),n=this.$textarea.val();this.$textarea.val(i+"\n\n"+n),e.slideToggle(),this.$textarea.focus()},_onKeyPressSubject:function(t){13===t.keyCode&&this._send(t)},_upload:function(t){var e;t.preventDefault(),e=new o({el:"#markitup_upload",textarea:this.$textarea[0]})},_media:function(t){t.preventDefault(),this.mediaView===!1&&(this.mediaView=new s({el:"#markitup_media",model:this.model})),this.mediaView.render()},_showPreview:function(t){var e;t.preventDefault(),this.$(".preview").slideDown("fast"),this.preview===!1&&(e=new r,this.preview=new a({el:this.$(".preview .content"),model:e})),this.preview.model.set("data",this.$("form").serialize())},_closePreview:function(t){t.preventDefault(),this.$(".preview").slideUp("fast")},_setupTextArea:function(){this.$textarea=t("textarea#EntryText")},_requestAnsweringForm:function(){t.ajax({url:n.settings.get("webroot")+"entries/add/"+this.model.get("id"),success:e.bind(function(t){this.answeringForm=t,this.render()},this)})},_postRendering:function(){this.$el.scrollIntoView("bottom"),this._focusSubject()},_focusSubject:function(){this.$(".postingform input[type=text]:first").focus()},_send:function(t){return this.sendInProgress?(t.preventDefault(),void 0):(this.sendInProgress=!0,this.parentThreadline?this._sendInline(t):this._sendRedirect(t),void 0)},_sendRedirect:function(i){var n=this.$(".btn-submit")[0];if(i.preventDefault(),"object"==typeof n.validity&&n.form.checkValidity()===!1){var o=e.bind(function(){this.checkValidityDummy||(this.checkValidityDummy=t("<button></button>",{type:"submit",style:"display: none;"}),t(n).after(this.checkValidityDummy)),this.checkValidityDummy.click()},this);o(),this.sendInProgress=!1}else n.disabled=!0,n.form.submit()},_sendInline:function(i){i.preventDefault(),t.ajax({url:n.settings.get("webroot")+"entries/add",type:"POST",dataType:"json",data:this.$("#EntryAddForm").serialize(),beforeSend:e.bind(function(){this.$(".btn.btn-submit").attr("disabled","disabled")},this),success:e.bind(function(t){this.model.set({isAnsweringFormShown:!1}),null!==this.parentThreadline&&this.parentThreadline.set("isInlineOpened",!1),n.eventBus.trigger("newEntry",{tid:t.tid,pid:this.model.get("id"),id:t.id})},this)})},render:function(){return this.answeringForm===!1?this._requestAnsweringForm():this.rendered===!1&&(this.rendered=!0,this.$el.html(this.answeringForm),this._setupTextArea(),e.defer(function(t){t._postRendering()},this)),this}});return l}),define("views/postings",["jquery","underscore","backbone","models/app","collections/geshis","views/geshi","views/answering","text!templates/spinner.html"],function(t,e,i,n,o,s,r,a){var l=i.View.extend({className:"js-entry-view-core",answeringForm:!1,events:{"click .js-btn-setAnsweringForm":"setAnsweringForm","click .btn-answeringClose":"setAnsweringForm"},initialize:function(t){this.collection=t.collection,this.parentThreadline=t.parentThreadline||null,this.listenTo(this.model,"change:isAnsweringFormShown",this.toggleAnsweringForm),this.listenTo(this.model,"change:html",this.render),this.initGeshi(".c_bbc_code-wrapper")},initGeshi:function(t){var e;if(e=this.$(t),e.length>0){var i=new o;e.each(function(t,e){new s({el:e,collection:i})})}},setAnsweringForm:function(t){t.preventDefault(),this.model.toggle("isAnsweringFormShown")},toggleAnsweringForm:function(){this.model.get("isAnsweringFormShown")?(this._hideAllAnsweringForms(),this._hideSignature(),this._showAnsweringForm(),this._hideBoxActions()):(this._showBoxActions(),this._hideAnsweringForm(),this._showSignature())},_showAnsweringForm:function(){n.eventBus.trigger("breakAutoreload"),this.answeringForm===!1&&this.$(".posting_formular_slider").html(a),this.$(".posting_formular_slider").slideDown("fast"),this.answeringForm===!1&&(this.answeringForm=new r({el:this.$(".posting_formular_slider"),model:this.model,parentThreadline:this.parentThreadline})),this.answeringForm.render()},_hideAnsweringForm:function(){var e;t(this.el).find(".posting_formular_slider").slideUp("fast"),e=t(this.el).find(".posting_formular_slider").parent(),this.answeringForm!==!1&&(this.answeringForm.remove(),this.answeringForm.undelegateEvents(),this.answeringForm=!1),e.append('<div class="posting_formular_slider"></div>')},_hideAllAnsweringForms:function(){this.collection.forEach(function(t){t.get("id")!==this.model.get("id")&&t.set("isAnsweringFormShown",!1)},this)},_showSignature:function(){t(this.el).find(".signature").slideDown("fast")},_hideSignature:function(){t(this.el).find(".signature").slideUp("fast")},_showBoxActions:function(){t(this.el).find(".l-box-footer").slideDown("fast")},_hideBoxActions:function(){t(this.el).find(".l-box-footer").slideUp("fast")},render:function(){return this.$el.html(this.model.get("html")),this.initGeshi(".c_bbc_code-wrapper"),this}});return l}),define("models/posting",["underscore","backbone","models/app"],function(t,e,i){var n=e.Model.extend({defaults:{isAnsweringFormShown:!1,html:""},fetchHtml:function(){$.ajax({success:t.bind(function(t){this.set("html",t)},this),type:"post",async:!1,dateType:"html",url:i.settings.get("webroot")+"entries/view/"+this.get("id")})}});return n}),define("views/threadlines",["jquery","underscore","backbone","models/app","models/threadline","views/threadline-spinner","text!templates/threadline-spinner.html","views/postings","models/posting","lib/saito/jquery.scrollIntoView"],function(t,e,i,n,o,s,r,a,l){var h=i.View.extend({className:"js-thread_line",tagName:"li",spinnerTpl:e.template(r),postings:null,events:{"click .btn_show_thread":"toggleInlineOpen","click .link_show_thread":"toggleInlineOpenFromLink"},initialize:function(t){this.postings=t.postings,this.model=new o({id:t.id}),void 0===t.el?this.model.fetch():this.model.set({html:this.el},{silent:!0}),this.collection.add(this.model,{silent:!0}),this.attributes={"data-id":t.id},this.listenTo(this.model,"change:isInlineOpened",this._toggleInlineOpened),this.listenTo(this.model,"change:html",this.render)},toggleInlineOpenFromLink:function(t){this.model.get("isAlwaysShownInline")&&this.toggleInlineOpen(t)},toggleInlineOpen:function(t){t.preventDefault(),this.model.get("isInlineOpened")?this.model.set({isInlineOpened:!1}):this.model.set({isInlineOpened:!0})},_toggleInlineOpened:function(t,i){if(i){var n=this.model.id;this.model.get("isContentLoaded")?this._showInlineView():(this.tlsV=new s({el:this.$el.find(".thread_line-pre i")}),this.tlsV.show(),this.$el.find(".js-thread_line-content").after(this.spinnerTpl({id:n})),this.$el.find(".js-btn-strip").on("click",e.bind(this.toggleInlineOpen,this)),this._insertContent())}else this._closeInlineView()},_insertContent:function(){var t,e;t=this.model.get("id"),this.postingModel=new l({id:t}),this.postings.add(this.postingModel),e=new a({el:this.$(".t_s"),model:this.postingModel,collection:this.postings,parentThreadline:this.model}),this.postingModel.fetchHtml(),this.model.set("isContentLoaded",!0),this._showInlineView()
},_showInlineView:function(){var t=e.bind(function(){var t=this.model.get("shouldScrollOnInlineOpen");this.tlsV.hide(),t?this.$el.scrollIntoView("isInView")===!1&&this.$el.scrollIntoView("bottom"):this.model.set("shouldScrollOnInlineOpen",!0)},this);this.$el.find(".js-thread_line-content").fadeOut(100,e.bind(function(){this.$(".js-thread_inline").show(0,t)},this))},_closeInlineView:function(){this.$(".js-thread_inline").hide(0,e.bind(function(){this.$el.find(".js-thread_line-content").slideDown(),this._scrollLineIntoView()},this))},_scrollLineIntoView:function(){var t=this.$(".js-thread_line-content");t.scrollIntoView("isInView")||t.scrollIntoView("top").effect("highlight",{times:1},3e3)},render:function(){var e,i,n;return i=this.model.get("html"),i.length>0&&(e=this.$el,n=t(this.model.get("html")),this.setElement(n),e.replaceWith(n)),this}});return h}),define("models/thread",["underscore","backbone","collections/threadlines"],function(t,e,i){var n=e.Model.extend({defaults:{isThreadCollapsed:!1},initialize:function(){this.threadlines=new i}});return n}),define("collections/threads",["underscore","backbone","backboneLocalStorage","models/thread"],function(t,e,i,n){var o=e.Collection.extend({model:n,localStorage:new i("Threads")});return o}),define("views/thread",["jquery","underscore","backbone","models/app","collections/threadlines","views/threadlines"],function(t,e,i,n,o,s){var r=i.View.extend({className:"thread_box",events:{"click .btn-threadCollapse":"collapseThread","click .js-btn-openAllThreadlines":"openAllThreadlines","click .js-btn-closeAllThreadlines":"closeAllThreadlines","click .js-btn-showAllNewThreadlines":"showAllNewThreadlines"},initialize:function(e){this.postings=e.postings,this.$rootUl=this.$("ul.root"),this.$subThreadRootIl=t(this.$rootUl.find("li:not(:first-child)")[0]),this.model.get("isThreadCollapsed")?this.hide():this.show(),this.listenTo(n.eventBus,"newEntry",this._showNewThreadLine),this.listenTo(this.model,"change:isThreadCollapsed",this.toggleCollapseThread)},_showNewThreadLine:function(t){var e;t.tid===this.model.get("id")&&(e=new s({id:t.id,collection:this.model.threadlines,postings:this.postings}),this._appendThreadlineToThread(t.pid,e.render().$el))},_appendThreadlineToThread:function(t,e){var i,n;i=this.$('.js-thread_line[data-id="'+t+'"]'),n=i.next().not(".js_threadline").find("ul:first"),0===n.length?e.wrap("<ul></ul>").parent().wrap("<li></li>").parent().insertAfter(i):n.append(e)},openAllThreadlines:function(t){t.preventDefault(),e.each(this.model.threadlines.where({isInlineOpened:!1}),function(t){t.set({isInlineOpened:!0,shouldScrollOnInlineOpen:!1})},this)},closeAllThreadlines:function(t){t&&t.preventDefault(),e.each(this.model.threadlines.where({isInlineOpened:!0}),function(t){t.set({isInlineOpened:!1})},this)},showAllNewThreadlines:function(t){t.preventDefault(),e.each(this.model.threadlines.where({isInlineOpened:!1,isNewToUser:!0}),function(t){t.set({isInlineOpened:!0,shouldScrollOnInlineOpen:!1})},this)},collapseThread:function(t){t.preventDefault(),this.closeAllThreadlines(),this.model.toggle("isThreadCollapsed"),this.model.save()},toggleCollapseThread:function(t,e){e?this.slideUp():this.slideDown()},slideUp:function(){this.$subThreadRootIl.slideUp(300),this.markHidden()},slideDown:function(){this.$subThreadRootIl.slideDown(300),this.markShown()},hide:function(){this.$subThreadRootIl.hide(),this.markHidden()},show:function(){this.$subThreadRootIl.show(),this.markShown()},markShown:function(){t(this.el).find(".icon-thread-closed").removeClass("icon-thread-closed").addClass("icon-thread-open")},markHidden:function(){t(this.el).find(".icon-thread-open").removeClass("icon-thread-open").addClass("icon-thread-closed")}});return r}),define("collections/postings",["underscore","backbone","models/posting"],function(t,e,i){var n=e.Collection.extend({model:i});return n}),define("models/bookmark",["underscore","backbone","models/app","cakeRest"],function(t,e,i,n){var o=e.Model.extend({initialize:function(){this.webroot=i.settings.get("webroot")+"bookmarks/"}});return t.extend(o.prototype,n),o}),define("collections/bookmarks",["underscore","backbone","models/bookmark"],function(t,e,i){var n=e.Collection.extend({model:i});return n}),define("views/bookmark",["jquery","underscore","backbone"],function(t,e,i){var n=i.View.extend({events:{"click .btn-bookmark-delete":"deleteBookmark"},initialize:function(){e.bindAll(this,"render"),this.model.on("destroy",this.removeBookmark,this)},deleteBookmark:function(t){t.preventDefault(),this.model.destroy()},removeBookmark:function(){this.$el.hide("slide",null,500,function(){t(this).remove()})}});return n}),define("views/bookmarks",["jquery","underscore","backbone","views/bookmark"],function(t,e,i,n){var o=i.View.extend({initialize:function(){this.initCollectionFromDom(".js-bookmark",this.collection,n)}});return o}),define("views/helps",["jquery","underscore","backbone"],function(t,e,i){var n=i.View.extend({isHelpShown:!1,events:function(){var t={};return t["click "+this.indicatorName]="toggle",t},initialize:function(t){this.indicatorName=t.indicatorName,this.elementName=t.elementName,this.activateHelpButton(),this.placeHelp()},activateHelpButton:function(){this.isHelpOnPage()&&t(this.indicatorName).removeClass("no-color")},placeHelp:function(){var e={trigger:"manual",html:!0},i=["bottom","right","left"];for(var n in i)t(this.elementName+"-"+i[n]).popover(t.extend(e,{placement:i[n]}));t(this.indicatorName).popover({placement:"left",trigger:"manual"})},isHelpOnPage:function(){return this.$el.find(this.elementName).length>0},toggle:function(){event.preventDefault(),this.isHelpShown?this.hide():this.show()},show:function(){this.isHelpShown=!0,this.isHelpOnPage()?t(this.elementName).popover("show"):t(this.indicatorName).popover("show")},hide:function(){this.isHelpShown=!1,t(this.elementName).popover("hide"),t(this.indicatorName).popover("hide")}});return n}),define("views/categoryChooser",["jquery","underscore","backbone"],function(t,e,i){return i.View.extend({initialize:function(){this.$el.dialog({autoOpen:!1,show:{effect:"scale",duration:200},hide:{effect:"fade",duration:200},width:400,position:[t("#btn-category-chooser").offset().left+t("#btn-category-chooser").width()-t(window).scrollLeft()-410,t("#btn-category-chooser").offset().top-t(window).scrollTop()+t("#btn-category-chooser").height()],title:t.i18n.__("Categories"),resizable:!1})},toggle:function(){this.$el.dialog("isOpen")?this.$el.dialog("close"):this.$el.dialog("open")}})}),define("models/slidetab",["underscore","backbone","models/app"],function(t,e,i){var n=e.Model.extend({defaults:{isOpen:!1},initialize:function(){this.webroot=i.settings.get("webroot")},sync:function(){$.ajax({url:this.webroot+"users/ajax_toggle/show_"+this.get("id")})}});return n}),define("collections/slidetabs",["underscore","backbone","models/slidetab"],function(t,e,i){var n=e.Collection.extend({model:i});return n}),define("models/shout",["underscore","backbone","models/app"],function(t,e,i){var n=e.Model.extend({defaults:{html:"",newShout:""},initialize:function(){this.webroot=i.settings.get("webroot")+"shouts/",this.listenTo(this,"change:newShout",this.send)},fetch:function(){$.ajax({url:this.webroot+"index",dataType:"html",success:t.bind(function(t){t.length>0&&this.set({html:t})},this)})},send:function(){$.ajax({url:this.webroot+"add",type:"post",data:{text:this.get("newShout")},success:t.bind(function(){this.fetch()},this)})}});return n}),define("views/shouts",["jquery","underscore","backbone","models/app","jqueryAutosize"],function(t,e,i,n){var o=i.View.extend({isPrerendered:!0,events:{"keyup form":"formUp","keydown form":"formDown"},initialize:function(t){this.webroot=n.settings.get("webroot")+"shouts/",this.shouts=this.$el.find(".shouts"),this.textarea=this.$el.find("textarea"),this.slidetabModel=t.slidetabModel,this.listenTo(n.status,"change:lastShoutId",this.fetch),this.listenTo(this.slidetabModel,"change:isOpen",this.fetch),this.listenTo(this.model,"change:html",this.render),this.textarea.autosize()},formDown:function(t){13===t.keyCode&&t.shiftKey===!1&&(this.submit(),this.clearForm(),t.preventDefault())},formUp:function(){this.textarea.val().length>0?n.eventBus.trigger("breakAutoreload"):0===this.textarea.val().length&&n.eventBus.trigger("initAutoreload")},clearForm:function(){this.textarea.val("").trigger("autosize")},submit:function(){this.model.set("newShout",this.textarea.val())},fetch:function(){this.slidetabModel.get("isOpen")&&this.model.fetch()},render:function(){return this.isPrerendered?this.isPrerendered=!1:t(this.shouts).html(this.model.get("html")),this}});return o}),define("views/slidetab",["jquery","underscore","backbone","models/shout","views/shouts"],function(t,e,i,n,o){var s=i.View.extend({events:{"click .slidetab-tab":"clickSlidetab"},initialize:function(t){this.collection=t.collection,this.model.set("isOpen",this.isOpen()),this.listenTo(this.model,"change",this.toggleSlidetab),"shoutbox"===this.model.get("id")&&this.initShoutbox()},isOpen:function(){return this.$el.find(".slidetab-content").is(":visible")},clickSlidetab:function(){this.model.save("isOpen",!this.model.get("isOpen"))},toggleSlidetab:function(){this.model.get("isOpen")?this.show():this.hide(),this.toggleSlidetabTabInfo()},show:function(){this.$el.animate({width:250}),this.$el.find(".slidetab-content").css("display","block")},hide:function(){this.$el.animate({width:28},e.bind(function(){this.$el.find(".slidetab-content").css("display","none")},this))},toggleSlidetabTabInfo:function(){this.$el.find(".slidetab-tab-info").toggle()},initShoutbox:function(){new o({el:this.$("#shoutbox"),slidetabModel:this.model,model:new n})}});return s}),define("views/slidetabs",["jquery","underscore","backbone","models/app","views/slidetab"],function(t,e,i,n,o){var s=i.View.extend({initialize:function(){this.webroot=n.settings.get("webroot"),this.initCollectionFromDom(".slidetab",this.collection,o),this.makeSortable()},makeSortable:function(){var i=this.webroot;this.$el.sortable({handle:".slidetab-tab",start:e.bind(function(){this.$el.css("overflow","visible")},this),stop:e.bind(function(){this.$el.css("overflow","hidden")},this),update:function(){var e=t(this).sortable("toArray",{attribute:"data-id"});e=e.map(function(t){return"slidetab_"+t}),t.ajax({type:"POST",url:i+"users/ajax_set",data:{data:{User:{slidetab_order:e}}},dataType:"json"})}})}});return s}),define("views/app",["jquery","underscore","backbone","models/app","collections/threadlines","views/threadlines","collections/threads","views/thread","collections/postings","views/postings","collections/bookmarks","views/bookmarks","views/helps","views/categoryChooser","collections/slidetabs","views/slidetabs","views/answering","jqueryUi"],function(t,e,i,n,o,s,r,a,l,h,c,u,d,f,p,g,m){var v=i.View.extend({el:t("body"),autoPageReloadTimer:!1,events:{"click #showLoginForm":"showLoginForm","focus #header-searchField":"widenSearchField","click #btn-scrollToTop":"scrollToTop","click #btn-manuallyMarkAsRead":"manuallyMarkAsRead","click #btn-category-chooser":"toggleCategoryChooser"},initialize:function(){this.threads=new r,"entries"===n.request.controller&&"index"===n.request.action&&this.threads.fetch(),this.postings=new l,this.threadLines=new o,this.listenTo(n.eventBus,"initAutoreload",this.initAutoreload),this.listenTo(n.eventBus,"breakAutoreload",this.breakAutoreload),this.$el.on("dialogopen",this.fixJqueryUiDialog)},initFromDom:function(i){if(t(".thread_box").each(e.bind(function(e,i){var o,s;s=parseInt(t(i).attr("data-id"),10),this.threads.get(s)||this.threads.add([{id:s,isThreadCollapsed:"entries"===n.request.controller&&"index"===n.request.action&&n.currentUser.get("user_show_thread_collapsed")}],{silent:!0}),o=new a({el:t(i),postings:this.postings,model:this.threads.get(s)})},this)),t(".js-entry-view-core").each(e.bind(function(e,i){var n,o;n=parseInt(i.getAttribute("data-id"),10),this.postings.add([{id:n}],{silent:!0}),o=new h({el:t(i),model:this.postings.get(n),collection:this.postings})},this)),t(".js-thread_line").each(e.bind(function(e,i){var n,o,r,a;o=parseInt(i.getAttribute("data-tid"),10),a=this.threads.get(o)?this.threads.get(o).threadlines:this.threadLines,r=parseInt(i.getAttribute("data-id"),10),n=new s({el:t(i),id:r,postings:this.postings,collection:a})},this)),this.initAutoreload(),this.initBookmarks("#bookmarks"),this.initHelp(".shp"),this.initSlidetabs("#slidetabs"),this.initCategoryChooser("#category-chooser"),t(".entry.add-not-inline").length>0&&(this.answeringForm=new m({el:this.$(".entry.add-not-inline"),id:"foo"})),n.initAppStatusUpdate(),this._showPage(i.SaitoApp.timeAppStart,i.contentTimer),n.eventBus.trigger("notification",i.SaitoApp),window.location.href.indexOf("/jump:")>-1){var o=/jump:(\d+)/.exec(window.location.href);this.scrollToThread(o[1]),window.history.replaceState("object or string","Title",window.location.pathname.replace(/jump:\d+(\/)?/,""))}},_showPage:function(e,i){var o=function(){n.eventBus.trigger("isAppVisible",!0)};n.request.isMobile||(new Date).getTime()-e>1500?(t("#content").css("visibility","visible"),o()):t("#content").css({visibility:"visible",opacity:0}).animate({opacity:1},{duration:150,easing:"easeInOutQuart",complete:o}),i.cancel()},fixJqueryUiDialog:function(){t(".ui-icon-closethick").attr("class","icon icon-close-widget icon-large").html("")},initBookmarks:function(e){var i;if(t(e).length){var n=new c;i=new u({el:e,collection:n})}},initSlidetabs:function(t){var e,i;e=new p,i=new g({el:t,collection:e})},initCategoryChooser:function(e){t(e).length>0&&(this.categoryChooser=new f({el:e}))},toggleCategoryChooser:function(){this.categoryChooser.toggle()},initHelp:function(t){new d({el:"body",elementName:t,indicatorName:"#shp-show"})},scrollToThread:function(e){t(".thread_box[data-id="+e+"]")[0].scrollIntoView("top")},initAutoreload:function(){this.breakAutoreload(),n.settings.get("autoPageReload")&&(this.autoPageReloadTimer=setTimeout(e.bind(function(){window.location=n.settings.get("webroot")+"entries/"},this),1e3*n.settings.get("autoPageReload")))},breakAutoreload:function(){this.autoPageReloadTimer!==!1&&(clearTimeout(this.autoPageReloadTimer),this.autoPageReloadTimer=!1)},widenSearchField:function(e){var i=350;e.preventDefault(),t(e.currentTarget).width()<i&&t(e.currentTarget).animate({width:i+"px"},"fast")},showLoginForm:function(e){var i;if(!navigator.userAgent.match(/iPhone/i)&&!navigator.userAgent.match(/iPod/i)){i=t("#modalLoginDialog"),e.preventDefault(),i.height("auto");var n=e.currentTarget.title;i.dialog({modal:!0,title:n,width:420,show:"fade",hide:"fade",position:["center",120],resizable:!1})}},scrollToTop:function(t){t.preventDefault(),window.scrollTo(0,0)},manuallyMarkAsRead:function(t){t.preventDefault(),window.redirect(n.settings.get("webroot")+"entries/update")}});return v}),function(t){var e,i,n,o=t(window),s={jqueryui:{container:"ui-widget ui-widget-content ui-corner-all",notice:"ui-state-highlight",notice_icon:"ui-icon ui-icon-info",info:"",info_icon:"ui-icon ui-icon-info",success:"ui-state-default",success_icon:"ui-icon ui-icon-circle-check",error:"ui-state-error",error_icon:"ui-icon ui-icon-alert",closer:"ui-icon ui-icon-close",pin_up:"ui-icon ui-icon-pin-w",pin_down:"ui-icon ui-icon-pin-s",hi_menu:"ui-state-default ui-corner-bottom",hi_btn:"ui-state-default ui-corner-all",hi_btnhov:"ui-state-hover",hi_hnd:"ui-icon ui-icon-grip-dotted-horizontal"},bootstrap:{container:"alert",notice:"",notice_icon:"icon-exclamation-sign",info:"alert-info",info_icon:"icon-info-sign",success:"alert-success",success_icon:"icon-ok-sign",error:"alert-error",error_icon:"icon-warning-sign",closer:"icon-remove",pin_up:"icon-pause",pin_down:"icon-play",hi_menu:"well",hi_btn:"btn",hi_btnhov:"",hi_hnd:"icon-chevron-down"}},r=function(){n=t("body"),o=t(window),o.bind("resize",function(){i&&clearTimeout(i),i=setTimeout(t.pnotify_position_all,10)})};document.body?r():t(r),t.extend({pnotify_remove_all:function(){var e=o.data("pnotify");e&&e.length&&t.each(e,function(){this.pnotify_remove&&this.pnotify_remove()})},pnotify_position_all:function(){i&&clearTimeout(i),i=null;var e=o.data("pnotify");e&&e.length&&(t.each(e,function(){var t=this.opts.stack;t&&(t.nextpos1=t.firstpos1,t.nextpos2=t.firstpos2,t.addpos2=0,t.animation=!0)}),t.each(e,function(){this.pnotify_position()}))},pnotify:function(r){var a,l;"object"!=typeof r?(l=t.extend({},t.pnotify.defaults),l.text=r):l=t.extend({},t.pnotify.defaults,r);for(var h in l)"string"==typeof h&&h.match(/^pnotify_/)&&(l[h.replace(/^pnotify_/,"")]=l[h]);if(l.before_init&&l.before_init(l)===!1)return null;var c,d=function(e,i){p.css("display","none");var n=document.elementFromPoint(e.clientX,e.clientY);p.css("display","block");var o=t(n),s=o.css("cursor");p.css("cursor","auto"!=s?s:"default"),c&&c.get(0)==n||(c&&(u.call(c.get(0),"mouseleave",e.originalEvent),u.call(c.get(0),"mouseout",e.originalEvent)),u.call(n,"mouseenter",e.originalEvent),u.call(n,"mouseover",e.originalEvent)),u.call(n,i,e.originalEvent),c=o},f=s[l.styling],p=t("<div />",{"class":"ui-pnotify "+l.addclass,css:{display:"none"},mouseenter:function(t){l.nonblock&&t.stopPropagation(),l.mouse_reset&&"out"==a&&(p.stop(!0),a="in",p.css("height","auto").animate({width:l.width,opacity:l.nonblock?l.nonblock_opacity:l.opacity},"fast")),l.nonblock&&p.animate({opacity:l.nonblock_opacity},"fast"),l.hide&&l.mouse_reset&&p.pnotify_cancel_remove(),l.sticker&&!l.nonblock&&p.sticker.trigger("pnotify_icon").css("visibility","visible"),l.closer&&!l.nonblock&&p.closer.css("visibility","visible")},mouseleave:function(e){l.nonblock&&e.stopPropagation(),c=null,p.css("cursor","auto"),l.nonblock&&"out"!=a&&p.animate({opacity:l.opacity},"fast"),l.hide&&l.mouse_reset&&p.pnotify_queue_remove(),l.sticker_hover&&p.sticker.css("visibility","hidden"),l.closer_hover&&p.closer.css("visibility","hidden"),t.pnotify_position_all()},mouseover:function(t){l.nonblock&&t.stopPropagation()},mouseout:function(t){l.nonblock&&t.stopPropagation()},mousemove:function(t){l.nonblock&&(t.stopPropagation(),d(t,"onmousemove"))},mousedown:function(t){l.nonblock&&(t.stopPropagation(),t.preventDefault(),d(t,"onmousedown"))},mouseup:function(t){l.nonblock&&(t.stopPropagation(),t.preventDefault(),d(t,"onmouseup"))},click:function(t){l.nonblock&&(t.stopPropagation(),d(t,"onclick"))},dblclick:function(t){l.nonblock&&(t.stopPropagation(),d(t,"ondblclick"))}});p.opts=l,p.container=t("<div />",{"class":f.container+" ui-pnotify-container "+("error"==l.type?f.error:"info"==l.type?f.info:"success"==l.type?f.success:f.notice)}).appendTo(p),""!=l.cornerclass&&p.container.removeClass("ui-corner-all").addClass(l.cornerclass),l.shadow&&p.container.addClass("ui-pnotify-shadow"),p.pnotify_version="1.2.0",p.pnotify=function(e){var i=l;"string"==typeof e?l.text=e:l=t.extend({},l,e);for(var n in l)"string"==typeof n&&n.match(/^pnotify_/)&&(l[n.replace(/^pnotify_/,"")]=l[n]);return p.opts=l,l.cornerclass!=i.cornerclass&&p.container.removeClass("ui-corner-all").addClass(l.cornerclass),l.shadow!=i.shadow&&(l.shadow?p.container.addClass("ui-pnotify-shadow"):p.container.removeClass("ui-pnotify-shadow")),l.addclass===!1?p.removeClass(i.addclass):l.addclass!==i.addclass&&p.removeClass(i.addclass).addClass(l.addclass),l.title===!1?p.title_container.slideUp("fast"):l.title!==i.title&&(l.title_escape?p.title_container.text(l.title).slideDown(200):p.title_container.html(l.title).slideDown(200)),l.text===!1?p.text_container.slideUp("fast"):l.text!==i.text&&(l.text_escape?p.text_container.text(l.text).slideDown(200):p.text_container.html(l.insert_brs?String(l.text).replace(/\n/g,"<br />"):l.text).slideDown(200)),p.pnotify_history=l.history,p.pnotify_hide=l.hide,l.type!=i.type&&p.container.removeClass(f.error+" "+f.notice+" "+f.success+" "+f.info).addClass("error"==l.type?f.error:"info"==l.type?f.info:"success"==l.type?f.success:f.notice),(l.icon!==i.icon||l.icon===!0&&l.type!=i.type)&&(p.container.find("div.ui-pnotify-icon").remove(),l.icon!==!1&&t("<div />",{"class":"ui-pnotify-icon"}).append(t("<span />",{"class":l.icon===!0?"error"==l.type?f.error_icon:"info"==l.type?f.info_icon:"success"==l.type?f.success_icon:f.notice_icon:l.icon})).prependTo(p.container)),l.width!==i.width&&p.animate({width:l.width}),l.min_height!==i.min_height&&p.container.animate({minHeight:l.min_height}),l.opacity!==i.opacity&&p.fadeTo(l.animate_speed,l.opacity),!l.closer||l.nonblock?p.closer.css("display","none"):p.closer.css("display","block"),!l.sticker||l.nonblock?p.sticker.css("display","none"):p.sticker.css("display","block"),p.sticker.trigger("pnotify_icon"),l.sticker_hover?p.sticker.css("visibility","hidden"):l.nonblock||p.sticker.css("visibility","visible"),l.closer_hover?p.closer.css("visibility","hidden"):l.nonblock||p.closer.css("visibility","visible"),l.hide?i.hide||p.pnotify_queue_remove():p.pnotify_cancel_remove(),p.pnotify_queue_position(),p},p.pnotify_position=function(t){var e=p.opts.stack;if(e){e.nextpos1||(e.nextpos1=e.firstpos1),e.nextpos2||(e.nextpos2=e.firstpos2),e.addpos2||(e.addpos2=0);var i="none"==p.css("display");if(!i||t){var n,s,r,a={};switch(e.dir1){case"down":r="top";break;case"up":r="bottom";break;case"left":r="right";break;case"right":r="left"}n=parseInt(p.css(r)),isNaN(n)&&(n=0),"undefined"!=typeof e.firstpos1||i||(e.firstpos1=n,e.nextpos1=e.firstpos1);var l;switch(e.dir2){case"down":l="top";break;case"up":l="bottom";break;case"left":l="right";break;case"right":l="left"}if(s=parseInt(p.css(l)),isNaN(s)&&(s=0),"undefined"!=typeof e.firstpos2||i||(e.firstpos2=s,e.nextpos2=e.firstpos2),("down"==e.dir1&&e.nextpos1+p.height()>o.height()||"up"==e.dir1&&e.nextpos1+p.height()>o.height()||"left"==e.dir1&&e.nextpos1+p.width()>o.width()||"right"==e.dir1&&e.nextpos1+p.width()>o.width())&&(e.nextpos1=e.firstpos1,e.nextpos2+=e.addpos2+("undefined"==typeof e.spacing2?25:e.spacing2),e.addpos2=0),e.animation&&e.nextpos2<s)switch(e.dir2){case"down":a.top=e.nextpos2+"px";break;case"up":a.bottom=e.nextpos2+"px";break;case"left":a.right=e.nextpos2+"px";break;case"right":a.left=e.nextpos2+"px"}else p.css(l,e.nextpos2+"px");switch(e.dir2){case"down":case"up":p.outerHeight(!0)>e.addpos2&&(e.addpos2=p.height());break;case"left":case"right":p.outerWidth(!0)>e.addpos2&&(e.addpos2=p.width())}if(e.nextpos1)if(e.animation&&(n>e.nextpos1||a.top||a.bottom||a.right||a.left))switch(e.dir1){case"down":a.top=e.nextpos1+"px";break;case"up":a.bottom=e.nextpos1+"px";break;case"left":a.right=e.nextpos1+"px";break;case"right":a.left=e.nextpos1+"px"}else p.css(r,e.nextpos1+"px");switch((a.top||a.bottom||a.right||a.left)&&p.animate(a,{duration:500,queue:!1}),e.dir1){case"down":case"up":e.nextpos1+=p.height()+("undefined"==typeof e.spacing1?25:e.spacing1);break;case"left":case"right":e.nextpos1+=p.width()+("undefined"==typeof e.spacing1?25:e.spacing1)}}}},p.pnotify_queue_position=function(e){i&&clearTimeout(i),e||(e=10),i=setTimeout(t.pnotify_position_all,e)},p.pnotify_display=function(){p.parent().length||p.appendTo(n),l.before_open&&l.before_open(p)===!1||("top"!=l.stack.push&&p.pnotify_position(!0),"fade"==l.animation||"fade"==l.animation.effect_in?p.show().fadeTo(0,0).hide():1!=l.opacity&&p.show().fadeTo(0,l.opacity).hide(),p.animate_in(function(){l.after_open&&l.after_open(p),p.pnotify_queue_position(),l.hide&&p.pnotify_queue_remove()}))},p.pnotify_remove=function(){p.timer&&(window.clearTimeout(p.timer),p.timer=null),l.before_close&&l.before_close(p)===!1||p.animate_out(function(){l.after_close&&l.after_close(p)===!1||(p.pnotify_queue_position(),l.remove&&p.detach())})},p.animate_in=function(t){a="in";var e;e="undefined"!=typeof l.animation.effect_in?l.animation.effect_in:l.animation,"none"==e?(p.show(),t()):"show"==e?p.show(l.animate_speed,t):"fade"==e?p.show().fadeTo(l.animate_speed,l.opacity,t):"slide"==e?p.slideDown(l.animate_speed,t):"function"==typeof e?e("in",t,p):p.show(e,"object"==typeof l.animation.options_in?l.animation.options_in:{},l.animate_speed,t)},p.animate_out=function(t){a="out";var e;e="undefined"!=typeof l.animation.effect_out?l.animation.effect_out:l.animation,"none"==e?(p.hide(),t()):"show"==e?p.hide(l.animate_speed,t):"fade"==e?p.fadeOut(l.animate_speed,t):"slide"==e?p.slideUp(l.animate_speed,t):"function"==typeof e?e("out",t,p):p.hide(e,"object"==typeof l.animation.options_out?l.animation.options_out:{},l.animate_speed,t)},p.pnotify_cancel_remove=function(){p.timer&&window.clearTimeout(p.timer)},p.pnotify_queue_remove=function(){p.pnotify_cancel_remove(),p.timer=window.setTimeout(function(){p.pnotify_remove()},isNaN(l.delay)?0:l.delay)},p.closer=t("<div />",{"class":"ui-pnotify-closer",css:{cursor:"pointer",visibility:l.closer_hover?"hidden":"visible"},click:function(){p.pnotify_remove(),p.sticker.css("visibility","hidden"),p.closer.css("visibility","hidden")}}).append(t("<span />",{"class":f.closer})).appendTo(p.container),(!l.closer||l.nonblock)&&p.closer.css("display","none"),p.sticker=t("<div />",{"class":"ui-pnotify-sticker",css:{cursor:"pointer",visibility:l.sticker_hover?"hidden":"visible"},click:function(){l.hide=!l.hide,l.hide?p.pnotify_queue_remove():p.pnotify_cancel_remove(),t(this).trigger("pnotify_icon")}}).bind("pnotify_icon",function(){t(this).children().removeClass(f.pin_up+" "+f.pin_down).addClass(l.hide?f.pin_up:f.pin_down)}).append(t("<span />",{"class":f.pin_up})).appendTo(p.container),(!l.sticker||l.nonblock)&&p.sticker.css("display","none"),l.icon!==!1&&t("<div />",{"class":"ui-pnotify-icon"}).append(t("<span />",{"class":l.icon===!0?"error"==l.type?f.error_icon:"info"==l.type?f.info_icon:"success"==l.type?f.success_icon:f.notice_icon:l.icon})).prependTo(p.container),p.title_container=t("<h4 />",{"class":"ui-pnotify-title"}).appendTo(p.container),l.title===!1?p.title_container.hide():l.title_escape?p.title_container.text(l.title):p.title_container.html(l.title),p.text_container=t("<div />",{"class":"ui-pnotify-text"}).appendTo(p.container),l.text===!1?p.text_container.hide():l.text_escape?p.text_container.text(l.text):p.text_container.html(l.insert_brs?String(l.text).replace(/\n/g,"<br />"):l.text),"string"==typeof l.width&&p.css("width",l.width),"string"==typeof l.min_height&&p.container.css("min-height",l.min_height),p.pnotify_history=l.history,p.pnotify_hide=l.hide;var g=o.data("pnotify");if((null==g||"object"!=typeof g)&&(g=[]),g="top"==l.stack.push?t.merge([p],g):t.merge(g,[p]),o.data("pnotify",g),"top"==l.stack.push&&p.pnotify_queue_position(1),l.after_init&&l.after_init(p),l.history){var m=o.data("pnotify_history");if("undefined"==typeof m){m=t("<div />",{"class":"ui-pnotify-history-container "+f.hi_menu,mouseleave:function(){m.animate({top:"-"+e+"px"},{duration:100,queue:!1})}}).append(t("<div />",{"class":"ui-pnotify-history-header",text:"Redisplay"})).append(t("<button />",{"class":"ui-pnotify-history-all "+f.hi_btn,text:"All",mouseenter:function(){t(this).addClass(f.hi_btnhov)},mouseleave:function(){t(this).removeClass(f.hi_btnhov)},click:function(){return t.each(g,function(){this.pnotify_history&&(this.is(":visible")?this.pnotify_hide&&this.pnotify_queue_remove():this.pnotify_display&&this.pnotify_display())}),!1}})).append(t("<button />",{"class":"ui-pnotify-history-last "+f.hi_btn,text:"Last",mouseenter:function(){t(this).addClass(f.hi_btnhov)},mouseleave:function(){t(this).removeClass(f.hi_btnhov)},click:function(){var t,e=-1;do{if(t=-1==e?g.slice(e):g.slice(e,e+1),!t[0])break;e--}while(!t[0].pnotify_history||t[0].is(":visible"));return t[0]?(t[0].pnotify_display&&t[0].pnotify_display(),!1):!1}})).appendTo(n);var v=t("<span />",{"class":"ui-pnotify-history-pulldown "+f.hi_hnd,mouseenter:function(){m.animate({top:"0"},{duration:100,queue:!1})}}).appendTo(m);e=v.offset().top+2,m.css({top:"-"+e+"px"}),o.data("pnotify_history",m)}}return l.stack.animation=!1,p.pnotify_display(),p}});var a=/^on/,l=/^(dbl)?click$|^mouse(move|down|up|over|out|enter|leave)$|^contextmenu$/,h=/^(focus|blur|select|change|reset)$|^key(press|down|up)$/,c=/^(scroll|resize|(un)?load|abort|error)$/,u=function(e,i){var n;if(e=e.toLowerCase(),document.createEvent&&this.dispatchEvent){if(e=e.replace(a,""),e.match(l)?(t(this).offset(),n=document.createEvent("MouseEvents"),n.initMouseEvent(e,i.bubbles,i.cancelable,i.view,i.detail,i.screenX,i.screenY,i.clientX,i.clientY,i.ctrlKey,i.altKey,i.shiftKey,i.metaKey,i.button,i.relatedTarget)):e.match(h)?(n=document.createEvent("UIEvents"),n.initUIEvent(e,i.bubbles,i.cancelable,i.view,i.detail)):e.match(c)&&(n=document.createEvent("HTMLEvents"),n.initEvent(e,i.bubbles,i.cancelable)),!n)return;this.dispatchEvent(n)}else e.match(a)||(e="on"+e),n=document.createEventObject(i),this.fireEvent(e,n)};t.pnotify.defaults={title:!1,title_escape:!1,text:!1,text_escape:!1,styling:"bootstrap",addclass:"",cornerclass:"",nonblock:!1,nonblock_opacity:.2,history:!0,width:"300px",min_height:"16px",type:"notice",icon:!0,animation:"fade",animate_speed:"slow",opacity:1,shadow:!0,closer:!0,closer_hover:!0,sticker:!0,sticker_hover:!0,hide:!0,delay:8e3,mouse_reset:!0,remove:!0,insert_brs:!0,stack:{dir1:"down",dir2:"left",push:"bottom",spacing1:25,spacing2:25}}}(jQuery),define("views/../../dev/vendors/pnotify/jquery.pnotify",function(){}),define("views/notification",["jquery","underscore","backbone","models/app","../../dev/vendors/pnotify/jquery.pnotify"],function(t,e,i,n){var o=i.View.extend({initialize:function(){this.listenTo(n.eventBus,"notification",this._showMessages),this.listenTo(n.eventBus,"notificationUnset",this._unset)},_showMessages:function(t){if(void 0!==t){if(void 0===t.msg){if(void 0===t.message)return;t={msg:[t]}}else if(0===t.msg.length)return;e.each(t.msg,function(t){this._showMessage(t)},this)}},_showMessage:function(t){switch(t.channel=t.channel||"notification",t.channel){case"form":this._form(t);break;case"popover":this._popover(t);break;default:this._showNotification(t)}},_unset:function(e){"all"===e&&t(".error-message").remove()},_form:function(i){var n;n=e.template('<div class="error-message"><%= message %></div>'),t(i.element).after(n({message:i.message}))},_showNotification:function(e){var i,n;switch(n=5e3,i={title:e.title,text:e.message,icon:!1,history:!1,addclass:"flash",delay:n},e.type){case"success":i.addclass+=" flash-success";break;case"warning":i.addclass+=" flash-warning";break;case"error":i.addclass+=" flash-error",i.delay=2*n;break;default:i.addclass+=" flash-notice"}t.pnotify(i)}});return o}),function(t){t.i18n={dict:null,setDictionary:function(t){this.dict=t},_:function(t,e){var i=t;return this.dict&&this.dict[t]&&(i=this.dict[t]),this.printf(i,e)},printf:function(t,e){if(!e)return t;for(var i="",n=/%(\d+)\$s/g,o=n.exec(t);o;){var s=parseInt(o[1],10)-1;t=t.replace("%"+o[1]+"$s",e[s]),o=n.exec(t)}var r=t.split("%s");if(r.length>1)for(var a=0;a<e.length;a++)r[a].length>0&&r[a].lastIndexOf("%")==r[a].length-1&&(r[a]+="s"+r.splice(a+1,1)[0]),i+=r[a]+e[a];return i+r[r.length-1]}},t.fn._t=function(e,i){return t(this).text(t.i18n._(e,i))}}(jQuery),define("lib/jquery.i18n/jquery.i18n",function(){}),define("lib/jquery.i18n/jquery.i18n.extend",["jquery","lib/jquery.i18n/jquery.i18n"],function(t){t.extend(t.i18n,{currentString:"",setDict:function(t){this.dict=t},setUrl:function(t){this.dictUrl=t,this._loadDict()},_loadDict:function(){return t.ajax({url:this.dictUrl,dataType:"json",async:!1,cache:!0,success:t.proxy(function(t){this.dict=t},this)})},__:function(t,e){var i="";return"string"==typeof this.dict[t]&&""!==this.dict[t]?(i=this.dict[t],"object"==typeof e&&(i=this._insert(i,e))):i=t,i},_insert:function(t,e){return t.replace(/:([-\w]+)/g,function(t,i){return"undefined"!=typeof e[i]?e[i]:t})}})}),function(t,e){"function"==typeof define&&define.amd?define("lib/saito/backbone.initHelper",["underscore","backbone"],function(i,n){return e(i||t._,n||t.Backbone)}):e(_,Backbone)}(this,function(t,e){e.View.prototype.initCollectionFromDom=function(t,e,i){var n=function(t,e,n){t.add({id:e}),new i({el:n,model:t.get(e)})};$(t).each(function(){n(e,$(this).data("id"),this)
})}}),function(t,e){"function"==typeof define&&define.amd?define("lib/saito/backbone.modelHelper",["underscore","backbone"],function(i,n){return e(i||t._,n||t.Backbone)}):e(_,Backbone)}(this,function(t,e){e.Model.prototype.toggle=function(t){this.set(t,!this.get(t))}}),require.config({paths:{common:"../dist/common"}}),"undefined"==typeof jasmine&&(jasmine={}),"undefined"==typeof console&&(console={},console.log=function(){},console.error=console.debug=console.info=console.log);var contentTimer={show:function(){$("#content").css("visibility","visible"),console.warn("DOM ready timed out: show content fallback used."),delete this.timeoutID},setup:function(){this.cancel();var t=this;this.timeoutID=window.setTimeout(function(){t.show()},5e3)},cancel:function(){"number"==typeof this.timeoutID&&(window.clearTimeout(this.timeoutID),delete this.timeoutID)}};contentTimer.setup(),function(t,e,i,n){t.redirect=function(t){document.location.replace(t)},$.ajaxSetup({cache:!1});var o={bootstrapApp:function(e){require(["domReady","views/app","backbone","jquery","models/app","views/notification","lib/jquery.i18n/jquery.i18n.extend","bootstrap","lib/saito/backbone.initHelper","lib/saito/backbone.modelHelper","fastclick"],function(i,n,o,s,r,a){var l,h;r.settings.set(e.SaitoApp.app.settings),r.currentUser.set(e.SaitoApp.currentUser),r.request=e.SaitoApp.request,new a,t.addEventListener("load",function(){new FastClick(document.body)},!1),s.i18n.setUrl(r.settings.get("webroot")+"saitos/langJs"),l=new n,h=function(){l.initFromDom({SaitoApp:e.SaitoApp,contentTimer:e.contentTimer})},s.isReady?h():i(function(){h()})})},bootstrapTest:function(e){require(["domReady","views/app","backbone","jquery"],function(i,o,s,r){r.ajaxSetup({cache:!0}),t.store="TestStore";var a=n.getEnv();a.updateInterval=1e3;var l=new n.HtmlReporter;a.addReporter(l),a.specFilter=function(t){return l.specFilter(t)};var h=["models/AppStatusModelSpec.js","models/BookmarkModelSpec.js","models/SlidetabModelSpec.js","models/StatusModelSpec.js","models/UploadModelSpec.js","lib/MarkItUpSpec.js","lib/jquery.i18n.extendSpec.js","views/ThreadViewSpec.js"];h=_.map(h,function(t){return e.SaitoApp.app.settings.webroot+"js/tests/"+t}),r(function(){require(h,function(){a.execute()})})})}};define("jquery",[],function(){return jQuery}),require(["common"],function(){require(["marionette"],function(t){var n=new t.Application;void 0===e.app.runJsTests?n.addInitializer(o.bootstrapApp):n.addInitializer(o.bootstrapTest),n.start({contentTimer:i,SaitoApp:e})})})}(this,SaitoApp,contentTimer,jasmine),define("main",function(){});