"undefined"==typeof console&&(console={},console.log=function(){},console.error=console.debug=console.info=console.log),window.redirect=function(e){document.location.replace(e)},$.ajaxSetup({cache:!1}),define("jquery",[],function(){return jQuery}),define("lib/bootstrapHelper",function(){}),define("app/core",["marionette"],function(e){return new e.Application}),define("app/vent",["marionette"],function(){var e=function(){this.vent=new Backbone.Wreqr.EventAggregator,this.commands=new Backbone.Wreqr.Commands,this.reqres=new Backbone.Wreqr.RequestResponse,this.request=function(){var e=Array.prototype.slice.apply(arguments);return this.reqres.request.apply(this.reqres,e)}};return new e}),define("models/appSetting",["underscore","backbone"],function(e,t){var i=t.Model.extend({});return i}),define("models/appStatus",["underscore","backbone","cakeRest","app/vent"],function(e,t,i,n){var o=t.Model.extend({stream:null,initialize:function(t,i){this.settings=i.settings,this.methodToCakePhpUrl=e.clone(this.methodToCakePhpUrl),this.methodToCakePhpUrl.read="status/",this.listenTo(this,"change:lastShoutId",this._onNewShout)},start:function(){this._setWebroot(this.settings.get("webroot")),this._poll()},_onNewShout:function(e){var t=e.get("lastShoutId");n.commands.execute("shoutbox:update",t)},_setWebroot:function(e){this.webroot=e+"status/"},_eventStream:function(){this.stream=new EventSource(this.webroot+this.methodToCakePhpUrl.read),this.stream.addEventListener("message",e.bind(function(e){var t=JSON.parse(e.data);this.set(t)},this),!1)},_poll:function(){var t,i,n,o,s,r,a=1e4,l=9e4;s=function(){void 0!==o&&clearTimeout(o)},t=function(){s(),r=a},n=function(){o=setTimeout(i,r)},i=e.bind(function(){n(),this.fetch({success:function(){r=Math.floor(r*(1+r/4e4)),r>l&&(r=l)},error:s})},this),this.listenTo(this,"change",function(){t(),n()}),i(),t(),n()}});return e.extend(o.prototype,i),o}),define("models/currentUser",["underscore","backbone"],function(e,t){var i=t.Model.extend({isLoggedIn:function(){return this.get("id")>0}});return i}),define("models/app",["underscore","backbone","app/vent","models/appSetting","models/appStatus","models/currentUser"],function(e,t,i,n,o,s){var r=t.Model.extend({eventBus:null,settings:null,status:null,currentUser:null,request:null,initialize:function(){this.eventBus=i.vent,this.commands=i.commands,this.reqres=i.reqres,this.settings=new n,this.status=new o({},{settings:this.settings}),this.currentUser=new s}});return new r}),define("modules/html5-notification/views/notification",["underscore","backbone","models/app"],function(e,t,i){var n=t.View.extend({_hideAfter:10,_iconUrl:!1,initialize:function(e){this._iconUrl=e.iconUrl,this.listenTo(i.eventBus,"html5-notification",this.notification),i.commands.setHandler("app:html5-notification:activate",this._activate,this),i.reqres.setHandler("app:html5-notification:available",this._isEnabled,this)},notification:function(t){var n=!i.reqres.request("isAppVisible");if(t=e.defaults(t,{icon:this._iconUrl,always:!1}),t.always||n){var o=new window.Notification(t.title,{icon:t.icon,body:t.message}),s=navigator.userAgent.toLowerCase().indexOf("chrome")>-1;s&&setTimeout(function(){o.close()},1e3*this._hideAfter)}},_activate:function(){return"permission"in window.Notification&&"granted"!==window.Notification.permission?(window.Notification.requestPermission(),void 0):(window.Notification.requestPermission(),void 0)},_isEnabled:function(){return"Notification"in window?!0:!1}});return n}),define("modules/html5-notification/html5-notification",["app/core","marionette","modules/html5-notification/views/notification"],function(e,t,i){var n=e.module("html5-notification");return n.addInitializer(function(e){new i({iconUrl:e.SaitoApp.app.settings.notificationIcon})}),n}),define("modules/shoutbox/models/shout",["underscore","backbone"],function(e,t){var i=t.Model.extend({initialize:function(e,t){this.urlRoot=t.urlRoot}});return i}),define("modules/shoutbox/collections/shouts",["underscore","backbone","modules/shoutbox/models/shout"],function(e,t,i){var n=t.Collection.extend({model:i,initialize:function(e,t){this.apiroot=t.apiroot+"shouts/"},fetch:function(){$.ajax({url:this.apiroot,dataType:"json",context:this}).done(function(e){e.length>0&&this.reset(e)})}});return n}),function(e){function t(e,t){return function(i){return l(e.call(this,i),t)}}function i(e,t){return function(i){return this.lang().ordinal(e.call(this,i),t)}}function n(){}function o(e){w(e),r(this,e)}function s(e){var t=p(e),i=t.year||0,n=t.month||0,o=t.week||0,s=t.day||0,r=t.hour||0,a=t.minute||0,l=t.second||0,d=t.millisecond||0;this._input=e,this._milliseconds=+d+1e3*l+6e4*a+36e5*r,this._days=+s+7*o,this._months=+n+12*i,this._data={},this._bubble()}function r(e,t){for(var i in t)t.hasOwnProperty(i)&&(e[i]=t[i]);return t.hasOwnProperty("toString")&&(e.toString=t.toString),t.hasOwnProperty("valueOf")&&(e.valueOf=t.valueOf),e}function a(e){return 0>e?Math.ceil(e):Math.floor(e)}function l(e,t){for(var i=e+"";i.length<t;)i="0"+i;return i}function d(e,t,i,n){var o,s,r=t._milliseconds,a=t._days,l=t._months;r&&e._d.setTime(+e._d+r*i),(a||l)&&(o=e.minute(),s=e.hour()),a&&e.date(e.date()+a*i),l&&e.month(e.month()+l*i),r&&!n&&tt.updateOffset(e),(a||l)&&(e.minute(o),e.hour(s))}function u(e){return"[object Array]"===Object.prototype.toString.call(e)}function c(e){return"[object Date]"===Object.prototype.toString.call(e)}function h(e,t,i){var n,o=Math.min(e.length,t.length),s=Math.abs(e.length-t.length),r=0;for(n=0;o>n;n++)(i&&e[n]!==t[n]||!i&&_(e[n])!==_(t[n]))&&r++;return r+s}function f(e){if(e){var t=e.toLowerCase().replace(/(.)s$/,"$1");e=Ut[e]||Ft[t]||t}return e}function p(e){var t,i,n={};for(i in e)e.hasOwnProperty(i)&&(t=f(i),t&&(n[t]=e[i]));return n}function m(t){var i,n;if(0===t.indexOf("week"))i=7,n="day";else{if(0!==t.indexOf("month"))return;i=12,n="month"}tt[t]=function(o,s){var r,a,l=tt.fn._lang[t],d=[];if("number"==typeof o&&(s=o,o=e),a=function(e){var t=tt().utc().set(n,e);return l.call(tt.fn._lang,t,o||"")},null!=s)return a(s);for(r=0;i>r;r++)d.push(a(r));return d}}function _(e){var t=+e,i=0;return 0!==t&&isFinite(t)&&(i=t>=0?Math.floor(t):Math.ceil(t)),i}function g(e,t){return new Date(Date.UTC(e,t+1,0)).getUTCDate()}function b(e){return v(e)?366:365}function v(e){return 0===e%4&&0!==e%100||0===e%400}function w(e){var t;e._a&&-2===e._pf.overflow&&(t=e._a[rt]<0||e._a[rt]>11?rt:e._a[at]<1||e._a[at]>g(e._a[st],e._a[rt])?at:e._a[lt]<0||e._a[lt]>23?lt:e._a[dt]<0||e._a[dt]>59?dt:e._a[ut]<0||e._a[ut]>59?ut:e._a[ct]<0||e._a[ct]>999?ct:-1,e._pf._overflowDayOfYear&&(st>t||t>at)&&(t=at),e._pf.overflow=t)}function y(e){e._pf={empty:!1,unusedTokens:[],unusedInput:[],overflow:-2,charsLeftOver:0,nullInput:!1,invalidMonth:null,invalidFormat:!1,userInvalidated:!1}}function k(e){return null==e._isValid&&(e._isValid=!isNaN(e._d.getTime())&&e._pf.overflow<0&&!e._pf.empty&&!e._pf.invalidMonth&&!e._pf.nullInput&&!e._pf.invalidFormat&&!e._pf.userInvalidated,e._strict&&(e._isValid=e._isValid&&0===e._pf.charsLeftOver&&0===e._pf.unusedTokens.length)),e._isValid}function x(e){return e?e.toLowerCase().replace("_","-"):e}function T(e,t){return t.abbr=e,ht[e]||(ht[e]=new n),ht[e].set(t),ht[e]}function D(e){delete ht[e]}function S(e){var t,i,n,o,s=0,r=function(e){if(!ht[e]&&ft)try{require("./lang/"+e)}catch(t){}return ht[e]};if(!e)return tt.fn._lang;if(!u(e)){if(i=r(e))return i;e=[e]}for(;s<e.length;){for(o=x(e[s]).split("-"),t=o.length,n=x(e[s+1]),n=n?n.split("-"):null;t>0;){if(i=r(o.slice(0,t).join("-")))return i;if(n&&n.length>=t&&h(o,n,!0)>=t-1)break;t--}s++}return tt.fn._lang}function M(e){return e.match(/\[[\s\S]/)?e.replace(/^\[|\]$/g,""):e.replace(/\\/g,"")}function I(e){var t,i,n=e.match(gt);for(t=0,i=n.length;i>t;t++)n[t]=Pt[n[t]]?Pt[n[t]]:M(n[t]);return function(o){var s="";for(t=0;i>t;t++)s+=n[t]instanceof Function?n[t].call(o,e):n[t];return s}}function C(e,t){return e.isValid()?(t=$(t,e.lang()),Yt[t]||(Yt[t]=I(t)),Yt[t](e)):e.lang().invalidDate()}function $(e,t){function i(e){return t.longDateFormat(e)||e}var n=5;for(bt.lastIndex=0;n>=0&&bt.test(e);)e=e.replace(bt,i),bt.lastIndex=0,n-=1;return e}function A(e,t){var i;switch(e){case"DDDD":return yt;case"YYYY":case"GGGG":case"gggg":return kt;case"YYYYY":case"GGGGG":case"ggggg":return xt;case"S":case"SS":case"SSS":case"DDD":return wt;case"MMM":case"MMMM":case"dd":case"ddd":case"dddd":return Tt;case"a":case"A":return S(t._l)._meridiemParse;case"X":return Mt;case"Z":case"ZZ":return Dt;case"T":return St;case"MM":case"DD":case"YY":case"GG":case"gg":case"HH":case"hh":case"mm":case"ss":case"M":case"D":case"d":case"H":case"h":case"m":case"s":case"w":case"ww":case"W":case"WW":case"e":case"E":return vt;default:return i=new RegExp(L(z(e.replace("\\","")),"i"))}}function O(e){var t=(Dt.exec(e)||[])[0],i=(t+"").match(Ot)||["-",0,0],n=+(60*i[1])+_(i[2]);return"+"===i[0]?-n:n}function q(e,t,i){var n,o=i._a;switch(e){case"M":case"MM":null!=t&&(o[rt]=_(t)-1);break;case"MMM":case"MMMM":n=S(i._l).monthsParse(t),null!=n?o[rt]=n:i._pf.invalidMonth=t;break;case"D":case"DD":null!=t&&(o[at]=_(t));break;case"DDD":case"DDDD":null!=t&&(i._dayOfYear=_(t));break;case"YY":o[st]=_(t)+(_(t)>68?1900:2e3);break;case"YYYY":case"YYYYY":o[st]=_(t);break;case"a":case"A":i._isPm=S(i._l).isPM(t);break;case"H":case"HH":case"h":case"hh":o[lt]=_(t);break;case"m":case"mm":o[dt]=_(t);break;case"s":case"ss":o[ut]=_(t);break;case"S":case"SS":case"SSS":o[ct]=_(1e3*("0."+t));break;case"X":i._d=new Date(1e3*parseFloat(t));break;case"Z":case"ZZ":i._useUTC=!0,i._tzm=O(t);break;case"w":case"ww":case"W":case"WW":case"d":case"dd":case"ddd":case"dddd":case"e":case"E":e=e.substr(0,1);case"gg":case"gggg":case"GG":case"GGGG":case"GGGGG":e=e.substr(0,2),t&&(i._w=i._w||{},i._w[e]=t)}}function j(e){var t,i,n,o,s,r,a,l,d,u,c=[];if(!e._d){for(n=F(e),e._w&&null==e._a[at]&&null==e._a[rt]&&(s=function(t){return t?t.length<3?parseInt(t,10)>68?"19"+t:"20"+t:t:null==e._a[st]?tt().weekYear():e._a[st]},r=e._w,null!=r.GG||null!=r.W||null!=r.E?a=J(s(r.GG),r.W||1,r.E,4,1):(l=S(e._l),d=null!=r.d?R(r.d,l):null!=r.e?parseInt(r.e,10)+l._week.dow:0,u=parseInt(r.w,10)||1,null!=r.d&&d<l._week.dow&&u++,a=J(s(r.gg),u,d,l._week.doy,l._week.dow)),e._a[st]=a.year,e._dayOfYear=a.dayOfYear),e._dayOfYear&&(o=null==e._a[st]?n[st]:e._a[st],e._dayOfYear>b(o)&&(e._pf._overflowDayOfYear=!0),i=H(o,0,e._dayOfYear),e._a[rt]=i.getUTCMonth(),e._a[at]=i.getUTCDate()),t=0;3>t&&null==e._a[t];++t)e._a[t]=c[t]=n[t];for(;7>t;t++)e._a[t]=c[t]=null==e._a[t]?2===t?1:0:e._a[t];c[lt]+=_((e._tzm||0)/60),c[dt]+=_((e._tzm||0)%60),e._d=(e._useUTC?H:V).apply(null,c)}}function U(e){var t;e._d||(t=p(e._i),e._a=[t.year,t.month,t.day,t.hour,t.minute,t.second,t.millisecond],j(e))}function F(e){var t=new Date;return e._useUTC?[t.getUTCFullYear(),t.getUTCMonth(),t.getUTCDate()]:[t.getFullYear(),t.getMonth(),t.getDate()]}function Y(e){e._a=[],e._pf.empty=!0;var t,i,n,o,s,r=S(e._l),a=""+e._i,l=a.length,d=0;for(n=$(e._f,r).match(gt)||[],t=0;t<n.length;t++)o=n[t],i=(A(o,e).exec(a)||[])[0],i&&(s=a.substr(0,a.indexOf(i)),s.length>0&&e._pf.unusedInput.push(s),a=a.slice(a.indexOf(i)+i.length),d+=i.length),Pt[o]?(i?e._pf.empty=!1:e._pf.unusedTokens.push(o),q(o,i,e)):e._strict&&!i&&e._pf.unusedTokens.push(o);e._pf.charsLeftOver=l-d,a.length>0&&e._pf.unusedInput.push(a),e._isPm&&e._a[lt]<12&&(e._a[lt]+=12),e._isPm===!1&&12===e._a[lt]&&(e._a[lt]=0),j(e),w(e)}function z(e){return e.replace(/\\(\[)|\\(\])|\[([^\]\[]*)\]|\\(.)/g,function(e,t,i,n,o){return t||i||n||o})}function L(e){return e.replace(/[-\/\\^$*+?.()|[\]{}]/g,"\\$&")}function P(e){var t,i,n,o,s;if(0===e._f.length)return e._pf.invalidFormat=!0,e._d=new Date(0/0),void 0;for(o=0;o<e._f.length;o++)s=0,t=r({},e),y(t),t._f=e._f[o],Y(t),k(t)&&(s+=t._pf.charsLeftOver,s+=10*t._pf.unusedTokens.length,t._pf.score=s,(null==n||n>s)&&(n=s,i=t));r(e,i||t)}function E(e){var t,i=e._i,n=It.exec(i);if(n){for(t=4;t>0;t--)if(n[t]){e._f=$t[t-1]+(n[6]||" ");break}for(t=0;4>t;t++)if(At[t][1].exec(i)){e._f+=At[t][0];break}Dt.exec(i)&&(e._f+=" Z"),Y(e)}else e._d=new Date(i)}function N(t){var i=t._i,n=pt.exec(i);i===e?t._d=new Date:n?t._d=new Date(+n[1]):"string"==typeof i?E(t):u(i)?(t._a=i.slice(0),j(t)):c(i)?t._d=new Date(+i):"object"==typeof i?U(t):t._d=new Date(i)}function V(e,t,i,n,o,s,r){var a=new Date(e,t,i,n,o,s,r);return 1970>e&&a.setFullYear(e),a}function H(e){var t=new Date(Date.UTC.apply(null,arguments));return 1970>e&&t.setUTCFullYear(e),t}function R(e,t){if("string"==typeof e)if(isNaN(e)){if(e=t.weekdaysParse(e),"number"!=typeof e)return null}else e=parseInt(e,10);return e}function B(e,t,i,n,o){return o.relativeTime(t||1,!!i,e,n)}function W(e,t,i){var n=ot(Math.abs(e)/1e3),o=ot(n/60),s=ot(o/60),r=ot(s/24),a=ot(r/365),l=45>n&&["s",n]||1===o&&["m"]||45>o&&["mm",o]||1===s&&["h"]||22>s&&["hh",s]||1===r&&["d"]||25>=r&&["dd",r]||45>=r&&["M"]||345>r&&["MM",ot(r/30)]||1===a&&["y"]||["yy",a];return l[2]=t,l[3]=e>0,l[4]=i,B.apply({},l)}function G(e,t,i){var n,o=i-t,s=i-e.day();return s>o&&(s-=7),o-7>s&&(s+=7),n=tt(e).add("d",s),{week:Math.ceil(n.dayOfYear()/7),year:n.year()}}function J(e,t,i,n,o){var s,r,a=new Date(Date.UTC(e,0)).getUTCDay();return i=null!=i?i:o,s=o-a+(a>n?7:0),r=7*(t-1)+(i-o)+s+1,{year:r>0?e:e-1,dayOfYear:r>0?r:b(e-1)+r}}function Z(e){var t=e._i,i=e._f;return"undefined"==typeof e._pf&&y(e),null===t?tt.invalid({nullInput:!0}):("string"==typeof t&&(e._i=t=S().preparse(t)),tt.isMoment(t)?(e=r({},t),e._d=new Date(+t._d)):i?u(i)?P(e):Y(e):N(e),new o(e))}function Q(e,t){tt.fn[e]=tt.fn[e+"s"]=function(e){var i=this._isUTC?"UTC":"";return null!=e?(this._d["set"+i+t](e),tt.updateOffset(this),this):this._d["get"+i+t]()}}function X(e){tt.duration.fn[e]=function(){return this._data[e]}}function K(e,t){tt.duration.fn["as"+e]=function(){return+this/t}}function et(){"undefined"==typeof ender&&(this.moment=tt)}for(var tt,it,nt="2.3.1",ot=Math.round,st=0,rt=1,at=2,lt=3,dt=4,ut=5,ct=6,ht={},ft="undefined"!=typeof module&&module.exports,pt=/^\/?Date\((\-?\d+)/i,mt=/(\-)?(?:(\d*)\.)?(\d+)\:(\d+)(?:\:(\d+)\.?(\d{3})?)?/,_t=/^(-)?P(?:(?:([0-9,.]*)Y)?(?:([0-9,.]*)M)?(?:([0-9,.]*)D)?(?:T(?:([0-9,.]*)H)?(?:([0-9,.]*)M)?(?:([0-9,.]*)S)?)?|([0-9,.]*)W)$/,gt=/(\[[^\[]*\])|(\\)?(Mo|MM?M?M?|Do|DDDo|DD?D?D?|ddd?d?|do?|w[o|w]?|W[o|W]?|YYYYY|YYYY|YY|gg(ggg?)?|GG(GGG?)?|e|E|a|A|hh?|HH?|mm?|ss?|SS?S?|X|zz?|ZZ?|.)/g,bt=/(\[[^\[]*\])|(\\)?(LT|LL?L?L?|l{1,4})/g,vt=/\d\d?/,wt=/\d{1,3}/,yt=/\d{3}/,kt=/\d{1,4}/,xt=/[+\-]?\d{1,6}/,Tt=/[0-9]*['a-z\u00A0-\u05FF\u0700-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF]+|[\u0600-\u06FF\/]+(\s*?[\u0600-\u06FF]+){1,2}/i,Dt=/Z|[\+\-]\d\d:?\d\d/i,St=/T/i,Mt=/[\+\-]?\d+(\.\d{1,3})?/,It=/^\s*\d{4}-(?:(\d\d-\d\d)|(W\d\d$)|(W\d\d-\d)|(\d\d\d))((T| )(\d\d(:\d\d(:\d\d(\.\d\d?\d?)?)?)?)?([\+\-]\d\d:?\d\d)?)?$/,Ct="YYYY-MM-DDTHH:mm:ssZ",$t=["YYYY-MM-DD","GGGG-[W]WW","GGGG-[W]WW-E","YYYY-DDD"],At=[["HH:mm:ss.S",/(T| )\d\d:\d\d:\d\d\.\d{1,3}/],["HH:mm:ss",/(T| )\d\d:\d\d:\d\d/],["HH:mm",/(T| )\d\d:\d\d/],["HH",/(T| )\d\d/]],Ot=/([\+\-]|\d\d)/gi,qt="Date|Hours|Minutes|Seconds|Milliseconds".split("|"),jt={Milliseconds:1,Seconds:1e3,Minutes:6e4,Hours:36e5,Days:864e5,Months:2592e6,Years:31536e6},Ut={ms:"millisecond",s:"second",m:"minute",h:"hour",d:"day",D:"date",w:"week",W:"isoWeek",M:"month",y:"year",DDD:"dayOfYear",e:"weekday",E:"isoWeekday",gg:"weekYear",GG:"isoWeekYear"},Ft={dayofyear:"dayOfYear",isoweekday:"isoWeekday",isoweek:"isoWeek",weekyear:"weekYear",isoweekyear:"isoWeekYear"},Yt={},zt="DDD w W M D d".split(" "),Lt="M D H h m s w W".split(" "),Pt={M:function(){return this.month()+1},MMM:function(e){return this.lang().monthsShort(this,e)},MMMM:function(e){return this.lang().months(this,e)},D:function(){return this.date()},DDD:function(){return this.dayOfYear()},d:function(){return this.day()},dd:function(e){return this.lang().weekdaysMin(this,e)},ddd:function(e){return this.lang().weekdaysShort(this,e)},dddd:function(e){return this.lang().weekdays(this,e)},w:function(){return this.week()},W:function(){return this.isoWeek()},YY:function(){return l(this.year()%100,2)},YYYY:function(){return l(this.year(),4)},YYYYY:function(){return l(this.year(),5)},gg:function(){return l(this.weekYear()%100,2)},gggg:function(){return this.weekYear()},ggggg:function(){return l(this.weekYear(),5)},GG:function(){return l(this.isoWeekYear()%100,2)},GGGG:function(){return this.isoWeekYear()},GGGGG:function(){return l(this.isoWeekYear(),5)},e:function(){return this.weekday()},E:function(){return this.isoWeekday()},a:function(){return this.lang().meridiem(this.hours(),this.minutes(),!0)},A:function(){return this.lang().meridiem(this.hours(),this.minutes(),!1)},H:function(){return this.hours()},h:function(){return this.hours()%12||12},m:function(){return this.minutes()},s:function(){return this.seconds()},S:function(){return _(this.milliseconds()/100)},SS:function(){return l(_(this.milliseconds()/10),2)},SSS:function(){return l(this.milliseconds(),3)},Z:function(){var e=-this.zone(),t="+";return 0>e&&(e=-e,t="-"),t+l(_(e/60),2)+":"+l(_(e)%60,2)},ZZ:function(){var e=-this.zone(),t="+";return 0>e&&(e=-e,t="-"),t+l(_(10*e/6),4)},z:function(){return this.zoneAbbr()},zz:function(){return this.zoneName()},X:function(){return this.unix()}},Et=["months","monthsShort","weekdays","weekdaysShort","weekdaysMin"];zt.length;)it=zt.pop(),Pt[it+"o"]=i(Pt[it],it);for(;Lt.length;)it=Lt.pop(),Pt[it+it]=t(Pt[it],2);for(Pt.DDDD=t(Pt.DDD,3),r(n.prototype,{set:function(e){var t,i;for(i in e)t=e[i],"function"==typeof t?this[i]=t:this["_"+i]=t},_months:"January_February_March_April_May_June_July_August_September_October_November_December".split("_"),months:function(e){return this._months[e.month()]},_monthsShort:"Jan_Feb_Mar_Apr_May_Jun_Jul_Aug_Sep_Oct_Nov_Dec".split("_"),monthsShort:function(e){return this._monthsShort[e.month()]},monthsParse:function(e){var t,i,n;for(this._monthsParse||(this._monthsParse=[]),t=0;12>t;t++)if(this._monthsParse[t]||(i=tt.utc([2e3,t]),n="^"+this.months(i,"")+"|^"+this.monthsShort(i,""),this._monthsParse[t]=new RegExp(n.replace(".",""),"i")),this._monthsParse[t].test(e))return t},_weekdays:"Sunday_Monday_Tuesday_Wednesday_Thursday_Friday_Saturday".split("_"),weekdays:function(e){return this._weekdays[e.day()]},_weekdaysShort:"Sun_Mon_Tue_Wed_Thu_Fri_Sat".split("_"),weekdaysShort:function(e){return this._weekdaysShort[e.day()]},_weekdaysMin:"Su_Mo_Tu_We_Th_Fr_Sa".split("_"),weekdaysMin:function(e){return this._weekdaysMin[e.day()]},weekdaysParse:function(e){var t,i,n;for(this._weekdaysParse||(this._weekdaysParse=[]),t=0;7>t;t++)if(this._weekdaysParse[t]||(i=tt([2e3,1]).day(t),n="^"+this.weekdays(i,"")+"|^"+this.weekdaysShort(i,"")+"|^"+this.weekdaysMin(i,""),this._weekdaysParse[t]=new RegExp(n.replace(".",""),"i")),this._weekdaysParse[t].test(e))return t},_longDateFormat:{LT:"h:mm A",L:"MM/DD/YYYY",LL:"MMMM D YYYY",LLL:"MMMM D YYYY LT",LLLL:"dddd, MMMM D YYYY LT"},longDateFormat:function(e){var t=this._longDateFormat[e];return!t&&this._longDateFormat[e.toUpperCase()]&&(t=this._longDateFormat[e.toUpperCase()].replace(/MMMM|MM|DD|dddd/g,function(e){return e.slice(1)}),this._longDateFormat[e]=t),t},isPM:function(e){return"p"===(e+"").toLowerCase().charAt(0)},_meridiemParse:/[ap]\.?m?\.?/i,meridiem:function(e,t,i){return e>11?i?"pm":"PM":i?"am":"AM"},_calendar:{sameDay:"[Today at] LT",nextDay:"[Tomorrow at] LT",nextWeek:"dddd [at] LT",lastDay:"[Yesterday at] LT",lastWeek:"[Last] dddd [at] LT",sameElse:"L"},calendar:function(e,t){var i=this._calendar[e];return"function"==typeof i?i.apply(t):i},_relativeTime:{future:"in %s",past:"%s ago",s:"a few seconds",m:"a minute",mm:"%d minutes",h:"an hour",hh:"%d hours",d:"a day",dd:"%d days",M:"a month",MM:"%d months",y:"a year",yy:"%d years"},relativeTime:function(e,t,i,n){var o=this._relativeTime[i];return"function"==typeof o?o(e,t,i,n):o.replace(/%d/i,e)},pastFuture:function(e,t){var i=this._relativeTime[e>0?"future":"past"];return"function"==typeof i?i(t):i.replace(/%s/i,t)},ordinal:function(e){return this._ordinal.replace("%d",e)},_ordinal:"%d",preparse:function(e){return e},postformat:function(e){return e},week:function(e){return G(e,this._week.dow,this._week.doy).week},_week:{dow:0,doy:6},_invalidDate:"Invalid date",invalidDate:function(){return this._invalidDate}}),tt=function(t,i,n,o){return"boolean"==typeof n&&(o=n,n=e),Z({_i:t,_f:i,_l:n,_strict:o,_isUTC:!1})},tt.utc=function(t,i,n,o){var s;return"boolean"==typeof n&&(o=n,n=e),s=Z({_useUTC:!0,_isUTC:!0,_l:n,_i:t,_f:i,_strict:o}).utc()},tt.unix=function(e){return tt(1e3*e)},tt.duration=function(e,t){var i,n,o,r=tt.isDuration(e),a="number"==typeof e,l=r?e._input:a?{}:e,d=null;return a?t?l[t]=e:l.milliseconds=e:(d=mt.exec(e))?(i="-"===d[1]?-1:1,l={y:0,d:_(d[at])*i,h:_(d[lt])*i,m:_(d[dt])*i,s:_(d[ut])*i,ms:_(d[ct])*i}):(d=_t.exec(e))&&(i="-"===d[1]?-1:1,o=function(e){var t=e&&parseFloat(e.replace(",","."));return(isNaN(t)?0:t)*i},l={y:o(d[2]),M:o(d[3]),d:o(d[4]),h:o(d[5]),m:o(d[6]),s:o(d[7]),w:o(d[8])}),n=new s(l),r&&e.hasOwnProperty("_lang")&&(n._lang=e._lang),n},tt.version=nt,tt.defaultFormat=Ct,tt.updateOffset=function(){},tt.lang=function(e,t){var i;return e?(t?T(x(e),t):null===t?(D(e),e="en"):ht[e]||S(e),i=tt.duration.fn._lang=tt.fn._lang=S(e),i._abbr):tt.fn._lang._abbr},tt.langData=function(e){return e&&e._lang&&e._lang._abbr&&(e=e._lang._abbr),S(e)},tt.isMoment=function(e){return e instanceof o},tt.isDuration=function(e){return e instanceof s},it=Et.length-1;it>=0;--it)m(Et[it]);for(tt.normalizeUnits=function(e){return f(e)},tt.invalid=function(e){var t=tt.utc(0/0);return null!=e?r(t._pf,e):t._pf.userInvalidated=!0,t},tt.parseZone=function(e){return tt(e).parseZone()},r(tt.fn=o.prototype,{clone:function(){return tt(this)},valueOf:function(){return+this._d+6e4*(this._offset||0)},unix:function(){return Math.floor(+this/1e3)},toString:function(){return this.clone().lang("en").format("ddd MMM DD YYYY HH:mm:ss [GMT]ZZ")},toDate:function(){return this._offset?new Date(+this):this._d},toISOString:function(){return C(tt(this).utc(),"YYYY-MM-DD[T]HH:mm:ss.SSS[Z]")},toArray:function(){var e=this;return[e.year(),e.month(),e.date(),e.hours(),e.minutes(),e.seconds(),e.milliseconds()]},isValid:function(){return k(this)},isDSTShifted:function(){return this._a?this.isValid()&&h(this._a,(this._isUTC?tt.utc(this._a):tt(this._a)).toArray())>0:!1},parsingFlags:function(){return r({},this._pf)},invalidAt:function(){return this._pf.overflow},utc:function(){return this.zone(0)},local:function(){return this.zone(0),this._isUTC=!1,this},format:function(e){var t=C(this,e||tt.defaultFormat);return this.lang().postformat(t)},add:function(e,t){var i;return i="string"==typeof e?tt.duration(+t,e):tt.duration(e,t),d(this,i,1),this},subtract:function(e,t){var i;return i="string"==typeof e?tt.duration(+t,e):tt.duration(e,t),d(this,i,-1),this},diff:function(e,t,i){var n,o,s=this._isUTC?tt(e).zone(this._offset||0):tt(e).local(),r=6e4*(this.zone()-s.zone());return t=f(t),"year"===t||"month"===t?(n=432e5*(this.daysInMonth()+s.daysInMonth()),o=12*(this.year()-s.year())+(this.month()-s.month()),o+=(this-tt(this).startOf("month")-(s-tt(s).startOf("month")))/n,o-=6e4*(this.zone()-tt(this).startOf("month").zone()-(s.zone()-tt(s).startOf("month").zone()))/n,"year"===t&&(o/=12)):(n=this-s,o="second"===t?n/1e3:"minute"===t?n/6e4:"hour"===t?n/36e5:"day"===t?(n-r)/864e5:"week"===t?(n-r)/6048e5:n),i?o:a(o)},from:function(e,t){return tt.duration(this.diff(e)).lang(this.lang()._abbr).humanize(!t)},fromNow:function(e){return this.from(tt(),e)},calendar:function(){var e=this.diff(tt().zone(this.zone()).startOf("day"),"days",!0),t=-6>e?"sameElse":-1>e?"lastWeek":0>e?"lastDay":1>e?"sameDay":2>e?"nextDay":7>e?"nextWeek":"sameElse";return this.format(this.lang().calendar(t,this))},isLeapYear:function(){return v(this.year())},isDST:function(){return this.zone()<this.clone().month(0).zone()||this.zone()<this.clone().month(5).zone()},day:function(e){var t=this._isUTC?this._d.getUTCDay():this._d.getDay();return null!=e?(e=R(e,this.lang()),this.add({d:e-t})):t},month:function(e){var t,i=this._isUTC?"UTC":"";return null!=e?"string"==typeof e&&(e=this.lang().monthsParse(e),"number"!=typeof e)?this:(t=this.date(),this.date(1),this._d["set"+i+"Month"](e),this.date(Math.min(t,this.daysInMonth())),tt.updateOffset(this),this):this._d["get"+i+"Month"]()},startOf:function(e){switch(e=f(e)){case"year":this.month(0);case"month":this.date(1);case"week":case"isoWeek":case"day":this.hours(0);case"hour":this.minutes(0);case"minute":this.seconds(0);case"second":this.milliseconds(0)}return"week"===e?this.weekday(0):"isoWeek"===e&&this.isoWeekday(1),this},endOf:function(e){return e=f(e),this.startOf(e).add("isoWeek"===e?"week":e,1).subtract("ms",1)},isAfter:function(e,t){return t="undefined"!=typeof t?t:"millisecond",+this.clone().startOf(t)>+tt(e).startOf(t)},isBefore:function(e,t){return t="undefined"!=typeof t?t:"millisecond",+this.clone().startOf(t)<+tt(e).startOf(t)},isSame:function(e,t){return t="undefined"!=typeof t?t:"millisecond",+this.clone().startOf(t)===+tt(e).startOf(t)},min:function(e){return e=tt.apply(null,arguments),this>e?this:e},max:function(e){return e=tt.apply(null,arguments),e>this?this:e},zone:function(e){var t=this._offset||0;return null==e?this._isUTC?t:this._d.getTimezoneOffset():("string"==typeof e&&(e=O(e)),Math.abs(e)<16&&(e=60*e),this._offset=e,this._isUTC=!0,t!==e&&d(this,tt.duration(t-e,"m"),1,!0),this)},zoneAbbr:function(){return this._isUTC?"UTC":""},zoneName:function(){return this._isUTC?"Coordinated Universal Time":""},parseZone:function(){return"string"==typeof this._i&&this.zone(this._i),this},hasAlignedHourOffset:function(e){return e=e?tt(e).zone():0,0===(this.zone()-e)%60},daysInMonth:function(){return g(this.year(),this.month())},dayOfYear:function(e){var t=ot((tt(this).startOf("day")-tt(this).startOf("year"))/864e5)+1;return null==e?t:this.add("d",e-t)},weekYear:function(e){var t=G(this,this.lang()._week.dow,this.lang()._week.doy).year;return null==e?t:this.add("y",e-t)},isoWeekYear:function(e){var t=G(this,1,4).year;return null==e?t:this.add("y",e-t)},week:function(e){var t=this.lang().week(this);return null==e?t:this.add("d",7*(e-t))},isoWeek:function(e){var t=G(this,1,4).week;return null==e?t:this.add("d",7*(e-t))},weekday:function(e){var t=(this.day()+7-this.lang()._week.dow)%7;return null==e?t:this.add("d",e-t)},isoWeekday:function(e){return null==e?this.day()||7:this.day(this.day()%7?e:e-7)},get:function(e){return e=f(e),this[e]()},set:function(e,t){return e=f(e),"function"==typeof this[e]&&this[e](t),this},lang:function(t){return t===e?this._lang:(this._lang=S(t),this)}}),it=0;it<qt.length;it++)Q(qt[it].toLowerCase().replace(/s$/,""),qt[it]);Q("year","FullYear"),tt.fn.days=tt.fn.day,tt.fn.months=tt.fn.month,tt.fn.weeks=tt.fn.week,tt.fn.isoWeeks=tt.fn.isoWeek,tt.fn.toJSON=tt.fn.toISOString,r(tt.duration.fn=s.prototype,{_bubble:function(){var e,t,i,n,o=this._milliseconds,s=this._days,r=this._months,l=this._data;l.milliseconds=o%1e3,e=a(o/1e3),l.seconds=e%60,t=a(e/60),l.minutes=t%60,i=a(t/60),l.hours=i%24,s+=a(i/24),l.days=s%30,r+=a(s/30),l.months=r%12,n=a(r/12),l.years=n},weeks:function(){return a(this.days()/7)},valueOf:function(){return this._milliseconds+864e5*this._days+2592e6*(this._months%12)+31536e6*_(this._months/12)},humanize:function(e){var t=+this,i=W(t,!e,this.lang());return e&&(i=this.lang().pastFuture(t,i)),this.lang().postformat(i)},add:function(e,t){var i=tt.duration(e,t);return this._milliseconds+=i._milliseconds,this._days+=i._days,this._months+=i._months,this._bubble(),this},subtract:function(e,t){var i=tt.duration(e,t);return this._milliseconds-=i._milliseconds,this._days-=i._days,this._months-=i._months,this._bubble(),this},get:function(e){return e=f(e),this[e.toLowerCase()+"s"]()},as:function(e){return e=f(e),this["as"+e.charAt(0).toUpperCase()+e.slice(1)+"s"]()},lang:tt.fn.lang,toIsoString:function(){var e=Math.abs(this.years()),t=Math.abs(this.months()),i=Math.abs(this.days()),n=Math.abs(this.hours()),o=Math.abs(this.minutes()),s=Math.abs(this.seconds()+this.milliseconds()/1e3);return this.asSeconds()?(this.asSeconds()<0?"-":"")+"P"+(e?e+"Y":"")+(t?t+"M":"")+(i?i+"D":"")+(n||o||s?"T":"")+(n?n+"H":"")+(o?o+"M":"")+(s?s+"S":""):"P0D"}});for(it in jt)jt.hasOwnProperty(it)&&(K(it,jt[it]),X(it.toLowerCase()));K("Weeks",6048e5),tt.duration.fn.asMonths=function(){return(+this-31536e6*this.years())/2592e6+12*this.years()},tt.lang("en",{ordinal:function(e){var t=e%10,i=1===_(e%100/10)?"th":1===t?"st":2===t?"nd":3===t?"rd":"th";return e+i}}),ft?(module.exports=tt,et()):"function"==typeof define&&define.amd?define("moment",["require","exports","module"],function(e,t,i){return i.config().noGlobal!==!0&&et(),tt}):et()}.call(this),define("modules/shoutbox/models/control",["underscore","backbone","models/app"],function(e,t,i){var n=t.Model.extend({defaults:{lastId:0,mar:0,notify:!1},initialize:function(){this._restore(["notify","mar"]),this.listenTo(this,"change:notify",this._onChangeNotify),i.commands.setHandler("shoutbox:mar",this._mar,this)},_mar:function(t){t=t||{},e.defaults(t,{silent:!1}),this.set({mar:this.get("lastId")},{silent:t.silent}),this._save("mar")},setLastId:function(e){e<=this.get("lastId")||this.set("lastId",e)},_onChangeNotify:function(){this._save("notify")},_onChangeMar:function(){this._save("mar")},_restore:function(t){e.isArray(t)&&e.each(t,function(e){this._restore(e)},this),i.reqres.request("app:localStorage:available")&&this.set(t,JSON.parse(localStorage.getItem("shoutbox-"+t)))},_save:function(e){i.reqres.request("app:localStorage:available")&&localStorage.setItem("shoutbox-"+e,JSON.stringify(this.get(e)))}});return new n}),define("text!modules/shoutbox/templates/shout.html",[],function(){return'<span class="username">\n    <a href="<%= user_url %>"><%= user_name %></a>:\n</span>\n<%= html %>\n'}),define("modules/shoutbox/views/shout",["jquery","underscore","backbone","marionette","models/app","modules/shoutbox/models/control","text!modules/shoutbox/templates/shout.html"],function(e,t,i,n,o,s,r){var a=n.ItemView.extend({className:"shout",initialize:function(e){this.webroot=e.webroot,this.listenTo(s,"change:mar",this.render)},serializeData:function(){var e=this.model.toJSON();e.user_url=this.webroot+"users/view/"+this.model.get("user_id");var t=this.model.get("id")>s.get("mar"),i=this.model.get("user_id")===o.currentUser.get("id");return i&&this.$el.addClass("shoutbox-shout-cu"),t&&!i?this.$el.addClass("shoutbox-shout-new"):this.$el.addClass("shoutbox-shout-old"),e},onRender:function(){s.setLastId(this.model.get("id"))},template:function(e){return t.template(r,e)}});return a}),define("modules/shoutbox/views/shouts",["jquery","underscore","backbone","marionette","moment","models/app","modules/shoutbox/views/shout","modules/shoutbox/models/control"],function(e,t,i,n,o,s,r,a){var l=n.CollectionView.extend({itemView:r,itemViewOptions:{},_Notifications:{_last:0,_models:[],_isEnabled:!1,init:function(e){this._currentUserId=e.currentUserId,this._isEnabled=e.isEnabled,this._last=e.last},add:function(e){this._isEnabled===!0&&this._currentUserId!==e.get("user_id")&&(e.get("id")<=this._last||this._models.push(e))},send:function(){0!==this._models.length&&(t.each(this._models,function(e){s.eventBus.trigger("html5-notification",{title:e.get("user_name"),message:e.get("text")})}),this._last=t.first(this._models).get("id"),this._models=[])}},_Delimiter:{_conversationCoolOff:300,_previousItemTime:null,tpl:t.template('<div class="infoText"><span title="<%= time_long %>"><%= time %></span></div>'),init:function(e){this.$el=e.$el},append:function(e){var t=o(e.model.get("time"));return this._itemTime=t,null===this._previousItemTime?(this._previousItemTime=t,void 0):(this._previousItemTime.unix()-t.unix()>this._conversationCoolOff?this._append(this._previousItemTime):this._append("<hr>"),this._previousItemTime=t,void 0)},finish:function(){this._previousItemTime=null,this._itemTime&&this._append(this._itemTime)},_append:function(e){var i=e;t.isObject(e)&&(i=this.tpl({time:e.format("LT"),time_long:e.format("llll")})),this.$el.append(i)
}},initialize:function(e){this.itemViewOptions.webroot=e.webroot,this._Delimiter.init({$el:this.$el}),this.setupNotifications(),this.listenTo(a,"change:notify",this.setupNotifications)},setupNotifications:function(){var e=0;this.collection.size()>0&&(e=this.collection.first().get("id")),this._Notifications.init({currentUserId:s.currentUser.get("id"),isEnabled:a.get("notify"),last:e})},onBeforeRender:function(){this.$el.html("")},onBeforeItemAdded:function(e){this._Delimiter.append(e)},onAfterItemAdded:function(e){this._Notifications.add(e.model)},onRender:function(){this._Delimiter.finish(),this._Notifications.send()}});return l}),define("text!modules/shoutbox/templates/add.html",[],function(){return'<form>\n    <textarea id="shoutbox-input" maxlength="255" rows="1"\n            placeholder="<%= placeholder %>"></textarea>\n</form>\n'}),define("modules/shoutbox/views/add",["jquery","underscore","backbone","marionette","models/app","modules/shoutbox/models/shout","text!modules/shoutbox/templates/add.html","jqueryAutosize"],function(e,t,i,n,o,s,r){var a=n.ItemView.extend({template:t.template(r),_placeholder:{a:e.i18n.__("Shout :shortcut",{shortcut:"⌃s"}),b:e.i18n.__("Hit enter to mark as read")},events:{"keyup form":"formUp","keydown form":"formDown","blur #shoutbox-input":"_setPlaceholder","focus #shoutbox-input":"_setPlaceholder"},submit:function(){this.model.save({text:this.textarea.val()},{success:t.bind(function(e,t){o.commands.execute("shoutbox:mar",{silent:!0}),this.collection.reset(t)},this)})},_setPlaceholder:function(){t.defer(t.bind(function(){var e;e=this.textarea.is(":focus")?this._placeholder.b:this._placeholder.a,this.textarea.attr("placeholder",e)},this))},_firefoxRowFix:function(){if(-1!==navigator.userAgent.toLowerCase().indexOf("firefox")){var e=parseFloat(this.textarea.css("line-height")),t=1*this.textarea.attr("rows");this.textarea.css("height",t*e)}},serializeData:function(){return{placeholder:this._placeholder.a}},clearForm:function(){this.textarea.val("").trigger("autosize.resize")},formDown:function(e){13===e.keyCode&&e.shiftKey===!1&&(e.preventDefault(),this.textarea.val().length>0?(this.submit(),this.clearForm()):o.commands.execute("shoutbox:mar"))},formUp:function(){this.textarea.val().length>0?o.eventBus.trigger("breakAutoreload"):0===this.textarea.val().length&&o.eventBus.trigger("initAutoreload")},onShow:function(){this.textarea=this.$("#shoutbox-input"),this._firefoxRowFix(),this.textarea.autosize(),this._setPlaceholder(),e(window).keydown(t.bind(function(e){e.ctrlKey===!0&&83===e.which&&this.textarea.focus()},this))}});return a}),define("text!modules/shoutbox/templates/control.html",[],function(){return"<label id='shoutbox-notify-label' for='shoutbox-notify' style=\"display: none;\">\n    <input id='shoutbox-notify' type='checkbox'>\n    <%- n %>\n</label>\n"}),define("modules/shoutbox/views/control",["jquery","underscore","backbone","marionette","models/app","modules/shoutbox/models/control","text!modules/shoutbox/templates/control.html"],function(e,t,i,n,o,s,r){var a=n.ItemView.extend({template:t.template(r),events:{"click #shoutbox-notify":"onChangeNotify"},initialize:function(){this.model=s},onRender:function(){this._putNotifyCheckbox()},serializeData:function(){return{n:e.i18n.__("Notification")}},_putNotifyCheckbox:function(){var e=o.reqres.request("app:html5-notification:available");e===!0&&(this.notify=this.$("#shoutbox-notify"),this.model.get("notify")?this.notify.attr("checked","checked"):this.notify.removeAttr("checked"),this.$("#shoutbox-notify-label").show())},onChangeNotify:function(){var e=this.notify.is(":checked");this.model.set("notify",e),e&&o.commands.execute("app:html5-notification:activate")}});return a}),define("text!modules/shoutbox/templates/layout.html",[],function(){return"<div>\n    <div id='shoutbox-add'></div>\n    <div id='shoutbox-shouts'></div>\n    <div id='shoutbox-control'></div>\n</div>\n"}),define("modules/shoutbox/shoutbox",["jquery","app/app","models/app","marionette","modules/shoutbox/collections/shouts","modules/shoutbox/models/shout","modules/shoutbox/views/shouts","modules/shoutbox/views/add","modules/shoutbox/views/control","text!modules/shoutbox/templates/layout.html"],function(e,t,i,n,o,s,r,a,l,d){var u=t.module("Shoutbox");return u.addInitializer(function(t){var u=t.SaitoApp.shouts,c=i.reqres.request("webroot"),h=i.reqres.request("apiroot");if(e("#shoutbox").length){var f={layout:null,shoutsCollection:null,initialize:function(){this.initLayout(),this.initShoutsCollection(),this.initAdd(),this.initShouts(),this.initControl()},initShoutsCollection:function(){this.shoutsCollection=new o(u,{apiroot:h});var e=_.bind(function(){var e=!i.reqres.request("slidetab:open","shoutbox");e||this.shoutsCollection.fetch()},this);i.eventBus.on("slidetab:open",_.bind(function(t){"shoutbox"===t.slidetab&&e()},this)),i.commands.setHandler("shoutbox:update",_.bind(function(t){var i=0;this.shoutsCollection.size()>0&&(i=this.shoutsCollection.at(0).get("id")),t!==i&&e()},this))},initLayout:function(){var e=n.Layout.extend({el:"#shoutbox",template:d,regions:{add:"#shoutbox-add",shouts:"#shoutbox-shouts",control:"#shoutbox-control"}});this.layout=new e,this.layout.render(),this.layout.$("#shoutbox-add").addClass("slidetab-header"),this.layout.$("#shoutbox-shouts").addClass("slidetab-content"),this.layout.$("#shoutbox-control").addClass("slidetab-footer")},initShouts:function(){var e=new r({collection:this.shoutsCollection,webroot:c});this.layout.shouts.show(e)},initControl:function(){var e=new l;this.layout.control.show(e)},initAdd:function(){var e=new s({},{urlRoot:h+"shouts/"});this.layout.add.show(new a({model:e,collection:this.shoutsCollection}))}};f.initialize()}}),u}),define("models/threadline",["underscore","backbone","models/app","cakeRest"],function(e,t,i,n){var o=t.Model.extend({defaults:{isInlineOpened:!1,shouldScrollOnInlineOpen:!0,isAlwaysShownInline:!1,isNewToUser:!1,posting:"",html:""},initialize:function(){this.webroot=i.settings.get("webroot")+"entries/",this.methodToCakePhpUrl=e.clone(this.methodToCakePhpUrl),this.methodToCakePhpUrl.read="threadLine/",this.set("isAlwaysShownInline",i.currentUser.get("user_show_inline")||!1),this.listenTo(this,"change:html",this._setIsNewToUser)},_setIsNewToUser:function(){this.set("isNewToUser","1"===$(this.get("html")).data("data-new"))}});return e.extend(o.prototype,n),o}),define("collections/threadlines",["underscore","backbone","models/threadline"],function(e,t,i){var n=t.Collection.extend({model:i});return n}),define("views/threadline-spinner",["jquery","underscore","backbone"],function(e,t,i){var n=i.View.extend({running:!1,show:function(){var e=t.bind(function(){return this.running===!1?(this.$el.css({opacity:1}),void 0):(this.$el.animate({opacity:.1},900,t.bind(function(){this.$el.animate({opacity:1},500,e())},this)),void 0)},this);this.running=!0,e()},hide:function(){this.running=!1}});return n}),define("text!templates/threadline-spinner.html",[],function(){return'<div class="js-thread_inline thread_inline" style="display:none">\n	<div class="js-btn-strip btn-strip btn-strip-top pointer">\n		<i class="fa fa-close-widget"></i>\n	</div>\n	<div class="threadInline-slider">\n	</div>\n</div>'}),define("views/postingActionBookmark",["jquery","underscore","marionette","models/app"],function(e,t,i,n){return i.ItemView.extend({tagName:"a",className:"btn-bookmark-add",template:t.template('<i class="fa fa-lg"></i>'),events:{click:"_onClick"},modelEvents:{"change:isBookmarked":"_toggle"},initialize:function(){this._shouldRender()&&(this.$el.attr("href","#"),this.render())},_shouldRender:function(){return n.currentUser.isLoggedIn()?!0:!1},_onClick:function(e){e.preventDefault(),this.model.get("isBookmarked")?window.location=n.settings.get("webroot")+"bookmarks/index/#"+this.model.get("id"):this.model.set("isBookmarked",!0)},_toggle:function(){var t=this.$("i");this.model.get("isBookmarked")?(t.removeClass("fa-bookmark-o"),t.addClass("fa-bookmark"),this.$el.attr("title",e.i18n.__("Entry is bookmarked"))):(t.removeClass("fa-bookmark"),t.addClass("fa-bookmark-o"),this.$el.attr("title",e.i18n.__("Bookmark the entry")))},onRender:function(){this._toggle()}})}),define("views/postingActionSolves",["jquery","marionette","models/app"],function(e,t,i){return t.ItemView.extend({tagName:"a",className:"btn-solves",template:_.template('<i class="fa fa-badge-solves-o fa-lg"></i>'),events:{click:"_onClick"},modelEvents:{"change:isSolves":"_toggle"},initialize:function(){this._shouldRender()&&(this.$el.attr({href:"#",title:e.i18n.__("Mark entry as helpful")}),this.render())},_shouldRender:function(){return i.currentUser.isLoggedIn()?this.model.isRoot()?!1:this.model.get("rootEntryUserId")!==i.currentUser.get("id")?!1:!0:!1},_onClick:function(e){e.preventDefault(),this.model.toggle("isSolves")},_toggle:function(){var t=this.$("i"),i=this.model.get("isSolves"),n="";i?(t.addClass("solves-isSolved"),t.removeClass("fa-badge-solves-o"),t.addClass("fa-badge-solves"),n=this.$el.html(),n=e(n).removeClass("fa-lg")):(t.removeClass("fa-badge-solves"),t.addClass("fa-badge-solves-o"),t.removeClass("solves-isSolved")),this._toggleGlobal(n)},_toggleGlobal:function(t){var i=e(".solves."+this.model.get("id"));i.html(t)},onRender:function(){this._toggle()}})}),define("views/editCountdown",["jquery","underscore","marionette","moment","jqueryTinyTimer"],function(e,t,i,n){return i.ItemView.extend({_editEnd:null,_buttonText:null,_$countdownDummy:null,_doneAction:"remove",initialize:function(t){this._editEnd=n(this.model.get("time")).unix()+60*t.editPeriod,n().unix()>this._editEnd||(t.done&&(this._doneAction=t.done),this._buttonText=this.$el.html(),this._$countdownDummy=e('<span style="display: none;"></span>'),this.$el.append(this._$countdownDummy),this._start())},_setButtonText:function(e){this.$el.text(this._buttonText+" "+e)},_onTick:function(e){e.m>1||1===e.m&&e.s>30?(e.m=e.m+1,this._setButtonText("("+e.m+" min)")):1===e.m?this._setButtonText("("+e.m+" min "+e.s+" s)"):this._setButtonText("("+e.s+" s)")},_onEnd:function(){switch(this._doneAction){case"disable":this._disable();break;default:this._remove()}},_remove:function(){this.remove()},_disable:function(){this.$el.attr("disabled","disabled")},_start:function(){this._$countdownDummy.tinyTimer({to:n.unix(this._editEnd).toDate(),format:"",onTick:t.bind(this._onTick,this),onEnd:t.bind(this._onEnd,this)})}})}),define("views/postingAction",["jquery","underscore","marionette","models/app","views/postingActionBookmark","views/postingActionSolves","views/editCountdown"],function(e,t,i,n,o,s,r){var a=i.ItemView.extend({events:{"click .js-btn-setAnsweringForm":"onBtnAnswer"},_jsButtons:[o,s],initialize:function(){this._initFormElements(),this.listenTo(this.model,"change:isAnsweringFormShown",this._toggleAnsweringForm)},_initFormElements:function(){t.each(this._jsButtons,function(e){this.$(".js-buttons").append(new e({model:this.model}).$el)},this);var e=this.$(".js-btn-edit");e.length>0&&new r({el:e,model:this.model,editPeriod:n.settings.get("editPeriod")})},onBtnAnswer:function(e){e.preventDefault(),this.model.set("isAnsweringFormShown",!0)},_toggleAnsweringForm:function(){this.model.get("isAnsweringFormShown")?this.$el.slideUp("fast"):this.$el.slideDown("fast")}});return a}),define("models/geshi",["underscore","backbone"],function(e,t){var i=t.Model.extend({defaults:{isPlaintext:!1}});return i}),define("collections/geshis",["underscore","backbone","models/geshi"],function(e,t,i){var n=t.Collection.extend({model:i});return n}),define("views/geshi",["jquery","underscore","backbone","models/geshi"],function(e,t,i,n){var o=i.View.extend({plainText:!1,htmlText:!1,events:{"click .geshi-plain-text":"_togglePlaintext"},initialize:function(){this.model=new n,this.collection.push(this.model),this.block=this.$(".geshi-plain-text").next(),this._setPlaintextButton(),this.listenTo(this.model,"change",this.render)},_setPlaintextButton:function(e){var t;e&&e.preventDefault(),t=this.model.get("isPlaintext")?"fa-list-ol":"fa-align-justify",this.$(".geshi-plain-text").html("<i class='fa "+t+"'></i>")},_togglePlaintext:function(e){e.preventDefault(),this.model.set("isPlaintext",!this.model.get("isPlaintext"))},_extractPlaintext:function(){this.plainText===!1&&(this.htmlText=this.block.html(),"Microsoft Internet Explorer"===navigator.appName?(this.htmlText=this.htmlText.replace(/\n\r/g,"+"),this.plainText=e(this.htmlText).text().replace(/\+\+/g,"\r")):this.plainText=this.block.text().replace(/code /g,"code \n"))},_renderText:function(){this.model.get("isPlaintext")?this.block.text(this.plainText).wrapInner('<pre class="code"></pre>'):this.block.html(this.htmlText)},render:function(){return this._setPlaintextButton(),this._extractPlaintext(),this._renderText(),this}});return o}),define("views/postingContent",["jquery","underscore","marionette","collections/geshis","views/geshi"],function(e,t,i,n,o){return i.ItemView.extend({initialize:function(){this.listenTo(this.model,"change:isAnsweringFormShown",this._toggleAnsweringForm),this.listenTo(this.model,"change:html",this.render),this._initGeshi(".c-bbcode-code-wrapper")},_toggleAnsweringForm:function(){this.model.get("isAnsweringFormShown")?this._hideSignature():this._showSignature()},_showSignature:function(){this.$(".signature").slideDown("fast")},_hideSignature:function(){this.$(".signature").slideUp("fast")},_initGeshi:function(e){var t=this.$(e);if(t.length>0){var i=new n;t.each(function(e,t){new o({el:t,collection:i})})}},render:function(){return this.$el.html(this.model.get("html")),this._initGeshi(".c-bbcode-code-wrapper"),this}})}),define("models/upload",["underscore","backbone","models/app","cakeRest"],function(e,t,i,n){var o=t.Model.extend({initialize:function(){this.webroot=i.settings.get("webroot")+"uploads/"}});return e.extend(o.prototype,n),o}),define("collections/uploads",["underscore","backbone","models/upload"],function(e,t,i){var n=t.Collection.extend({model:i,initialize:function(e){this.url=e.url+"uploads/index/"}});return n}),define("text!templates/upload.html",[],function(){return'<div>\n    <div class="upload_box_header">\n        <%= linkImage %>\n    </div>\n</div>\n<div>\n    <div class="l-box-footer box-footer-form upload_box_footer">\n        <button class="btn btn-submit">\n            <%- $.i18n.__(\'upload_btn_insert_into_posting\') %>\n        </button>\n        <div class="upload_box_delete">\n            <%= linkDelete %>\n        </div>\n    </div>\n</div>\n'}),function(e,t){"function"==typeof define&&define.amd?define("lib/saito/jquery.insertAtCaret",["jquery"],function(e){return t(e)}):t(jQuery)}(this,function(e){e.fn.insertAtCaret=function(e){var t,i=this[0],n=0,o=i.selectionStart||"0"===i.selectionStart?"standard":document.selection?"ie":!1;"ie"===o?(i.focus(),t=document.selection.createRange(),t.moveStart("character",-i.value.length),n=t.text.length):"standard"===o&&(n=i.selectionStart);var s=i.value.substring(0,n),r=i.value.substring(n,i.value.length);return i.value=s+e+r,n+=e.length,"ie"===o?(i.focus(),t=document.selection.createRange(),t.moveStart("character",-i.value.length),t.moveStart("character",n),t.moveEnd("character",0),t.select()):"standard"===o&&(i.selectionStart=n,i.selectionEnd=n,i.focus()),this}}),define("views/upload",["jquery","underscore","backbone","models/app","text!templates/upload.html","lib/saito/jquery.insertAtCaret"],function(e,t,i,n,o){var s=i.View.extend({className:"box-content upload_box current",events:{"click .upload_box_delete":"_removeUpload","click .btn-submit":"_insert"},initialize:function(e){this.textarea=e.textarea,this.listenTo(this.model,"destroy",this._uploadRemoved)},_removeUpload:function(e){e.preventDefault(),this.model.destroy({success:t.bind(function(e,t){n.eventBus.trigger("notification",t)},this)})},_uploadRemoved:function(){this.remove()},_insert:function(t){t.preventDefault(),e(this.textarea).insertAtCaret("[upload]"+this.model.get("name")+"[/upload]")},render:function(){return this.$el.html(t.template(o,this.model.toJSON())),this}});return s}),function(e){function t(){}jQuery.event.props.push("dataTransfer");var i,n,o={fallback_id:"",url:"",refresh:1e3,paramname:"userfile",allowedfiletypes:[],maxfiles:25,maxfilesize:1,queuefiles:0,queuewait:200,data:{},headers:{},drop:t,dragStart:t,dragEnter:t,dragOver:t,dragLeave:t,docEnter:t,docOver:t,docLeave:t,beforeEach:t,afterAll:t,rename:t,error:function(e){alert(e)},uploadStarted:t,uploadFinished:t,progressUpdated:t,globalProgressUpdated:t,speedUpdated:t},s=["BrowserNotSupported","TooManyFiles","FileTooLarge","FileTypeNotAllowed","NotFound","NotReadable","AbortError","ReadError"],r=!1,a=0;e.fn.filedrop=function(t){function l(e){return T.drop.call(this,e)===!1?!1:(n=e.dataTransfer.files,null===n||void 0===n||0===n.length?(T.error(s[0]),!1):(a=n.length,h(),e.preventDefault(),!1))}function d(t,i,n,o){var s="--",r="\r\n",a="";if(T.data){var l=e.param(T.data).replace(/\+/g,"%20").split(/&/);e.each(l,function(){var e=this.split("=",2),t=decodeURIComponent(e[0]),i=decodeURIComponent(e[1]);a+=s,a+=o,a+=r,a+='Content-Disposition: form-data; name="'+t+'"',a+=r,a+=r,a+=i,a+=r})}return a+=s,a+=o,a+=r,a+='Content-Disposition: form-data; name="'+T.paramname+'"',a+='; filename="'+t+'"',a+=r,a+="Content-Type: "+n,a+=r,a+=r,a+=i,a+=r,a+=s,a+=o,a+=s,a+=r}function u(e){if(e.lengthComputable){var t=Math.round(100*e.loaded/e.total);if(this.currentProgress!==t){this.currentProgress=t,T.progressUpdated(this.index,this.file,this.currentProgress),D[this.global_progress_index]=this.currentProgress,c();var i=(new Date).getTime(),n=i-this.currentStart;if(n>=T.refresh){var o=e.loaded-this.startData,s=o/n;T.speedUpdated(this.index,this.file,s),this.startData=e.loaded,this.currentStart=i}}}}function c(){if(0!==D.length){var e,t=0;for(e in D)D.hasOwnProperty(e)&&(t+=D[e]);T.globalProgressUpdated(Math.round(t/D.length))}}function h(){if(r=!1,!n)return T.error(s[0]),!1;if(T.allowedfiletypes.push&&T.allowedfiletypes.length)for(var t=n.length;t--;)if(!n[t].type||e.inArray(n[t].type,T.allowedfiletypes)<0)return T.error(s[3],n[t]),!1;var i=0,o=0;if(a>T.maxfiles&&0===T.queuefiles)return T.error(s[1]),!1;for(var l=[],h=[],g=[],b=0;a>b;b++)l.push(b);var v=function(e){setTimeout(w,e)},w=function(){var e;if(r)return!1;if(T.queuefiles>0&&h.length>=T.queuefiles)return v(T.queuewait);e=l[0],l.splice(0,1),h.push(e);try{if(m(n[e])!==!1){if(e===a)return;var t=new FileReader,i=1048576*T.maxfilesize;if(t.index=e,n[e].size>i)return T.error(s[2],n[e],e),h.forEach(function(t,i){t===e&&h.splice(i,1)}),o++,!0;t.onerror=function(e){switch(e.target.error.code){case e.target.error.NOT_FOUND_ERR:return T.error(s[4]),!1;case e.target.error.NOT_READABLE_ERR:return T.error(s[5]),!1;case e.target.error.ABORT_ERR:return T.error(s[6]),!1;default:return T.error(s[7]),!1}},t.onloadend=T.beforeSend?function(t){T.beforeSend(n[e],e,function(){y(t)})}:y,t.readAsBinaryString(n[e])}else o++}catch(d){return h.forEach(function(t,i){t===e&&h.splice(i,1)}),T.error(s[0]),!1}l.length>0&&w()},y=function(t){var s=("undefined"==typeof t.srcElement?t.target:t.srcElement).index;void 0===t.target.index&&(t.target.index=f(t.total));var l,m=new XMLHttpRequest,b=m.upload,v=n[t.target.index],w=t.target.index,y=(new Date).getTime(),k="------multipartformboundary"+(new Date).getTime(),x=D.length,S=p(v.name),M=v.type;T.withCredentials&&(m.withCredentials=T.withCredentials),l="string"==typeof S?d(S,t.target.result,M,k):d(v.name,t.target.result,M,k),b.index=w,b.file=v,b.downloadStartTime=y,b.currentStart=y,b.currentProgress=0,b.global_progress_index=x,b.startData=0,b.addEventListener("progress",u,!1),jQuery.isFunction(T.url)?m.open("POST",T.url(),!0):m.open("POST",T.url,!0),m.setRequestHeader("content-type","multipart/form-data; boundary="+k),e.each(T.headers,function(e,t){m.setRequestHeader(e,t)}),m.sendAsBinary(l),D[x]=0,c(),T.uploadStarted(w,v,a),m.onload=function(){var e=null;if(m.responseText)try{e=jQuery.parseJSON(m.responseText)}catch(t){e=m.responseText}var n=(new Date).getTime(),l=n-y,d=T.uploadFinished(w,v,e,l,m);i++,h.forEach(function(e,t){e===s&&h.splice(t,1)}),g.push(s),D[x]=100,c(),i===a-o&&_(),d===!1&&(r=!0),(m.status<200||m.status>299)&&T.error(m.statusText,v,s,m.status)}};w()}function f(e){for(var t=0;a>t;t++)if(n[t].size===e)return t;return void 0}function p(e){return T.rename(e)}function m(e){return T.beforeEach(e)}function _(){return T.afterAll()}function g(e){clearTimeout(i),e.preventDefault(),T.dragEnter.call(this,e)}function b(e){clearTimeout(i),e.preventDefault(),T.docOver.call(this,e),T.dragOver.call(this,e)}function v(e){clearTimeout(i),T.dragLeave.call(this,e),e.stopPropagation()}function w(e){return e.preventDefault(),T.docLeave.call(this,e),!1}function y(e){return clearTimeout(i),e.preventDefault(),T.docEnter.call(this,e),!1}function k(e){return clearTimeout(i),e.preventDefault(),T.docOver.call(this,e),!1}function x(e){i=setTimeout(function(t){return function(){T.docLeave.call(t,e)}}(this),200)}var T=e.extend({},o,t),D=[];return this.on("drop",l).on("dragstart",T.dragStart).on("dragenter",g).on("dragover",b).on("dragleave",v),e(document).on("drop",w).on("dragenter",y).on("dragover",k).on("dragleave",x),e("#"+T.fallback_id).change(function(e){T.drop(e),n=e.target.files,a=n.length,h()}),this};try{if(XMLHttpRequest.prototype.sendAsBinary)return;XMLHttpRequest.prototype.sendAsBinary=function(e){function t(e){return 255&e.charCodeAt(0)}var i=Array.prototype.map.call(e,t),n=new Uint8Array(i);this.send(n.buffer)}}catch(l){}}(jQuery),define("views/../../dev/vendors/jquery-filedrop/jquery.filedrop",function(){}),define("text!templates/uploadNew.html",[],function(){return'<form action="<%= url %>" method="post" class="dropbox" target="uploadIFrame"\n      enctype="multipart/form-data">\n    <div class="upload_box_header">\n        <div class="upload-layer">\n        </div>\n        <div class="upload-drag-indicator">\n            <i class="icon-upload"></i>\n        </div>\n        <h2> <%- $.i18n.__(\'upload_new_title\') %></h2>\n        <p>\n            <%- $.i18n.__(\'upload_info\', {size: upload_size}) %>\n        </p>\n    </div>\n    <div class="l-box-footer box-footer-form upload_box_footer">\n        <div style="position: relative;">\n            <%\n            // To present a nice upload button we generate a dead button.\n            // Beneath the nice dummy button is the actual input file upload,\n            // but it\'s hidden behind the opacity:0 curtain div.\n            // z-index: 2000 to have the button above the jQuery UI modal.\n            %>\n            <button class="btn btn-submit" type="button">\n                <%- $.i18n.__("upload_btn") %>\n            </button>\n            <div style="position: absolute; z-index: 2000; top:0; right: 0; width: 100%; height: 100%; opacity: 0; cursor: pointer; overflow: hidden; " >\n                <input id="Upload0File"\n                       class="btn btn-submit"\n                       type="file" name="data[Upload][0][file]"\n                       style="width: 150px; height: 100%">\n            </div>\n        </div>\n    </div>\n</form>\n<iframe id="uploadIFrame" name="uploadIFrame" src="about:blank" style="display: none;">\n    <html><head></head><body></body></html>\n</iframe>\n'}),define("text!templates/spinner.html",[],function(){return'<div class="spinner"></div>\n'}),define("views/uploadNew",["jquery","underscore","backbone","../../dev/vendors/jquery-filedrop/jquery.filedrop","models/app","text!templates/uploadNew.html","text!templates/spinner.html","humanize"],function(e,t,i,n,o,s,r,a){var l=i.View.extend({className:"box-content upload_box upload-new",wasChild:"unset",events:{"change #Upload0File":"_uploadManual"},initialize:function(e){this.uploadUrl=o.settings.get("webroot")+"uploads/add",this.collection=e.collection},_initDropUploader:function(){this._browserSupportsDragAndDrop()&&window.FileReader?this.$(".upload-layer").filedrop({maxfiles:1,maxfilesize:o.settings.get("upload_max_img_size")/1024,url:this.uploadUrl,paramname:"data[Upload][0][file]",allowedfiletypes:["image/jpeg","image/jpg","image/png","image/gif"],dragOver:t.bind(function(){this._showDragIndicator()},this),dragLeave:t.bind(function(){this._hideDragIndicator()},this),uploadFinished:t.bind(function(e,t,i){this._postUpload(i)},this),beforeSend:t.bind(function(e,t,i){this._hideDragIndicator(),this._setUploadSpinner(),i()},this),error:t.bind(function(t,i){var n;switch(this._hideDragIndicator(),t){case"FileTypeNotAllowed":n=e.i18n.__("upload_fileTypeNotAllowed");break;case"FileTooLarge":n=e.i18n.__("upload_fileToLarge",{name:i.name});break;case"BrowserNotSupported":n=e.i18n.__("upload_browserNotSupported");break;case"TooManyFiles":n=e.i18n.__("upload_toManyFiles");break;default:n=t}o.eventBus.trigger("notification",{title:"Error",message:n,type:"error"})},this)}):this.$("h2").html(e.i18n.__("Upload"))},_browserSupportsDragAndDrop:function(){var e=this.$(".upload-layer")[0];return"draggable"in e||"ondragstart"in e&&"ondrop"in e},_showDragIndicator:function(){this.$(".upload-drag-indicator").fadeIn()},_hideDragIndicator:function(){this.$(".upload-drag-indicator").fadeOut()},_setUploadSpinner:function(){this.$(".upload_box_header").html(r)},_uploadManual:function(e){var t,i,n=!0;e.preventDefault();try{t=new FormData,i=this.$("#Upload0File")[0],t.append(i.name,i.files[0])}catch(o){n=!1}this._setUploadSpinner(),n?this._uploadAjax(t):this._uploadIFrame()},_uploadIFrame:function(){var e=this.$("form"),i=this.$("#uploadIFrame");i.load(t.bind(function(){this._postUpload(i.contents().find("body").html()),i.off("load")},this)),e.submit()},_uploadAjax:function(e){var i=new XMLHttpRequest;i.open("POST",this.uploadUrl),i.onloadend=t.bind(function(e){this._postUpload(e.target.response)},this),i.onerror=this._onUploadError,i.send(e)},_onUploadError:function(){o.eventBus.trigger("notification",{type:"error",message:e.i18n.__("upload_genericError")})},_postUpload:function(e){if(t.isString(e))try{e=JSON.parse(e)}catch(i){this._onUploadError()}o.eventBus.trigger("notification",e),this.collection.fetch({reset:!0}),this.render()},render:function(){return this.$el.html(t.template(s)({url:this.uploadUrl,upload_size:a.filesize(o.settings.get("upload_max_img_size"))})),this._initDropUploader(),this}});return l}),define("text!templates/uploads.html",[],function(){return'<div id="upload_index" class="upload index">\n    <div class="content">\n    </div>\n</div>\n'}),define("views/uploads",["jquery","underscore","backbone","models/app","collections/uploads","views/upload","views/uploadNew","text!templates/uploads.html"],function(e,t,i,n,o,s,r,a){var l=i.View.extend({events:{"click .current .btn-submit":"_closeDialog"},initialize:function(e){this.textarea=e.textarea,this.collection=new o({url:n.settings.get("webroot")}),this.listenTo(this.collection,"reset",this._addAll),this.$(".body").html(t.template(a)),this.uploadNewView=new r({collection:this.collection}),this.$(".content").append(this.uploadNewView.el),this.render(),this.collection.fetch({reset:!0})},_addOne:function(e){var t=new s({model:e,textarea:this.textarea});this.$(".upload-new").after(t.render().el)},_addAll:function(){this._removeAll(),this.collection.each(this._addOne,this)},_removeAll:function(){this.$(".upload_box.current").remove()},_setDialogSize:function(){this.$el.dialog("option","width",window.innerWidth-80),this.$el.dialog("option","height",window.innerHeight-80)},_closeDialog:function(){this.$el.dialog("close")},render:function(){return this.uploadNewView.render(),this.$el.dialog({title:e.i18n.__("Upload"),modal:!0,draggable:!1,resizable:!1,position:[40,40],hide:"fade"}),this._setDialogSize(),e(window).resize(t.bind(function(){this._setDialogSize()},this)),window.onorientationchange=t.bind(function(){this._setDialogSize()},this),this}});return l}),define("lib/saito/markItUp.media",["jquery","underscore"],function(e,t){var i={cleanUp:function(e){return e=e.replace(/https:\/\/www\.dropbox\.com\//,"https://dl.dropbox.com/")}},n={rawUrlCleaner:[i],multimedia:function(i,o){var s=e.trim(i),r="([\\/?]|$)",a=new RegExp("\\.(png|gif|jpg|jpeg|webp)"+r,"i"),l=new RegExp("\\.(mp4|webm|m4v)"+r,"i"),d=new RegExp("\\.(m4a|ogg|mp3|wav|opus)"+r,"i"),u=/<object/i,c=/<iframe/i,h="";return o=o||{},t.defaults(o,{embedlyEnabled:!1}),t.each(this.rawUrlCleaner,function(e){s=e.cleanUp(s)}),h=a.test(s)?n._image(s):l.test(s)?n._videoHtml5(s):d.test(s)?n._audioHtml5(s):c.test(s)?n._videoIframe(s):u.test(s)?n._videoFlash(s):n._videoFallback(s),o.embedlyEnabled===!0&&""===h&&(h=n._embedly(s)),h},_image:function(e){return"[img]"+e+"[/img]"},_videoFlash:function(e){var t="[flash_video]URL|WIDTH|HEIGHT[/flash_video]";return null!==e?(t=t.replace("WIDTH",/width="(\d+)"/.exec(e)[1]),t=t.replace("HEIGHT",/height="(\d+)"/.exec(e)[1]),t=t.replace("URL",/src="([^"]+)"/.exec(e)[1])):""},_videoHtml5:function(e){return"[video]"+e+"[/video]"},_audioHtml5:function(e){return"[audio]"+e+"[/audio]"},_videoIframe:function(e){var t=/<iframe(.*?)>.*?<\/iframe>/i.exec(e)[1];return t=t.replace(/["']/g,""),"[iframe"+t+"][/iframe]"},_videoFallback:function(e){var t,i="";if(/http/.test(e)===!1&&(e="http://"+e),/(http|https):\/\/(\w+:{0,1}\w*@)?(\S+)(:[0-9]+)?(\/|\/([\w#!:.?+=&%@!\-\/]))?/i.test(e)){var o=e.match(/(https?:\/\/)?(www\.)?(.[^\/:]+)/i).pop();if("youtu.be"===o&&/youtu.be\/(.*?)(&.*)?$/.test(e))return t=e.match(/youtu.be\/(.*?)(&.*)?$/)[1],i=n._createIframe({url:"//www.youtube.com/embed/"+t}),i=n._videoIframe(i);if("youtube.com"===o)return/v=(.*?)(&.*)?$/.test(e)&&(t=e.match(/v=(.*?)(&.*)?$/)[1],i=n._createIframe({url:"//www.youtube.com/embed/"+t}),i=n._videoIframe(i)),i}return i},_embedly:function(e){return"[embed]"+e+"[/embed]"},_createIframe:function(e){return'<iframe src="'+e.url+'" width="425" height="349" frameborder="0" allowfullscreen></iframe>'}};return n}),define("text!templates/mediaInsert.html",[],function(){return'<form action="#" style="width: 100%;">\n    <label for="markitup_media_txta">\n        <%- $.i18n.__(\'Enter link to media or embedding code:\') %>\n    </label>\n    <textarea name="data[media]" id="markitup_media_txta"\n              class="c_markitup_popup_txta" rows="6" columns="20"></textarea>\n    <input class="btn btn-submit" id="markitup_media_btn" type="submit"\n           value="<%- $.i18n.__(\'Insert\') %>">\n    <div id="markitup_media_message" class="flash error" style="display: none;">\n        <%- $.i18n.__(\'Nothing recognized.\') %>\n    </div>\n</form>\n'}),define("views/mediaInsert",["jquery","underscore","backbone","models/app","lib/saito/markItUp.media","text!templates/mediaInsert.html"],function(e,t,i,n,o,s){return i.View.extend({template:t.template(s),events:{"click #markitup_media_btn":"_insert"},initialize:function(){void 0!==this.model&&null!==this.model&&this.listenTo(this.model,"change:isAnsweringFormShown",this.remove)},_insert:function(t){var i,s;t.preventDefault(),s=o,i=s.multimedia(this.$("#markitup_media_txta").val(),{embedlyEnabled:n.settings.get("embedly_enabled")===!0}),""===i?this._invalidInput():(e.markItUp({replaceWith:i}),this._closeDialog())},_hideErrorMessages:function(){this.$("#markitup_media_message").hide()},_invalidInput:function(){this.$("#markitup_media_message").show(),this.$el.dialog().parent().effect("shake",{times:2},250)},_closeDialog:function(){this.$el.dialog("close"),this._hideErrorMessages(),this.$("#markitup_media_txta").val("")},_showDialog:function(){this.$el.dialog({show:{effect:"scale",duration:200},hide:{effect:"fade",duration:200},title:e.i18n.__("Multimedia"),minWidth:346,position:{at:"left+50% top+40%"},resizable:!1,open:function(){setTimeout(function(){e("#markitup_media_txta").focus()},210)},close:t.bind(function(){this._hideErrorMessages()},this)})},render:function(){return this.$el.html(this.template),this._showDialog(),this}})}),define("models/preview",["underscore","backbone","models/app"],function(e,t,i){var n=t.Model.extend({defaults:{rendered:"",data:"",fetchingData:0},initialize:function(){this.webroot=i.settings.get("webroot"),this.listenTo(this,"change:data",this._fetchRendered)
},_fetchRendered:function(){this.set("fetchingData",1),$.post(this.webroot+"entries/preview/",this.get("data"),e.bind(function(e){this.set("fetchingData",0),this.set("rendered",e.html),i.eventBus.trigger("notificationUnset","all"),i.eventBus.trigger("notification",e)},this),"json")}});return n}),define("views/preview",["jquery","underscore","backbone","text!templates/spinner.html"],function(e,t,i,n){var o=i.View.extend({initialize:function(){this.render(),this.listenTo(this.model,"change:fetchingData",this._spinner),this.listenTo(this.model,"change:rendered",this.render)},_spinner:function(e){e.get("fetchingData")?this.$el.html(n):this.$el.html("")},render:function(){var e;return e=this.model.get("rendered"),e||(e=""),this.$el.html(e),this}});return o}),function(e){var t={_scrollToTop:function(t){e("body").animate({scrollTop:t.offset().top-10,easing:"swing"},300)},_scrollToBottom:function(i){e("body").animate({scrollTop:t._elementBottom(i)-e(window).height()+20,easing:"swing"},300,function(){t._isHeigherThanView(i)&&t._scrollToTop(i)})},_elementBottom:function(e){return e.offset().top+e.height()},_isScrolledIntoView:function(i){if(0===e(i).length)return!0;var n=e(window).scrollTop(),o=n+e(window).height(),s=e(i).offset().top,r=t._elementBottom(i);return o>=r&&s>=n},_isHeigherThanView:function(t){return e(window).height()<=t.height()}},i={top:function(){var i;return i=e(this),t._isScrolledIntoView(i)||t._scrollToTop(i),this},bottom:function(){var i;return i=e(this),t._isScrolledIntoView(i)||t._scrollToBottom(i),this},isInView:function(){var i;return i=e(this),t._isScrolledIntoView(i)}};e.fn.scrollIntoView=function(t){return i[t]?i[t].apply(this,Array.prototype.slice.call(arguments,1)):"object"!=typeof t&&t?(e.error("Method "+t+" does not exist on jQuery.scrollIntoView"),void 0):i.init.apply(this,arguments)}}(jQuery),define("lib/saito/jquery.scrollIntoView",function(){}),define("views/answering",["jquery","underscore","backbone","models/app","views/uploads","views/mediaInsert","views/editCountdown","models/preview","views/preview","lib/saito/jquery.scrollIntoView"],function(e,t,i,n,o,s,r,a,l){return i.View.extend({rendered:!1,answeringForm:!1,preview:!1,mediaView:!1,sendInProgress:!1,_action:null,model:null,events:{"click .btn-previewClose":"_closePreview","click .btn-preview":"_showPreview","click .btn-markItUp-Upload":"_upload","click .btn-markItUp-Media":"_media","click .btn-submit":"_send","click .btn-cite":"_cite","keypress .inp-subject":"_onKeyPressSubject"},initialize:function(e){this.parentThreadline=e.parentThreadline||null,this.parentThreadline||this._onFormReady(),this.listenTo(n.eventBus,"isAppVisible",this._focusSubject)},_cite:function(e){e.preventDefault();var t=this.$(".cite-container"),i=this.$(".btn-cite").data("text"),n=this.$textarea.val();this.$textarea.val(i+"\n\n"+n),t.slideToggle(),this.$textarea.focus()},_onKeyPressSubject:function(e){13===e.keyCode&&this._send(e)},_upload:function(e){var t;e&&e.preventDefault(),t=new o({el:"#markitup_upload",textarea:this.$textarea[0]})},_media:function(e){e.preventDefault(),this.mediaView===!1&&(this.mediaView=new s({el:"#markitup_media",model:this.model})),this.mediaView.render()},_showPreview:function(e){var t;e.preventDefault(),this.$(".preview").slideDown("fast"),this.preview===!1&&(t=new a,this.preview=new l({el:this.$(".preview .content"),model:t})),this.preview.model.set("data",this.$("form").serialize())},_closePreview:function(e){e.preventDefault(),this.$(".preview").slideUp("fast")},_setupTextArea:function(){this.$textarea=e("textarea#EntryText")},_requestAnsweringForm:function(){e.ajax({url:n.settings.get("webroot")+"entries/add/"+this.model.get("id"),success:t.bind(function(e){this.answeringForm=e,this.render()},this)})},_postRendering:function(){this.$el.scrollIntoView("bottom"),this._focusSubject(),this._onFormReady()},_onFormReady:function(){this._setupTextArea();var e=this.$(".js-data");if(e.length>0&&"edit"===e.data("meta").action){var t=this.$(".js-data").data("entry");this.model.set(t,{silent:!0}),this._addCountdown()}},_addCountdown:function(){var e=this.$(".js-btn-submit");new r({el:e,model:this.model,editPeriod:n.settings.get("editPeriod"),done:"disable"})},_focusSubject:function(){this.$(".postingform input[type=text]:first").focus()},_send:function(e){return this.sendInProgress?(e.preventDefault(),void 0):(this.sendInProgress=!0,this.parentThreadline?this._sendInline(e):this._sendRedirect(e),void 0)},_sendRedirect:function(i){var n=this.$(".btn-submit")[0];if(i.preventDefault(),"object"==typeof n.validity&&n.form.checkValidity()===!1){var o=t.bind(function(){this.checkValidityDummy||(this.checkValidityDummy=e("<button></button>",{type:"submit",style:"display: none;"}),e(n).after(this.checkValidityDummy)),this.checkValidityDummy.click()},this);o(),this.sendInProgress=!1}else n.disabled=!0,n.form.submit()},_sendInline:function(i){i.preventDefault(),e.ajax({url:n.settings.get("webroot")+"entries/add",type:"POST",dataType:"json",data:this.$("#EntryAddForm").serialize(),beforeSend:t.bind(function(){this.$(".btn.btn-submit").attr("disabled","disabled")},this),success:t.bind(function(e){this.model.set({isAnsweringFormShown:!1}),null!==this.parentThreadline&&this.parentThreadline.set("isInlineOpened",!1),n.eventBus.trigger("newEntry",{tid:e.tid,pid:this.model.get("id"),id:e.id})},this)})},render:function(){return this.answeringForm===!1?this._requestAnsweringForm():this.rendered===!1&&(this.rendered=!0,this.$el.html(this.answeringForm),t.defer(function(e){e._postRendering()},this)),this}})}),define("views/postingSlider",["jquery","marionette","models/app","views/answering","text!templates/spinner.html"],function(e,t,i,n,o){return t.ItemView.extend({answeringForm:!1,events:{"click .btn-answeringClose":"onBtnClose"},initialize:function(e){this.parentThreadline=e.parentThreadline||null,this.listenTo(this.model,"change:isAnsweringFormShown",this.toggleAnsweringForm)},onBtnClose:function(e){e.preventDefault(),this.model.set("isAnsweringFormShown",!1)},toggleAnsweringForm:function(){this.model.get("isAnsweringFormShown")?(this._hideAllAnsweringForms(),this._showAnsweringForm()):this._hideAnsweringForm()},_showAnsweringForm:function(){i.eventBus.trigger("breakAutoreload"),this.answeringForm===!1&&this.$el.html(o),this.$el.slideDown("fast"),this.answeringForm===!1&&(this.answeringForm=new n({el:this.$el,model:this.model,parentThreadline:this.parentThreadline})),this.answeringForm.render()},_hideAnsweringForm:function(){this.$el.slideUp("fast")},_hideAllAnsweringForms:function(){this.collection.forEach(function(e){e.get("id")!==this.model.get("id")&&e.set("isAnsweringFormShown",!1)},this)}})}),define("views/postingLayout",["underscore","marionette","views/postingAction","views/postingContent","views/postingSlider"],function(e,t,i,n,o){var s=t.Layout.extend({initialize:function(t){e.defaults(t,{inline:!1,parentThreadline:!1}),t.inline&&(this.model.fetchHtml(),this.$el.html(this.model.get("html")));var s=this.$(".js-data").data("entry");this.model.set(s,{silent:!0}),new n({el:this.$(".content"),model:this.model}),new i({el:this.$(".box-footer-form"),model:this.model}),new o({el:this.$(".posting_formular_slider"),model:this.model,collection:this.collection,parentThreadline:t.parentThreadline})}});return s}),function(e,t){"function"==typeof define&&define.amd?define("lib/saito/backbone.modelHelper",["underscore","backbone"],function(i,n){return t(i||e._,n||e.Backbone)}):t(_,Backbone)}(this,function(e,t){t.Model.prototype.toggle=function(e){this.set(e,!this.get(e))}}),define("models/posting",["underscore","backbone","models/app","lib/saito/backbone.modelHelper"],function(e,t,i){var n=t.Model.extend({defaults:{isBookmarked:!1,isSolves:!1,isAnsweringFormShown:!1,html:""},initialize:function(){this.listenTo(this,"change:isSolves",this.syncSolved),this.listenTo(this,"change:isBookmarked",this.syncBookmarked)},isRoot:function(){var t=this.get("pid");if(!e.isNumber(t))throw"pid is not a number.";return 0===t},syncBookmarked:function(){this.get("isBookmarked")&&$.ajax({url:i.settings.get("webroot")+"bookmarks/add",type:"POST",dataType:"json",data:"id="+this.get("id")})},syncSolved:function(){$.ajax({url:i.settings.get("webroot")+"entries/solve/"+this.get("id"),type:"POST",dateType:"json"})},fetchHtml:function(){$.ajax({success:e.bind(function(e){this.set("html",e)},this),type:"POST",async:!1,dateType:"html",url:i.settings.get("webroot")+"entries/view/"+this.get("id")})}});return n}),define("views/threadlines",["jquery","underscore","backbone","models/app","models/threadline","views/threadline-spinner","text!templates/threadline-spinner.html","views/postingLayout","models/posting","lib/saito/jquery.scrollIntoView"],function(e,t,i,n,o,s,r,a,l){var d=i.View.extend({className:"threadLeaf",tagName:"li",spinnerTpl:t.template(r),postings:null,events:{"click .btn_show_thread":"toggleInlineOpen","click .link_show_thread":"toggleInlineOpenFromLink"},initialize:function(e){this.postings=e.postings,this.model=new o({id:e.id}),void 0===e.el?this.model.fetch():this.model.set({html:this.el},{silent:!0}),this.collection.add(this.model,{silent:!0}),this.attributes={"data-id":e.id},this.listenTo(this.model,"change:isInlineOpened",this._toggleInlineOpened),this.listenTo(this.model,"change:html",this.render)},toggleInlineOpenFromLink:function(e){this.model.get("isAlwaysShownInline")&&this.toggleInlineOpen(e)},toggleInlineOpen:function(e){e.preventDefault(),this.model.get("isInlineOpened")?this.model.set({isInlineOpened:!1}):this.model.set({isInlineOpened:!0})},_toggleInlineOpened:function(e,i){if(i){var n=this.model.id;this.model.get("isContentLoaded")?this._showInlineView():(this.tlsV=new s({el:this.$el.find(".threadLine-pre i")}),this.tlsV.show(),this.$el.find(".threadLine").after(this.spinnerTpl({id:n})),this.$el.find(".js-btn-strip").on("click",t.bind(this.toggleInlineOpen,this)),this._insertContent())}else this._closeInlineView()},_insertContent:function(){var e,t;e=this.model.get("id"),this.postingModel=new l({id:e}),this.postings.add(this.postingModel),t=new a({el:this.$(".threadInline-slider"),inline:!0,model:this.postingModel,collection:this.postings,parentThreadline:this.model}),this.model.set("isContentLoaded",!0),this._showInlineView()},_showInlineView:function(){var e=t.bind(function(){var e=this.model.get("shouldScrollOnInlineOpen");this.tlsV.hide(),e?this.$el.scrollIntoView("isInView")===!1&&this.$el.scrollIntoView("bottom"):this.model.set("shouldScrollOnInlineOpen",!0)},this);this.$el.find(".threadLine").fadeOut(100,t.bind(function(){this.$(".js-thread_inline").show(0,e)},this))},_closeInlineView:function(){this.$(".js-thread_inline").hide(0,t.bind(function(){this.$el.find(".threadLine").slideDown(),this._scrollLineIntoView()},this))},_scrollLineIntoView:function(){var e=this.$(".threadLine");e.scrollIntoView("isInView")||e.scrollIntoView("top").effect("highlight",{times:1},3e3)},render:function(){var t,i,n;return i=this.model.get("html"),i.length>0&&(t=this.$el,n=e(this.model.get("html")),this.setElement(n),t.replaceWith(n)),this}});return d}),define("models/thread",["underscore","backbone","collections/threadlines"],function(e,t,i){var n=t.Model.extend({defaults:{isThreadCollapsed:!1},initialize:function(){this.threadlines=new i}});return n}),define("lib/saito/localStorageHelper",["underscore","app/vent"],function(e,t){var i=function(){};e.extend(i.prototype,{_available:null,available:function(){return null===this._available&&(this._available=this._isAvailable()),this._available},_isAvailable:function(){if(!("localStorage"in window))return!1;try{var e="localStorageAvailableTestKey",t=window.localStorage;return t.setItem(e,"1"),t.removeItem(e),!0}catch(i){return!1}return!1}});var n=new i;t.reqres.setHandler("app:localStorage:available",n.available,n)}),define("collections/threads",["underscore","backbone","backboneLocalStorage","models/thread","models/app","lib/saito/localStorageHelper"],function(e,t,i,n,o){var s=t.Collection.extend({model:n,localStorage:function(){return o.reqres.request("app:localStorage:available")?new i("Threads"):void 0}(),fetch:function(e){return o.reqres.request("app:localStorage:available")?t.Model.prototype.fetch.call(this,e):void 0}});return s}),define("views/thread",["jquery","underscore","backbone","models/app","collections/threadlines","views/threadlines"],function(e,t,i,n,o,s){var r=i.View.extend({className:"threadBox",events:{"click .btn-threadCollapse":"collapseThread","click .js-btn-openAllThreadlines":"openAllThreadlines","click .js-btn-closeAllThreadlines":"closeAllThreadlines","click .js-btn-showAllNewThreadlines":"showAllNewThreadlines"},initialize:function(t){this.postings=t.postings,this.$rootUl=this.$("ul.root"),this.$subThreadRootIl=e(this.$rootUl.find("li:not(:first-child)")[0]),this.model.get("isThreadCollapsed")?this.hide():this.show(),n.reqres.request("app:localStorage:available")||this._hideCollapseButton(),this.listenTo(n.eventBus,"newEntry",this._showNewThreadLine),this.listenTo(this.model,"change:isThreadCollapsed",this.toggleCollapseThread)},_showNewThreadLine:function(e){var t;e.tid===this.model.get("id")&&(t=new s({id:e.id,collection:this.model.threadlines,postings:this.postings}),this._appendThreadlineToThread(e.pid,t.render().$el))},_appendThreadlineToThread:function(e,t){var i,n;i=this.$('.threadLeaf[data-id="'+e+'"]'),n=i.next().not(".js_threadline").find("ul:first"),0===n.length?t.wrap('<ul class="threadTree-node"></ul>').parent().wrap("<li></li>").parent().insertAfter(i):n.append(t)},openAllThreadlines:function(e){e.preventDefault(),t.each(this.model.threadlines.where({isInlineOpened:!1}),function(e){e.set({isInlineOpened:!0,shouldScrollOnInlineOpen:!1})},this)},closeAllThreadlines:function(e){e&&e.preventDefault(),t.each(this.model.threadlines.where({isInlineOpened:!0}),function(e){e.set({isInlineOpened:!1})},this)},showAllNewThreadlines:function(e){e.preventDefault(),t.each(this.model.threadlines.where({isInlineOpened:!1,isNewToUser:!0}),function(e){e.set({isInlineOpened:!0,shouldScrollOnInlineOpen:!1})},this)},_hideCollapseButton:function(){this.$(".btn-threadCollapse").css("visibility","hidden")},collapseThread:function(e){e.preventDefault(),this.closeAllThreadlines(),this.model.toggle("isThreadCollapsed"),this.model.save()},toggleCollapseThread:function(e,t){t?this.slideUp():this.slideDown()},slideUp:function(){this.$subThreadRootIl.slideUp(300),this.markHidden()},slideDown:function(){this.$subThreadRootIl.slideDown(300),this.markShown()},hide:function(){this.$subThreadRootIl.hide(),this.markHidden()},show:function(){this.$subThreadRootIl.show(),this.markShown()},markShown:function(){e(this.el).find(".fa-thread-closed").removeClass("fa-thread-closed").addClass("fa-thread-open")},markHidden:function(){e(this.el).find(".fa-thread-open").removeClass("fa-thread-open").addClass("fa-thread-closed")}});return r}),define("collections/postings",["underscore","backbone","models/posting"],function(e,t,i){var n=t.Collection.extend({model:i});return n}),define("models/bookmark",["underscore","backbone","models/app","cakeRest"],function(e,t,i,n){var o=t.Model.extend({initialize:function(){this.webroot=i.settings.get("webroot")+"bookmarks/"}});return e.extend(o.prototype,n),o}),define("collections/bookmarks",["underscore","backbone","models/bookmark"],function(e,t,i){var n=t.Collection.extend({model:i});return n}),define("views/bookmark",["jquery","underscore","backbone"],function(e,t,i){var n=i.View.extend({events:{"click .btn-bookmark-delete":"deleteBookmark"},initialize:function(){t.bindAll(this,"render"),this.model.on("destroy",this.removeBookmark,this)},deleteBookmark:function(e){e.preventDefault(),this.model.destroy()},removeBookmark:function(){this.$el.hide("slide",null,500,function(){e(this).remove()})}});return n}),define("views/bookmarks",["jquery","underscore","backbone","views/bookmark"],function(e,t,i,n){var o=i.View.extend({initialize:function(){this.initCollectionFromDom(".js-bookmark",this.collection,n)}});return o}),define("views/helps",["jquery","underscore","backbone"],function(e,t,i){var n=i.View.extend({isHelpShown:!1,events:function(){var e={};return e["click "+this.indicatorName]="toggle",e},initialize:function(e){this.indicatorName=e.indicatorName,this.elementName=e.elementName,this.activateHelpButton(),this.placeHelp()},activateHelpButton:function(){this.isHelpOnPage()&&e(this.indicatorName).removeClass("no-color")},placeHelp:function(){for(var t={trigger:"manual",html:!0},i=["bottom","right","left"],n=0;n<i.length;n++)e(this.elementName+"-"+i[n]).popover(e.extend(t,{placement:i[n]}));e(this.indicatorName).popover({placement:"left",trigger:"manual"})},isHelpOnPage:function(){return this.$el.find(this.elementName).length>0},toggle:function(e){e.preventDefault(),this.isHelpShown?this.hide():this.show()},show:function(){this.isHelpShown=!0,this.isHelpOnPage()?e(this.elementName).popover("show"):e(this.indicatorName).popover("show")},hide:function(){this.isHelpShown=!1,e(this.elementName).popover("hide"),e(this.indicatorName).popover("hide")}});return n}),define("views/categoryChooser",["jquery","underscore","backbone"],function(e,t,i){return i.View.extend({initialize:function(){this.$el.dialog({autoOpen:!1,show:{effect:"scale",duration:200},hide:{effect:"fade",duration:200},width:400,position:[e("#btn-category-chooser").offset().left+e("#btn-category-chooser").width()-e(window).scrollLeft()-410,e("#btn-category-chooser").offset().top-e(window).scrollTop()+e("#btn-category-chooser").height()],title:e.i18n.__("Categories"),resizable:!1})},toggle:function(){this.$el.dialog("isOpen")?this.$el.dialog("close"):this.$el.dialog("open")}})}),define("models/slidetab",["underscore","backbone","app/vent","models/app"],function(e,t,i,n){var o=t.Model.extend({defaults:{isOpen:!1},initialize:function(){this.webroot=n.settings.get("webroot"),this.listenTo(this,"change:isOpen",this.onChangeIsOpen)},onChangeIsOpen:function(){i.vent.trigger("slidetab:open",{slidetab:this.get("id"),open:this.get("isOpen")})},sync:function(){$.ajax({url:this.webroot+"users/ajax_toggle/show_"+this.get("id")})}});return o}),define("collections/slidetabs",["underscore","backbone","models/app","models/slidetab"],function(e,t,i,n){var o=t.Collection.extend({model:n,initialize:function(){i.reqres.setHandler("slidetab:open",e.bind(this.isOpen,this))},isOpen:function(e){return this.get(e).get("isOpen")}});return o}),define("views/slidetab",["jquery","underscore","backbone"],function(e,t,i){var n=i.View.extend({events:{"click .slidetab-tab":"clickSlidetab"},initialize:function(e){this.collection=e.collection,this.model.set({isOpen:this.isOpen()},{silent:!0}),this.listenTo(this.model,"change",this.toggleSlidetab)},isOpen:function(){return this.$el.find(".slidetab-outer").is(":visible")},clickSlidetab:function(){this.model.save("isOpen",!this.model.get("isOpen"))},toggleSlidetab:function(){this.model.get("isOpen")?this.show():this.hide(),this.toggleSlidetabTabInfo()},show:function(){this.$el.animate({width:280}),this.$el.find(".slidetab-outer").css("display","block")},hide:function(){this.$el.animate({width:28},t.bind(function(){this.$el.find(".slidetab-outer").css("display","none")},this))},toggleSlidetabTabInfo:function(){this.$el.find(".slidetab-tab-info").toggle()}});return n}),define("views/slidetabs",["jquery","underscore","backbone","models/app","views/slidetab"],function(e,t,i,n,o){var s=i.View.extend({initialize:function(){this.webroot=n.settings.get("webroot"),this.initCollectionFromDom(".slidetab",this.collection,o),this.makeSortable()},makeSortable:function(){var i=this.webroot;this.$el.sortable({handle:".slidetab-tab",start:t.bind(function(){this.$el.css("overflow","visible")},this),stop:t.bind(function(){this.$el.css("overflow","hidden")},this),update:function(){var t=e(this).sortable("toArray",{attribute:"data-id"});t=t.map(function(e){return"slidetab_"+e}),e.ajax({type:"POST",url:i+"users/ajax_set",data:{data:{User:{slidetab_order:t}}},dataType:"json"})}})}});return s}),define("views/app",["jquery","underscore","backbone","models/app","collections/threadlines","views/threadlines","collections/threads","views/thread","collections/postings","models/posting","views/postingLayout","collections/bookmarks","views/bookmarks","views/helps","views/categoryChooser","collections/slidetabs","views/slidetabs","views/answering","jqueryUi"],function(e,t,i,n,o,s,r,a,l,d,u,c,h,f,p,m,_,g){var b=i.View.extend({el:e("body"),autoPageReloadTimer:!1,events:{"click #showLoginForm":"showLoginForm","focus #header-searchField":"widenSearchField","click #btn-scrollToTop":"scrollToTop","click #btn-manuallyMarkAsRead":"manuallyMarkAsRead","click #btn-category-chooser":"toggleCategoryChooser","click #btn_header_logo":"_onEntriesIndexReload"},initialize:function(){this.threads=new r,"entries"===n.request.controller&&"index"===n.request.action&&this.threads.fetch(),this.postings=new l,this.threadLines=new o,this.listenTo(n.eventBus,"initAutoreload",this.initAutoreload),this.listenTo(n.eventBus,"breakAutoreload",this.breakAutoreload),this.$el.on("dialogopen",this.fixJqueryUiDialog)},initFromDom:function(i){if(e(".threadBox").each(t.bind(function(t,i){var o,s;s=parseInt(e(i).attr("data-id"),10),this.threads.get(s)||this.threads.add([{id:s,isThreadCollapsed:"entries"===n.request.controller&&"index"===n.request.action&&n.currentUser.get("user_show_thread_collapsed")}],{silent:!0}),o=new a({el:e(i),postings:this.postings,model:this.threads.get(s)})},this)),e(".js-entry-view-core").each(t.bind(function(t,i){var n,o,s;n=parseInt(i.getAttribute("data-id"),10),s=new d({id:n}),this.postings.add(s,{silent:!0}),o=new u({el:e(i),model:this.postings.get(n),collection:this.postings})},this)),e(".threadLeaf").each(t.bind(function(t,i){var n,o,r,a;o=parseInt(i.getAttribute("data-tid"),10),a=this.threads.get(o)?this.threads.get(o).threadlines:this.threadLines,r=parseInt(i.getAttribute("data-id"),10),n=new s({el:e(i),id:r,postings:this.postings,collection:a})},this)),this.initAutoreload(),this.initBookmarks("#bookmarks"),this.initHelp(".shp"),this.initSlidetabs("#slidetabs"),this.initCategoryChooser("#category-chooser"),e(".entry.add-not-inline").length>0&&(this.answeringForm=new g({el:this.$(".entry.add-not-inline"),model:new d({id:"foo"})})),n.status.start(),this._showPage(i.SaitoApp.timeAppStart,i.contentTimer),n.eventBus.trigger("notification",i.SaitoApp),window.location.href.indexOf("/jump:")>-1){var o=/jump:(\d+)/.exec(window.location.href);this.scrollToThread(o[1]),window.history.replaceState("object or string","Title",window.location.pathname.replace(/jump:\d+(\/)?/,""))}},_showPage:function(t,i){var o=function(){n.eventBus.trigger("isAppVisible",!0)};n.request.isMobile||(new Date).getTime()-t>1500?(e("#content").css("visibility","visible"),o()):e("#content").css({visibility:"visible",opacity:0}).animate({opacity:1},{duration:150,easing:"easeInOutQuart",complete:o}),i.cancel()},fixJqueryUiDialog:function(){e(".ui-icon-closethick").attr("class","jqueryUi-closethick-fix").html("")},initBookmarks:function(t){var i;if(e(t).length){var n=new c;i=new h({el:t,collection:n})}},initSlidetabs:function(e){var t,i;t=new m,i=new _({el:e,collection:t})},initCategoryChooser:function(t){e(t).length>0&&(this.categoryChooser=new p({el:t}))},toggleCategoryChooser:function(){this.categoryChooser.toggle()},initHelp:function(e){new f({el:"body",elementName:e,indicatorName:"#shp-show"})},scrollToThread:function(t){e(".threadBox[data-id="+t+"]")[0].scrollIntoView("top")},initAutoreload:function(){this.breakAutoreload(),n.settings.get("autoPageReload")&&(this.autoPageReloadTimer=setTimeout(t.bind(function(){window.location=n.settings.get("webroot")+"entries/"},this),1e3*n.settings.get("autoPageReload")))},breakAutoreload:function(){this.autoPageReloadTimer!==!1&&(clearTimeout(this.autoPageReloadTimer),this.autoPageReloadTimer=!1)},widenSearchField:function(t){var i=350;t.preventDefault(),e(t.currentTarget).width()<i&&e(t.currentTarget).animate({width:i+"px"},"fast")},showLoginForm:function(t){var i;if(!navigator.userAgent.match(/iPhone/i)&&!navigator.userAgent.match(/iPod/i)){i=e("#modalLoginDialog"),t.preventDefault(),i.height("auto");var n=t.currentTarget.title;i.dialog({modal:!0,title:n,width:420,show:"fade",hide:"fade",position:["center",120],resizable:!1})}},scrollToTop:function(e){e.preventDefault(),window.scrollTo(0,0)},manuallyMarkAsRead:function(e){e&&e.preventDefault(),this._onEntriesIndexReload(),window.redirect(n.settings.get("webroot")+"entries/update")},_onEntriesIndexReload:function(){var e=n.request.controller,t=n.request.action;"entries"===e&&"index"===t&&n.commands.execute("shoutbox:mar",{silent:!0})}});return b}),function(e){var t,i,n,o=e(window),s={jqueryui:{container:"ui-widget ui-widget-content ui-corner-all",notice:"ui-state-highlight",notice_icon:"ui-icon ui-icon-info",info:"",info_icon:"ui-icon ui-icon-info",success:"ui-state-default",success_icon:"ui-icon ui-icon-circle-check",error:"ui-state-error",error_icon:"ui-icon ui-icon-alert",closer:"ui-icon ui-icon-close",pin_up:"ui-icon ui-icon-pin-w",pin_down:"ui-icon ui-icon-pin-s",hi_menu:"ui-state-default ui-corner-bottom",hi_btn:"ui-state-default ui-corner-all",hi_btnhov:"ui-state-hover",hi_hnd:"ui-icon ui-icon-grip-dotted-horizontal"},bootstrap:{container:"alert",notice:"",notice_icon:"icon-exclamation-sign",info:"alert-info",info_icon:"icon-info-sign",success:"alert-success",success_icon:"icon-ok-sign",error:"alert-error",error_icon:"icon-warning-sign",closer:"icon-remove",pin_up:"icon-pause",pin_down:"icon-play",hi_menu:"well",hi_btn:"btn",hi_btnhov:"",hi_hnd:"icon-chevron-down"}},r=function(){n=e("body"),o=e(window),o.bind("resize",function(){i&&clearTimeout(i),i=setTimeout(e.pnotify_position_all,10)})};document.body?r():e(r),e.extend({pnotify_remove_all:function(){var t=o.data("pnotify");t&&t.length&&e.each(t,function(){this.pnotify_remove&&this.pnotify_remove()})},pnotify_position_all:function(){i&&clearTimeout(i),i=null;var t=o.data("pnotify");t&&t.length&&(e.each(t,function(){var e=this.opts.stack;e&&(e.nextpos1=e.firstpos1,e.nextpos2=e.firstpos2,e.addpos2=0,e.animation=!0)}),e.each(t,function(){this.pnotify_position()}))},pnotify:function(r){var a,l;"object"!=typeof r?(l=e.extend({},e.pnotify.defaults),l.text=r):l=e.extend({},e.pnotify.defaults,r);for(var d in l)"string"==typeof d&&d.match(/^pnotify_/)&&(l[d.replace(/^pnotify_/,"")]=l[d]);if(l.before_init&&l.before_init(l)===!1)return null;var u,h=function(t,i){p.css("display","none");var n=document.elementFromPoint(t.clientX,t.clientY);p.css("display","block");var o=e(n),s=o.css("cursor");p.css("cursor","auto"!=s?s:"default"),u&&u.get(0)==n||(u&&(c.call(u.get(0),"mouseleave",t.originalEvent),c.call(u.get(0),"mouseout",t.originalEvent)),c.call(n,"mouseenter",t.originalEvent),c.call(n,"mouseover",t.originalEvent)),c.call(n,i,t.originalEvent),u=o},f=s[l.styling],p=e("<div />",{"class":"ui-pnotify "+l.addclass,css:{display:"none"},mouseenter:function(e){l.nonblock&&e.stopPropagation(),l.mouse_reset&&"out"==a&&(p.stop(!0),a="in",p.css("height","auto").animate({width:l.width,opacity:l.nonblock?l.nonblock_opacity:l.opacity},"fast")),l.nonblock&&p.animate({opacity:l.nonblock_opacity},"fast"),l.hide&&l.mouse_reset&&p.pnotify_cancel_remove(),l.sticker&&!l.nonblock&&p.sticker.trigger("pnotify_icon").css("visibility","visible"),l.closer&&!l.nonblock&&p.closer.css("visibility","visible")},mouseleave:function(t){l.nonblock&&t.stopPropagation(),u=null,p.css("cursor","auto"),l.nonblock&&"out"!=a&&p.animate({opacity:l.opacity},"fast"),l.hide&&l.mouse_reset&&p.pnotify_queue_remove(),l.sticker_hover&&p.sticker.css("visibility","hidden"),l.closer_hover&&p.closer.css("visibility","hidden"),e.pnotify_position_all()},mouseover:function(e){l.nonblock&&e.stopPropagation()},mouseout:function(e){l.nonblock&&e.stopPropagation()},mousemove:function(e){l.nonblock&&(e.stopPropagation(),h(e,"onmousemove"))},mousedown:function(e){l.nonblock&&(e.stopPropagation(),e.preventDefault(),h(e,"onmousedown"))},mouseup:function(e){l.nonblock&&(e.stopPropagation(),e.preventDefault(),h(e,"onmouseup"))},click:function(e){l.nonblock&&(e.stopPropagation(),h(e,"onclick"))},dblclick:function(e){l.nonblock&&(e.stopPropagation(),h(e,"ondblclick"))}});p.opts=l,p.container=e("<div />",{"class":f.container+" ui-pnotify-container "+("error"==l.type?f.error:"info"==l.type?f.info:"success"==l.type?f.success:f.notice)}).appendTo(p),""!=l.cornerclass&&p.container.removeClass("ui-corner-all").addClass(l.cornerclass),l.shadow&&p.container.addClass("ui-pnotify-shadow"),p.pnotify_version="1.2.0",p.pnotify=function(t){var i=l;"string"==typeof t?l.text=t:l=e.extend({},l,t);for(var n in l)"string"==typeof n&&n.match(/^pnotify_/)&&(l[n.replace(/^pnotify_/,"")]=l[n]);return p.opts=l,l.cornerclass!=i.cornerclass&&p.container.removeClass("ui-corner-all").addClass(l.cornerclass),l.shadow!=i.shadow&&(l.shadow?p.container.addClass("ui-pnotify-shadow"):p.container.removeClass("ui-pnotify-shadow")),l.addclass===!1?p.removeClass(i.addclass):l.addclass!==i.addclass&&p.removeClass(i.addclass).addClass(l.addclass),l.title===!1?p.title_container.slideUp("fast"):l.title!==i.title&&(l.title_escape?p.title_container.text(l.title).slideDown(200):p.title_container.html(l.title).slideDown(200)),l.text===!1?p.text_container.slideUp("fast"):l.text!==i.text&&(l.text_escape?p.text_container.text(l.text).slideDown(200):p.text_container.html(l.insert_brs?String(l.text).replace(/\n/g,"<br />"):l.text).slideDown(200)),p.pnotify_history=l.history,p.pnotify_hide=l.hide,l.type!=i.type&&p.container.removeClass(f.error+" "+f.notice+" "+f.success+" "+f.info).addClass("error"==l.type?f.error:"info"==l.type?f.info:"success"==l.type?f.success:f.notice),(l.icon!==i.icon||l.icon===!0&&l.type!=i.type)&&(p.container.find("div.ui-pnotify-icon").remove(),l.icon!==!1&&e("<div />",{"class":"ui-pnotify-icon"}).append(e("<span />",{"class":l.icon===!0?"error"==l.type?f.error_icon:"info"==l.type?f.info_icon:"success"==l.type?f.success_icon:f.notice_icon:l.icon})).prependTo(p.container)),l.width!==i.width&&p.animate({width:l.width}),l.min_height!==i.min_height&&p.container.animate({minHeight:l.min_height}),l.opacity!==i.opacity&&p.fadeTo(l.animate_speed,l.opacity),!l.closer||l.nonblock?p.closer.css("display","none"):p.closer.css("display","block"),!l.sticker||l.nonblock?p.sticker.css("display","none"):p.sticker.css("display","block"),p.sticker.trigger("pnotify_icon"),l.sticker_hover?p.sticker.css("visibility","hidden"):l.nonblock||p.sticker.css("visibility","visible"),l.closer_hover?p.closer.css("visibility","hidden"):l.nonblock||p.closer.css("visibility","visible"),l.hide?i.hide||p.pnotify_queue_remove():p.pnotify_cancel_remove(),p.pnotify_queue_position(),p},p.pnotify_position=function(e){var t=p.opts.stack;if(t){t.nextpos1||(t.nextpos1=t.firstpos1),t.nextpos2||(t.nextpos2=t.firstpos2),t.addpos2||(t.addpos2=0);var i="none"==p.css("display");if(!i||e){var n,s,r,a={};switch(t.dir1){case"down":r="top";break;case"up":r="bottom";break;case"left":r="right";break;case"right":r="left"}n=parseInt(p.css(r)),isNaN(n)&&(n=0),"undefined"!=typeof t.firstpos1||i||(t.firstpos1=n,t.nextpos1=t.firstpos1);var l;switch(t.dir2){case"down":l="top";break;case"up":l="bottom";break;case"left":l="right";break;case"right":l="left"}if(s=parseInt(p.css(l)),isNaN(s)&&(s=0),"undefined"!=typeof t.firstpos2||i||(t.firstpos2=s,t.nextpos2=t.firstpos2),("down"==t.dir1&&t.nextpos1+p.height()>o.height()||"up"==t.dir1&&t.nextpos1+p.height()>o.height()||"left"==t.dir1&&t.nextpos1+p.width()>o.width()||"right"==t.dir1&&t.nextpos1+p.width()>o.width())&&(t.nextpos1=t.firstpos1,t.nextpos2+=t.addpos2+("undefined"==typeof t.spacing2?25:t.spacing2),t.addpos2=0),t.animation&&t.nextpos2<s)switch(t.dir2){case"down":a.top=t.nextpos2+"px";break;case"up":a.bottom=t.nextpos2+"px";break;case"left":a.right=t.nextpos2+"px";break;case"right":a.left=t.nextpos2+"px"}else p.css(l,t.nextpos2+"px");switch(t.dir2){case"down":case"up":p.outerHeight(!0)>t.addpos2&&(t.addpos2=p.height());
break;case"left":case"right":p.outerWidth(!0)>t.addpos2&&(t.addpos2=p.width())}if(t.nextpos1)if(t.animation&&(n>t.nextpos1||a.top||a.bottom||a.right||a.left))switch(t.dir1){case"down":a.top=t.nextpos1+"px";break;case"up":a.bottom=t.nextpos1+"px";break;case"left":a.right=t.nextpos1+"px";break;case"right":a.left=t.nextpos1+"px"}else p.css(r,t.nextpos1+"px");switch((a.top||a.bottom||a.right||a.left)&&p.animate(a,{duration:500,queue:!1}),t.dir1){case"down":case"up":t.nextpos1+=p.height()+("undefined"==typeof t.spacing1?25:t.spacing1);break;case"left":case"right":t.nextpos1+=p.width()+("undefined"==typeof t.spacing1?25:t.spacing1)}}}},p.pnotify_queue_position=function(t){i&&clearTimeout(i),t||(t=10),i=setTimeout(e.pnotify_position_all,t)},p.pnotify_display=function(){p.parent().length||p.appendTo(n),l.before_open&&l.before_open(p)===!1||("top"!=l.stack.push&&p.pnotify_position(!0),"fade"==l.animation||"fade"==l.animation.effect_in?p.show().fadeTo(0,0).hide():1!=l.opacity&&p.show().fadeTo(0,l.opacity).hide(),p.animate_in(function(){l.after_open&&l.after_open(p),p.pnotify_queue_position(),l.hide&&p.pnotify_queue_remove()}))},p.pnotify_remove=function(){p.timer&&(window.clearTimeout(p.timer),p.timer=null),l.before_close&&l.before_close(p)===!1||p.animate_out(function(){l.after_close&&l.after_close(p)===!1||(p.pnotify_queue_position(),l.remove&&p.detach())})},p.animate_in=function(e){a="in";var t;t="undefined"!=typeof l.animation.effect_in?l.animation.effect_in:l.animation,"none"==t?(p.show(),e()):"show"==t?p.show(l.animate_speed,e):"fade"==t?p.show().fadeTo(l.animate_speed,l.opacity,e):"slide"==t?p.slideDown(l.animate_speed,e):"function"==typeof t?t("in",e,p):p.show(t,"object"==typeof l.animation.options_in?l.animation.options_in:{},l.animate_speed,e)},p.animate_out=function(e){a="out";var t;t="undefined"!=typeof l.animation.effect_out?l.animation.effect_out:l.animation,"none"==t?(p.hide(),e()):"show"==t?p.hide(l.animate_speed,e):"fade"==t?p.fadeOut(l.animate_speed,e):"slide"==t?p.slideUp(l.animate_speed,e):"function"==typeof t?t("out",e,p):p.hide(t,"object"==typeof l.animation.options_out?l.animation.options_out:{},l.animate_speed,e)},p.pnotify_cancel_remove=function(){p.timer&&window.clearTimeout(p.timer)},p.pnotify_queue_remove=function(){p.pnotify_cancel_remove(),p.timer=window.setTimeout(function(){p.pnotify_remove()},isNaN(l.delay)?0:l.delay)},p.closer=e("<div />",{"class":"ui-pnotify-closer",css:{cursor:"pointer",visibility:l.closer_hover?"hidden":"visible"},click:function(){p.pnotify_remove(),p.sticker.css("visibility","hidden"),p.closer.css("visibility","hidden")}}).append(e("<span />",{"class":f.closer})).appendTo(p.container),(!l.closer||l.nonblock)&&p.closer.css("display","none"),p.sticker=e("<div />",{"class":"ui-pnotify-sticker",css:{cursor:"pointer",visibility:l.sticker_hover?"hidden":"visible"},click:function(){l.hide=!l.hide,l.hide?p.pnotify_queue_remove():p.pnotify_cancel_remove(),e(this).trigger("pnotify_icon")}}).bind("pnotify_icon",function(){e(this).children().removeClass(f.pin_up+" "+f.pin_down).addClass(l.hide?f.pin_up:f.pin_down)}).append(e("<span />",{"class":f.pin_up})).appendTo(p.container),(!l.sticker||l.nonblock)&&p.sticker.css("display","none"),l.icon!==!1&&e("<div />",{"class":"ui-pnotify-icon"}).append(e("<span />",{"class":l.icon===!0?"error"==l.type?f.error_icon:"info"==l.type?f.info_icon:"success"==l.type?f.success_icon:f.notice_icon:l.icon})).prependTo(p.container),p.title_container=e("<h4 />",{"class":"ui-pnotify-title"}).appendTo(p.container),l.title===!1?p.title_container.hide():l.title_escape?p.title_container.text(l.title):p.title_container.html(l.title),p.text_container=e("<div />",{"class":"ui-pnotify-text"}).appendTo(p.container),l.text===!1?p.text_container.hide():l.text_escape?p.text_container.text(l.text):p.text_container.html(l.insert_brs?String(l.text).replace(/\n/g,"<br />"):l.text),"string"==typeof l.width&&p.css("width",l.width),"string"==typeof l.min_height&&p.container.css("min-height",l.min_height),p.pnotify_history=l.history,p.pnotify_hide=l.hide;var m=o.data("pnotify");if((null==m||"object"!=typeof m)&&(m=[]),m="top"==l.stack.push?e.merge([p],m):e.merge(m,[p]),o.data("pnotify",m),"top"==l.stack.push&&p.pnotify_queue_position(1),l.after_init&&l.after_init(p),l.history){var _=o.data("pnotify_history");if("undefined"==typeof _){_=e("<div />",{"class":"ui-pnotify-history-container "+f.hi_menu,mouseleave:function(){_.animate({top:"-"+t+"px"},{duration:100,queue:!1})}}).append(e("<div />",{"class":"ui-pnotify-history-header",text:"Redisplay"})).append(e("<button />",{"class":"ui-pnotify-history-all "+f.hi_btn,text:"All",mouseenter:function(){e(this).addClass(f.hi_btnhov)},mouseleave:function(){e(this).removeClass(f.hi_btnhov)},click:function(){return e.each(m,function(){this.pnotify_history&&(this.is(":visible")?this.pnotify_hide&&this.pnotify_queue_remove():this.pnotify_display&&this.pnotify_display())}),!1}})).append(e("<button />",{"class":"ui-pnotify-history-last "+f.hi_btn,text:"Last",mouseenter:function(){e(this).addClass(f.hi_btnhov)},mouseleave:function(){e(this).removeClass(f.hi_btnhov)},click:function(){var e,t=-1;do{if(e=-1==t?m.slice(t):m.slice(t,t+1),!e[0])break;t--}while(!e[0].pnotify_history||e[0].is(":visible"));return e[0]?(e[0].pnotify_display&&e[0].pnotify_display(),!1):!1}})).appendTo(n);var g=e("<span />",{"class":"ui-pnotify-history-pulldown "+f.hi_hnd,mouseenter:function(){_.animate({top:"0"},{duration:100,queue:!1})}}).appendTo(_);t=g.offset().top+2,_.css({top:"-"+t+"px"}),o.data("pnotify_history",_)}}return l.stack.animation=!1,p.pnotify_display(),p}});var a=/^on/,l=/^(dbl)?click$|^mouse(move|down|up|over|out|enter|leave)$|^contextmenu$/,d=/^(focus|blur|select|change|reset)$|^key(press|down|up)$/,u=/^(scroll|resize|(un)?load|abort|error)$/,c=function(t,i){var n;if(t=t.toLowerCase(),document.createEvent&&this.dispatchEvent){if(t=t.replace(a,""),t.match(l)?(e(this).offset(),n=document.createEvent("MouseEvents"),n.initMouseEvent(t,i.bubbles,i.cancelable,i.view,i.detail,i.screenX,i.screenY,i.clientX,i.clientY,i.ctrlKey,i.altKey,i.shiftKey,i.metaKey,i.button,i.relatedTarget)):t.match(d)?(n=document.createEvent("UIEvents"),n.initUIEvent(t,i.bubbles,i.cancelable,i.view,i.detail)):t.match(u)&&(n=document.createEvent("HTMLEvents"),n.initEvent(t,i.bubbles,i.cancelable)),!n)return;this.dispatchEvent(n)}else t.match(a)||(t="on"+t),n=document.createEventObject(i),this.fireEvent(t,n)};e.pnotify.defaults={title:!1,title_escape:!1,text:!1,text_escape:!1,styling:"bootstrap",addclass:"",cornerclass:"",nonblock:!1,nonblock_opacity:.2,history:!0,width:"300px",min_height:"16px",type:"notice",icon:!0,animation:"fade",animate_speed:"slow",opacity:1,shadow:!0,closer:!0,closer_hover:!0,sticker:!0,sticker_hover:!0,hide:!0,delay:8e3,mouse_reset:!0,remove:!0,insert_brs:!0,stack:{dir1:"down",dir2:"left",push:"bottom",spacing1:25,spacing2:25}}}(jQuery),define("views/../../dev/vendors/pnotify/jquery.pnotify",function(){}),define("views/notification",["jquery","underscore","backbone","models/app","../../dev/vendors/pnotify/jquery.pnotify"],function(e,t,i,n){var o=i.View.extend({initialize:function(){this.listenTo(n.eventBus,"notification",this._showMessages),this.listenTo(n.eventBus,"notificationUnset",this._unset)},_showMessages:function(e){if(void 0!==e){if(void 0===e.msg){if(void 0===e.message)return;e={msg:[e]}}else if(0===e.msg.length)return;t.each(e.msg,function(e){this._showMessage(e)},this)}},_showMessage:function(e){switch(e.channel=e.channel||"notification",e.channel){case"form":this._form(e);break;case"popover":this._popover(e);break;default:this._showNotification(e)}},_unset:function(t){"all"===t&&e(".error-message").remove()},_form:function(i){var n;n=t.template('<div class="error-message"><%= message %></div>'),e(i.element).after(n({message:i.message}))},_showNotification:function(t){var i,n;switch(n=5e3,i={title:t.title,text:t.message,icon:!1,history:!1,addclass:"flash",delay:n},t.type){case"success":i.addclass+=" flash-success";break;case"warning":i.addclass+=" flash-warning";break;case"error":i.addclass+=" flash-error",i.delay=2*n;break;default:i.addclass+=" flash-notice"}e.pnotify(i)}});return o}),define("views/prerequisitesTester",["jquery","marionette","models/app"],function(e,t,i){var n=t.ItemView.extend({_warningTpl:_.template('<div class="app-prerequisites-warning"> <%- warning %> </div>'),initialize:function(){this._testLocalStorage()},_testLocalStorage:function(){i.reqres.request("app:localStorage:available")||this._addWarning(e.i18n.__("This web-application depends on Cookies and localStorage. Please make those available in your browser."))},_addWarning:function(e){this.$el.append(this._warningTpl({warning:e}))}});return n}),function(e){"function"==typeof define&&define.amd?define("moment-de",["moment"],e):"object"==typeof exports?module.exports=e(require("../moment")):e(window.moment)}(function(e){function t(e,t,i){var n={m:["eine Minute","einer Minute"],h:["eine Stunde","einer Stunde"],d:["ein Tag","einem Tag"],dd:[e+" Tage",e+" Tagen"],M:["ein Monat","einem Monat"],MM:[e+" Monate",e+" Monaten"],y:["ein Jahr","einem Jahr"],yy:[e+" Jahre",e+" Jahren"]};return t?n[i][0]:n[i][1]}return e.lang("de",{months:"Januar_Februar_März_April_Mai_Juni_Juli_August_September_Oktober_November_Dezember".split("_"),monthsShort:"Jan._Febr._Mrz._Apr._Mai_Jun._Jul._Aug._Sept._Okt._Nov._Dez.".split("_"),weekdays:"Sonntag_Montag_Dienstag_Mittwoch_Donnerstag_Freitag_Samstag".split("_"),weekdaysShort:"So._Mo._Di._Mi._Do._Fr._Sa.".split("_"),weekdaysMin:"So_Mo_Di_Mi_Do_Fr_Sa".split("_"),longDateFormat:{LT:"H:mm [Uhr]",L:"DD.MM.YYYY",LL:"D. MMMM YYYY",LLL:"D. MMMM YYYY LT",LLLL:"dddd, D. MMMM YYYY LT"},calendar:{sameDay:"[Heute um] LT",sameElse:"L",nextDay:"[Morgen um] LT",nextWeek:"dddd [um] LT",lastDay:"[Gestern um] LT",lastWeek:"[letzten] dddd [um] LT"},relativeTime:{future:"in %s",past:"vor %s",s:"ein paar Sekunden",m:t,mm:"%d Minuten",h:t,hh:"%d Stunden",d:t,dd:t,M:t,MM:t,y:t,yy:t},ordinal:"%d.",week:{dow:1,doy:4}})}),define("app/time",["moment","moment-de"],function(e){var t=e().lang()._longDateFormat;t.LT="H:mm",e.lang("de",{longDateFormat:t})}),define("lib/Saito/isAppVisible",["jquery","underscore","models/app"],function(e,t,i){var n=function(){this.initialize.apply(this,arguments)};return t.extend(n.prototype,{_isVisibleOldSchool:!0,initialize:function(){i.reqres.setHandler("isAppVisible",this.isVisible,this),this._isVisibleOldSchool=this._isAppVisibleHtml5(),this._initAppVisibleOldSchool()},isVisible:function(){return this._isVisibleOldSchool},_initAppVisibleOldSchool:function(){e(window).blur(t.bind(function(){this._isVisibleOldSchool=!1},this)),e(window).focus(t.bind(function(){this._isVisibleOldSchool=!0},this))},_isAppVisibleHtml5:function(){var e,t=!1;return"undefined"!=typeof document.hidden?e="hidden":"undefined"!=typeof document.webkitHidden&&(e="webkitHidden"),document[e]&&(t=document[e]),!t}}),new n}),function(e){e.i18n={dict:null,setDictionary:function(e){this.dict=e},_:function(e,t){var i=e;return this.dict&&this.dict[e]&&(i=this.dict[e]),this.printf(i,t)},printf:function(e,t){if(!t)return e;for(var i="",n=/%(\d+)\$s/g,o=n.exec(e);o;){var s=parseInt(o[1],10)-1;e=e.replace("%"+o[1]+"$s",t[s]),o=n.exec(e)}var r=e.split("%s");if(r.length>1)for(var a=0;a<t.length;a++)r[a].length>0&&r[a].lastIndexOf("%")==r[a].length-1&&(r[a]+="s"+r.splice(a+1,1)[0]),i+=r[a]+t[a];return i+r[r.length-1]}},e.fn._t=function(t,i){return e(this).text(e.i18n._(t,i))}}(jQuery),define("lib/jquery.i18n/jquery.i18n",function(){}),define("lib/jquery.i18n/jquery.i18n.extend",["jquery","lib/jquery.i18n/jquery.i18n"],function(e){e.extend(e.i18n,{currentString:"",setDict:function(e){this.dict=e},setUrl:function(e){this.dictUrl=e,this._loadDict()},_loadDict:function(){return e.ajax({url:this.dictUrl,dataType:"json",async:!1,cache:!0,success:e.proxy(function(e){this.dict=e},this)})},__:function(e,t){var i=e;return"string"==typeof this.dict[e]&&""!==this.dict[e]&&(i=this.dict[e]),"object"==typeof t&&(i=this._insert(i,t)),i},_insert:function(e,t){return e.replace(/:([-\w]+)/g,function(e,i){return"undefined"!=typeof t[i]?t[i]:e})}})}),function(e,t){"function"==typeof define&&define.amd?define("lib/saito/backbone.initHelper",["underscore","backbone"],function(i,n){return t(i||e._,n||e.Backbone)}):t(_,Backbone)}(this,function(e,t){t.View.prototype.initCollectionFromDom=function(e,t,i){var n=function(e,t,n){e.add({id:t}),new i({el:n,model:e.get(t)})};$(e).each(function(){n(t,$(this).data("id"),this)})}}),define("app/app",["marionette","app/core","app/vent","modules/html5-notification/html5-notification"],function(e,t,i){var n=SaitoApp,o=function(e){require(["jquery","domReady"],function(t,i){t.isReady?e():i(function(){e()})})},s={bootstrapShoutbox:function(){o(function(){require(["modules/shoutbox/shoutbox"],function(e){e.start()})})},bootstrapApp:function(e){require(["domReady","views/app","backbone","jquery","models/app","views/notification","views/prerequisitesTester","modules/html5-notification/html5-notification","app/time","lib/Saito/isAppVisible","lib/jquery.i18n/jquery.i18n.extend","bootstrap","lib/saito/backbone.initHelper","lib/saito/backbone.modelHelper","fastclick"],function(t,i,r,a,l,d,u,c){var h,f,p;l.settings.set(e.SaitoApp.app.settings),a.i18n.setUrl(l.settings.get("webroot")+"da/langJs"),l.currentUser.set(e.SaitoApp.currentUser),l.request=e.SaitoApp.request,c.start(),new d,window.addEventListener("load",function(){new FastClick(document.body)},!1),p=new u({el:a(".app-prerequisites-warnings")}),h=new i,f=function(){"shouts"in n&&s.bootstrapShoutbox(),h.initFromDom({SaitoApp:e.SaitoApp,contentTimer:e.contentTimer})},o(f)})}},r=t;return r.addInitializer(s.bootstrapApp),r.start({contentTimer:contentTimer,SaitoApp:n}),i.reqres.setHandler("webroot",function(){return n.app.settings.webroot}),i.reqres.setHandler("apiroot",function(){return n.app.settings.webroot+"api/v1/"}),r}),require.config({paths:{common:"../dist/common",moment:"../dev/bower_components/momentjs/js/moment","moment-de":"../dev/bower_components/momentjs/lang/de"}}),function(e){e.contentTimer={show:function(){$("#content").css("visibility","visible"),console.warn("DOM ready timed out: show content fallback used."),delete this.timeoutID},setup:function(){this.cancel();var t=this;this.timeoutID=e.setTimeout(function(){t.show()},5e3)},cancel:function(){"number"==typeof this.timeoutID&&(e.clearTimeout(this.timeoutID),delete this.timeoutID)}},e.contentTimer.setup()}(window),require(["lib/bootstrapHelper","common"],function(){require(["app/app"])}),define("main",function(){});